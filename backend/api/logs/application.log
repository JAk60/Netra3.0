2025-08-06 23:50:22,857 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-06 23:50:22,904 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-06 23:50:22,920 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-06 23:50:22,920 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-06 23:50:22,920 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-06 23:50:22,921 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-06 23:50:22,921 - INFO - ‚úÖ Database connection established
2025-08-06 23:50:22,933 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-06 23:50:22,938 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-06 23:50:22,941 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-06 23:50:22,944 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-06 23:50:22,947 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-06 23:50:22,950 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-06 23:50:22,952 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-06 23:50:22,955 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-06 23:50:22,958 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-06 23:50:22,960 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-06 23:50:22,963 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-06 23:50:22,966 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-06 23:50:22,969 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-06 23:50:22,972 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-06 23:50:22,977 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-06 23:50:22,981 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:50:22,981 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-06 23:50:22,985 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-06 23:50:22,985 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-06 23:50:22,989 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:50:22,989 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-06 23:50:22,993 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:50:22,993 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-06 23:50:22,997 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:50:22,997 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-06 23:50:23,002 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-06 23:50:23,002 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-06 23:50:23,006 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-06 23:50:23,006 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-06 23:50:23,006 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-06 23:50:23,010 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-06 23:50:23,010 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-06 23:50:23,010 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-06 23:50:23,015 - DEBUG - üîó Foreign keys for ships: []
2025-08-06 23:50:23,019 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-06 23:50:23,019 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-06 23:50:23,019 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-06 23:50:23,019 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-06 23:50:23,019 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-06 23:50:23,024 - DEBUG - üîó Foreign keys for systems: []
2025-08-06 23:50:23,028 - DEBUG - üîó Foreign keys for users: []
2025-08-06 23:50:23,028 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-06 23:50:23,028 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-06 23:50:23,028 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-06 23:50:23,028 - DEBUG - üîç Relationship Details:
2025-08-06 23:50:23,028 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-06 23:50:23,028 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-06 23:50:23,028 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-06 23:50:23,028 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-06 23:50:23,028 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-06 23:50:23,028 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-06 23:50:23,028 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-06 23:50:23,028 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-06 23:50:23,028 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-06 23:50:23,029 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-06 23:50:23,029 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-06 23:50:23,029 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-06 23:50:23,029 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-06 23:50:23,029 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-06 23:50:23,029 - INFO - üìå Maritime system initialization complete.
2025-08-06 23:50:23,029 - INFO - ‚úÖ All global variables verified successfully
2025-08-06 23:52:38,470 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-06 23:52:38,603 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-06 23:52:38,603 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-06 23:52:38,603 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-06 23:52:38,780 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-06 23:52:39,011 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-06 23:52:39,027 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-06 23:52:39,027 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-06 23:52:39,042 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-06 23:52:39,042 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-06 23:52:39,057 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-06 23:52:39,058 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-06 23:52:39,058 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-06 23:52:39,067 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-06 23:52:39,067 - INFO - ‚úÖ Database connection established
2025-08-06 23:52:39,087 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-06 23:52:39,092 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-06 23:52:39,095 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-06 23:52:39,098 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-06 23:52:39,101 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-06 23:52:39,103 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-06 23:52:39,106 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-06 23:52:39,109 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-06 23:52:39,112 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-06 23:52:39,114 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-06 23:52:39,117 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-06 23:52:39,120 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-06 23:52:39,122 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-06 23:52:39,125 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-06 23:52:39,131 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-06 23:52:39,135 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:52:39,135 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-06 23:52:39,139 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-06 23:52:39,139 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-06 23:52:39,143 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:52:39,143 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-06 23:52:39,147 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:52:39,147 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-06 23:52:39,151 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:52:39,151 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-06 23:52:39,155 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-06 23:52:39,155 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-06 23:52:39,159 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-06 23:52:39,159 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-06 23:52:39,159 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-06 23:52:39,163 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-06 23:52:39,163 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-06 23:52:39,163 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-06 23:52:39,167 - DEBUG - üîó Foreign keys for ships: []
2025-08-06 23:52:39,171 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-06 23:52:39,172 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-06 23:52:39,172 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-06 23:52:39,172 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-06 23:52:39,172 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-06 23:52:39,176 - DEBUG - üîó Foreign keys for systems: []
2025-08-06 23:52:39,180 - DEBUG - üîó Foreign keys for users: []
2025-08-06 23:52:39,180 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-06 23:52:39,180 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-06 23:52:39,180 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-06 23:52:39,180 - DEBUG - üîç Relationship Details:
2025-08-06 23:52:39,180 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-06 23:52:39,180 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-06 23:52:39,180 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-06 23:52:39,180 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-06 23:52:39,180 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-06 23:52:39,180 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-06 23:52:39,180 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-06 23:52:39,180 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-06 23:52:39,180 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-06 23:52:39,180 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-06 23:52:39,180 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-06 23:52:39,180 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-06 23:52:39,180 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-06 23:52:39,181 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-06 23:52:39,181 - INFO - üìå Maritime system initialization complete.
2025-08-06 23:52:39,181 - INFO - ‚úÖ All global variables verified successfully
2025-08-06 23:52:39,182 - INFO - üìå Loaded conversation memory from disk.
2025-08-06 23:52:39,182 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-06 23:52:39,182 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-06 23:52:40,110 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-06 23:52:40,110 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-06 23:52:40,126 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-06 23:52:40,126 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-06 23:52:40,126 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-06 23:52:40,126 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-06 23:52:40,126 - INFO - ‚úÖ Database connection established
2025-08-06 23:52:40,139 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-06 23:52:40,144 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-06 23:52:40,147 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-06 23:52:40,149 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-06 23:52:40,152 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-06 23:52:40,155 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-06 23:52:40,157 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-06 23:52:40,161 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-06 23:52:40,164 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-06 23:52:40,166 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-06 23:52:40,169 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-06 23:52:40,172 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-06 23:52:40,174 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-06 23:52:40,177 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-06 23:52:40,182 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-06 23:52:40,186 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:52:40,186 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-06 23:52:40,190 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-06 23:52:40,190 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-06 23:52:40,194 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:52:40,194 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-06 23:52:40,198 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:52:40,198 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-06 23:52:40,203 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-06 23:52:40,203 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-06 23:52:40,207 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-06 23:52:40,207 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-06 23:52:40,211 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-06 23:52:40,211 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-06 23:52:40,211 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-06 23:52:40,215 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-06 23:52:40,215 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-06 23:52:40,215 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-06 23:52:40,219 - DEBUG - üîó Foreign keys for ships: []
2025-08-06 23:52:40,223 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-06 23:52:40,223 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-06 23:52:40,223 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-06 23:52:40,223 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-06 23:52:40,223 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-06 23:52:40,227 - DEBUG - üîó Foreign keys for systems: []
2025-08-06 23:52:40,231 - DEBUG - üîó Foreign keys for users: []
2025-08-06 23:52:40,231 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-06 23:52:40,231 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-06 23:52:40,231 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-06 23:52:40,231 - DEBUG - üîç Relationship Details:
2025-08-06 23:52:40,231 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-06 23:52:40,231 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-06 23:52:40,231 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-06 23:52:40,232 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-06 23:52:40,232 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-06 23:52:40,232 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-06 23:52:40,232 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-06 23:52:40,232 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-06 23:52:40,232 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-06 23:52:40,232 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-06 23:52:40,232 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-06 23:52:40,232 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-06 23:52:40,232 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-06 23:52:40,232 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-06 23:52:40,232 - INFO - üìå Maritime system initialization complete.
2025-08-06 23:52:40,232 - INFO - ‚úÖ All global variables verified successfully
2025-08-06 23:56:23,062 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-06 23:56:23,078 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-06 23:56:23,080 - INFO - Database engine created with pool_size=10
2025-08-06 23:56:23,171 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-06 23:56:23,173 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x742189d32210>
2025-08-06 23:56:23,173 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-06 23:56:23,173 - DEBUG - send_request_headers.complete
2025-08-06 23:56:23,173 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-06 23:56:23,173 - DEBUG - send_request_body.complete
2025-08-06 23:56:23,173 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-06 23:57:14,448 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 06 Aug 2025 18:27:14 GMT'), (b'Content-Length', b'475')])
2025-08-06 23:57:14,449 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-06 23:57:14,449 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-06 23:57:14,449 - DEBUG - receive_response_body.complete
2025-08-06 23:57:14,449 - DEBUG - response_closed.started
2025-08-06 23:57:14,449 - DEBUG - response_closed.complete
2025-08-06 23:57:14,449 - DEBUG - close.started
2025-08-06 23:57:14,449 - DEBUG - close.complete
2025-08-07 00:00:43,047 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:00:43,063 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 00:00:43,091 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 00:00:43,091 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x742189eaaed0>
2025-08-07 00:00:43,092 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 00:00:43,092 - DEBUG - send_request_headers.complete
2025-08-07 00:00:43,092 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 00:00:43,092 - DEBUG - send_request_body.complete
2025-08-07 00:00:43,092 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 00:00:44,360 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 06 Aug 2025 18:30:44 GMT'), (b'Content-Length', b'532')])
2025-08-07 00:00:44,360 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 00:00:44,360 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 00:00:44,361 - DEBUG - receive_response_body.complete
2025-08-07 00:00:44,361 - DEBUG - response_closed.started
2025-08-07 00:00:44,361 - DEBUG - response_closed.complete
2025-08-07 00:00:44,361 - DEBUG - close.started
2025-08-07 00:00:44,361 - DEBUG - close.complete
2025-08-07 00:25:58,905 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:25:58,922 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 00:25:59,493 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 00:25:59,493 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x742181d52e50>
2025-08-07 00:25:59,494 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 00:25:59,494 - DEBUG - send_request_headers.complete
2025-08-07 00:25:59,494 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 00:25:59,494 - DEBUG - send_request_body.complete
2025-08-07 00:25:59,494 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 00:26:49,745 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 06 Aug 2025 18:56:49 GMT'), (b'Content-Length', b'512')])
2025-08-07 00:26:49,745 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 00:26:49,745 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 00:26:49,745 - DEBUG - receive_response_body.complete
2025-08-07 00:26:49,746 - DEBUG - response_closed.started
2025-08-07 00:26:49,746 - DEBUG - response_closed.complete
2025-08-07 00:26:49,746 - DEBUG - close.started
2025-08-07 00:26:49,746 - DEBUG - close.complete
2025-08-07 00:31:00,743 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:31:00,760 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 00:31:00,878 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 00:31:00,879 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x74218bbc5cd0>
2025-08-07 00:31:00,879 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 00:31:00,880 - DEBUG - send_request_headers.complete
2025-08-07 00:31:00,880 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 00:31:00,880 - DEBUG - send_request_body.complete
2025-08-07 00:31:00,880 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 00:31:01,903 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Wed, 06 Aug 2025 19:01:01 GMT'), (b'Content-Length', b'506')])
2025-08-07 00:31:01,903 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 00:31:01,903 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 00:31:01,903 - DEBUG - receive_response_body.complete
2025-08-07 00:31:01,903 - DEBUG - response_closed.started
2025-08-07 00:31:01,904 - DEBUG - response_closed.complete
2025-08-07 00:31:01,904 - DEBUG - close.started
2025-08-07 00:31:01,904 - DEBUG - close.complete
2025-08-07 00:33:52,080 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 00:33:52,090 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 00:33:52,092 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 00:33:52,094 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 00:33:52,096 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 00:33:52,100 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 00:33:52,106 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 00:33:52,108 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 00:33:52,109 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 00:33:52,111 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 00:51:17,157 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 00:51:17,288 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 00:51:17,288 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 00:51:17,288 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 00:51:17,467 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 00:51:17,570 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:51:17,593 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:51:17,593 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:51:17,630 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 00:51:17,630 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:51:17,654 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 00:51:17,655 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:51:17,655 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 00:51:17,664 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 00:51:17,665 - INFO - ‚úÖ Database connection established
2025-08-07 00:51:17,794 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:51:17,800 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 00:51:17,803 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 00:51:17,806 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 00:51:17,809 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 00:51:17,812 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 00:51:17,815 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 00:51:17,818 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 00:51:17,821 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 00:51:17,823 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 00:51:17,826 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 00:51:17,830 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 00:51:17,832 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 00:51:17,836 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 00:51:17,842 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 00:51:17,846 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:51:17,846 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 00:51:17,851 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 00:51:17,851 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 00:51:17,855 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:51:17,855 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 00:51:17,859 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:51:17,859 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 00:51:17,864 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:51:17,864 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 00:51:17,869 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 00:51:17,869 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 00:51:17,873 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 00:51:17,873 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 00:51:17,873 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 00:51:17,877 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 00:51:17,877 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 00:51:17,877 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 00:51:17,882 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 00:51:17,886 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 00:51:17,886 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 00:51:17,886 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 00:51:17,886 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 00:51:17,886 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 00:51:17,890 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 00:51:17,895 - DEBUG - üîó Foreign keys for users: []
2025-08-07 00:51:17,895 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 00:51:17,895 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:51:17,895 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 00:51:17,895 - DEBUG - üîç Relationship Details:
2025-08-07 00:51:17,895 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:51:17,895 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 00:51:17,895 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:51:17,895 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 00:51:17,896 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 00:51:17,896 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 00:51:17,896 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 00:51:17,896 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 00:51:17,896 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 00:51:17,896 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 00:51:17,896 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 00:51:17,896 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 00:51:17,896 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 00:51:17,896 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 00:51:17,896 - INFO - üìå Maritime system initialization complete.
2025-08-07 00:51:17,896 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 00:51:17,897 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 00:51:17,898 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 00:51:17,898 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 00:51:18,381 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 00:51:18,381 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:51:18,397 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 00:51:18,397 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:51:18,397 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 00:51:18,397 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 00:51:18,397 - INFO - ‚úÖ Database connection established
2025-08-07 00:51:18,410 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:51:18,415 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 00:51:18,418 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 00:51:18,420 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 00:51:18,423 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 00:51:18,426 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 00:51:18,428 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 00:51:18,431 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 00:51:18,434 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 00:51:18,437 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 00:51:18,440 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 00:51:18,444 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 00:51:18,446 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 00:51:18,450 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 00:51:18,455 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 00:51:18,460 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:51:18,460 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 00:51:18,464 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 00:51:18,464 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 00:51:18,468 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:51:18,468 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 00:51:18,472 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:51:18,472 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 00:51:18,476 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:51:18,476 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 00:51:18,480 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 00:51:18,480 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 00:51:18,484 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 00:51:18,484 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 00:51:18,484 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 00:51:18,488 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 00:51:18,488 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 00:51:18,488 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 00:51:18,492 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 00:51:18,496 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 00:51:18,497 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 00:51:18,497 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 00:51:18,497 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 00:51:18,497 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 00:51:18,501 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 00:51:18,505 - DEBUG - üîó Foreign keys for users: []
2025-08-07 00:51:18,505 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 00:51:18,505 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:51:18,505 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 00:51:18,505 - DEBUG - üîç Relationship Details:
2025-08-07 00:51:18,505 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:51:18,505 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 00:51:18,505 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:51:18,505 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 00:51:18,505 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 00:51:18,505 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 00:51:18,506 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 00:51:18,506 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 00:51:18,506 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 00:51:18,506 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 00:51:18,506 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 00:51:18,506 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 00:51:18,506 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 00:51:18,506 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 00:51:18,506 - INFO - üìå Maritime system initialization complete.
2025-08-07 00:51:18,506 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 00:51:58,789 - INFO - Database engine created with pool_size=10
2025-08-07 00:51:58,829 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 00:51:58,839 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 00:51:58,840 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 00:51:58,842 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 00:51:58,844 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 00:51:58,847 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 00:51:58,853 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 00:51:58,855 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 00:51:58,857 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 00:51:58,859 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 00:52:19,416 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 00:52:19,422 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 00:52:19,424 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 00:52:19,426 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 00:52:19,428 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 00:52:19,431 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 00:52:19,437 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 00:52:19,439 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 00:52:19,441 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 00:52:19,443 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 00:57:43,686 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 00:57:43,842 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 00:57:43,843 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 00:57:43,843 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 00:57:44,014 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 00:57:44,379 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:57:44,396 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:57:44,396 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:57:44,411 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 00:57:44,411 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:57:44,426 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 00:57:44,426 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:57:44,426 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 00:57:44,435 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 00:57:44,435 - INFO - ‚úÖ Database connection established
2025-08-07 00:57:44,455 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:57:44,460 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 00:57:44,463 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 00:57:44,465 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 00:57:44,468 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 00:57:44,470 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 00:57:44,473 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 00:57:44,475 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 00:57:44,478 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 00:57:44,481 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 00:57:44,483 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 00:57:44,486 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 00:57:44,489 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 00:57:44,492 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 00:57:44,497 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 00:57:44,501 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:57:44,501 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 00:57:44,505 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 00:57:44,505 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 00:57:44,509 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:57:44,509 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 00:57:44,513 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:57:44,513 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 00:57:44,517 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:57:44,517 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 00:57:44,521 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 00:57:44,521 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 00:57:44,525 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 00:57:44,525 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 00:57:44,525 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 00:57:44,529 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 00:57:44,529 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 00:57:44,530 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 00:57:44,534 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 00:57:44,538 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 00:57:44,538 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 00:57:44,538 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 00:57:44,538 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 00:57:44,538 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 00:57:44,542 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 00:57:44,546 - DEBUG - üîó Foreign keys for users: []
2025-08-07 00:57:44,546 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 00:57:44,546 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:57:44,547 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 00:57:44,547 - DEBUG - üîç Relationship Details:
2025-08-07 00:57:44,547 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:57:44,547 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 00:57:44,547 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:57:44,547 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 00:57:44,547 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 00:57:44,547 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 00:57:44,547 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 00:57:44,547 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 00:57:44,547 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 00:57:44,547 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 00:57:44,547 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 00:57:44,547 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 00:57:44,548 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 00:57:44,548 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 00:57:44,548 - INFO - üìå Maritime system initialization complete.
2025-08-07 00:57:44,548 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 00:57:44,550 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 00:57:44,550 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 00:57:44,550 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 00:57:44,978 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 00:57:44,978 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:57:44,994 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 00:57:44,994 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:57:44,994 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 00:57:44,995 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 00:57:44,995 - INFO - ‚úÖ Database connection established
2025-08-07 00:57:45,007 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:57:45,011 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 00:57:45,014 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 00:57:45,016 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 00:57:45,019 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 00:57:45,022 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 00:57:45,024 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 00:57:45,027 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 00:57:45,030 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 00:57:45,033 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 00:57:45,035 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 00:57:45,038 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 00:57:45,041 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 00:57:45,044 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 00:57:45,049 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 00:57:45,053 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:57:45,053 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 00:57:45,057 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 00:57:45,057 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 00:57:45,061 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:57:45,061 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 00:57:45,065 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:57:45,065 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 00:57:45,069 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:57:45,069 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 00:57:45,073 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 00:57:45,073 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 00:57:45,077 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 00:57:45,077 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 00:57:45,077 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 00:57:45,081 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 00:57:45,082 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 00:57:45,082 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 00:57:45,086 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 00:57:45,090 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 00:57:45,090 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 00:57:45,090 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 00:57:45,090 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 00:57:45,090 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 00:57:45,094 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 00:57:45,098 - DEBUG - üîó Foreign keys for users: []
2025-08-07 00:57:45,098 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 00:57:45,098 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:57:45,098 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 00:57:45,098 - DEBUG - üîç Relationship Details:
2025-08-07 00:57:45,099 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:57:45,099 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 00:57:45,099 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:57:45,099 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 00:57:45,099 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 00:57:45,099 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 00:57:45,099 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 00:57:45,099 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 00:57:45,099 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 00:57:45,099 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 00:57:45,099 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 00:57:45,099 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 00:57:45,099 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 00:57:45,099 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 00:57:45,099 - INFO - üìå Maritime system initialization complete.
2025-08-07 00:57:45,099 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 00:57:46,880 - INFO - Database engine created with pool_size=10
2025-08-07 00:57:52,973 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 00:57:52,982 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 00:57:52,984 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 00:57:52,986 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 00:57:52,987 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 00:57:52,990 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 00:57:52,996 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 00:57:52,998 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 00:57:52,999 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 00:57:53,001 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 00:58:19,574 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 00:58:19,709 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 00:58:19,709 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 00:58:19,709 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 00:58:19,887 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 00:58:19,984 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:58:20,000 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:58:20,000 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:58:20,016 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 00:58:20,016 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:58:20,031 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 00:58:20,032 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:58:20,032 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 00:58:20,041 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 00:58:20,041 - INFO - ‚úÖ Database connection established
2025-08-07 00:58:20,061 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:58:20,067 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 00:58:20,070 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 00:58:20,073 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 00:58:20,075 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 00:58:20,078 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 00:58:20,081 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 00:58:20,084 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 00:58:20,087 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 00:58:20,089 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 00:58:20,092 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 00:58:20,095 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 00:58:20,098 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 00:58:20,101 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 00:58:20,107 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 00:58:20,111 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:58:20,111 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 00:58:20,115 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 00:58:20,115 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 00:58:20,119 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:58:20,119 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 00:58:20,123 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:58:20,123 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 00:58:20,127 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:58:20,127 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 00:58:20,131 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 00:58:20,131 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 00:58:20,135 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 00:58:20,135 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 00:58:20,135 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 00:58:20,140 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 00:58:20,140 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 00:58:20,140 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 00:58:20,144 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 00:58:20,148 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 00:58:20,148 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 00:58:20,148 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 00:58:20,148 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 00:58:20,148 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 00:58:20,152 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 00:58:20,156 - DEBUG - üîó Foreign keys for users: []
2025-08-07 00:58:20,156 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 00:58:20,157 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:58:20,157 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 00:58:20,157 - DEBUG - üîç Relationship Details:
2025-08-07 00:58:20,157 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,157 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 00:58:20,157 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,157 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,157 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,157 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 00:58:20,157 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,157 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 00:58:20,157 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,157 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 00:58:20,157 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 00:58:20,157 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 00:58:20,157 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 00:58:20,157 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 00:58:20,158 - INFO - üìå Maritime system initialization complete.
2025-08-07 00:58:20,158 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 00:58:20,160 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 00:58:20,160 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 00:58:20,160 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 00:58:20,394 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 00:58:20,394 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:58:20,411 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 00:58:20,411 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:58:20,411 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 00:58:20,412 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 00:58:20,412 - INFO - ‚úÖ Database connection established
2025-08-07 00:58:20,424 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:58:20,429 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 00:58:20,431 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 00:58:20,434 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 00:58:20,437 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 00:58:20,439 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 00:58:20,442 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 00:58:20,445 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 00:58:20,448 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 00:58:20,451 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 00:58:20,454 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 00:58:20,457 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 00:58:20,459 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 00:58:20,462 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 00:58:20,468 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 00:58:20,473 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:58:20,473 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 00:58:20,477 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 00:58:20,477 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 00:58:20,482 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:58:20,482 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 00:58:20,486 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:58:20,486 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 00:58:20,490 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:58:20,490 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 00:58:20,494 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 00:58:20,494 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 00:58:20,498 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 00:58:20,498 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 00:58:20,498 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 00:58:20,503 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 00:58:20,503 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 00:58:20,503 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 00:58:20,507 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 00:58:20,511 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 00:58:20,511 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 00:58:20,511 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 00:58:20,511 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 00:58:20,512 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 00:58:20,515 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 00:58:20,520 - DEBUG - üîó Foreign keys for users: []
2025-08-07 00:58:20,520 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 00:58:20,520 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:58:20,520 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 00:58:20,520 - DEBUG - üîç Relationship Details:
2025-08-07 00:58:20,520 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,520 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 00:58:20,520 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,520 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,520 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,520 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 00:58:20,520 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,520 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 00:58:20,520 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 00:58:20,520 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 00:58:20,520 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 00:58:20,520 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 00:58:20,520 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 00:58:20,520 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 00:58:20,520 - INFO - üìå Maritime system initialization complete.
2025-08-07 00:58:20,520 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 00:58:23,963 - INFO - Database engine created with pool_size=10
2025-08-07 00:58:30,392 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 00:58:30,403 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 00:58:30,404 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 00:58:30,406 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 00:58:30,408 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 00:58:30,411 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 00:58:30,417 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 00:58:30,418 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 00:58:30,420 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 00:58:30,421 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 00:59:58,105 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 00:59:58,240 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 00:59:58,240 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 00:59:58,240 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 00:59:58,415 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 00:59:58,511 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:59:58,528 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:59:58,528 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:59:58,544 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 00:59:58,544 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:59:58,559 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 00:59:58,559 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:59:58,559 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 00:59:58,569 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 00:59:58,569 - INFO - ‚úÖ Database connection established
2025-08-07 00:59:58,589 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:59:58,595 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 00:59:58,597 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 00:59:58,600 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 00:59:58,603 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 00:59:58,605 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 00:59:58,608 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 00:59:58,610 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 00:59:58,614 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 00:59:58,616 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 00:59:58,619 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 00:59:58,622 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 00:59:58,624 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 00:59:58,627 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 00:59:58,633 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 00:59:58,637 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:59:58,637 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 00:59:58,641 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 00:59:58,641 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 00:59:58,645 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:59:58,646 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 00:59:58,650 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:59:58,650 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 00:59:58,654 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:59:58,654 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 00:59:58,658 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 00:59:58,658 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 00:59:58,662 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 00:59:58,662 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 00:59:58,662 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 00:59:58,666 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 00:59:58,666 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 00:59:58,666 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 00:59:58,670 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 00:59:58,675 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 00:59:58,675 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 00:59:58,675 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 00:59:58,675 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 00:59:58,675 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 00:59:58,679 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 00:59:58,683 - DEBUG - üîó Foreign keys for users: []
2025-08-07 00:59:58,683 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 00:59:58,683 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:59:58,683 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 00:59:58,683 - DEBUG - üîç Relationship Details:
2025-08-07 00:59:58,683 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:59:58,683 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 00:59:58,683 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:59:58,683 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 00:59:58,683 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 00:59:58,683 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 00:59:58,683 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 00:59:58,684 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 00:59:58,684 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 00:59:58,684 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 00:59:58,684 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 00:59:58,684 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 00:59:58,684 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 00:59:58,684 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 00:59:58,684 - INFO - üìå Maritime system initialization complete.
2025-08-07 00:59:58,684 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 00:59:58,685 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 00:59:58,685 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 00:59:58,685 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 00:59:58,915 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 00:59:58,915 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 00:59:58,932 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 00:59:58,932 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 00:59:58,932 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 00:59:58,932 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 00:59:58,932 - INFO - ‚úÖ Database connection established
2025-08-07 00:59:58,945 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:59:58,949 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 00:59:58,952 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 00:59:58,955 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 00:59:58,958 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 00:59:58,960 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 00:59:58,963 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 00:59:58,966 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 00:59:58,969 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 00:59:58,972 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 00:59:58,974 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 00:59:58,977 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 00:59:58,980 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 00:59:58,983 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 00:59:58,988 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 00:59:58,992 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:59:58,992 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 00:59:58,997 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 00:59:58,997 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 00:59:59,001 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:59:59,001 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 00:59:59,005 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:59:59,005 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 00:59:59,009 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 00:59:59,009 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 00:59:59,013 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 00:59:59,013 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 00:59:59,017 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 00:59:59,017 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 00:59:59,017 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 00:59:59,022 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 00:59:59,022 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 00:59:59,022 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 00:59:59,026 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 00:59:59,030 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 00:59:59,030 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 00:59:59,030 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 00:59:59,030 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 00:59:59,030 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 00:59:59,035 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 00:59:59,039 - DEBUG - üîó Foreign keys for users: []
2025-08-07 00:59:59,039 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 00:59:59,039 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 00:59:59,039 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 00:59:59,039 - DEBUG - üîç Relationship Details:
2025-08-07 00:59:59,039 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:59:59,039 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 00:59:59,039 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 00:59:59,039 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 00:59:59,039 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 00:59:59,039 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 00:59:59,039 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 00:59:59,040 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 00:59:59,040 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 00:59:59,040 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 00:59:59,040 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 00:59:59,040 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 00:59:59,040 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 00:59:59,040 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 00:59:59,040 - INFO - üìå Maritime system initialization complete.
2025-08-07 00:59:59,040 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 01:00:06,242 - INFO - Database engine created with pool_size=10
2025-08-07 01:00:06,283 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 01:00:06,293 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:00:06,295 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:00:06,296 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:00:06,298 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:00:06,301 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 01:00:06,307 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:00:06,309 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:00:06,311 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:00:06,312 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:00:20,580 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 01:00:20,587 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:00:20,589 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:00:20,591 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:00:20,592 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:00:20,595 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 01:00:20,601 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:00:20,603 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:00:20,605 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:00:20,606 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:01:12,941 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 01:01:13,071 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 01:01:13,071 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 01:01:13,072 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 01:01:13,245 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 01:01:13,339 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:01:13,355 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:01:13,355 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:01:13,370 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 01:01:13,370 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:01:13,386 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 01:01:13,386 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:01:13,386 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 01:01:13,397 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 01:01:13,397 - INFO - ‚úÖ Database connection established
2025-08-07 01:01:13,417 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:01:13,422 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 01:01:13,425 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 01:01:13,428 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 01:01:13,430 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 01:01:13,433 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 01:01:13,435 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 01:01:13,438 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 01:01:13,441 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 01:01:13,444 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 01:01:13,447 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 01:01:13,450 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 01:01:13,453 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 01:01:13,456 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 01:01:13,461 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 01:01:13,465 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:01:13,465 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 01:01:13,469 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 01:01:13,469 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 01:01:13,473 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:01:13,473 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 01:01:13,477 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:01:13,478 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 01:01:13,481 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:01:13,481 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 01:01:13,485 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 01:01:13,486 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 01:01:13,490 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 01:01:13,490 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 01:01:13,490 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 01:01:13,494 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 01:01:13,494 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 01:01:13,494 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 01:01:13,498 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 01:01:13,502 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 01:01:13,502 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 01:01:13,502 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 01:01:13,502 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 01:01:13,502 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 01:01:13,506 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 01:01:13,511 - DEBUG - üîó Foreign keys for users: []
2025-08-07 01:01:13,511 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 01:01:13,511 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:01:13,511 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 01:01:13,511 - DEBUG - üîç Relationship Details:
2025-08-07 01:01:13,511 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,511 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 01:01:13,511 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,511 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,511 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,511 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 01:01:13,512 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,512 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 01:01:13,512 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,512 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 01:01:13,512 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 01:01:13,512 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 01:01:13,512 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 01:01:13,512 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 01:01:13,512 - INFO - üìå Maritime system initialization complete.
2025-08-07 01:01:13,512 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 01:01:13,514 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 01:01:13,514 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 01:01:13,515 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 01:01:13,742 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 01:01:13,742 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:01:13,758 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 01:01:13,758 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:01:13,758 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 01:01:13,759 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 01:01:13,759 - INFO - ‚úÖ Database connection established
2025-08-07 01:01:13,771 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:01:13,775 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 01:01:13,777 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 01:01:13,780 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 01:01:13,783 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 01:01:13,785 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 01:01:13,788 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 01:01:13,790 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 01:01:13,793 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 01:01:13,796 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 01:01:13,799 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 01:01:13,802 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 01:01:13,804 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 01:01:13,807 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 01:01:13,846 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 01:01:13,850 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:01:13,850 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 01:01:13,854 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 01:01:13,854 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 01:01:13,858 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:01:13,858 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 01:01:13,862 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:01:13,862 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 01:01:13,866 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:01:13,866 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 01:01:13,870 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 01:01:13,870 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 01:01:13,874 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 01:01:13,874 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 01:01:13,874 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 01:01:13,878 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 01:01:13,878 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 01:01:13,878 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 01:01:13,882 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 01:01:13,886 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 01:01:13,886 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 01:01:13,886 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 01:01:13,886 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 01:01:13,887 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 01:01:13,890 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 01:01:13,894 - DEBUG - üîó Foreign keys for users: []
2025-08-07 01:01:13,895 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 01:01:13,895 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:01:13,895 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 01:01:13,895 - DEBUG - üîç Relationship Details:
2025-08-07 01:01:13,895 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,895 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 01:01:13,895 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,895 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,895 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,895 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 01:01:13,895 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,895 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 01:01:13,895 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 01:01:13,895 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 01:01:13,895 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 01:01:13,895 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 01:01:13,895 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 01:01:13,895 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 01:01:13,895 - INFO - üìå Maritime system initialization complete.
2025-08-07 01:01:13,895 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 01:01:18,517 - INFO - Database engine created with pool_size=10
2025-08-07 01:01:18,560 - INFO - Retrieved 4 systems for ship ID: 53f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 01:01:18,571 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:01:18,573 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:01:18,574 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:01:18,576 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:01:18,579 - INFO - Retrieved 4 systems for ship ID: 53f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 01:01:18,585 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:01:18,587 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:01:18,588 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:01:18,590 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:01:31,206 - INFO - Retrieved 4 systems for ship ID: 53f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 01:01:31,213 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:01:31,215 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:01:31,217 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:01:31,219 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:01:31,223 - INFO - Retrieved 4 systems for ship ID: 53f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 01:01:31,229 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:01:31,231 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:01:31,233 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:01:31,235 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:08:19,084 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 01:08:19,214 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 01:08:19,214 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 01:08:19,214 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 01:08:19,388 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 01:08:19,481 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:08:19,498 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:08:19,498 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:08:19,513 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 01:08:19,513 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:08:19,528 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 01:08:19,528 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:08:19,528 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 01:08:19,537 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 01:08:19,537 - INFO - ‚úÖ Database connection established
2025-08-07 01:08:19,557 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:08:19,563 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 01:08:19,566 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 01:08:19,569 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 01:08:19,571 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 01:08:19,574 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 01:08:19,576 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 01:08:19,579 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 01:08:19,582 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 01:08:19,585 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 01:08:19,588 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 01:08:19,591 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 01:08:19,593 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 01:08:19,596 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 01:08:19,602 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 01:08:19,606 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:08:19,606 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 01:08:19,610 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 01:08:19,610 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 01:08:19,614 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:08:19,614 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 01:08:19,619 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:08:19,619 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 01:08:19,623 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:08:19,623 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 01:08:19,627 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 01:08:19,627 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 01:08:19,631 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 01:08:19,631 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 01:08:19,631 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 01:08:19,636 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 01:08:19,636 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 01:08:19,636 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 01:08:19,640 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 01:08:19,644 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 01:08:19,644 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 01:08:19,644 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 01:08:19,644 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 01:08:19,644 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 01:08:19,648 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 01:08:19,653 - DEBUG - üîó Foreign keys for users: []
2025-08-07 01:08:19,653 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 01:08:19,653 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:08:19,653 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 01:08:19,653 - DEBUG - üîç Relationship Details:
2025-08-07 01:08:19,653 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:08:19,653 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 01:08:19,653 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:08:19,653 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 01:08:19,653 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 01:08:19,653 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 01:08:19,653 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 01:08:19,653 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 01:08:19,653 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 01:08:19,653 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 01:08:19,653 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 01:08:19,653 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 01:08:19,654 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 01:08:19,654 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 01:08:19,654 - INFO - üìå Maritime system initialization complete.
2025-08-07 01:08:19,654 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 01:08:19,655 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 01:08:19,655 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 01:08:19,655 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 01:08:19,881 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 01:08:19,881 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:08:19,897 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 01:08:19,897 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:08:19,897 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 01:08:19,897 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 01:08:19,897 - INFO - ‚úÖ Database connection established
2025-08-07 01:08:19,910 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:08:19,915 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 01:08:19,917 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 01:08:19,920 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 01:08:19,923 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 01:08:19,925 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 01:08:19,928 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 01:08:19,930 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 01:08:19,933 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 01:08:19,936 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 01:08:19,938 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 01:08:19,941 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 01:08:19,944 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 01:08:19,947 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 01:08:19,952 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 01:08:19,956 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:08:19,956 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 01:08:19,960 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 01:08:19,960 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 01:08:19,964 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:08:19,964 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 01:08:19,968 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:08:19,968 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 01:08:19,972 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:08:19,972 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 01:08:19,976 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 01:08:19,976 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 01:08:19,980 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 01:08:19,980 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 01:08:19,980 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 01:08:19,985 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 01:08:19,985 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 01:08:19,985 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 01:08:19,989 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 01:08:19,993 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 01:08:19,993 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 01:08:19,993 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 01:08:19,993 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 01:08:19,993 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 01:08:19,997 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 01:08:20,001 - DEBUG - üîó Foreign keys for users: []
2025-08-07 01:08:20,001 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 01:08:20,001 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:08:20,001 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 01:08:20,001 - DEBUG - üîç Relationship Details:
2025-08-07 01:08:20,001 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:08:20,002 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 01:08:20,002 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:08:20,002 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 01:08:20,002 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 01:08:20,002 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 01:08:20,002 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 01:08:20,002 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 01:08:20,002 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 01:08:20,002 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 01:08:20,002 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 01:08:20,002 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 01:08:20,002 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 01:08:20,002 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 01:08:20,002 - INFO - üìå Maritime system initialization complete.
2025-08-07 01:08:20,002 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 01:08:20,906 - INFO - Database engine created with pool_size=10
2025-08-07 01:08:31,391 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 01:08:31,401 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:08:31,403 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:08:31,405 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:08:31,407 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:08:31,410 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 01:08:31,416 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:08:31,418 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:08:31,419 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:08:31,421 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:11:31,058 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 01:11:31,064 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:11:31,066 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:11:31,068 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:11:31,070 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:11:31,073 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 01:11:31,079 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:11:31,081 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:11:31,083 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:11:31,085 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:17:24,402 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 01:17:24,536 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 01:17:24,536 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 01:17:24,536 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 01:17:24,711 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 01:17:24,807 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:17:24,823 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:17:24,824 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:17:24,839 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 01:17:24,839 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:17:24,854 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 01:17:24,854 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:17:24,854 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 01:17:24,865 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 01:17:24,865 - INFO - ‚úÖ Database connection established
2025-08-07 01:17:24,885 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:17:24,890 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 01:17:24,893 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 01:17:24,896 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 01:17:24,899 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 01:17:24,901 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 01:17:24,904 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 01:17:24,906 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 01:17:24,909 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 01:17:24,912 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 01:17:24,915 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 01:17:24,918 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 01:17:24,920 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 01:17:24,923 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 01:17:24,929 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 01:17:24,933 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:17:24,933 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 01:17:24,937 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 01:17:24,937 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 01:17:24,941 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:17:24,941 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 01:17:24,945 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:17:24,945 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 01:17:24,949 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:17:24,949 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 01:17:24,953 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 01:17:24,953 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 01:17:24,957 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 01:17:24,957 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 01:17:24,958 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 01:17:24,962 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 01:17:24,962 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 01:17:24,962 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 01:17:24,966 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 01:17:24,970 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 01:17:24,970 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 01:17:24,970 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 01:17:24,970 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 01:17:24,970 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 01:17:24,975 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 01:17:24,978 - DEBUG - üîó Foreign keys for users: []
2025-08-07 01:17:24,979 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 01:17:24,979 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:17:24,979 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 01:17:24,979 - DEBUG - üîç Relationship Details:
2025-08-07 01:17:24,979 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:17:24,979 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 01:17:24,979 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:17:24,979 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 01:17:24,979 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 01:17:24,979 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 01:17:24,979 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 01:17:24,979 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 01:17:24,979 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 01:17:24,979 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 01:17:24,979 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 01:17:24,979 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 01:17:24,979 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 01:17:24,980 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 01:17:24,980 - INFO - üìå Maritime system initialization complete.
2025-08-07 01:17:24,980 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 01:17:24,982 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 01:17:24,982 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 01:17:24,982 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 01:17:25,212 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 01:17:25,212 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:17:25,227 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 01:17:25,228 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:17:25,228 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 01:17:25,228 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 01:17:25,228 - INFO - ‚úÖ Database connection established
2025-08-07 01:17:25,240 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:17:25,245 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 01:17:25,247 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 01:17:25,250 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 01:17:25,252 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 01:17:25,255 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 01:17:25,258 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 01:17:25,261 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 01:17:25,264 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 01:17:25,266 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 01:17:25,269 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 01:17:25,272 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 01:17:25,274 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 01:17:25,277 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 01:17:25,282 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 01:17:25,286 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:17:25,286 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 01:17:25,290 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 01:17:25,290 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 01:17:25,294 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:17:25,294 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 01:17:25,298 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:17:25,298 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 01:17:25,302 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:17:25,302 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 01:17:25,306 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 01:17:25,306 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 01:17:25,310 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 01:17:25,310 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 01:17:25,310 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 01:17:25,314 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 01:17:25,314 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 01:17:25,314 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 01:17:25,318 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 01:17:25,322 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 01:17:25,322 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 01:17:25,322 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 01:17:25,322 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 01:17:25,323 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 01:17:25,326 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 01:17:25,331 - DEBUG - üîó Foreign keys for users: []
2025-08-07 01:17:25,331 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 01:17:25,331 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:17:25,331 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 01:17:25,331 - DEBUG - üîç Relationship Details:
2025-08-07 01:17:25,331 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:17:25,331 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 01:17:25,331 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:17:25,331 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 01:17:25,331 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 01:17:25,331 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 01:17:25,331 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 01:17:25,331 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 01:17:25,331 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 01:17:25,331 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 01:17:25,331 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 01:17:25,332 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 01:17:25,332 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 01:17:25,332 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 01:17:25,332 - INFO - üìå Maritime system initialization complete.
2025-08-07 01:17:25,332 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 01:17:27,934 - INFO - Database engine created with pool_size=10
2025-08-07 01:17:38,602 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 01:17:38,612 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:17:38,614 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:17:38,616 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:17:38,618 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:17:38,621 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 01:17:38,628 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:17:38,630 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:17:38,631 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:17:38,633 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:42:02,631 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 01:42:02,766 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 01:42:02,766 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 01:42:02,766 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 01:42:02,945 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 01:42:03,043 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:42:03,060 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:42:03,061 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:42:03,076 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 01:42:03,077 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:42:03,093 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 01:42:03,093 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:42:03,093 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 01:42:03,106 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 01:42:03,107 - INFO - ‚úÖ Database connection established
2025-08-07 01:42:03,558 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:42:03,564 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 01:42:03,568 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 01:42:03,571 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 01:42:03,574 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 01:42:03,577 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 01:42:03,580 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 01:42:03,583 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 01:42:03,586 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 01:42:03,589 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 01:42:03,592 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 01:42:03,596 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 01:42:03,599 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 01:42:03,602 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 01:42:03,607 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 01:42:03,612 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:42:03,612 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 01:42:03,616 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 01:42:03,616 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 01:42:03,620 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:42:03,620 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 01:42:03,624 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:42:03,624 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 01:42:03,628 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:42:03,628 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 01:42:03,632 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 01:42:03,633 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 01:42:03,637 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 01:42:03,637 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 01:42:03,637 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 01:42:03,641 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 01:42:03,641 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 01:42:03,641 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 01:42:03,645 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 01:42:03,649 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 01:42:03,650 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 01:42:03,650 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 01:42:03,650 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 01:42:03,650 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 01:42:03,654 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 01:42:03,658 - DEBUG - üîó Foreign keys for users: []
2025-08-07 01:42:03,658 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 01:42:03,658 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:42:03,658 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 01:42:03,658 - DEBUG - üîç Relationship Details:
2025-08-07 01:42:03,658 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:42:03,658 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 01:42:03,659 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:42:03,659 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 01:42:03,659 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 01:42:03,659 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 01:42:03,659 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 01:42:03,659 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 01:42:03,659 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 01:42:03,659 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 01:42:03,659 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 01:42:03,659 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 01:42:03,659 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 01:42:03,659 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 01:42:03,659 - INFO - üìå Maritime system initialization complete.
2025-08-07 01:42:03,659 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 01:42:03,662 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 01:42:03,662 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 01:42:03,662 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 01:42:03,932 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 01:42:03,932 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 01:42:03,948 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 01:42:03,948 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 01:42:03,948 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 01:42:03,949 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 01:42:03,949 - INFO - ‚úÖ Database connection established
2025-08-07 01:42:03,961 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:42:03,965 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 01:42:03,968 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 01:42:03,971 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 01:42:03,973 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 01:42:03,976 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 01:42:03,978 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 01:42:03,981 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 01:42:03,984 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 01:42:03,987 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 01:42:03,990 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 01:42:03,993 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 01:42:03,995 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 01:42:03,998 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 01:42:04,004 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 01:42:04,008 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:42:04,008 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 01:42:04,012 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 01:42:04,012 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 01:42:04,017 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:42:04,017 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 01:42:04,021 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:42:04,021 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 01:42:04,025 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 01:42:04,025 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 01:42:04,029 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 01:42:04,029 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 01:42:04,033 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 01:42:04,034 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 01:42:04,034 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 01:42:04,038 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 01:42:04,038 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 01:42:04,038 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 01:42:04,042 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 01:42:04,046 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 01:42:04,047 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 01:42:04,047 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 01:42:04,047 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 01:42:04,047 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 01:42:04,051 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 01:42:04,055 - DEBUG - üîó Foreign keys for users: []
2025-08-07 01:42:04,055 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 01:42:04,055 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 01:42:04,055 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 01:42:04,055 - DEBUG - üîç Relationship Details:
2025-08-07 01:42:04,056 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:42:04,056 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 01:42:04,056 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 01:42:04,056 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 01:42:04,056 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 01:42:04,056 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 01:42:04,056 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 01:42:04,056 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 01:42:04,056 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 01:42:04,056 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 01:42:04,056 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 01:42:04,056 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 01:42:04,056 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 01:42:04,056 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 01:42:04,057 - INFO - üìå Maritime system initialization complete.
2025-08-07 01:42:04,057 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 01:42:04,124 - INFO - Database engine created with pool_size=10
2025-08-07 01:42:19,387 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 01:42:19,397 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:42:19,400 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:42:19,402 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:42:19,403 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 01:42:19,406 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 01:42:19,412 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 01:42:19,413 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 01:42:19,415 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 01:42:19,416 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 08:51:03,979 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 08:51:04,111 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 08:51:04,111 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 08:51:04,111 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 08:51:04,286 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 08:51:04,381 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 08:51:04,400 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 08:51:04,400 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 08:51:04,415 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 08:51:04,415 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 08:51:04,430 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 08:51:04,431 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 08:51:04,431 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 08:51:04,440 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 08:51:04,440 - INFO - ‚úÖ Database connection established
2025-08-07 08:51:05,089 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 08:51:05,095 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 08:51:05,098 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 08:51:05,101 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 08:51:05,103 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 08:51:05,106 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 08:51:05,109 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 08:51:05,112 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 08:51:05,115 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 08:51:05,118 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 08:51:05,120 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 08:51:05,124 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 08:51:05,126 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 08:51:05,130 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 08:51:05,135 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 08:51:05,139 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 08:51:05,139 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 08:51:05,143 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 08:51:05,143 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 08:51:05,148 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 08:51:05,148 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 08:51:05,152 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 08:51:05,152 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 08:51:05,156 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 08:51:05,156 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 08:51:05,160 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 08:51:05,160 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 08:51:05,164 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 08:51:05,164 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 08:51:05,164 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 08:51:05,169 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 08:51:05,169 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 08:51:05,169 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 08:51:05,173 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 08:51:05,178 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 08:51:05,178 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 08:51:05,178 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 08:51:05,178 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 08:51:05,178 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 08:51:05,182 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 08:51:05,186 - DEBUG - üîó Foreign keys for users: []
2025-08-07 08:51:05,186 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 08:51:05,186 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 08:51:05,187 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 08:51:05,187 - DEBUG - üîç Relationship Details:
2025-08-07 08:51:05,187 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,187 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 08:51:05,187 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,187 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,187 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,187 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 08:51:05,187 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,187 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 08:51:05,187 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,187 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 08:51:05,187 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 08:51:05,187 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 08:51:05,187 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 08:51:05,187 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 08:51:05,187 - INFO - üìå Maritime system initialization complete.
2025-08-07 08:51:05,187 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 08:51:05,188 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 08:51:05,188 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 08:51:05,189 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 08:51:05,415 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 08:51:05,415 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 08:51:05,431 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 08:51:05,432 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 08:51:05,432 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 08:51:05,432 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 08:51:05,432 - INFO - ‚úÖ Database connection established
2025-08-07 08:51:05,444 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 08:51:05,448 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 08:51:05,451 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 08:51:05,454 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 08:51:05,456 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 08:51:05,459 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 08:51:05,461 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 08:51:05,464 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 08:51:05,467 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 08:51:05,470 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 08:51:05,473 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 08:51:05,476 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 08:51:05,478 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 08:51:05,481 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 08:51:05,486 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 08:51:05,491 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 08:51:05,491 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 08:51:05,495 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 08:51:05,495 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 08:51:05,498 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 08:51:05,499 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 08:51:05,502 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 08:51:05,502 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 08:51:05,506 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 08:51:05,506 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 08:51:05,510 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 08:51:05,510 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 08:51:05,514 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 08:51:05,514 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 08:51:05,514 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 08:51:05,519 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 08:51:05,519 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 08:51:05,519 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 08:51:05,523 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 08:51:05,527 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 08:51:05,527 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 08:51:05,527 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 08:51:05,527 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 08:51:05,527 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 08:51:05,531 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 08:51:05,535 - DEBUG - üîó Foreign keys for users: []
2025-08-07 08:51:05,535 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 08:51:05,535 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 08:51:05,535 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 08:51:05,535 - DEBUG - üîç Relationship Details:
2025-08-07 08:51:05,535 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,535 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 08:51:05,535 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,535 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,535 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,535 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 08:51:05,535 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,535 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 08:51:05,536 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 08:51:05,536 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 08:51:05,536 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 08:51:05,536 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 08:51:05,536 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 08:51:05,536 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 08:51:05,536 - INFO - üìå Maritime system initialization complete.
2025-08-07 08:51:05,536 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 08:51:08,157 - INFO - Database engine created with pool_size=10
2025-08-07 08:51:40,931 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 08:51:40,947 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 08:51:40,981 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 08:51:40,982 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x707fd5ca7090>
2025-08-07 08:51:40,982 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 08:51:40,982 - DEBUG - send_request_headers.complete
2025-08-07 08:51:40,982 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 08:51:40,983 - DEBUG - send_request_body.complete
2025-08-07 08:51:40,983 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 08:52:40,984 - DEBUG - receive_response_headers.failed exception=ReadTimeout(TimeoutError())
2025-08-07 08:52:40,984 - DEBUG - response_closed.started
2025-08-07 08:52:40,984 - DEBUG - response_closed.complete
2025-08-07 08:55:56,142 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 08:55:56,157 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 08:55:56,185 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 08:55:56,185 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x707fd5cb04d0>
2025-08-07 08:55:56,186 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 08:55:56,186 - DEBUG - send_request_headers.complete
2025-08-07 08:55:56,186 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 08:55:56,186 - DEBUG - send_request_body.complete
2025-08-07 08:55:56,186 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 08:56:20,238 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 03:26:20 GMT'), (b'Content-Length', b'537')])
2025-08-07 08:56:20,238 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 08:56:20,238 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 08:56:20,238 - DEBUG - receive_response_body.complete
2025-08-07 08:56:20,238 - DEBUG - response_closed.started
2025-08-07 08:56:20,238 - DEBUG - response_closed.complete
2025-08-07 08:56:20,239 - DEBUG - close.started
2025-08-07 08:56:20,239 - DEBUG - close.complete
2025-08-07 08:57:05,652 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 08:57:05,662 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 08:57:05,664 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 08:57:05,666 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 08:57:05,668 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 08:57:05,671 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 08:57:05,678 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 08:57:05,680 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 08:57:05,682 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 08:57:05,684 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 09:01:47,500 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:01:47,516 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 09:01:47,550 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 09:01:47,551 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x707fd5ce1350>
2025-08-07 09:01:47,551 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 09:01:47,551 - DEBUG - send_request_headers.complete
2025-08-07 09:01:47,552 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 09:01:47,552 - DEBUG - send_request_body.complete
2025-08-07 09:01:47,552 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 09:02:30,739 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 03:32:30 GMT'), (b'Content-Length', b'474')])
2025-08-07 09:02:30,739 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 09:02:30,739 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 09:02:30,739 - DEBUG - receive_response_body.complete
2025-08-07 09:02:30,740 - DEBUG - response_closed.started
2025-08-07 09:02:30,740 - DEBUG - response_closed.complete
2025-08-07 09:02:30,740 - DEBUG - close.started
2025-08-07 09:02:30,740 - DEBUG - close.complete
2025-08-07 09:02:59,456 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:02:59,472 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 09:02:59,500 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 09:02:59,500 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x707fcdca4d50>
2025-08-07 09:02:59,500 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 09:02:59,501 - DEBUG - send_request_headers.complete
2025-08-07 09:02:59,501 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 09:02:59,501 - DEBUG - send_request_body.complete
2025-08-07 09:02:59,501 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 09:03:01,033 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 03:33:01 GMT'), (b'Content-Length', b'546')])
2025-08-07 09:03:01,033 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 09:03:01,034 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 09:03:01,034 - DEBUG - receive_response_body.complete
2025-08-07 09:03:01,034 - DEBUG - response_closed.started
2025-08-07 09:03:01,034 - DEBUG - response_closed.complete
2025-08-07 09:03:01,034 - DEBUG - close.started
2025-08-07 09:03:01,034 - DEBUG - close.complete
2025-08-07 09:08:10,212 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:08:10,343 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 09:08:10,343 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 09:08:10,343 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 09:08:10,517 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 09:08:10,611 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:08:10,627 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:08:10,627 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:08:10,643 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:08:10,643 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:08:10,658 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:08:10,658 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:08:10,659 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:08:10,694 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:08:10,695 - INFO - ‚úÖ Database connection established
2025-08-07 09:08:10,810 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:08:10,815 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:08:10,818 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:08:10,821 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:08:10,824 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:08:10,826 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:08:10,829 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:08:10,831 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:08:10,834 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:08:10,837 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:08:10,840 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:08:10,843 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:08:10,846 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:08:10,849 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:08:10,854 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:08:10,858 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:08:10,858 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:08:10,862 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:08:10,862 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:08:10,866 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:08:10,866 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:08:10,870 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:08:10,870 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:08:10,874 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:08:10,874 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:08:10,879 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:08:10,879 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:08:10,884 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:08:10,884 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:08:10,884 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:08:10,888 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:08:10,888 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:08:10,888 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:08:10,893 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:08:10,898 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:08:10,898 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:08:10,898 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:08:10,898 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:08:10,898 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:08:10,902 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:08:10,906 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:08:10,906 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:08:10,906 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:08:10,906 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:08:10,906 - DEBUG - üîç Relationship Details:
2025-08-07 09:08:10,906 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:08:10,906 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:08:10,907 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:08:10,907 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:08:10,907 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:08:10,907 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:08:10,907 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:08:10,907 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:08:10,907 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:08:10,907 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:08:10,907 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:08:10,907 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:08:10,907 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:08:10,907 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:08:10,907 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:08:10,907 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:08:10,908 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 09:08:10,908 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 09:08:10,908 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:08:11,156 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:08:11,156 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:08:11,172 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:08:11,173 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:08:11,173 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:08:11,173 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:08:11,173 - INFO - ‚úÖ Database connection established
2025-08-07 09:08:11,186 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:08:11,190 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:08:11,193 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:08:11,196 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:08:11,198 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:08:11,201 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:08:11,203 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:08:11,206 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:08:11,209 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:08:11,211 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:08:11,214 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:08:11,217 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:08:11,219 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:08:11,222 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:08:11,227 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:08:11,231 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:08:11,231 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:08:11,235 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:08:11,235 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:08:11,239 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:08:11,239 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:08:11,243 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:08:11,243 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:08:11,247 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:08:11,247 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:08:11,251 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:08:11,251 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:08:11,255 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:08:11,255 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:08:11,255 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:08:11,259 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:08:11,259 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:08:11,259 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:08:11,263 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:08:11,268 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:08:11,268 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:08:11,268 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:08:11,268 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:08:11,268 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:08:11,272 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:08:11,276 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:08:11,276 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:08:11,276 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:08:11,276 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:08:11,276 - DEBUG - üîç Relationship Details:
2025-08-07 09:08:11,277 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:08:11,277 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:08:11,277 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:08:11,277 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:08:11,277 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:08:11,277 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:08:11,277 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:08:11,277 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:08:11,277 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:08:11,277 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:08:11,277 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:08:11,277 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:08:11,277 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:08:11,277 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:08:11,277 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:08:11,277 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:09:53,705 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:09:53,720 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 09:09:53,722 - INFO - Database engine created with pool_size=10
2025-08-07 09:09:53,886 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 09:09:53,887 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7eceff3a8f90>
2025-08-07 09:09:53,887 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 09:09:53,887 - DEBUG - send_request_headers.complete
2025-08-07 09:09:53,887 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 09:09:53,887 - DEBUG - send_request_body.complete
2025-08-07 09:09:53,887 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 09:10:15,654 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 03:40:15 GMT'), (b'Content-Length', b'530')])
2025-08-07 09:10:15,655 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 09:10:15,655 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 09:10:15,655 - DEBUG - receive_response_body.complete
2025-08-07 09:10:15,655 - DEBUG - response_closed.started
2025-08-07 09:10:15,655 - DEBUG - response_closed.complete
2025-08-07 09:10:15,655 - DEBUG - close.started
2025-08-07 09:10:15,655 - DEBUG - close.complete
2025-08-07 09:10:25,091 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:10:25,108 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 09:10:25,135 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 09:10:25,136 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7ecefd540190>
2025-08-07 09:10:25,137 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 09:10:25,137 - DEBUG - send_request_headers.complete
2025-08-07 09:10:25,137 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 09:10:25,137 - DEBUG - send_request_body.complete
2025-08-07 09:10:25,137 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 09:10:28,612 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 03:40:28 GMT'), (b'Content-Length', b'724')])
2025-08-07 09:10:28,612 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 09:10:28,613 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 09:10:28,613 - DEBUG - receive_response_body.complete
2025-08-07 09:10:28,613 - DEBUG - response_closed.started
2025-08-07 09:10:28,613 - DEBUG - response_closed.complete
2025-08-07 09:10:28,613 - DEBUG - close.started
2025-08-07 09:10:28,613 - DEBUG - close.complete
2025-08-07 09:15:12,721 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:15:12,853 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 09:15:12,853 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 09:15:12,853 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 09:15:13,028 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 09:15:13,128 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:13,145 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:15:13,145 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:13,161 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:15:13,161 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:13,176 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:15:13,176 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:15:13,176 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:15:13,197 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:15:13,197 - INFO - ‚úÖ Database connection established
2025-08-07 09:15:13,257 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:13,263 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:15:13,266 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:15:13,269 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:15:13,272 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:15:13,274 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:15:13,277 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:15:13,280 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:15:13,282 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:15:13,285 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:15:13,288 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:15:13,291 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:15:13,293 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:15:13,296 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:15:13,301 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:15:13,305 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:13,305 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:13,309 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:15:13,309 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:15:13,313 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:13,313 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:13,317 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:13,318 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:15:13,322 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:13,322 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:15:13,326 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:15:13,326 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:15:13,330 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:15:13,330 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:15:13,330 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:15:13,334 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:15:13,334 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:15:13,334 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:15:13,338 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:15:13,342 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:15:13,343 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:15:13,343 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:15:13,343 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:15:13,343 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:15:13,347 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:15:13,351 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:15:13,351 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:15:13,351 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:13,351 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:15:13,351 - DEBUG - üîç Relationship Details:
2025-08-07 09:15:13,351 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,351 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:15:13,351 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,351 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,352 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,352 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:15:13,352 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,352 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:15:13,352 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,352 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:15:13,352 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:15:13,352 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:15:13,352 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:15:13,352 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:15:13,352 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:15:13,352 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:15:13,353 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 09:15:13,353 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 09:15:13,353 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:15:13,583 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:15:13,583 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:13,604 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:15:13,604 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:15:13,604 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:15:13,605 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:15:13,605 - INFO - ‚úÖ Database connection established
2025-08-07 09:15:13,618 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:13,625 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:15:13,628 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:15:13,632 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:15:13,635 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:15:13,638 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:15:13,641 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:15:13,644 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:15:13,647 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:15:13,650 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:15:13,652 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:15:13,655 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:15:13,658 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:15:13,661 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:15:13,666 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:15:13,670 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:13,670 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:13,674 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:15:13,674 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:15:13,678 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:13,678 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:13,682 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:13,682 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:15:13,686 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:13,686 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:15:13,690 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:15:13,690 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:15:13,694 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:15:13,694 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:15:13,694 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:15:13,698 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:15:13,698 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:15:13,698 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:15:13,702 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:15:13,707 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:15:13,707 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:15:13,707 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:15:13,707 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:15:13,707 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:15:13,711 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:15:13,715 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:15:13,715 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:15:13,715 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:13,715 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:15:13,715 - DEBUG - üîç Relationship Details:
2025-08-07 09:15:13,715 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,715 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:15:13,715 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,715 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,715 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,715 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:15:13,715 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,715 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:15:13,715 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:15:13,715 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:15:13,716 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:15:13,716 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:15:13,716 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:15:13,716 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:15:13,716 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:15:13,716 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:15:16,837 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:15:16,976 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 09:15:16,976 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 09:15:16,976 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 09:15:17,150 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 09:15:17,377 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:17,394 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:15:17,394 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:17,409 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:15:17,409 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:17,424 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:15:17,424 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:15:17,425 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:15:17,434 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:15:17,434 - INFO - ‚úÖ Database connection established
2025-08-07 09:15:17,455 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:17,461 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:15:17,464 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:15:17,467 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:15:17,470 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:15:17,473 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:15:17,475 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:15:17,478 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:15:17,481 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:15:17,484 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:15:17,487 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:15:17,490 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:15:17,493 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:15:17,496 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:15:17,502 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:15:17,506 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:17,506 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:17,510 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:15:17,510 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:15:17,514 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:17,514 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:17,518 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:17,518 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:15:17,522 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:17,522 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:15:17,526 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:15:17,526 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:15:17,530 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:15:17,530 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:15:17,530 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:15:17,534 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:15:17,534 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:15:17,534 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:15:17,538 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:15:17,542 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:15:17,543 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:15:17,543 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:15:17,543 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:15:17,543 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:15:17,547 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:15:17,551 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:15:17,551 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:15:17,551 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:17,551 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:15:17,551 - DEBUG - üîç Relationship Details:
2025-08-07 09:15:17,551 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,551 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:15:17,551 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,551 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,551 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,551 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:15:17,551 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,551 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:15:17,551 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,551 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:15:17,551 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:15:17,551 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:15:17,551 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:15:17,551 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:15:17,552 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:15:17,552 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:15:17,553 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 09:15:17,553 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 09:15:17,553 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:15:17,779 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:15:17,779 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:17,795 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:15:17,795 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:15:17,796 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:15:17,796 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:15:17,796 - INFO - ‚úÖ Database connection established
2025-08-07 09:15:17,809 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:17,814 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:15:17,817 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:15:17,820 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:15:17,822 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:15:17,825 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:15:17,828 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:15:17,831 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:15:17,834 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:15:17,837 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:15:17,840 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:15:17,843 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:15:17,846 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:15:17,849 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:15:17,854 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:15:17,859 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:17,859 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:17,863 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:15:17,863 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:15:17,867 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:17,868 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:17,872 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:17,872 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:15:17,876 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:17,876 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:15:17,880 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:15:17,881 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:15:17,885 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:15:17,885 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:15:17,885 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:15:17,889 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:15:17,889 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:15:17,889 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:15:17,893 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:15:17,898 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:15:17,898 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:15:17,898 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:15:17,898 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:15:17,898 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:15:17,902 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:15:17,906 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:15:17,906 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:15:17,906 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:17,906 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:15:17,906 - DEBUG - üîç Relationship Details:
2025-08-07 09:15:17,906 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,906 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:15:17,906 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,906 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,906 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,907 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:15:17,907 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,907 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:15:17,907 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:15:17,907 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:15:17,907 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:15:17,907 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:15:17,907 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:15:17,907 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:15:17,907 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:15:17,907 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:15:19,680 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:15:19,811 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 09:15:19,811 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 09:15:19,811 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 09:15:19,983 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 09:15:20,077 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:20,094 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:15:20,094 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:20,109 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:15:20,109 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:20,124 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:15:20,124 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:15:20,124 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:15:20,133 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:15:20,133 - INFO - ‚úÖ Database connection established
2025-08-07 09:15:20,154 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:20,160 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:15:20,162 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:15:20,165 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:15:20,168 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:15:20,170 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:15:20,173 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:15:20,176 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:15:20,179 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:15:20,181 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:15:20,184 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:15:20,187 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:15:20,190 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:15:20,193 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:15:20,199 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:15:20,203 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:20,203 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:20,207 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:15:20,207 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:15:20,211 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:20,212 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:20,216 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:20,216 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:15:20,220 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:20,220 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:15:20,224 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:15:20,224 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:15:20,229 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:15:20,229 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:15:20,229 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:15:20,233 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:15:20,233 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:15:20,233 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:15:20,238 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:15:20,242 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:15:20,242 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:15:20,242 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:15:20,242 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:15:20,242 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:15:20,246 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:15:20,250 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:15:20,250 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:15:20,251 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:20,251 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:15:20,251 - DEBUG - üîç Relationship Details:
2025-08-07 09:15:20,251 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,251 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:15:20,251 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,251 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,251 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,251 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:15:20,251 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,251 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:15:20,251 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,251 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:15:20,251 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:15:20,252 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:15:20,252 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:15:20,252 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:15:20,252 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:15:20,252 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:15:20,254 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 09:15:20,254 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 09:15:20,254 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:15:20,479 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:15:20,479 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:20,495 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:15:20,495 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:15:20,495 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:15:20,496 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:15:20,496 - INFO - ‚úÖ Database connection established
2025-08-07 09:15:20,508 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:20,513 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:15:20,515 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:15:20,518 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:15:20,521 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:15:20,524 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:15:20,527 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:15:20,530 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:15:20,533 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:15:20,536 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:15:20,539 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:15:20,542 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:15:20,545 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:15:20,548 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:15:20,553 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:15:20,557 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:20,557 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:20,561 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:15:20,561 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:15:20,565 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:20,566 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:15:20,570 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:20,570 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:15:20,574 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:15:20,574 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:15:20,578 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:15:20,578 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:15:20,582 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:15:20,582 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:15:20,583 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:15:20,587 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:15:20,587 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:15:20,587 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:15:20,591 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:15:20,596 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:15:20,596 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:15:20,596 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:15:20,596 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:15:20,596 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:15:20,600 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:15:20,604 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:15:20,604 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:15:20,604 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:15:20,604 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:15:20,605 - DEBUG - üîç Relationship Details:
2025-08-07 09:15:20,605 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,605 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:15:20,605 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,605 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,605 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,605 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:15:20,605 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,605 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:15:20,605 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:15:20,605 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:15:20,605 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:15:20,605 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:15:20,605 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:15:20,606 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:15:20,606 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:15:20,606 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:15:28,647 - INFO - Database engine created with pool_size=10
2025-08-07 09:15:32,060 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:15:32,076 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 09:15:32,209 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 09:15:32,210 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7aa79d0cb590>
2025-08-07 09:15:32,211 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 09:15:32,211 - DEBUG - send_request_headers.complete
2025-08-07 09:15:32,211 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 09:15:32,211 - DEBUG - send_request_body.complete
2025-08-07 09:15:32,211 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 09:15:41,139 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 03:45:41 GMT'), (b'Content-Length', b'696')])
2025-08-07 09:15:41,139 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 09:15:41,139 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 09:15:41,139 - DEBUG - receive_response_body.complete
2025-08-07 09:15:41,139 - DEBUG - response_closed.started
2025-08-07 09:15:41,139 - DEBUG - response_closed.complete
2025-08-07 09:15:41,140 - DEBUG - close.started
2025-08-07 09:15:41,140 - DEBUG - close.complete
2025-08-07 09:21:34,068 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:21:34,084 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 09:21:34,124 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 09:21:34,125 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7aa79d1af250>
2025-08-07 09:21:34,125 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 09:21:34,125 - DEBUG - send_request_headers.complete
2025-08-07 09:21:34,125 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 09:21:34,125 - DEBUG - send_request_body.complete
2025-08-07 09:21:34,125 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 09:21:38,045 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 03:51:38 GMT'), (b'Content-Length', b'541')])
2025-08-07 09:21:38,045 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 09:21:38,045 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 09:21:38,045 - DEBUG - receive_response_body.complete
2025-08-07 09:21:38,045 - DEBUG - response_closed.started
2025-08-07 09:21:38,045 - DEBUG - response_closed.complete
2025-08-07 09:21:38,045 - DEBUG - close.started
2025-08-07 09:21:38,046 - DEBUG - close.complete
2025-08-07 09:24:59,515 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:24:59,664 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 09:24:59,664 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 09:24:59,665 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 09:24:59,919 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 09:25:00,034 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:25:00,052 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:25:00,052 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:25:00,068 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:25:00,068 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:25:00,083 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:25:00,084 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:25:00,084 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:25:00,094 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:25:00,094 - INFO - ‚úÖ Database connection established
2025-08-07 09:25:00,125 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:25:00,132 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:25:00,135 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:25:00,138 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:25:00,140 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:25:00,143 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:25:00,145 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:25:00,148 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:25:00,151 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:25:00,153 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:25:00,156 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:25:00,159 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:25:00,161 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:25:00,164 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:25:00,169 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:25:00,173 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:25:00,173 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:25:00,177 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:25:00,177 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:25:00,181 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:25:00,181 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:25:00,185 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:25:00,185 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:25:00,189 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:25:00,189 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:25:00,193 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:25:00,193 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:25:00,197 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:25:00,197 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:25:00,197 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:25:00,201 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:25:00,201 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:25:00,201 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:25:00,205 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:25:00,209 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:25:00,209 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:25:00,209 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:25:00,209 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:25:00,209 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:25:00,213 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:25:00,217 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:25:00,217 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:25:00,217 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:25:00,217 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:25:00,217 - DEBUG - üîç Relationship Details:
2025-08-07 09:25:00,217 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:25:00,217 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:25:00,217 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:25:00,217 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:25:00,217 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:25:00,217 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:25:00,217 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:25:00,217 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:25:00,217 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:25:00,218 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:25:00,218 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:25:00,218 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:25:00,218 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:25:00,218 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:25:00,218 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:25:00,218 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:25:00,219 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 09:25:00,219 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 09:25:00,219 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:25:02,627 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:25:02,627 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:25:02,644 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:25:02,644 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:25:02,644 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:25:02,644 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:25:02,644 - INFO - ‚úÖ Database connection established
2025-08-07 09:25:02,657 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:25:02,661 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:25:02,664 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:25:02,667 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:25:02,669 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:25:02,672 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:25:02,674 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:25:02,677 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:25:02,680 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:25:02,682 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:25:02,685 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:25:02,688 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:25:02,691 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:25:02,694 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:25:02,699 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:25:02,703 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:25:02,703 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:25:02,707 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:25:02,707 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:25:02,711 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:25:02,711 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:25:02,715 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:25:02,715 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:25:02,719 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:25:02,719 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:25:02,723 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:25:02,723 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:25:02,727 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:25:02,727 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:25:02,727 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:25:02,731 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:25:02,731 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:25:02,731 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:25:02,735 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:25:02,739 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:25:02,739 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:25:02,739 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:25:02,739 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:25:02,739 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:25:02,743 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:25:02,747 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:25:02,747 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:25:02,747 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:25:02,747 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:25:02,747 - DEBUG - üîç Relationship Details:
2025-08-07 09:25:02,747 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:25:02,747 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:25:02,747 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:25:02,747 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:25:02,747 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:25:02,748 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:25:02,748 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:25:02,748 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:25:02,748 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:25:02,748 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:25:02,748 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:25:02,748 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:25:02,748 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:25:02,748 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:25:02,748 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:25:02,748 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:25:10,872 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:25:10,888 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 09:25:10,889 - INFO - Database engine created with pool_size=10
2025-08-07 09:25:10,952 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 09:25:10,953 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7f82d20bc7d0>
2025-08-07 09:25:10,954 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 09:25:10,954 - DEBUG - send_request_headers.complete
2025-08-07 09:25:10,954 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 09:25:10,954 - DEBUG - send_request_body.complete
2025-08-07 09:25:10,954 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 09:25:12,073 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 03:55:12 GMT'), (b'Content-Length', b'538')])
2025-08-07 09:25:12,073 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 09:25:12,073 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 09:25:12,073 - DEBUG - receive_response_body.complete
2025-08-07 09:25:12,074 - DEBUG - response_closed.started
2025-08-07 09:25:12,074 - DEBUG - response_closed.complete
2025-08-07 09:25:12,074 - DEBUG - close.started
2025-08-07 09:25:12,074 - DEBUG - close.complete
2025-08-07 09:26:05,563 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:26:05,697 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 09:26:05,697 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 09:26:05,697 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 09:26:05,872 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 09:26:05,967 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:26:05,984 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:26:05,984 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:26:05,999 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:26:05,999 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:26:06,014 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:26:06,015 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:26:06,015 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:26:06,024 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:26:06,024 - INFO - ‚úÖ Database connection established
2025-08-07 09:26:06,303 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:26:06,309 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:26:06,312 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:26:06,315 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:26:06,318 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:26:06,320 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:26:06,323 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:26:06,326 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:26:06,329 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:26:06,332 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:26:06,335 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:26:06,338 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:26:06,341 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:26:06,344 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:26:06,350 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:26:06,354 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:26:06,355 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:26:06,359 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:26:06,359 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:26:06,363 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:26:06,363 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:26:06,367 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:26:06,367 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:26:06,371 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:26:06,371 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:26:06,375 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:26:06,375 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:26:06,379 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:26:06,379 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:26:06,379 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:26:06,384 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:26:06,384 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:26:06,384 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:26:06,388 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:26:06,392 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:26:06,392 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:26:06,392 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:26:06,393 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:26:06,393 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:26:06,397 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:26:06,401 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:26:06,401 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:26:06,401 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:26:06,401 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:26:06,401 - DEBUG - üîç Relationship Details:
2025-08-07 09:26:06,401 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,401 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:26:06,401 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,401 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,401 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,401 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:26:06,401 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,401 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:26:06,401 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,401 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:26:06,401 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:26:06,401 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:26:06,402 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:26:06,402 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:26:06,402 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:26:06,402 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:26:06,403 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 09:26:06,403 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 09:26:06,403 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 09:26:06,633 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 09:26:06,633 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:26:06,649 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 09:26:06,649 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 09:26:06,649 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 09:26:06,650 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 09:26:06,650 - INFO - ‚úÖ Database connection established
2025-08-07 09:26:06,662 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:26:06,667 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 09:26:06,669 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 09:26:06,672 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 09:26:06,675 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 09:26:06,678 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 09:26:06,680 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 09:26:06,683 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 09:26:06,686 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 09:26:06,689 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 09:26:06,691 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 09:26:06,694 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 09:26:06,697 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 09:26:06,700 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 09:26:06,705 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 09:26:06,709 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:26:06,709 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 09:26:06,713 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 09:26:06,713 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 09:26:06,717 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:26:06,717 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 09:26:06,721 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:26:06,721 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 09:26:06,725 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 09:26:06,725 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 09:26:06,729 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 09:26:06,729 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 09:26:06,733 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 09:26:06,733 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 09:26:06,733 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 09:26:06,738 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 09:26:06,738 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 09:26:06,738 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 09:26:06,742 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 09:26:06,746 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 09:26:06,746 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 09:26:06,747 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 09:26:06,747 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 09:26:06,747 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 09:26:06,751 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 09:26:06,755 - DEBUG - üîó Foreign keys for users: []
2025-08-07 09:26:06,755 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 09:26:06,755 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 09:26:06,755 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 09:26:06,755 - DEBUG - üîç Relationship Details:
2025-08-07 09:26:06,755 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,755 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 09:26:06,755 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,755 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,755 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,755 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 09:26:06,755 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,755 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 09:26:06,756 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 09:26:06,756 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 09:26:06,756 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 09:26:06,756 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 09:26:06,756 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 09:26:06,756 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 09:26:06,756 - INFO - üìå Maritime system initialization complete.
2025-08-07 09:26:06,756 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 09:26:17,177 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 09:26:17,193 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 09:26:17,194 - INFO - Database engine created with pool_size=10
2025-08-07 09:26:17,257 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 09:26:17,259 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x75271ff52350>
2025-08-07 09:26:17,259 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 09:26:17,259 - DEBUG - send_request_headers.complete
2025-08-07 09:26:17,259 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 09:26:17,259 - DEBUG - send_request_body.complete
2025-08-07 09:26:17,259 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 09:26:18,389 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 03:56:18 GMT'), (b'Content-Length', b'538')])
2025-08-07 09:26:18,390 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 09:26:18,390 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 09:26:18,390 - DEBUG - receive_response_body.complete
2025-08-07 09:26:18,390 - DEBUG - response_closed.started
2025-08-07 09:26:18,390 - DEBUG - response_closed.complete
2025-08-07 09:26:18,391 - DEBUG - close.started
2025-08-07 09:26:18,391 - DEBUG - close.complete
2025-08-07 10:16:02,100 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:16:02,116 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 10:16:02,359 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 10:16:02,360 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x75271ff63c10>
2025-08-07 10:16:02,361 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 10:16:02,361 - DEBUG - send_request_headers.complete
2025-08-07 10:16:02,361 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 10:16:02,361 - DEBUG - send_request_body.complete
2025-08-07 10:16:02,361 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 10:16:08,882 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 04:46:08 GMT'), (b'Content-Length', b'542')])
2025-08-07 10:16:08,882 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 10:16:08,882 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 10:16:08,883 - DEBUG - receive_response_body.complete
2025-08-07 10:16:08,883 - DEBUG - response_closed.started
2025-08-07 10:16:08,883 - DEBUG - response_closed.complete
2025-08-07 10:16:08,883 - DEBUG - close.started
2025-08-07 10:16:08,883 - DEBUG - close.complete
2025-08-07 10:17:05,266 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:17:05,282 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 10:17:06,051 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 10:17:06,052 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x75271fff9c90>
2025-08-07 10:17:06,052 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 10:17:06,053 - DEBUG - send_request_headers.complete
2025-08-07 10:17:06,053 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 10:17:06,053 - DEBUG - send_request_body.complete
2025-08-07 10:17:06,053 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 10:17:08,700 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 04:47:08 GMT'), (b'Content-Length', b'691')])
2025-08-07 10:17:08,700 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 10:17:08,700 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 10:17:08,700 - DEBUG - receive_response_body.complete
2025-08-07 10:17:08,701 - DEBUG - response_closed.started
2025-08-07 10:17:08,701 - DEBUG - response_closed.complete
2025-08-07 10:17:08,701 - DEBUG - close.started
2025-08-07 10:17:08,701 - DEBUG - close.complete
2025-08-07 10:28:42,176 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 10:28:42,604 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 10:28:42,604 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 10:28:42,604 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 10:28:42,961 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 10:28:43,083 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:28:43,100 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 10:28:43,100 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:28:43,115 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 10:28:43,115 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:28:43,130 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 10:28:43,130 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 10:28:43,130 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 10:28:43,139 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 10:28:43,139 - INFO - ‚úÖ Database connection established
2025-08-07 10:28:43,169 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:28:43,175 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 10:28:43,178 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 10:28:43,181 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 10:28:43,184 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 10:28:43,186 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 10:28:43,189 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 10:28:43,192 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 10:28:43,195 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 10:28:43,197 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 10:28:43,200 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 10:28:43,203 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 10:28:43,205 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 10:28:43,208 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 10:28:43,214 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 10:28:43,218 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:28:43,218 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 10:28:43,222 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 10:28:43,222 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 10:28:43,226 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:28:43,226 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 10:28:43,230 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:28:43,230 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 10:28:43,234 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:28:43,234 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 10:28:43,238 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 10:28:43,238 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 10:28:43,242 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 10:28:43,242 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 10:28:43,242 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 10:28:43,246 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 10:28:43,246 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 10:28:43,246 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 10:28:43,251 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 10:28:43,255 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 10:28:43,255 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 10:28:43,255 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 10:28:43,255 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 10:28:43,256 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 10:28:43,259 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 10:28:43,263 - DEBUG - üîó Foreign keys for users: []
2025-08-07 10:28:43,263 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 10:28:43,263 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:28:43,263 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 10:28:43,263 - DEBUG - üîç Relationship Details:
2025-08-07 10:28:43,264 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,264 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 10:28:43,264 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,264 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,264 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,264 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 10:28:43,264 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,264 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 10:28:43,264 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,264 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 10:28:43,264 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 10:28:43,264 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 10:28:43,264 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 10:28:43,264 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 10:28:43,264 - INFO - üìå Maritime system initialization complete.
2025-08-07 10:28:43,264 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 10:28:43,265 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 10:28:43,265 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 10:28:43,266 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 10:28:43,799 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 10:28:43,799 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:28:43,815 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 10:28:43,816 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 10:28:43,816 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 10:28:43,816 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 10:28:43,816 - INFO - ‚úÖ Database connection established
2025-08-07 10:28:43,829 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:28:43,834 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 10:28:43,836 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 10:28:43,839 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 10:28:43,841 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 10:28:43,844 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 10:28:43,847 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 10:28:43,849 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 10:28:43,852 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 10:28:43,855 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 10:28:43,857 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 10:28:43,860 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 10:28:43,863 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 10:28:43,866 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 10:28:43,871 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 10:28:43,875 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:28:43,875 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 10:28:43,879 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 10:28:43,879 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 10:28:43,884 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:28:43,884 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 10:28:43,888 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:28:43,888 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 10:28:43,892 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:28:43,892 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 10:28:43,896 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 10:28:43,896 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 10:28:43,900 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 10:28:43,900 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 10:28:43,900 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 10:28:43,905 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 10:28:43,905 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 10:28:43,905 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 10:28:43,909 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 10:28:43,914 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 10:28:43,914 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 10:28:43,914 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 10:28:43,914 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 10:28:43,914 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 10:28:43,918 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 10:28:43,922 - DEBUG - üîó Foreign keys for users: []
2025-08-07 10:28:43,922 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 10:28:43,923 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:28:43,923 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 10:28:43,923 - DEBUG - üîç Relationship Details:
2025-08-07 10:28:43,923 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,923 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 10:28:43,923 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,923 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,923 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,923 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 10:28:43,923 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,923 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 10:28:43,923 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 10:28:43,923 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 10:28:43,923 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 10:28:43,923 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 10:28:43,923 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 10:28:43,923 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 10:28:43,923 - INFO - üìå Maritime system initialization complete.
2025-08-07 10:28:43,923 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 10:28:49,081 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:28:49,097 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 10:28:49,098 - INFO - Database engine created with pool_size=10
2025-08-07 10:28:49,162 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 10:28:49,163 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x786d9e02b850>
2025-08-07 10:28:49,163 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 10:28:49,163 - DEBUG - send_request_headers.complete
2025-08-07 10:28:49,164 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 10:28:49,164 - DEBUG - send_request_body.complete
2025-08-07 10:28:49,164 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 10:28:53,597 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 04:58:53 GMT'), (b'Content-Length', b'542')])
2025-08-07 10:28:53,597 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 10:28:53,597 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 10:28:53,598 - DEBUG - receive_response_body.complete
2025-08-07 10:28:53,598 - DEBUG - response_closed.started
2025-08-07 10:28:53,598 - DEBUG - response_closed.complete
2025-08-07 10:28:53,598 - DEBUG - close.started
2025-08-07 10:28:53,598 - DEBUG - close.complete
2025-08-07 10:32:21,127 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:32:21,142 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 10:32:21,619 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:32:21,635 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 10:32:21,635 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:32:21,651 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 10:32:21,651 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:32:21,667 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 10:32:21,667 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 10:32:21,667 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 10:32:21,668 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 10:32:21,668 - INFO - ‚úÖ Database connection established
2025-08-07 10:32:21,680 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:32:21,685 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 10:32:21,687 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 10:32:21,690 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 10:32:21,693 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 10:32:21,695 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 10:32:21,698 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 10:32:21,700 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 10:32:21,703 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 10:32:21,706 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 10:32:21,709 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 10:32:21,712 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 10:32:21,715 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 10:32:21,718 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 10:32:21,723 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 10:32:21,727 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:32:21,727 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 10:32:21,731 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 10:32:21,731 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 10:32:21,736 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:32:21,736 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 10:32:21,740 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:32:21,740 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 10:32:21,744 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:32:21,744 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 10:32:21,748 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 10:32:21,748 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 10:32:21,752 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 10:32:21,752 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 10:32:21,752 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 10:32:21,756 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 10:32:21,756 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 10:32:21,756 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 10:32:21,760 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 10:32:21,764 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 10:32:21,764 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 10:32:21,765 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 10:32:21,765 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 10:32:21,765 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 10:32:21,768 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 10:32:21,772 - DEBUG - üîó Foreign keys for users: []
2025-08-07 10:32:21,772 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 10:32:21,773 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:32:21,773 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 10:32:21,773 - DEBUG - üîç Relationship Details:
2025-08-07 10:32:21,773 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 10:32:21,773 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 10:32:21,773 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 10:32:21,773 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 10:32:21,773 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 10:32:21,773 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 10:32:21,773 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 10:32:21,773 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 10:32:21,773 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 10:32:21,773 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 10:32:21,773 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 10:32:21,773 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 10:32:21,773 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 10:32:21,773 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 10:32:21,773 - INFO - üìå Maritime system initialization complete.
2025-08-07 10:32:21,774 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 10:32:21,775 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 10:32:21,775 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 10:32:21,775 - INFO - üìå User input: list all ships
2025-08-07 10:32:21,775 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-08-07 10:32:21,775 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-08-07 10:32:21,775 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:32:21,775 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-08-07 10:32:21,775 - DEBUG - üìå Generated Prompt Length: 9890 characters
2025-08-07 10:32:21,775 - INFO - Generating SQL query...
2025-08-07 10:32:21,776 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-07 10:32:21,776 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x786d9e28dd90>
2025-08-07 10:32:21,776 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 10:32:21,776 - DEBUG - send_request_headers.complete
2025-08-07 10:32:21,777 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 10:32:21,777 - DEBUG - send_request_body.complete
2025-08-07 10:32:21,777 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 10:32:25,506 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 05:02:25 GMT'), (b'Content-Length', b'347')])
2025-08-07 10:32:25,506 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 10:32:25,506 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 10:32:25,506 - DEBUG - receive_response_body.complete
2025-08-07 10:32:25,506 - DEBUG - response_closed.started
2025-08-07 10:32:25,506 - DEBUG - response_closed.complete
2025-08-07 10:32:25,507 - DEBUG - Extracting SQL from response: SELECT ship_id, ship_name FROM ships;...
2025-08-07 10:32:25,507 - INFO - Direct SQL response detected: SELECT ship_id, ship_name FROM ships;
2025-08-07 10:32:25,507 - INFO - SQL query generation completed
2025-08-07 10:32:25,507 - DEBUG - Generated SQL query: SELECT ship_id, ship_name FROM ships;
2025-08-07 10:32:25,507 - DEBUG - üìå LLM Raw Response: SELECT ship_id, ship_name FROM ships;
2025-08-07 10:32:25,508 - DEBUG - üîç Table aliases in FROM/JOIN: set()
2025-08-07 10:32:25,508 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 10:32:25,508 - INFO - üìå Generated Valid SQL Query: SELECT ship_id, ship_name FROM ships;
2025-08-07 10:32:25,508 - DEBUG - üîç Table aliases in FROM/JOIN: set()
2025-08-07 10:32:25,508 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 10:32:25,508 - INFO - ‚úÖ Query is safe and authorized!
2025-08-07 10:32:25,509 - INFO - üìå Executing SQL query: SELECT ship_id, ship_name FROM ships;
2025-08-07 10:32:25,601 - INFO - üìå Query executed successfully in 0.092 seconds. Retrieved 3 records.
2025-08-07 10:35:16,001 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 10:35:16,009 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 10:35:16,011 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 10:35:16,013 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 10:35:16,014 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 10:35:16,017 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 10:35:16,023 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 10:35:16,025 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 10:35:16,027 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 10:35:16,028 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 10:39:26,454 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 10:39:26,622 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 10:39:26,622 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 10:39:26,623 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 10:39:26,829 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 10:39:26,938 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:39:26,955 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 10:39:26,955 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:39:26,970 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 10:39:26,970 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:39:26,985 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 10:39:26,985 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 10:39:26,985 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 10:39:26,995 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 10:39:26,995 - INFO - ‚úÖ Database connection established
2025-08-07 10:39:27,015 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:39:27,021 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 10:39:27,024 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 10:39:27,026 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 10:39:27,029 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 10:39:27,031 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 10:39:27,034 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 10:39:27,037 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 10:39:27,040 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 10:39:27,043 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 10:39:27,046 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 10:39:27,049 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 10:39:27,051 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 10:39:27,054 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 10:39:27,059 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 10:39:27,063 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:39:27,063 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 10:39:27,067 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 10:39:27,067 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 10:39:27,071 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:39:27,071 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 10:39:27,075 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:39:27,075 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 10:39:27,079 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:39:27,079 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 10:39:27,083 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 10:39:27,083 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 10:39:27,087 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 10:39:27,087 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 10:39:27,087 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 10:39:27,092 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 10:39:27,092 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 10:39:27,092 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 10:39:27,096 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 10:39:27,100 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 10:39:27,100 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 10:39:27,100 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 10:39:27,100 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 10:39:27,101 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 10:39:27,105 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 10:39:27,109 - DEBUG - üîó Foreign keys for users: []
2025-08-07 10:39:27,109 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 10:39:27,109 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:39:27,109 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 10:39:27,109 - DEBUG - üîç Relationship Details:
2025-08-07 10:39:27,109 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,109 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 10:39:27,109 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,109 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,110 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,110 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 10:39:27,110 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,110 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 10:39:27,110 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,110 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 10:39:27,110 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 10:39:27,110 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 10:39:27,110 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 10:39:27,110 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 10:39:27,110 - INFO - üìå Maritime system initialization complete.
2025-08-07 10:39:27,110 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 10:39:27,111 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 10:39:27,111 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 10:39:27,112 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 10:39:27,450 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 10:39:27,450 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 10:39:27,466 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 10:39:27,466 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 10:39:27,466 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 10:39:27,467 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 10:39:27,467 - INFO - ‚úÖ Database connection established
2025-08-07 10:39:27,479 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:39:27,483 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 10:39:27,486 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 10:39:27,488 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 10:39:27,491 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 10:39:27,493 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 10:39:27,496 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 10:39:27,498 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 10:39:27,501 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 10:39:27,504 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 10:39:27,506 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 10:39:27,509 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 10:39:27,512 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 10:39:27,515 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 10:39:27,521 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 10:39:27,525 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:39:27,525 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 10:39:27,529 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 10:39:27,529 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 10:39:27,533 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:39:27,533 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 10:39:27,537 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:39:27,537 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 10:39:27,541 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 10:39:27,541 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 10:39:27,545 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 10:39:27,545 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 10:39:27,549 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 10:39:27,549 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 10:39:27,549 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 10:39:27,553 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 10:39:27,553 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 10:39:27,553 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 10:39:27,557 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 10:39:27,562 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 10:39:27,562 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 10:39:27,562 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 10:39:27,562 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 10:39:27,562 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 10:39:27,566 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 10:39:27,570 - DEBUG - üîó Foreign keys for users: []
2025-08-07 10:39:27,570 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 10:39:27,570 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 10:39:27,570 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 10:39:27,570 - DEBUG - üîç Relationship Details:
2025-08-07 10:39:27,570 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,570 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 10:39:27,570 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,570 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,571 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,571 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 10:39:27,571 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,571 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 10:39:27,571 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 10:39:27,571 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 10:39:27,571 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 10:39:27,571 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 10:39:27,571 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 10:39:27,571 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 10:39:27,571 - INFO - üìå Maritime system initialization complete.
2025-08-07 10:39:27,571 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 10:39:36,715 - INFO - Database engine created with pool_size=10
2025-08-07 10:39:42,840 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 10:39:42,850 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 10:39:42,852 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 10:39:42,854 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 10:39:42,855 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 10:39:42,858 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-07 10:39:42,865 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 10:39:42,866 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 10:39:42,868 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 10:39:42,869 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:16:01,180 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:16:01,311 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 11:16:01,311 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 11:16:01,311 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 11:16:01,486 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 11:16:01,581 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:16:01,598 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:16:01,598 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:16:01,613 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:16:01,613 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:16:01,628 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:16:01,628 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:16:01,628 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:16:01,638 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:16:01,638 - INFO - ‚úÖ Database connection established
2025-08-07 11:16:01,658 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:16:01,664 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:16:01,667 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:16:01,669 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:16:01,672 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:16:01,674 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:16:01,677 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:16:01,680 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:16:01,683 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:16:01,686 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:16:01,688 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:16:01,692 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:16:01,694 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:16:01,697 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:16:01,703 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:16:01,707 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:16:01,707 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:16:01,711 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:16:01,711 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:16:01,715 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:16:01,715 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:16:01,719 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:16:01,719 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:16:01,723 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:16:01,723 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:16:01,727 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:16:01,727 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:16:01,731 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:16:01,731 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:16:01,731 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:16:01,735 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:16:01,735 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:16:01,735 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:16:01,739 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:16:01,744 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:16:01,744 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:16:01,744 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:16:01,744 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:16:01,744 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:16:01,748 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:16:01,752 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:16:01,752 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:16:01,752 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:16:01,752 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:16:01,752 - DEBUG - üîç Relationship Details:
2025-08-07 11:16:01,752 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:16:01,752 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:16:01,753 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:16:01,753 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:16:01,753 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:16:01,753 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:16:01,753 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:16:01,753 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:16:01,753 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:16:01,753 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:16:01,753 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:16:01,753 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:16:01,753 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:16:01,753 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:16:01,753 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:16:01,753 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:16:01,754 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:16:01,754 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:16:01,754 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:16:01,984 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:16:01,984 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:16:02,000 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:16:02,000 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:16:02,000 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:16:02,000 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:16:02,000 - INFO - ‚úÖ Database connection established
2025-08-07 11:16:02,013 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:16:02,017 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:16:02,020 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:16:02,022 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:16:02,025 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:16:02,027 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:16:02,030 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:16:02,032 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:16:02,035 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:16:02,038 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:16:02,040 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:16:02,043 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:16:02,046 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:16:02,049 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:16:02,054 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:16:02,058 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:16:02,058 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:16:02,062 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:16:02,062 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:16:02,066 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:16:02,066 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:16:02,070 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:16:02,071 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:16:02,074 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:16:02,075 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:16:02,079 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:16:02,079 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:16:02,083 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:16:02,083 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:16:02,083 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:16:02,087 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:16:02,087 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:16:02,087 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:16:02,092 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:16:02,099 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:16:02,099 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:16:02,099 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:16:02,099 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:16:02,100 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:16:02,105 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:16:02,109 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:16:02,110 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:16:02,110 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:16:02,110 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:16:02,110 - DEBUG - üîç Relationship Details:
2025-08-07 11:16:02,110 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:16:02,110 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:16:02,110 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:16:02,110 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:16:02,110 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:16:02,110 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:16:02,110 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:16:02,110 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:16:02,110 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:16:02,110 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:16:02,110 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:16:02,110 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:16:02,110 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:16:02,110 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:16:02,111 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:16:02,111 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:16:06,912 - INFO - Database engine created with pool_size=10
2025-08-07 11:16:15,111 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:16:15,121 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:16:15,123 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:16:15,125 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:16:15,127 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:16:15,131 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:16:15,138 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:16:15,140 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:16:15,142 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:16:15,143 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:20:08,729 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:20:08,864 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 11:20:08,864 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 11:20:08,865 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 11:20:09,037 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 11:20:09,130 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:20:09,147 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:20:09,147 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:20:09,161 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:20:09,162 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:20:09,176 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:20:09,177 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:20:09,177 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:20:09,186 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:20:09,186 - INFO - ‚úÖ Database connection established
2025-08-07 11:20:09,205 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:20:09,210 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:20:09,213 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:20:09,216 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:20:09,219 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:20:09,221 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:20:09,223 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:20:09,226 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:20:09,229 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:20:09,232 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:20:09,235 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:20:09,238 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:20:09,240 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:20:09,243 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:20:09,249 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:20:09,253 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:20:09,253 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:20:09,257 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:20:09,257 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:20:09,261 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:20:09,261 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:20:09,265 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:20:09,265 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:20:09,269 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:20:09,269 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:20:09,273 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:20:09,273 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:20:09,277 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:20:09,277 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:20:09,277 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:20:09,282 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:20:09,282 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:20:09,282 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:20:09,286 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:20:09,290 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:20:09,290 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:20:09,290 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:20:09,290 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:20:09,291 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:20:09,295 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:20:09,299 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:20:09,299 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:20:09,299 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:20:09,299 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:20:09,299 - DEBUG - üîç Relationship Details:
2025-08-07 11:20:09,299 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,299 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:20:09,299 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,299 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,300 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,300 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:20:09,300 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,300 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:20:09,300 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,300 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:20:09,300 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:20:09,300 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:20:09,300 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:20:09,300 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:20:09,300 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:20:09,300 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:20:09,302 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:20:09,302 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:20:09,303 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:20:09,594 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:20:09,594 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:20:09,610 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:20:09,610 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:20:09,610 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:20:09,611 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:20:09,611 - INFO - ‚úÖ Database connection established
2025-08-07 11:20:09,623 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:20:09,627 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:20:09,630 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:20:09,632 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:20:09,635 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:20:09,637 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:20:09,640 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:20:09,642 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:20:09,645 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:20:09,647 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:20:09,650 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:20:09,653 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:20:09,655 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:20:09,658 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:20:09,663 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:20:09,667 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:20:09,667 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:20:09,671 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:20:09,671 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:20:09,675 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:20:09,675 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:20:09,679 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:20:09,679 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:20:09,683 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:20:09,683 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:20:09,687 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:20:09,688 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:20:09,692 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:20:09,692 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:20:09,692 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:20:09,696 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:20:09,696 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:20:09,696 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:20:09,700 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:20:09,704 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:20:09,704 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:20:09,704 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:20:09,704 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:20:09,704 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:20:09,709 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:20:09,713 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:20:09,713 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:20:09,713 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:20:09,713 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:20:09,713 - DEBUG - üîç Relationship Details:
2025-08-07 11:20:09,713 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,713 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:20:09,713 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,713 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,713 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,713 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:20:09,714 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,714 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:20:09,714 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:20:09,714 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:20:09,714 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:20:09,714 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:20:09,714 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:20:09,714 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:20:09,714 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:20:09,714 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:20:12,987 - INFO - Database engine created with pool_size=10
2025-08-07 11:20:20,732 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:20:20,742 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:20:20,744 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:20:20,746 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:20:20,748 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:20:20,751 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:20:20,757 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:20:20,758 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:20:20,760 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:20:20,761 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:21:13,378 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:21:13,394 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 11:21:13,397 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:21:13,412 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:21:13,412 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:21:13,427 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:21:13,427 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:21:13,443 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:21:13,443 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:21:13,443 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:21:13,443 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:21:13,444 - INFO - ‚úÖ Database connection established
2025-08-07 11:21:13,456 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:21:13,460 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:21:13,463 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:21:13,466 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:21:13,468 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:21:13,471 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:21:13,473 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:21:13,476 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:21:13,479 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:21:13,481 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:21:13,484 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:21:13,487 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:21:13,490 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:21:13,493 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:21:13,498 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:21:13,502 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:21:13,502 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:21:13,506 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:21:13,507 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:21:13,511 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:21:13,511 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:21:13,515 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:21:13,515 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:21:13,519 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:21:13,519 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:21:13,523 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:21:13,523 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:21:13,527 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:21:13,527 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:21:13,527 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:21:13,531 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:21:13,531 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:21:13,532 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:21:13,536 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:21:13,540 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:21:13,540 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:21:13,540 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:21:13,540 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:21:13,540 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:21:13,544 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:21:13,548 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:21:13,548 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:21:13,548 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:21:13,548 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:21:13,549 - DEBUG - üîç Relationship Details:
2025-08-07 11:21:13,549 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:21:13,549 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:21:13,549 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:21:13,549 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:21:13,549 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:21:13,549 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:21:13,549 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:21:13,549 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:21:13,549 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:21:13,549 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:21:13,549 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:21:13,549 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:21:13,549 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:21:13,549 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:21:13,550 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:21:13,550 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:21:13,552 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:21:13,552 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:21:13,552 - INFO - üìå User input: list all ships
2025-08-07 11:21:13,552 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-08-07 11:21:13,552 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-08-07 11:21:13,552 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:21:13,552 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-08-07 11:21:13,553 - DEBUG - üìå Generated Prompt Length: 9890 characters
2025-08-07 11:21:13,553 - INFO - Generating SQL query...
2025-08-07 11:21:13,553 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-07 11:21:13,553 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x71e3761aa110>
2025-08-07 11:21:13,553 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 11:21:13,554 - DEBUG - send_request_headers.complete
2025-08-07 11:21:13,554 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 11:21:13,554 - DEBUG - send_request_body.complete
2025-08-07 11:21:13,554 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 11:21:26,351 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 05:51:26 GMT'), (b'Content-Length', b'351')])
2025-08-07 11:21:26,352 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 11:21:26,352 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 11:21:26,352 - DEBUG - receive_response_body.complete
2025-08-07 11:21:26,352 - DEBUG - response_closed.started
2025-08-07 11:21:26,352 - DEBUG - response_closed.complete
2025-08-07 11:21:26,352 - DEBUG - Extracting SQL from response: SELECT ship_id, ship_name FROM ships;...
2025-08-07 11:21:26,353 - INFO - Direct SQL response detected: SELECT ship_id, ship_name FROM ships;
2025-08-07 11:21:26,353 - INFO - SQL query generation completed
2025-08-07 11:21:26,353 - DEBUG - Generated SQL query: SELECT ship_id, ship_name FROM ships;
2025-08-07 11:21:26,353 - DEBUG - üìå LLM Raw Response: SELECT ship_id, ship_name FROM ships;
2025-08-07 11:21:26,353 - DEBUG - üîç Table aliases in FROM/JOIN: set()
2025-08-07 11:21:26,354 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:21:26,354 - INFO - üìå Generated Valid SQL Query: SELECT ship_id, ship_name FROM ships;
2025-08-07 11:21:26,354 - DEBUG - üîç Table aliases in FROM/JOIN: set()
2025-08-07 11:21:26,354 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:21:26,354 - INFO - ‚úÖ Query is safe and authorized!
2025-08-07 11:21:26,354 - INFO - üìå Executing SQL query: SELECT ship_id, ship_name FROM ships;
2025-08-07 11:21:26,356 - INFO - üìå Query executed successfully in 0.001 seconds. Retrieved 3 records.
2025-08-07 11:22:58,730 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:22:58,738 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:22:58,740 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:22:58,742 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:22:58,744 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:22:58,747 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:22:58,753 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:22:58,754 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:22:58,756 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:22:58,757 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:25:40,587 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:25:40,718 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 11:25:40,718 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 11:25:40,718 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 11:25:40,894 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 11:25:40,989 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:25:41,005 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:25:41,005 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:25:41,021 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:25:41,021 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:25:41,036 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:25:41,036 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:25:41,036 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:25:41,045 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:25:41,045 - INFO - ‚úÖ Database connection established
2025-08-07 11:25:41,065 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:25:41,071 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:25:41,073 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:25:41,076 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:25:41,079 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:25:41,081 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:25:41,084 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:25:41,086 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:25:41,089 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:25:41,092 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:25:41,094 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:25:41,097 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:25:41,100 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:25:41,102 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:25:41,107 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:25:41,111 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:25:41,111 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:25:41,116 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:25:41,116 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:25:41,120 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:25:41,120 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:25:41,124 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:25:41,124 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:25:41,180 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:25:41,181 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:25:41,184 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:25:41,185 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:25:41,189 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:25:41,189 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:25:41,189 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:25:41,193 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:25:41,193 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:25:41,193 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:25:41,197 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:25:41,201 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:25:41,201 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:25:41,201 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:25:41,201 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:25:41,202 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:25:41,205 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:25:41,209 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:25:41,210 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:25:41,210 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:25:41,210 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:25:41,210 - DEBUG - üîç Relationship Details:
2025-08-07 11:25:41,210 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,210 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:25:41,210 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,210 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,210 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,210 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:25:41,210 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,210 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:25:41,210 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,210 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:25:41,210 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:25:41,210 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:25:41,210 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:25:41,210 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:25:41,210 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:25:41,210 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:25:41,211 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:25:41,212 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:25:41,212 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:25:41,440 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:25:41,440 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:25:41,456 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:25:41,457 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:25:41,457 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:25:41,457 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:25:41,457 - INFO - ‚úÖ Database connection established
2025-08-07 11:25:41,470 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:25:41,474 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:25:41,477 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:25:41,480 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:25:41,483 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:25:41,486 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:25:41,488 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:25:41,491 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:25:41,494 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:25:41,497 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:25:41,500 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:25:41,503 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:25:41,505 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:25:41,508 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:25:41,513 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:25:41,518 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:25:41,518 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:25:41,522 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:25:41,522 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:25:41,526 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:25:41,526 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:25:41,530 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:25:41,530 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:25:41,534 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:25:41,534 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:25:41,538 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:25:41,538 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:25:41,543 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:25:41,543 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:25:41,543 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:25:41,547 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:25:41,547 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:25:41,547 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:25:41,551 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:25:41,556 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:25:41,556 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:25:41,556 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:25:41,556 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:25:41,556 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:25:41,560 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:25:41,564 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:25:41,564 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:25:41,564 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:25:41,564 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:25:41,564 - DEBUG - üîç Relationship Details:
2025-08-07 11:25:41,564 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,564 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:25:41,564 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,564 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,565 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,565 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:25:41,565 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,565 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:25:41,565 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:25:41,565 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:25:41,565 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:25:41,565 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:25:41,565 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:25:41,565 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:25:41,565 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:25:41,565 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:25:52,231 - INFO - Database engine created with pool_size=10
2025-08-07 11:25:52,272 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:25:52,282 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:25:52,284 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:25:52,285 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:25:52,287 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:25:52,290 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:25:52,296 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:25:52,298 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:25:52,300 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:25:52,302 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:26:14,600 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:26:14,729 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 11:26:14,729 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 11:26:14,729 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 11:26:14,904 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 11:26:14,997 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:26:15,014 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:26:15,014 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:26:15,029 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:26:15,029 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:26:15,044 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:26:15,045 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:26:15,045 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:26:15,053 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:26:15,054 - INFO - ‚úÖ Database connection established
2025-08-07 11:26:15,074 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:26:15,079 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:26:15,082 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:26:15,085 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:26:15,087 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:26:15,090 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:26:15,092 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:26:15,095 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:26:15,098 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:26:15,101 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:26:15,103 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:26:15,106 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:26:15,109 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:26:15,111 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:26:15,117 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:26:15,121 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:26:15,121 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:26:15,125 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:26:15,125 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:26:15,129 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:26:15,129 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:26:15,133 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:26:15,133 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:26:15,137 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:26:15,137 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:26:15,141 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:26:15,141 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:26:15,145 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:26:15,145 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:26:15,145 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:26:15,149 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:26:15,149 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:26:15,149 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:26:15,153 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:26:15,157 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:26:15,157 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:26:15,158 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:26:15,158 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:26:15,158 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:26:15,162 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:26:15,166 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:26:15,166 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:26:15,166 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:26:15,166 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:26:15,166 - DEBUG - üîç Relationship Details:
2025-08-07 11:26:15,166 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,166 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:26:15,166 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,166 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,166 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,166 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:26:15,166 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,166 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:26:15,166 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,166 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:26:15,166 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:26:15,166 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:26:15,166 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:26:15,166 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:26:15,166 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:26:15,166 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:26:15,168 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:26:15,168 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:26:15,168 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:26:15,394 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:26:15,394 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:26:15,410 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:26:15,411 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:26:15,411 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:26:15,411 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:26:15,411 - INFO - ‚úÖ Database connection established
2025-08-07 11:26:15,424 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:26:15,428 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:26:15,431 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:26:15,434 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:26:15,436 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:26:15,439 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:26:15,441 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:26:15,444 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:26:15,447 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:26:15,449 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:26:15,452 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:26:15,455 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:26:15,457 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:26:15,460 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:26:15,466 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:26:15,470 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:26:15,470 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:26:15,474 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:26:15,474 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:26:15,479 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:26:15,479 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:26:15,483 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:26:15,483 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:26:15,487 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:26:15,487 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:26:15,491 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:26:15,491 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:26:15,495 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:26:15,495 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:26:15,495 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:26:15,499 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:26:15,499 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:26:15,499 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:26:15,504 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:26:15,508 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:26:15,508 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:26:15,508 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:26:15,508 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:26:15,508 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:26:15,512 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:26:15,516 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:26:15,516 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:26:15,517 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:26:15,517 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:26:15,517 - DEBUG - üîç Relationship Details:
2025-08-07 11:26:15,517 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,517 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:26:15,517 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,517 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,517 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,517 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:26:15,517 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,517 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:26:15,517 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:26:15,517 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:26:15,517 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:26:15,518 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:26:15,518 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:26:15,518 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:26:15,518 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:26:15,518 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:26:16,895 - INFO - Database engine created with pool_size=10
2025-08-07 11:26:26,508 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:26:26,518 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:26:26,520 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:26:26,522 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:26:26,523 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:26:26,526 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:26:26,532 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:26:26,534 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:26:26,536 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:26:26,537 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:27:51,132 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:27:51,266 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 11:27:51,266 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 11:27:51,266 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 11:27:51,445 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 11:27:51,541 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:27:51,558 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:27:51,558 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:27:51,574 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:27:51,574 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:27:51,589 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:27:51,590 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:27:51,590 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:27:51,599 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:27:51,599 - INFO - ‚úÖ Database connection established
2025-08-07 11:27:51,620 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:27:51,626 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:27:51,628 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:27:51,631 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:27:51,634 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:27:51,637 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:27:51,639 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:27:51,642 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:27:51,645 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:27:51,648 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:27:51,650 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:27:51,653 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:27:51,656 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:27:51,659 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:27:51,664 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:27:51,668 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:27:51,668 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:27:51,673 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:27:51,673 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:27:51,676 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:27:51,677 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:27:51,680 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:27:51,680 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:27:51,684 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:27:51,684 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:27:51,688 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:27:51,688 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:27:51,692 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:27:51,692 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:27:51,692 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:27:51,696 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:27:51,696 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:27:51,696 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:27:51,700 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:27:51,704 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:27:51,704 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:27:51,704 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:27:51,704 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:27:51,704 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:27:51,708 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:27:51,712 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:27:51,712 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:27:51,712 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:27:51,712 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:27:51,712 - DEBUG - üîç Relationship Details:
2025-08-07 11:27:51,712 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:27:51,712 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:27:51,712 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:27:51,713 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:27:51,713 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:27:51,713 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:27:51,713 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:27:51,713 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:27:51,713 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:27:51,713 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:27:51,713 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:27:51,713 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:27:51,713 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:27:51,713 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:27:51,713 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:27:51,713 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:27:51,714 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:27:51,714 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:27:51,714 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:27:51,945 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:27:51,945 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:27:51,962 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:27:51,962 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:27:51,962 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:27:51,963 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:27:51,963 - INFO - ‚úÖ Database connection established
2025-08-07 11:27:51,975 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:27:51,979 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:27:51,982 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:27:51,984 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:27:51,987 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:27:51,990 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:27:51,992 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:27:51,995 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:27:51,998 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:27:52,000 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:27:52,003 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:27:52,006 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:27:52,008 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:27:52,011 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:27:52,017 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:27:52,021 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:27:52,021 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:27:52,025 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:27:52,025 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:27:52,029 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:27:52,029 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:27:52,032 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:27:52,033 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:27:52,036 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:27:52,037 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:27:52,041 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:27:52,041 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:27:52,045 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:27:52,045 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:27:52,045 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:27:52,049 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:27:52,049 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:27:52,049 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:27:52,053 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:27:52,057 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:27:52,057 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:27:52,057 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:27:52,057 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:27:52,057 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:27:52,061 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:27:52,065 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:27:52,065 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:27:52,065 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:27:52,065 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:27:52,065 - DEBUG - üîç Relationship Details:
2025-08-07 11:27:52,066 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:27:52,066 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:27:52,066 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:27:52,066 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:27:52,066 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:27:52,066 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:27:52,066 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:27:52,066 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:27:52,066 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:27:52,066 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:27:52,066 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:27:52,066 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:27:52,066 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:27:52,066 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:27:52,066 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:27:52,067 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:27:54,521 - INFO - Database engine created with pool_size=10
2025-08-07 11:28:04,638 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:28:04,648 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:28:04,650 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:28:04,652 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:28:04,654 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:28:04,657 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 11:28:04,663 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 11:28:04,665 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 11:28:04,667 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 11:28:04,668 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 11:29:13,996 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:29:14,126 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 11:29:14,126 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 11:29:14,126 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 11:29:14,298 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 11:29:14,392 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:29:14,409 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:29:14,409 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:29:14,423 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:29:14,424 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:29:14,438 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:29:14,439 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:29:14,439 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:29:14,447 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:29:14,447 - INFO - ‚úÖ Database connection established
2025-08-07 11:29:14,467 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:29:14,473 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:29:14,476 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:29:14,478 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:29:14,481 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:29:14,483 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:29:14,486 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:29:14,489 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:29:14,492 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:29:14,494 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:29:14,497 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:29:14,500 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:29:14,502 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:29:14,505 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:29:14,511 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:29:14,515 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:29:14,515 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:29:14,519 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:29:14,519 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:29:14,523 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:29:14,523 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:29:14,527 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:29:14,527 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:29:14,530 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:29:14,531 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:29:14,534 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:29:14,534 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:29:14,538 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:29:14,539 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:29:14,539 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:29:14,543 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:29:14,543 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:29:14,543 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:29:14,547 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:29:14,551 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:29:14,551 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:29:14,551 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:29:14,551 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:29:14,551 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:29:14,555 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:29:14,559 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:29:14,559 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:29:14,559 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:29:14,559 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:29:14,559 - DEBUG - üîç Relationship Details:
2025-08-07 11:29:14,559 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,560 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:29:14,560 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,560 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,560 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,560 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:29:14,560 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,560 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:29:14,560 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,560 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:29:14,560 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:29:14,560 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:29:14,560 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:29:14,560 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:29:14,560 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:29:14,560 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:29:14,562 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:29:14,563 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:29:14,563 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 11:29:14,787 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:29:14,787 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:29:14,803 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:29:14,803 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:29:14,804 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:29:14,804 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:29:14,804 - INFO - ‚úÖ Database connection established
2025-08-07 11:29:14,817 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:29:14,821 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:29:14,824 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:29:14,826 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:29:14,829 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:29:14,833 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:29:14,835 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:29:14,838 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:29:14,841 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:29:14,844 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:29:14,847 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:29:14,853 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:29:14,856 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:29:14,859 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:29:14,866 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:29:14,870 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:29:14,870 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:29:14,874 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:29:14,874 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:29:14,878 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:29:14,878 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:29:14,882 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:29:14,882 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:29:14,886 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:29:14,886 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:29:14,890 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:29:14,890 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:29:14,894 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:29:14,894 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:29:14,894 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:29:14,898 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:29:14,899 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:29:14,899 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:29:14,903 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:29:14,907 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:29:14,907 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:29:14,907 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:29:14,907 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:29:14,907 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:29:14,911 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:29:14,914 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:29:14,915 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:29:14,915 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:29:14,915 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:29:14,915 - DEBUG - üîç Relationship Details:
2025-08-07 11:29:14,915 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,915 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:29:14,915 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,915 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,915 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,915 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:29:14,915 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,915 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:29:14,915 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:29:14,915 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:29:14,915 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:29:14,915 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:29:14,915 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:29:14,915 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:29:14,915 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:29:14,915 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:51:48,041 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:51:48,057 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 11:51:48,059 - INFO - Database engine created with pool_size=10
2025-08-07 11:51:48,322 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:51:48,338 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:51:48,338 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:51:48,354 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:51:48,354 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:51:48,370 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:51:48,370 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:51:48,370 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:51:48,371 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:51:48,371 - INFO - ‚úÖ Database connection established
2025-08-07 11:51:48,383 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:51:48,387 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:51:48,390 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:51:48,393 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:51:48,395 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:51:48,398 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:51:48,400 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:51:48,403 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:51:48,406 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:51:48,409 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:51:48,412 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:51:48,415 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:51:48,418 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:51:48,421 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:51:48,426 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:51:48,431 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:51:48,431 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:51:48,435 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:51:48,435 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:51:48,439 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:51:48,439 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:51:48,443 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:51:48,443 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:51:48,447 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:51:48,447 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:51:48,451 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:51:48,451 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:51:48,455 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:51:48,456 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:51:48,456 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:51:48,459 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:51:48,460 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:51:48,460 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:51:48,464 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:51:48,468 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:51:48,468 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:51:48,468 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:51:48,469 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:51:48,469 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:51:48,473 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:51:48,477 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:51:48,477 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:51:48,477 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:51:48,478 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:51:48,478 - DEBUG - üîç Relationship Details:
2025-08-07 11:51:48,478 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:51:48,478 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:51:48,478 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:51:48,478 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:51:48,478 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:51:48,478 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:51:48,478 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:51:48,478 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:51:48,478 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:51:48,478 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:51:48,478 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:51:48,478 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:51:48,478 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:51:48,478 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:51:48,478 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:51:48,478 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:51:48,479 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:51:48,480 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:51:48,480 - INFO - üìå User input: list all equipment of ins one
2025-08-07 11:51:48,480 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment of ins one
2025-08-07 11:51:48,480 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment of ins one
2025-08-07 11:51:48,480 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:51:48,480 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment of ins one
2025-08-07 11:51:48,480 - DEBUG - üìå Generated Prompt Length: 9905 characters
2025-08-07 11:51:48,480 - INFO - Generating SQL query...
2025-08-07 11:51:48,481 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-07 11:51:48,481 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7dbe1a420ad0>
2025-08-07 11:51:48,481 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 11:51:48,481 - DEBUG - send_request_headers.complete
2025-08-07 11:51:48,481 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 11:51:48,481 - DEBUG - send_request_body.complete
2025-08-07 11:51:48,481 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 11:51:57,059 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 06:21:57 GMT'), (b'Content-Length', b'492')])
2025-08-07 11:51:57,060 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 11:51:57,060 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 11:51:57,060 - DEBUG - receive_response_body.complete
2025-08-07 11:51:57,060 - DEBUG - response_closed.started
2025-08-07 11:51:57,060 - DEBUG - response_closed.complete
2025-08-07 11:51:57,061 - DEBUG - Extracting SQL from response: SELECT * FROM system_configuration sc
JOIN departments d ON sc.department_id = d.department_id
JOIN ships s ON d.ship_id = s.ship_id
WHERE UPPER(s.ship_name) = UPPER('INS ONE')...
2025-08-07 11:51:57,061 - INFO - Direct SQL response detected: SELECT * FROM system_configuration sc
JOIN departments d ON sc.department_id = d.department_id
JOIN ships s ON d.ship_id = s.ship_id
WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:51:57,061 - INFO - SQL query generation completed
2025-08-07 11:51:57,061 - DEBUG - Generated SQL query: SELECT * FROM system_configuration sc
JOIN departments d ON sc.department_id = d.department_id
JOIN ships s ON d.ship_id = s.ship_id
WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:51:57,061 - DEBUG - üìå LLM Raw Response: SELECT * FROM system_configuration sc
JOIN departments d ON sc.department_id = d.department_id
JOIN ships s ON d.ship_id = s.ship_id
WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:51:57,062 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'd', 's'}
2025-08-07 11:51:57,062 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:51:57,062 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:51:57,062 - INFO - üìå Generated Valid SQL Query: SELECT * FROM system_configuration sc JOIN departments d ON sc.department_id = d.department_id JOIN ships s ON d.ship_id = s.ship_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:51:57,062 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'd', 's'}
2025-08-07 11:51:57,063 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:51:57,063 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:51:57,063 - INFO - ‚úÖ Query is safe and authorized!
2025-08-07 11:51:57,063 - INFO - üìå Executing SQL query: SELECT * FROM system_configuration sc JOIN departments d ON sc.department_id = d.department_id JOIN ships s ON d.ship_id = s.ship_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:51:57,870 - INFO - üìå Query executed successfully in 0.807 seconds. Retrieved 21 records.
2025-08-07 11:56:15,267 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:56:15,283 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 11:56:15,286 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:56:15,301 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:56:15,301 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:56:15,317 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:56:15,317 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:56:15,334 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:56:15,334 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:56:15,334 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:56:15,334 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:56:15,334 - INFO - ‚úÖ Database connection established
2025-08-07 11:56:15,349 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:56:15,353 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:56:15,356 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:56:15,358 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:56:15,361 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:56:15,363 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:56:15,366 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:56:15,368 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:56:15,371 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:56:15,374 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:56:15,377 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:56:15,380 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:56:15,382 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:56:15,385 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:56:15,390 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:56:15,394 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:56:15,394 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:56:15,399 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:56:15,399 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:56:15,403 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:56:15,403 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:56:15,407 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:56:15,407 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:56:15,411 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:56:15,411 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:56:15,415 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:56:15,415 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:56:15,419 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:56:15,419 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:56:15,420 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:56:15,424 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:56:15,424 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:56:15,424 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:56:15,428 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:56:15,432 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:56:15,432 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:56:15,432 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:56:15,432 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:56:15,432 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:56:15,436 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:56:15,440 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:56:15,441 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:56:15,441 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:56:15,441 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:56:15,441 - DEBUG - üîç Relationship Details:
2025-08-07 11:56:15,441 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:56:15,441 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:56:15,441 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:56:15,441 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:56:15,441 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:56:15,441 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:56:15,441 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:56:15,441 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:56:15,441 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:56:15,441 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:56:15,441 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:56:15,441 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:56:15,441 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:56:15,441 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:56:15,441 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:56:15,441 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:56:15,443 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:56:15,443 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:56:15,443 - INFO - üìå User input: list all equipment on ins one
2025-08-07 11:56:15,443 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment on ins one
2025-08-07 11:56:15,443 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment on ins one
2025-08-07 11:56:15,443 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:56:15,443 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment on ins one
2025-08-07 11:56:15,444 - DEBUG - üìå Generated Prompt Length: 9920 characters
2025-08-07 11:56:15,444 - INFO - Generating SQL query...
2025-08-07 11:56:15,444 - DEBUG - close.started
2025-08-07 11:56:15,444 - DEBUG - close.complete
2025-08-07 11:56:15,444 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-07 11:56:15,444 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7dbe1a3f4ed0>
2025-08-07 11:56:15,444 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 11:56:15,445 - DEBUG - send_request_headers.complete
2025-08-07 11:56:15,445 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 11:56:15,445 - DEBUG - send_request_body.complete
2025-08-07 11:56:15,445 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 11:56:18,924 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 06:26:18 GMT'), (b'Content-Length', b'807')])
2025-08-07 11:56:18,924 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 11:56:18,925 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 11:56:18,925 - DEBUG - receive_response_body.complete
2025-08-07 11:56:18,925 - DEBUG - response_closed.started
2025-08-07 11:56:18,925 - DEBUG - response_closed.complete
2025-08-07 11:56:18,925 - DEBUG - Extracting SQL from response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
           ...
2025-08-07 11:56:18,925 - INFO - Direct SQL response detected: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:56:18,925 - INFO - SQL query generation completed
2025-08-07 11:56:18,925 - DEBUG - Generated SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:56:18,925 - DEBUG - üìå LLM Raw Response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:56:18,925 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'sm', 'd', 's'}
2025-08-07 11:56:18,925 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:56:18,926 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:56:18,926 - INFO - üìå Generated Valid SQL Query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:56:18,926 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'sm', 'd', 's'}
2025-08-07 11:56:18,926 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:56:18,926 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:56:18,926 - INFO - ‚úÖ Query is safe and authorized!
2025-08-07 11:56:18,926 - INFO - üìå Executing SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:56:18,970 - INFO - üìå Query executed successfully in 0.044 seconds. Retrieved 3 records.
2025-08-07 11:56:51,030 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:56:51,045 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 11:56:51,054 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:56:51,069 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:56:51,069 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:56:51,084 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:56:51,085 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:56:51,100 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:56:51,100 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:56:51,100 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:56:51,101 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:56:51,101 - INFO - ‚úÖ Database connection established
2025-08-07 11:56:51,113 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:56:51,117 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:56:51,120 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:56:51,123 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:56:51,125 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:56:51,128 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:56:51,130 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:56:51,133 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:56:51,136 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:56:51,139 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:56:51,141 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:56:51,144 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:56:51,147 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:56:51,150 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:56:51,155 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:56:51,159 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:56:51,159 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:56:51,164 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:56:51,164 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:56:51,168 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:56:51,168 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:56:51,172 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:56:51,172 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:56:51,176 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:56:51,176 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:56:51,180 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:56:51,180 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:56:51,184 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:56:51,184 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:56:51,184 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:56:51,188 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:56:51,188 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:56:51,188 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:56:51,192 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:56:51,197 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:56:51,197 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:56:51,197 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:56:51,197 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:56:51,197 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:56:51,201 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:56:51,205 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:56:51,205 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:56:51,205 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:56:51,205 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:56:51,205 - DEBUG - üîç Relationship Details:
2025-08-07 11:56:51,205 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:56:51,205 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:56:51,205 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:56:51,205 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:56:51,205 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:56:51,205 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:56:51,205 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:56:51,205 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:56:51,205 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:56:51,205 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:56:51,205 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:56:51,206 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:56:51,206 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:56:51,206 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:56:51,206 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:56:51,206 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:56:51,207 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:56:51,207 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:56:51,207 - INFO - üìå User input: list all equipment on ins one
2025-08-07 11:56:51,207 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment on ins one
2025-08-07 11:56:51,207 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment on ins one
2025-08-07 11:56:51,207 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:56:51,207 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all sensors', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment on ins one
2025-08-07 11:56:51,207 - DEBUG - üìå Generated Prompt Length: 9935 characters
2025-08-07 11:56:51,207 - INFO - Generating SQL query...
2025-08-07 11:56:51,208 - DEBUG - close.started
2025-08-07 11:56:51,208 - DEBUG - close.complete
2025-08-07 11:56:51,208 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-07 11:56:51,208 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7dbe1a49ffd0>
2025-08-07 11:56:51,208 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 11:56:51,208 - DEBUG - send_request_headers.complete
2025-08-07 11:56:51,208 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 11:56:51,208 - DEBUG - send_request_body.complete
2025-08-07 11:56:51,209 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 11:56:54,708 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 06:26:54 GMT'), (b'Content-Length', b'807')])
2025-08-07 11:56:54,709 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 11:56:54,709 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 11:56:54,709 - DEBUG - receive_response_body.complete
2025-08-07 11:56:54,709 - DEBUG - response_closed.started
2025-08-07 11:56:54,709 - DEBUG - response_closed.complete
2025-08-07 11:56:54,709 - DEBUG - Extracting SQL from response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
           ...
2025-08-07 11:56:54,709 - INFO - Direct SQL response detected: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:56:54,709 - INFO - SQL query generation completed
2025-08-07 11:56:54,710 - DEBUG - Generated SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:56:54,710 - DEBUG - üìå LLM Raw Response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:56:54,710 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'sm', 'd', 's'}
2025-08-07 11:56:54,710 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:56:54,710 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:56:54,710 - INFO - üìå Generated Valid SQL Query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:56:54,710 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'sm', 'd', 's'}
2025-08-07 11:56:54,710 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:56:54,710 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:56:54,710 - INFO - ‚úÖ Query is safe and authorized!
2025-08-07 11:56:54,710 - INFO - üìå Executing SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:56:54,713 - INFO - üìå Query executed successfully in 0.002 seconds. Retrieved 3 records.
2025-08-07 11:57:15,828 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:57:15,844 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 11:57:15,847 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:57:15,862 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:57:15,862 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:57:15,877 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:57:15,877 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:57:15,893 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:57:15,893 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:57:15,893 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:57:15,893 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:57:15,893 - INFO - ‚úÖ Database connection established
2025-08-07 11:57:15,908 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:57:15,912 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:57:15,916 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:57:15,918 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:57:15,921 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:57:15,924 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:57:15,927 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:57:15,930 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:57:15,933 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:57:15,936 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:57:15,939 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:57:15,943 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:57:15,946 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:57:15,949 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:57:15,954 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:57:15,958 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:57:15,958 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:57:15,962 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:57:15,962 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:57:15,966 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:57:15,966 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:57:15,970 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:57:15,970 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:57:15,974 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:57:15,974 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:57:15,978 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:57:15,978 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:57:15,982 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:57:15,982 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:57:15,983 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:57:15,986 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:57:15,987 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:57:15,987 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:57:15,990 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:57:15,994 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:57:15,994 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:57:15,995 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:57:15,995 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:57:15,995 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:57:15,999 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:57:16,003 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:57:16,003 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:57:16,003 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:57:16,003 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:57:16,003 - DEBUG - üîç Relationship Details:
2025-08-07 11:57:16,003 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:57:16,003 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:57:16,003 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:57:16,003 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:57:16,003 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:57:16,003 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:57:16,003 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:57:16,003 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:57:16,003 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:57:16,004 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:57:16,004 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:57:16,004 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:57:16,004 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:57:16,004 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:57:16,004 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:57:16,004 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:57:16,005 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:57:16,005 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:57:16,005 - INFO - üìå User input: list all equipment of ins one
2025-08-07 11:57:16,005 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment of ins one
2025-08-07 11:57:16,005 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment of ins one
2025-08-07 11:57:16,005 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:57:16,005 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all equipment of ins one
2025-08-07 11:57:16,006 - DEBUG - üìå Generated Prompt Length: 9948 characters
2025-08-07 11:57:16,006 - INFO - Generating SQL query...
2025-08-07 11:57:16,006 - DEBUG - close.started
2025-08-07 11:57:16,006 - DEBUG - close.complete
2025-08-07 11:57:16,006 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-07 11:57:16,006 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7dbe199bdd10>
2025-08-07 11:57:16,006 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 11:57:16,007 - DEBUG - send_request_headers.complete
2025-08-07 11:57:16,007 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 11:57:16,007 - DEBUG - send_request_body.complete
2025-08-07 11:57:16,007 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 11:57:19,536 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 06:27:19 GMT'), (b'Content-Length', b'807')])
2025-08-07 11:57:19,536 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 11:57:19,536 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 11:57:19,536 - DEBUG - receive_response_body.complete
2025-08-07 11:57:19,537 - DEBUG - response_closed.started
2025-08-07 11:57:19,537 - DEBUG - response_closed.complete
2025-08-07 11:57:19,537 - DEBUG - Extracting SQL from response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
           ...
2025-08-07 11:57:19,537 - INFO - Direct SQL response detected: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:57:19,537 - INFO - SQL query generation completed
2025-08-07 11:57:19,537 - DEBUG - Generated SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:57:19,537 - DEBUG - üìå LLM Raw Response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:57:19,537 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'sm', 'd', 's'}
2025-08-07 11:57:19,537 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:57:19,537 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:57:19,537 - INFO - üìå Generated Valid SQL Query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:57:19,538 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'sm', 'd', 's'}
2025-08-07 11:57:19,538 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:57:19,538 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:57:19,538 - INFO - ‚úÖ Query is safe and authorized!
2025-08-07 11:57:19,538 - INFO - üìå Executing SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:57:19,540 - INFO - üìå Query executed successfully in 0.002 seconds. Retrieved 3 records.
2025-08-07 11:57:46,444 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:57:46,459 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 11:57:46,462 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:57:46,477 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:57:46,477 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:57:46,493 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:57:46,493 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:57:46,508 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:57:46,508 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:57:46,508 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:57:46,509 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:57:46,509 - INFO - ‚úÖ Database connection established
2025-08-07 11:57:46,521 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:57:46,526 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:57:46,529 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:57:46,531 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:57:46,534 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:57:46,537 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:57:46,539 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:57:46,542 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:57:46,545 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:57:46,548 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:57:46,550 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:57:46,553 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:57:46,556 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:57:46,559 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:57:46,564 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:57:46,569 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:57:46,569 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:57:46,573 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:57:46,573 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:57:46,578 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:57:46,578 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:57:46,583 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:57:46,583 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:57:46,587 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:57:46,587 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:57:46,592 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:57:46,592 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:57:46,598 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:57:46,598 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:57:46,599 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:57:46,603 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:57:46,603 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:57:46,603 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:57:46,608 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:57:46,613 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:57:46,613 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:57:46,613 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:57:46,613 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:57:46,613 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:57:46,617 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:57:46,621 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:57:46,621 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:57:46,621 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:57:46,621 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:57:46,621 - DEBUG - üîç Relationship Details:
2025-08-07 11:57:46,621 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:57:46,621 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:57:46,622 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:57:46,622 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:57:46,622 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:57:46,622 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:57:46,622 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:57:46,622 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:57:46,622 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:57:46,622 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:57:46,622 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:57:46,622 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:57:46,622 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:57:46,622 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:57:46,622 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:57:46,622 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:57:46,623 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:57:46,623 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:57:46,623 - INFO - üìå User input: what are all the equipment on ins one
2025-08-07 11:57:46,623 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what are all the equipment on ins one
2025-08-07 11:57:46,624 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what are all the equipment on ins one
2025-08-07 11:57:46,624 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:57:46,624 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what are all the equipment on ins one
2025-08-07 11:57:46,624 - DEBUG - üìå Generated Prompt Length: 9971 characters
2025-08-07 11:57:46,624 - INFO - Generating SQL query...
2025-08-07 11:57:46,624 - DEBUG - close.started
2025-08-07 11:57:46,624 - DEBUG - close.complete
2025-08-07 11:57:46,624 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-07 11:57:46,625 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7dbe1bfdb610>
2025-08-07 11:57:46,625 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 11:57:46,625 - DEBUG - send_request_headers.complete
2025-08-07 11:57:46,625 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 11:57:46,625 - DEBUG - send_request_body.complete
2025-08-07 11:57:46,625 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 11:57:50,113 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 06:27:50 GMT'), (b'Content-Length', b'807')])
2025-08-07 11:57:50,114 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 11:57:50,114 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 11:57:50,114 - DEBUG - receive_response_body.complete
2025-08-07 11:57:50,114 - DEBUG - response_closed.started
2025-08-07 11:57:50,114 - DEBUG - response_closed.complete
2025-08-07 11:57:50,114 - DEBUG - Extracting SQL from response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
           ...
2025-08-07 11:57:50,115 - INFO - Direct SQL response detected: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:57:50,115 - INFO - SQL query generation completed
2025-08-07 11:57:50,115 - DEBUG - Generated SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:57:50,115 - DEBUG - üìå LLM Raw Response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:57:50,115 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'sm', 'd', 's'}
2025-08-07 11:57:50,115 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:57:50,115 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:57:50,115 - INFO - üìå Generated Valid SQL Query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:57:50,115 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'sm', 'd', 's'}
2025-08-07 11:57:50,115 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:57:50,115 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:57:50,115 - INFO - ‚úÖ Query is safe and authorized!
2025-08-07 11:57:50,115 - INFO - üìå Executing SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:57:50,118 - INFO - üìå Query executed successfully in 0.002 seconds. Retrieved 3 records.
2025-08-07 11:59:32,069 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:59:32,085 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 11:59:32,088 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:59:32,103 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:59:32,103 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:59:32,119 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 11:59:32,119 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 11:59:32,134 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 11:59:32,134 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 11:59:32,134 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 11:59:32,135 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 11:59:32,135 - INFO - ‚úÖ Database connection established
2025-08-07 11:59:32,148 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:59:32,153 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 11:59:32,156 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 11:59:32,159 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 11:59:32,161 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 11:59:32,164 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 11:59:32,166 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 11:59:32,169 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 11:59:32,172 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 11:59:32,174 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 11:59:32,177 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 11:59:32,180 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 11:59:32,182 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 11:59:32,185 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 11:59:32,190 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 11:59:32,194 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:59:32,194 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 11:59:32,198 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 11:59:32,198 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 11:59:32,202 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:59:32,202 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 11:59:32,206 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:59:32,206 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 11:59:32,210 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 11:59:32,210 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 11:59:32,214 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 11:59:32,214 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 11:59:32,218 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 11:59:32,218 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 11:59:32,218 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 11:59:32,222 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 11:59:32,222 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 11:59:32,223 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 11:59:32,227 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 11:59:32,231 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 11:59:32,231 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 11:59:32,231 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 11:59:32,231 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 11:59:32,231 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 11:59:32,235 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 11:59:32,239 - DEBUG - üîó Foreign keys for users: []
2025-08-07 11:59:32,239 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 11:59:32,239 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:59:32,239 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 11:59:32,239 - DEBUG - üîç Relationship Details:
2025-08-07 11:59:32,240 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:59:32,240 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 11:59:32,240 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 11:59:32,240 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 11:59:32,240 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 11:59:32,240 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 11:59:32,240 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 11:59:32,240 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 11:59:32,240 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 11:59:32,240 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 11:59:32,240 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 11:59:32,240 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 11:59:32,240 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 11:59:32,240 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 11:59:32,240 - INFO - üìå Maritime system initialization complete.
2025-08-07 11:59:32,240 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 11:59:32,241 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 11:59:32,241 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 11:59:32,242 - INFO - üìå User input: list all sensors on ins one
2025-08-07 11:59:32,242 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all sensors on ins one
2025-08-07 11:59:32,242 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all sensors on ins one
2025-08-07 11:59:32,242 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 11:59:32,242 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all sensors on ins one
2025-08-07 11:59:32,242 - DEBUG - üìå Generated Prompt Length: 9984 characters
2025-08-07 11:59:32,242 - INFO - Generating SQL query...
2025-08-07 11:59:32,242 - DEBUG - close.started
2025-08-07 11:59:32,242 - DEBUG - close.complete
2025-08-07 11:59:32,243 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-07 11:59:32,243 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7dbe1991fd10>
2025-08-07 11:59:32,243 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 11:59:32,243 - DEBUG - send_request_headers.complete
2025-08-07 11:59:32,243 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 11:59:32,243 - DEBUG - send_request_body.complete
2025-08-07 11:59:32,243 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 11:59:35,754 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 06:29:35 GMT'), (b'Content-Length', b'807')])
2025-08-07 11:59:35,755 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 11:59:35,755 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 11:59:35,755 - DEBUG - receive_response_body.complete
2025-08-07 11:59:35,755 - DEBUG - response_closed.started
2025-08-07 11:59:35,755 - DEBUG - response_closed.complete
2025-08-07 11:59:35,755 - DEBUG - Extracting SQL from response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
           ...
2025-08-07 11:59:35,755 - INFO - Direct SQL response detected: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:59:35,755 - INFO - SQL query generation completed
2025-08-07 11:59:35,755 - DEBUG - Generated SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:59:35,755 - DEBUG - üìå LLM Raw Response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:59:35,755 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'sm', 'd', 's'}
2025-08-07 11:59:35,756 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:59:35,756 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:59:35,756 - INFO - üìå Generated Valid SQL Query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:59:35,756 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'sm', 'd', 's'}
2025-08-07 11:59:35,756 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-07 11:59:35,756 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 11:59:35,756 - INFO - ‚úÖ Query is safe and authorized!
2025-08-07 11:59:35,756 - INFO - üìå Executing SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-07 11:59:35,758 - INFO - üìå Query executed successfully in 0.002 seconds. Retrieved 3 records.
2025-08-07 12:01:14,897 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 12:01:14,912 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 12:01:15,011 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 12:01:15,027 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 12:01:15,027 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 12:01:15,042 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 12:01:15,042 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 12:01:15,057 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 12:01:15,057 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 12:01:15,057 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 12:01:15,058 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 12:01:15,058 - INFO - ‚úÖ Database connection established
2025-08-07 12:01:15,070 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 12:01:15,074 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 12:01:15,077 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 12:01:15,080 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 12:01:15,082 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 12:01:15,085 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 12:01:15,087 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 12:01:15,090 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 12:01:15,093 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 12:01:15,096 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 12:01:15,099 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 12:01:15,102 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 12:01:15,104 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 12:01:15,107 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 12:01:15,112 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 12:01:15,116 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 12:01:15,116 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 12:01:15,120 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 12:01:15,120 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 12:01:15,124 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 12:01:15,124 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 12:01:15,128 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 12:01:15,128 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 12:01:15,132 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 12:01:15,132 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 12:01:15,136 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 12:01:15,136 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 12:01:15,140 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 12:01:15,140 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 12:01:15,140 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 12:01:15,145 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 12:01:15,145 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 12:01:15,145 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 12:01:15,149 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 12:01:15,153 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 12:01:15,153 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 12:01:15,153 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 12:01:15,153 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 12:01:15,153 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 12:01:15,157 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 12:01:15,161 - DEBUG - üîó Foreign keys for users: []
2025-08-07 12:01:15,161 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 12:01:15,162 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 12:01:15,162 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 12:01:15,162 - DEBUG - üîç Relationship Details:
2025-08-07 12:01:15,162 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 12:01:15,162 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 12:01:15,162 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 12:01:15,162 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 12:01:15,162 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 12:01:15,162 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 12:01:15,162 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 12:01:15,162 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 12:01:15,162 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 12:01:15,162 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 12:01:15,162 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 12:01:15,162 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 12:01:15,162 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 12:01:15,162 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 12:01:15,162 - INFO - üìå Maritime system initialization complete.
2025-08-07 12:01:15,162 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 12:01:15,164 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 12:01:15,164 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 12:01:15,164 - INFO - üìå User input: what are the failure modes of GT_1_S2 sensor??
2025-08-07 12:01:15,164 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what are the failure modes of GT_1_S2 sensor??
2025-08-07 12:01:15,164 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what are the failure modes of GT_1_S2 sensor??
2025-08-07 12:01:15,164 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 12:01:15,164 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what are the failure modes of GT_1_S2 sensor??
2025-08-07 12:01:15,164 - DEBUG - üìå Generated Prompt Length: 10001 characters
2025-08-07 12:01:15,164 - INFO - Generating SQL query...
2025-08-07 12:01:15,165 - DEBUG - close.started
2025-08-07 12:01:15,165 - DEBUG - close.complete
2025-08-07 12:01:15,165 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-07 12:01:15,165 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7dbe13f35f90>
2025-08-07 12:01:15,165 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 12:01:15,165 - DEBUG - send_request_headers.complete
2025-08-07 12:01:15,165 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 12:01:15,165 - DEBUG - send_request_body.complete
2025-08-07 12:01:15,165 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 12:01:17,114 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 06:31:17 GMT'), (b'Content-Length', b'494')])
2025-08-07 12:01:17,114 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 12:01:17,114 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 12:01:17,114 - DEBUG - receive_response_body.complete
2025-08-07 12:01:17,114 - DEBUG - response_closed.started
2025-08-07 12:01:17,114 - DEBUG - response_closed.complete
2025-08-07 12:01:17,115 - DEBUG - Extracting SQL from response: SELECT fm.failure_mode_id, fm.name, fm.severity
FROM system_configuration sc
JOIN failure_modes fm ON sc.component_id = fm.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT_1_S2')...
2025-08-07 12:01:17,115 - INFO - Direct SQL response detected: SELECT fm.failure_mode_id, fm.name, fm.severity
FROM system_configuration sc
JOIN failure_modes fm ON sc.component_id = fm.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT_1_S2')
2025-08-07 12:01:17,115 - INFO - SQL query generation completed
2025-08-07 12:01:17,115 - DEBUG - Generated SQL query: SELECT fm.failure_mode_id, fm.name, fm.severity
FROM system_configuration sc
JOIN failure_modes fm ON sc.component_id = fm.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT_1_S2')
2025-08-07 12:01:17,115 - DEBUG - üìå LLM Raw Response: SELECT fm.failure_mode_id, fm.name, fm.severity
FROM system_configuration sc
JOIN failure_modes fm ON sc.component_id = fm.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT_1_S2')
2025-08-07 12:01:17,115 - DEBUG - üîç Table aliases in FROM/JOIN: {'fm', 'sc'}
2025-08-07 12:01:17,115 - DEBUG - üîç Table aliases in WHERE: {'sc'}
2025-08-07 12:01:17,115 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 12:01:17,115 - INFO - üìå Generated Valid SQL Query: SELECT fm.failure_mode_id, fm.name, fm.severity FROM system_configuration sc JOIN failure_modes fm ON sc.component_id = fm.component_id WHERE UPPER(sc.nomenclature) = UPPER('GT_1_S2')
2025-08-07 12:01:17,115 - DEBUG - üîç Table aliases in FROM/JOIN: {'fm', 'sc'}
2025-08-07 12:01:17,115 - DEBUG - üîç Table aliases in WHERE: {'sc'}
2025-08-07 12:01:17,115 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 12:01:17,115 - INFO - ‚úÖ Query is safe and authorized!
2025-08-07 12:01:17,115 - INFO - üìå Executing SQL query: SELECT fm.failure_mode_id, fm.name, fm.severity FROM system_configuration sc JOIN failure_modes fm ON sc.component_id = fm.component_id WHERE UPPER(sc.nomenclature) = UPPER('GT_1_S2')
2025-08-07 12:01:19,310 - INFO - üìå Query executed successfully in 2.195 seconds, but no records were found.
2025-08-07 12:14:40,397 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 12:14:40,412 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 12:14:40,446 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 12:14:40,447 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7dbe1a49ff50>
2025-08-07 12:14:40,447 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 12:14:40,447 - DEBUG - send_request_headers.complete
2025-08-07 12:14:40,447 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 12:14:40,447 - DEBUG - send_request_body.complete
2025-08-07 12:14:40,447 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 12:14:50,711 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 06:44:50 GMT'), (b'Content-Length', b'710')])
2025-08-07 12:14:50,712 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 12:14:50,712 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 12:14:50,712 - DEBUG - receive_response_body.complete
2025-08-07 12:14:50,712 - DEBUG - response_closed.started
2025-08-07 12:14:50,712 - DEBUG - response_closed.complete
2025-08-07 12:14:50,712 - DEBUG - close.started
2025-08-07 12:14:50,713 - DEBUG - close.complete
2025-08-07 17:46:16,927 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 17:46:18,078 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 17:46:18,078 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 17:46:18,078 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 17:46:19,521 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 17:46:19,772 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 17:46:19,789 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 17:46:19,790 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 17:46:19,805 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 17:46:19,805 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 17:46:19,820 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 17:46:19,820 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 17:46:19,820 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 17:46:19,924 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 17:46:19,924 - INFO - ‚úÖ Database connection established
2025-08-07 17:46:20,163 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 17:46:20,168 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 17:46:20,171 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 17:46:20,174 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 17:46:20,177 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 17:46:20,180 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 17:46:20,183 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 17:46:20,186 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 17:46:20,189 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 17:46:20,191 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 17:46:20,194 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 17:46:20,197 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 17:46:20,200 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 17:46:20,203 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 17:46:20,208 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 17:46:20,212 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:20,212 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 17:46:20,217 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 17:46:20,217 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 17:46:20,221 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:20,221 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 17:46:20,225 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:20,225 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 17:46:20,229 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:20,229 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 17:46:20,233 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 17:46:20,234 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 17:46:20,238 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 17:46:20,238 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 17:46:20,238 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 17:46:20,242 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 17:46:20,243 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 17:46:20,243 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 17:46:20,247 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 17:46:20,251 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 17:46:20,251 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 17:46:20,251 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 17:46:20,251 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 17:46:20,251 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 17:46:20,255 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 17:46:20,260 - DEBUG - üîó Foreign keys for users: []
2025-08-07 17:46:20,260 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 17:46:20,260 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 17:46:20,260 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 17:46:20,260 - DEBUG - üîç Relationship Details:
2025-08-07 17:46:20,260 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 17:46:20,260 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 17:46:20,260 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 17:46:20,260 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 17:46:20,260 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 17:46:20,260 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 17:46:20,260 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 17:46:20,260 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 17:46:20,260 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 17:46:20,260 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 17:46:20,260 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 17:46:20,260 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 17:46:20,260 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 17:46:20,260 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 17:46:20,260 - INFO - üìå Maritime system initialization complete.
2025-08-07 17:46:20,261 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 17:46:20,262 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 17:46:20,262 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 17:46:20,262 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 17:46:21,090 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 17:46:21,090 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 17:46:21,107 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 17:46:21,107 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 17:46:21,107 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 17:46:21,108 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 17:46:21,108 - INFO - ‚úÖ Database connection established
2025-08-07 17:46:21,121 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 17:46:21,125 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 17:46:21,128 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 17:46:21,131 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 17:46:21,133 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 17:46:21,136 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 17:46:21,139 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 17:46:21,142 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 17:46:21,145 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 17:46:21,148 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 17:46:21,151 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 17:46:21,154 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 17:46:21,157 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 17:46:21,160 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 17:46:21,166 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 17:46:21,170 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:21,170 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 17:46:21,174 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 17:46:21,174 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 17:46:21,179 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:21,179 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 17:46:21,183 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:21,184 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 17:46:21,188 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:21,188 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 17:46:21,192 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 17:46:21,192 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 17:46:21,197 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 17:46:21,197 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 17:46:21,197 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 17:46:21,201 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 17:46:21,201 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 17:46:21,201 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 17:46:21,206 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 17:46:21,211 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 17:46:21,211 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 17:46:21,211 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 17:46:21,211 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 17:46:21,211 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 17:46:21,216 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 17:46:21,220 - DEBUG - üîó Foreign keys for users: []
2025-08-07 17:46:21,220 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 17:46:21,220 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 17:46:21,220 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 17:46:21,220 - DEBUG - üîç Relationship Details:
2025-08-07 17:46:21,220 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 17:46:21,220 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 17:46:21,220 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 17:46:21,220 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 17:46:21,220 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 17:46:21,220 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 17:46:21,220 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 17:46:21,220 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 17:46:21,220 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 17:46:21,220 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 17:46:21,220 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 17:46:21,220 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 17:46:21,221 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 17:46:21,221 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 17:46:21,221 - INFO - üìå Maritime system initialization complete.
2025-08-07 17:46:21,221 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 17:46:56,682 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 17:46:56,698 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 17:46:56,700 - INFO - Database engine created with pool_size=10
2025-08-07 17:46:57,568 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 17:46:57,584 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 17:46:57,584 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 17:46:57,599 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 17:46:57,599 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 17:46:57,615 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 17:46:57,615 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 17:46:57,615 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 17:46:57,616 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 17:46:57,616 - INFO - ‚úÖ Database connection established
2025-08-07 17:46:57,628 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 17:46:57,633 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 17:46:57,635 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 17:46:57,638 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 17:46:57,641 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 17:46:57,643 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 17:46:57,646 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 17:46:57,649 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 17:46:57,652 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 17:46:57,655 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 17:46:57,658 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 17:46:57,661 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 17:46:57,664 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 17:46:57,667 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 17:46:57,673 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 17:46:57,677 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:57,677 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 17:46:57,683 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 17:46:57,683 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 17:46:57,688 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:57,688 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 17:46:57,692 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:57,693 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 17:46:57,698 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 17:46:57,698 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 17:46:57,703 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 17:46:57,703 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 17:46:57,708 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 17:46:57,708 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 17:46:57,708 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 17:46:57,712 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 17:46:57,712 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 17:46:57,713 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 17:46:57,717 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 17:46:57,721 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 17:46:57,722 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 17:46:57,722 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 17:46:57,722 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 17:46:57,722 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 17:46:57,726 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 17:46:57,731 - DEBUG - üîó Foreign keys for users: []
2025-08-07 17:46:57,731 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 17:46:57,731 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 17:46:57,731 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 17:46:57,731 - DEBUG - üîç Relationship Details:
2025-08-07 17:46:57,731 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 17:46:57,731 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 17:46:57,731 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 17:46:57,732 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 17:46:57,732 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 17:46:57,732 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 17:46:57,732 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 17:46:57,732 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 17:46:57,732 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 17:46:57,732 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 17:46:57,732 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 17:46:57,732 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 17:46:57,732 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 17:46:57,732 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 17:46:57,732 - INFO - üìå Maritime system initialization complete.
2025-08-07 17:46:57,732 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 17:46:57,734 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 17:46:57,734 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 17:46:57,735 - INFO - üìå User input: list all ships
2025-08-07 17:46:57,735 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-08-07 17:46:57,735 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-08-07 17:46:57,735 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 17:46:57,735 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-08-07 17:46:57,735 - DEBUG - üìå Generated Prompt Length: 9986 characters
2025-08-07 17:46:57,735 - INFO - Generating SQL query...
2025-08-07 17:46:57,736 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-07 17:46:57,736 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7a054fa30cd0>
2025-08-07 17:46:57,736 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 17:46:57,737 - DEBUG - send_request_headers.complete
2025-08-07 17:46:57,737 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 17:46:57,737 - DEBUG - send_request_body.complete
2025-08-07 17:46:57,737 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 17:47:51,379 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 12:17:51 GMT'), (b'Content-Length', b'358')])
2025-08-07 17:47:51,380 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 17:47:51,380 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 17:47:51,380 - DEBUG - receive_response_body.complete
2025-08-07 17:47:51,380 - DEBUG - response_closed.started
2025-08-07 17:47:51,380 - DEBUG - response_closed.complete
2025-08-07 17:47:51,380 - DEBUG - Extracting SQL from response: SELECT s.ship_id, s.ship_name
FROM ships s;...
2025-08-07 17:47:51,381 - INFO - Direct SQL response detected: SELECT s.ship_id, s.ship_name
FROM ships s;
2025-08-07 17:47:51,381 - INFO - SQL query generation completed
2025-08-07 17:47:51,381 - DEBUG - Generated SQL query: SELECT s.ship_id, s.ship_name
FROM ships s;
2025-08-07 17:47:51,381 - DEBUG - üìå LLM Raw Response: SELECT s.ship_id, s.ship_name
FROM ships s;
2025-08-07 17:47:51,381 - DEBUG - üîç Table aliases in FROM/JOIN: {'s'}
2025-08-07 17:47:51,382 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 17:47:51,382 - INFO - üìå Generated Valid SQL Query: SELECT s.ship_id, s.ship_name FROM ships s;
2025-08-07 17:47:51,382 - DEBUG - üîç Table aliases in FROM/JOIN: {'s'}
2025-08-07 17:47:51,382 - INFO - ‚úÖ Query passed advanced validation
2025-08-07 17:47:51,383 - INFO - ‚úÖ Query is safe and authorized!
2025-08-07 17:47:51,383 - INFO - üìå Executing SQL query: SELECT s.ship_id, s.ship_name FROM ships s;
2025-08-07 17:47:51,384 - INFO - üìå Query executed successfully in 0.002 seconds. Retrieved 3 records.
2025-08-07 17:48:59,355 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 17:48:59,365 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 17:48:59,367 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 17:48:59,369 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 17:48:59,371 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 17:48:59,374 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-07 17:48:59,380 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-07 17:48:59,382 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-07 17:48:59,384 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-07 17:48:59,385 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-07 23:30:53,679 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 23:30:54,449 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-07 23:30:54,449 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-07 23:30:54,449 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-07 23:30:55,028 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-07 23:30:55,323 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 23:30:55,339 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 23:30:55,339 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 23:30:55,354 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 23:30:55,354 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 23:30:55,370 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 23:30:55,370 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 23:30:55,370 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 23:30:55,531 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 23:30:55,531 - INFO - ‚úÖ Database connection established
2025-08-07 23:30:55,722 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 23:30:55,728 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 23:30:55,731 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 23:30:55,733 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 23:30:55,736 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 23:30:55,738 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 23:30:55,741 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 23:30:55,744 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 23:30:55,747 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 23:30:55,750 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 23:30:55,753 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 23:30:55,756 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 23:30:55,758 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 23:30:55,761 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 23:30:55,767 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 23:30:55,771 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 23:30:55,771 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 23:30:55,775 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 23:30:55,775 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 23:30:55,779 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 23:30:55,779 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 23:30:55,784 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 23:30:55,784 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 23:30:55,788 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 23:30:55,788 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 23:30:55,792 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 23:30:55,792 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 23:30:55,796 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 23:30:55,796 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 23:30:55,796 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 23:30:55,800 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 23:30:55,800 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 23:30:55,801 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 23:30:55,805 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 23:30:55,810 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 23:30:55,810 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 23:30:55,810 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 23:30:55,810 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 23:30:55,810 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 23:30:55,814 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 23:30:55,818 - DEBUG - üîó Foreign keys for users: []
2025-08-07 23:30:55,819 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 23:30:55,819 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 23:30:55,819 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 23:30:55,819 - DEBUG - üîç Relationship Details:
2025-08-07 23:30:55,819 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 23:30:55,819 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 23:30:55,819 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 23:30:55,819 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 23:30:55,819 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 23:30:55,819 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 23:30:55,819 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 23:30:55,819 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 23:30:55,819 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 23:30:55,819 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 23:30:55,819 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 23:30:55,820 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 23:30:55,820 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 23:30:55,820 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 23:30:55,820 - INFO - üìå Maritime system initialization complete.
2025-08-07 23:30:55,820 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 23:30:55,845 - INFO - üìå Loaded conversation memory from disk.
2025-08-07 23:30:55,845 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-07 23:30:55,845 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-07 23:30:57,113 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-07 23:30:57,113 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 23:30:57,129 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-07 23:30:57,129 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-07 23:30:57,129 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-07 23:30:57,130 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-07 23:30:57,130 - INFO - ‚úÖ Database connection established
2025-08-07 23:30:57,142 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 23:30:57,147 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-07 23:30:57,150 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-07 23:30:57,153 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-07 23:30:57,156 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-07 23:30:57,159 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-07 23:30:57,162 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-07 23:30:57,164 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-07 23:30:57,167 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-07 23:30:57,170 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-07 23:30:57,173 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-07 23:30:57,176 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-07 23:30:57,179 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-07 23:30:57,182 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-07 23:30:57,187 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-07 23:30:57,192 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 23:30:57,192 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-07 23:30:57,197 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-07 23:30:57,197 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-07 23:30:57,201 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 23:30:57,201 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-07 23:30:57,205 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 23:30:57,205 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-07 23:30:57,210 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-07 23:30:57,210 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-07 23:30:57,215 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-07 23:30:57,215 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-07 23:30:57,219 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-07 23:30:57,219 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-07 23:30:57,219 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-07 23:30:57,224 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-07 23:30:57,224 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-07 23:30:57,224 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-07 23:30:57,229 - DEBUG - üîó Foreign keys for ships: []
2025-08-07 23:30:57,234 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-07 23:30:57,234 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-07 23:30:57,234 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-07 23:30:57,234 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-07 23:30:57,234 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-07 23:30:57,239 - DEBUG - üîó Foreign keys for systems: []
2025-08-07 23:30:57,243 - DEBUG - üîó Foreign keys for users: []
2025-08-07 23:30:57,243 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-07 23:30:57,243 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-07 23:30:57,243 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-07 23:30:57,244 - DEBUG - üîç Relationship Details:
2025-08-07 23:30:57,244 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-07 23:30:57,244 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-07 23:30:57,244 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-07 23:30:57,244 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-07 23:30:57,244 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-07 23:30:57,244 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-07 23:30:57,244 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-07 23:30:57,244 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-07 23:30:57,244 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-07 23:30:57,244 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-07 23:30:57,244 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-07 23:30:57,244 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-07 23:30:57,244 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-07 23:30:57,244 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-07 23:30:57,244 - INFO - üìå Maritime system initialization complete.
2025-08-07 23:30:57,244 - INFO - ‚úÖ All global variables verified successfully
2025-08-07 23:31:45,053 - INFO - Database engine created with pool_size=10
2025-08-07 23:41:20,195 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 23:41:20,211 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 23:41:20,251 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 23:41:20,252 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7399ad3c7850>
2025-08-07 23:41:20,253 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 23:41:20,253 - DEBUG - send_request_headers.complete
2025-08-07 23:41:20,253 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 23:41:20,253 - DEBUG - send_request_body.complete
2025-08-07 23:41:20,253 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 23:41:24,926 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:11:24 GMT'), (b'Content-Length', b'535')])
2025-08-07 23:41:24,927 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 23:41:24,927 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 23:41:24,927 - DEBUG - receive_response_body.complete
2025-08-07 23:41:24,927 - DEBUG - response_closed.started
2025-08-07 23:41:24,928 - DEBUG - response_closed.complete
2025-08-07 23:41:24,928 - DEBUG - close.started
2025-08-07 23:41:24,928 - DEBUG - close.complete
2025-08-07 23:53:15,711 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 23:53:15,726 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 23:53:15,755 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 23:53:15,756 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7399ad386710>
2025-08-07 23:53:15,756 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 23:53:15,756 - DEBUG - send_request_headers.complete
2025-08-07 23:53:15,756 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 23:53:15,756 - DEBUG - send_request_body.complete
2025-08-07 23:53:15,756 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 23:53:18,295 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:23:18 GMT'), (b'Content-Length', b'473')])
2025-08-07 23:53:18,295 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 23:53:18,295 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 23:53:18,296 - DEBUG - receive_response_body.complete
2025-08-07 23:53:18,296 - DEBUG - response_closed.started
2025-08-07 23:53:18,296 - DEBUG - response_closed.complete
2025-08-07 23:53:18,296 - DEBUG - close.started
2025-08-07 23:53:18,296 - DEBUG - close.complete
2025-08-07 23:53:44,937 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 23:53:44,953 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 23:53:44,980 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 23:53:44,981 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7399ad3d59d0>
2025-08-07 23:53:44,981 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 23:53:44,982 - DEBUG - send_request_headers.complete
2025-08-07 23:53:44,982 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 23:53:44,982 - DEBUG - send_request_body.complete
2025-08-07 23:53:44,982 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 23:53:46,356 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:23:46 GMT'), (b'Content-Length', b'545')])
2025-08-07 23:53:46,356 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 23:53:46,357 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 23:53:46,357 - DEBUG - receive_response_body.complete
2025-08-07 23:53:46,357 - DEBUG - response_closed.started
2025-08-07 23:53:46,357 - DEBUG - response_closed.complete
2025-08-07 23:53:46,357 - DEBUG - close.started
2025-08-07 23:53:46,357 - DEBUG - close.complete
2025-08-07 23:59:31,129 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-07 23:59:31,145 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-07 23:59:31,670 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-08-07 23:59:31,671 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7399ad3f8990>
2025-08-07 23:59:31,672 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-07 23:59:31,672 - DEBUG - send_request_headers.complete
2025-08-07 23:59:31,672 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-07 23:59:31,672 - DEBUG - send_request_body.complete
2025-08-07 23:59:31,672 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-07 23:59:36,115 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:29:36 GMT'), (b'Content-Length', b'696')])
2025-08-07 23:59:36,115 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-08-07 23:59:36,116 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-07 23:59:36,116 - DEBUG - receive_response_body.complete
2025-08-07 23:59:36,116 - DEBUG - response_closed.started
2025-08-07 23:59:36,116 - DEBUG - response_closed.complete
2025-08-07 23:59:36,116 - DEBUG - close.started
2025-08-07 23:59:36,116 - DEBUG - close.complete
2025-08-08 00:05:22,046 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:05:22,062 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:05:22,070 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:05:22,085 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:05:22,086 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:05:22,101 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:05:22,101 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:05:22,116 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:05:22,116 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:05:22,116 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:05:22,117 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:05:22,117 - INFO - ‚úÖ Database connection established
2025-08-08 00:05:22,130 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:05:22,134 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:05:22,137 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:05:22,140 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:05:22,142 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:05:22,145 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:05:22,147 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:05:22,150 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:05:22,153 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:05:22,156 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:05:22,158 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:05:22,161 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:05:22,164 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:05:22,167 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:05:22,172 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:05:22,176 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:05:22,176 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:05:22,180 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:05:22,180 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:05:22,184 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:05:22,184 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:05:22,188 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:05:22,188 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:05:22,192 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:05:22,192 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:05:22,196 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:05:22,197 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:05:22,201 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:05:22,201 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:05:22,201 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:05:22,205 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:05:22,205 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:05:22,205 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:05:22,210 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:05:22,214 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:05:22,214 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:05:22,214 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:05:22,214 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:05:22,214 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:05:22,218 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:05:22,222 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:05:22,222 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:05:22,222 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:05:22,222 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:05:22,222 - DEBUG - üîç Relationship Details:
2025-08-08 00:05:22,222 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:05:22,223 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:05:22,223 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:05:22,223 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:05:22,223 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:05:22,223 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:05:22,223 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:05:22,223 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:05:22,223 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:05:22,223 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:05:22,223 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:05:22,223 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:05:22,223 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:05:22,223 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:05:22,223 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:05:22,223 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:05:22,224 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:05:22,224 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:05:22,225 - INFO - üìå User input: list all sensors on ins one
2025-08-08 00:05:22,225 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all sensors on ins one
2025-08-08 00:05:22,225 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all sensors on ins one
2025-08-08 00:05:22,225 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:05:22,225 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all equipment of ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all sensors on ins one
2025-08-08 00:05:22,225 - DEBUG - üìå Generated Prompt Length: 9984 characters
2025-08-08 00:05:22,225 - INFO - Generating SQL query...
2025-08-08 00:05:22,226 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:05:22,226 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399a53a0290>
2025-08-08 00:05:22,226 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:05:22,226 - DEBUG - send_request_headers.complete
2025-08-08 00:05:22,226 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:05:22,226 - DEBUG - send_request_body.complete
2025-08-08 00:05:22,226 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:05:34,774 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:35:34 GMT'), (b'Content-Length', b'812')])
2025-08-08 00:05:34,775 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:05:34,775 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:05:34,775 - DEBUG - receive_response_body.complete
2025-08-08 00:05:34,775 - DEBUG - response_closed.started
2025-08-08 00:05:34,775 - DEBUG - response_closed.complete
2025-08-08 00:05:34,775 - DEBUG - Extracting SQL from response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
           ...
2025-08-08 00:05:34,775 - INFO - Direct SQL response detected: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:05:34,775 - INFO - SQL query generation completed
2025-08-08 00:05:34,775 - DEBUG - Generated SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:05:34,775 - DEBUG - üìå LLM Raw Response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:05:34,776 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'sm', 'd'}
2025-08-08 00:05:34,776 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-08 00:05:34,776 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:05:34,776 - INFO - üìå Generated Valid SQL Query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:05:34,776 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'sm', 'd'}
2025-08-08 00:05:34,776 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-08 00:05:34,777 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:05:34,777 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:05:34,777 - INFO - üìå Executing SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:05:34,942 - INFO - üìå Query executed successfully in 0.166 seconds. Retrieved 3 records.
2025-08-08 00:07:24,614 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:07:24,629 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:07:24,638 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:07:24,654 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:07:24,654 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:07:24,670 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:07:24,670 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:07:24,685 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:07:24,685 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:07:24,685 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:07:24,686 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:07:24,686 - INFO - ‚úÖ Database connection established
2025-08-08 00:07:24,699 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:07:24,703 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:07:24,706 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:07:24,709 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:07:24,712 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:07:24,714 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:07:24,717 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:07:24,720 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:07:24,723 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:07:24,726 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:07:24,729 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:07:24,732 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:07:24,734 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:07:24,738 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:07:24,743 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:07:24,747 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:07:24,748 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:07:24,752 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:07:24,752 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:07:24,756 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:07:24,756 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:07:24,760 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:07:24,761 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:07:24,765 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:07:24,765 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:07:24,769 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:07:24,769 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:07:24,773 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:07:24,773 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:07:24,773 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:07:24,777 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:07:24,777 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:07:24,777 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:07:24,781 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:07:24,786 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:07:24,786 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:07:24,786 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:07:24,786 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:07:24,786 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:07:24,790 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:07:24,794 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:07:24,794 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:07:24,794 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:07:24,794 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:07:24,794 - DEBUG - üîç Relationship Details:
2025-08-08 00:07:24,794 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:07:24,794 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:07:24,794 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:07:24,795 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:07:24,795 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:07:24,795 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:07:24,795 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:07:24,795 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:07:24,795 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:07:24,795 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:07:24,795 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:07:24,795 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:07:24,795 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:07:24,795 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:07:24,795 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:07:24,795 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:07:24,796 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:07:24,796 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:07:24,797 - INFO - üìå User input: what are all the equipment on ins one
2025-08-08 00:07:24,797 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what are all the equipment on ins one
2025-08-08 00:07:24,797 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what are all the equipment on ins one
2025-08-08 00:07:24,797 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:07:24,797 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what are all the equipment on ins one
2025-08-08 00:07:24,797 - DEBUG - üìå Generated Prompt Length: 9992 characters
2025-08-08 00:07:24,797 - INFO - Generating SQL query...
2025-08-08 00:07:24,797 - DEBUG - close.started
2025-08-08 00:07:24,797 - DEBUG - close.complete
2025-08-08 00:07:24,798 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:07:24,798 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399a5366910>
2025-08-08 00:07:24,798 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:07:24,798 - DEBUG - send_request_headers.complete
2025-08-08 00:07:24,798 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:07:24,798 - DEBUG - send_request_body.complete
2025-08-08 00:07:24,798 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:07:28,564 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:37:28 GMT'), (b'Content-Length', b'809')])
2025-08-08 00:07:28,564 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:07:28,564 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:07:28,564 - DEBUG - receive_response_body.complete
2025-08-08 00:07:28,564 - DEBUG - response_closed.started
2025-08-08 00:07:28,565 - DEBUG - response_closed.complete
2025-08-08 00:07:28,565 - DEBUG - Extracting SQL from response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
           ...
2025-08-08 00:07:28,565 - INFO - Direct SQL response detected: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:07:28,565 - INFO - SQL query generation completed
2025-08-08 00:07:28,565 - DEBUG - Generated SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:07:28,565 - DEBUG - üìå LLM Raw Response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, 
                             sc.component_name, d.department_name, s.ship_name
                      FROM ships s
                      JOIN departments d ON s.ship_id = d.ship_id
                      JOIN system_configuration sc ON d.department_id = sc.department_id
                      JOIN sensor_metadata sm ON sc.component_id = sm.component_id
                      WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:07:28,565 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'sm', 'd'}
2025-08-08 00:07:28,565 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-08 00:07:28,565 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:07:28,565 - INFO - üìå Generated Valid SQL Query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:07:28,565 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'sm', 'd'}
2025-08-08 00:07:28,565 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-08 00:07:28,565 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:07:28,565 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:07:28,565 - INFO - üìå Executing SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:07:28,568 - INFO - üìå Query executed successfully in 0.002 seconds. Retrieved 3 records.
2025-08-08 00:08:15,305 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:08:15,321 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:08:15,329 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:08:15,345 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:08:15,345 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:08:15,361 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:08:15,361 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:08:15,376 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:08:15,376 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:08:15,376 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:08:15,377 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:08:15,377 - INFO - ‚úÖ Database connection established
2025-08-08 00:08:15,389 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:08:15,393 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:08:15,396 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:08:15,399 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:08:15,401 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:08:15,404 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:08:15,406 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:08:15,409 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:08:15,412 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:08:15,415 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:08:15,418 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:08:15,421 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:08:15,424 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:08:15,427 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:08:15,432 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:08:15,436 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:08:15,436 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:08:15,440 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:08:15,440 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:08:15,444 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:08:15,444 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:08:15,448 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:08:15,448 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:08:15,452 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:08:15,452 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:08:15,456 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:08:15,456 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:08:15,460 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:08:15,460 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:08:15,460 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:08:15,464 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:08:15,464 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:08:15,464 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:08:15,468 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:08:15,472 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:08:15,472 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:08:15,472 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:08:15,472 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:08:15,472 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:08:15,477 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:08:15,480 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:08:15,481 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:08:15,481 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:08:15,481 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:08:15,481 - DEBUG - üîç Relationship Details:
2025-08-08 00:08:15,481 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:08:15,481 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:08:15,481 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:08:15,481 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:08:15,481 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:08:15,481 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:08:15,481 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:08:15,481 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:08:15,481 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:08:15,481 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:08:15,481 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:08:15,481 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:08:15,481 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:08:15,481 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:08:15,481 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:08:15,481 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:08:15,482 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:08:15,482 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:08:15,483 - INFO - üìå User input: list all sensors with unit Deg C of GT 1 on ins one
2025-08-08 00:08:15,483 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all sensors with unit Deg C of GT 1 on ins one
2025-08-08 00:08:15,483 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all sensors with unit Deg C of GT 1 on ins one
2025-08-08 00:08:15,483 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:08:15,483 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all sensors with unit Deg C of GT 1 on ins one
2025-08-08 00:08:15,483 - DEBUG - üìå Generated Prompt Length: 10006 characters
2025-08-08 00:08:15,483 - INFO - Generating SQL query...
2025-08-08 00:08:15,483 - DEBUG - close.started
2025-08-08 00:08:15,484 - DEBUG - close.complete
2025-08-08 00:08:15,484 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:08:15,484 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399a654f590>
2025-08-08 00:08:15,484 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:08:15,484 - DEBUG - send_request_headers.complete
2025-08-08 00:08:15,484 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:08:15,484 - DEBUG - send_request_body.complete
2025-08-08 00:08:15,484 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:08:19,641 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:38:19 GMT'), (b'Content-Length', b'746')])
2025-08-08 00:08:19,642 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:08:19,642 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:08:19,642 - DEBUG - receive_response_body.complete
2025-08-08 00:08:19,642 - DEBUG - response_closed.started
2025-08-08 00:08:19,642 - DEBUG - response_closed.complete
2025-08-08 00:08:19,642 - DEBUG - Extracting SQL from response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configu...
2025-08-08 00:08:19,642 - INFO - Direct SQL response detected: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN sensor_metadata sm ON sc.component_id = sm.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sm.unit) = UPPER('deg c') AND UPPER(sc.nomenclature) = UPPER('GT 1');
2025-08-08 00:08:19,642 - INFO - SQL query generation completed
2025-08-08 00:08:19,643 - DEBUG - Generated SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN sensor_metadata sm ON sc.component_id = sm.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sm.unit) = UPPER('deg c') AND UPPER(sc.nomenclature) = UPPER('GT 1');
2025-08-08 00:08:19,643 - DEBUG - üìå LLM Raw Response: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN sensor_metadata sm ON sc.component_id = sm.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sm.unit) = UPPER('deg c') AND UPPER(sc.nomenclature) = UPPER('GT 1');
2025-08-08 00:08:19,643 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'sm', 'd'}
2025-08-08 00:08:19,643 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc', 'sm'}
2025-08-08 00:08:19,643 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:08:19,643 - INFO - üìå Generated Valid SQL Query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sm.unit) = UPPER('deg c') AND UPPER(sc.nomenclature) = UPPER('GT 1');
2025-08-08 00:08:19,643 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'sm', 'd'}
2025-08-08 00:08:19,643 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc', 'sm'}
2025-08-08 00:08:19,643 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:08:19,643 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:08:19,644 - INFO - üìå Executing SQL query: SELECT sm.sensor_id, sm.sensor_name, sm.unit, sm.min_value, sm.max_value, sc.component_name, d.department_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sm.unit) = UPPER('deg c') AND UPPER(sc.nomenclature) = UPPER('GT 1');
2025-08-08 00:08:19,649 - INFO - üìå Query executed successfully in 0.005 seconds. Retrieved 2 records.
2025-08-08 00:13:48,684 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:13:48,700 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:13:48,709 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:13:48,724 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:13:48,724 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:13:48,739 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:13:48,739 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:13:48,754 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:13:48,755 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:13:48,755 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:13:48,755 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:13:48,755 - INFO - ‚úÖ Database connection established
2025-08-08 00:13:48,767 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:13:48,772 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:13:48,774 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:13:48,777 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:13:48,779 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:13:48,782 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:13:48,784 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:13:48,787 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:13:48,790 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:13:48,792 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:13:48,795 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:13:48,798 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:13:48,800 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:13:48,803 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:13:48,808 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:13:48,813 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:13:48,813 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:13:48,817 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:13:48,817 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:13:48,821 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:13:48,821 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:13:48,825 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:13:48,825 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:13:48,829 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:13:48,829 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:13:48,833 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:13:48,834 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:13:48,838 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:13:48,838 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:13:48,838 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:13:48,842 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:13:48,842 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:13:48,842 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:13:48,846 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:13:48,850 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:13:48,851 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:13:48,851 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:13:48,851 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:13:48,851 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:13:48,855 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:13:48,859 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:13:48,859 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:13:48,859 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:13:48,859 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:13:48,859 - DEBUG - üîç Relationship Details:
2025-08-08 00:13:48,859 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:13:48,859 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:13:48,859 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:13:48,859 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:13:48,859 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:13:48,859 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:13:48,859 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:13:48,859 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:13:48,859 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:13:48,860 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:13:48,860 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:13:48,860 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:13:48,860 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:13:48,860 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:13:48,860 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:13:48,860 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:13:48,861 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:13:48,861 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:13:48,861 - INFO - üìå User input: what is the monthly utilization of GT 1 on ine one
2025-08-08 00:13:48,862 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what is the monthly utilization of GT 1 on ine one
2025-08-08 00:13:48,862 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what is the monthly utilization of GT 1 on ine one
2025-08-08 00:13:48,862 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:13:48,862 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='what are the failure modes of GT_1_S2 sensor??', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: what is the monthly utilization of GT 1 on ine one
2025-08-08 00:13:48,862 - DEBUG - üìå Generated Prompt Length: 10029 characters
2025-08-08 00:13:48,862 - INFO - Generating SQL query...
2025-08-08 00:13:48,862 - DEBUG - close.started
2025-08-08 00:13:48,862 - DEBUG - close.complete
2025-08-08 00:13:48,862 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:13:48,863 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399a53be590>
2025-08-08 00:13:48,863 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:13:48,863 - DEBUG - send_request_headers.complete
2025-08-08 00:13:48,863 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:13:48,863 - DEBUG - send_request_body.complete
2025-08-08 00:13:48,863 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:13:56,076 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:43:56 GMT'), (b'Content-Length', b'628')])
2025-08-08 00:13:56,076 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:13:56,076 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:13:56,076 - DEBUG - receive_response_body.complete
2025-08-08 00:13:56,076 - DEBUG - response_closed.started
2025-08-08 00:13:56,076 - DEBUG - response_closed.complete
2025-08-08 00:13:56,076 - DEBUG - Extracting SQL from response: SELECT monthly_utilization.utlization
FROM system_configuration sc
JOIN sensor_metadata sm ON sc.component_id = sm.component_id
JOIN sensor_readings sr ON sm.sensor_id = sr.sensor_id
JOIN ships s ON s...
2025-08-08 00:13:56,076 - INFO - Direct SQL response detected: SELECT monthly_utilization.utlization
FROM system_configuration sc
JOIN sensor_metadata sm ON sc.component_id = sm.component_id
JOIN sensor_readings sr ON sm.sensor_id = sr.sensor_id
JOIN ships s ON sc.ship_id = s.ship_id
WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE');
2025-08-08 00:13:56,076 - INFO - SQL query generation completed
2025-08-08 00:13:56,076 - DEBUG - Generated SQL query: SELECT monthly_utilization.utlization
FROM system_configuration sc
JOIN sensor_metadata sm ON sc.component_id = sm.component_id
JOIN sensor_readings sr ON sm.sensor_id = sr.sensor_id
JOIN ships s ON sc.ship_id = s.ship_id
WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE');
2025-08-08 00:13:56,077 - DEBUG - üìå LLM Raw Response: SELECT monthly_utilization.utlization
FROM system_configuration sc
JOIN sensor_metadata sm ON sc.component_id = sm.component_id
JOIN sensor_readings sr ON sm.sensor_id = sr.sensor_id
JOIN ships s ON sc.ship_id = s.ship_id
WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE');
2025-08-08 00:13:56,077 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'sm', 'sr'}
2025-08-08 00:13:56,077 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:13:56,077 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:13:56,077 - INFO - üìå Generated Valid SQL Query: SELECT monthly_utilization.utlization FROM system_configuration sc JOIN sensor_metadata sm ON sc.component_id = sm.component_id JOIN sensor_readings sr ON sm.sensor_id = sr.sensor_id JOIN ships s ON sc.ship_id = s.ship_id WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE');
2025-08-08 00:13:56,077 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'sm', 'sr'}
2025-08-08 00:13:56,077 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:13:56,077 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:13:56,077 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:13:56,077 - INFO - üìå Executing SQL query: SELECT monthly_utilization.utlization FROM system_configuration sc JOIN sensor_metadata sm ON sc.component_id = sm.component_id JOIN sensor_readings sr ON sm.sensor_id = sr.sensor_id JOIN ships s ON sc.ship_id = s.ship_id WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE');
2025-08-08 00:13:56,135 - ERROR - ‚ùå SQL Execution Error: (pyodbc.ProgrammingError) ('42000', '[42000] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]The multi-part identifier "monthly_utilization.utlization" could not be bound. (4104) (SQLExecDirectW)')
[SQL: SELECT monthly_utilization.utlization FROM system_configuration sc JOIN sensor_metadata sm ON sc.component_id = sm.component_id JOIN sensor_readings sr ON sm.sensor_id = sr.sensor_id JOIN ships s ON sc.ship_id = s.ship_id WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE');]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-08-08 00:18:04,431 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:18:04,447 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:18:04,455 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:18:04,470 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:18:04,471 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:18:04,486 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:18:04,486 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:18:04,501 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:18:04,501 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:18:04,501 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:18:04,502 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:18:04,502 - INFO - ‚úÖ Database connection established
2025-08-08 00:18:04,514 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:18:04,518 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:18:04,521 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:18:04,523 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:18:04,526 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:18:04,529 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:18:04,531 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:18:04,534 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:18:04,537 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:18:04,540 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:18:04,542 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:18:04,545 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:18:04,548 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:18:04,551 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:18:04,556 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:18:04,560 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:18:04,560 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:18:04,564 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:18:04,565 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:18:04,569 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:18:04,569 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:18:04,573 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:18:04,573 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:18:04,577 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:18:04,577 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:18:04,581 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:18:04,581 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:18:04,585 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:18:04,585 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:18:04,585 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:18:04,590 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:18:04,590 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:18:04,590 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:18:04,594 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:18:04,598 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:18:04,599 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:18:04,599 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:18:04,599 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:18:04,599 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:18:04,603 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:18:04,607 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:18:04,607 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:18:04,607 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:18:04,607 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:18:04,607 - DEBUG - üîç Relationship Details:
2025-08-08 00:18:04,607 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:18:04,607 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:18:04,607 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:18:04,607 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:18:04,607 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:18:04,607 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:18:04,608 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:18:04,608 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:18:04,608 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:18:04,608 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:18:04,608 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:18:04,608 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:18:04,608 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:18:04,608 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:18:04,608 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:18:04,608 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:18:04,610 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:18:04,610 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:18:04,610 - INFO - üìå User input: list alpha beta on ship ins one
2025-08-08 00:18:04,610 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta on ship ins one
2025-08-08 00:18:04,610 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta on ship ins one
2025-08-08 00:18:04,610 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:18:04,610 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta on ship ins one
2025-08-08 00:18:04,610 - DEBUG - üìå Generated Prompt Length: 10014 characters
2025-08-08 00:18:04,610 - INFO - Generating SQL query...
2025-08-08 00:18:04,611 - DEBUG - close.started
2025-08-08 00:18:04,611 - DEBUG - close.complete
2025-08-08 00:18:04,611 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:18:04,611 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399a53e6410>
2025-08-08 00:18:04,611 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:18:04,611 - DEBUG - send_request_headers.complete
2025-08-08 00:18:04,612 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:18:04,612 - DEBUG - send_request_body.complete
2025-08-08 00:18:04,612 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:18:07,767 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:48:07 GMT'), (b'Content-Length', b'641')])
2025-08-08 00:18:07,767 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:18:07,767 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:18:07,768 - DEBUG - receive_response_body.complete
2025-08-08 00:18:07,768 - DEBUG - response_closed.started
2025-08-08 00:18:07,768 - DEBUG - response_closed.complete
2025-08-08 00:18:07,768 - DEBUG - Extracting SQL from response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ...
2025-08-08 00:18:07,768 - INFO - Direct SQL response detected: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sc.nomenclature) = UPPER('GT 1');
2025-08-08 00:18:07,768 - INFO - SQL query generation completed
2025-08-08 00:18:07,768 - DEBUG - Generated SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sc.nomenclature) = UPPER('GT 1');
2025-08-08 00:18:07,768 - DEBUG - üìå LLM Raw Response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sc.nomenclature) = UPPER('GT 1');
2025-08-08 00:18:07,768 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:18:07,768 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:18:07,768 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:18:07,768 - INFO - üìå Generated Valid SQL Query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sc.nomenclature) = UPPER('GT 1');
2025-08-08 00:18:07,768 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:18:07,768 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:18:07,768 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:18:07,769 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:18:07,769 - INFO - üìå Executing SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sc.nomenclature) = UPPER('GT 1');
2025-08-08 00:18:07,774 - INFO - üìå Query executed successfully in 0.005 seconds. Retrieved 1 records.
2025-08-08 00:18:58,145 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:18:58,160 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:18:58,169 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:18:58,186 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:18:58,186 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:18:58,201 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:18:58,202 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:18:58,217 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:18:58,217 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:18:58,217 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:18:58,218 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:18:58,218 - INFO - ‚úÖ Database connection established
2025-08-08 00:18:58,231 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:18:58,235 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:18:58,238 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:18:58,240 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:18:58,243 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:18:58,246 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:18:58,249 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:18:58,252 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:18:58,255 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:18:58,257 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:18:58,260 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:18:58,263 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:18:58,266 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:18:58,268 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:18:58,274 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:18:58,278 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:18:58,278 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:18:58,282 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:18:58,282 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:18:58,286 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:18:58,286 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:18:58,290 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:18:58,290 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:18:58,294 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:18:58,294 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:18:58,298 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:18:58,298 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:18:58,303 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:18:58,303 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:18:58,303 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:18:58,307 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:18:58,308 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:18:58,308 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:18:58,312 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:18:58,316 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:18:58,316 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:18:58,316 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:18:58,316 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:18:58,316 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:18:58,320 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:18:58,324 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:18:58,324 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:18:58,324 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:18:58,324 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:18:58,324 - DEBUG - üîç Relationship Details:
2025-08-08 00:18:58,324 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:18:58,324 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:18:58,324 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:18:58,325 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:18:58,325 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:18:58,325 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:18:58,325 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:18:58,325 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:18:58,325 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:18:58,325 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:18:58,325 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:18:58,325 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:18:58,325 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:18:58,325 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:18:58,325 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:18:58,325 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:18:58,327 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:18:58,327 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:18:58,327 - INFO - üìå User input: list alpha beta of GT 1 on ship ins one
2025-08-08 00:18:58,327 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of GT 1 on ship ins one
2025-08-08 00:18:58,328 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of GT 1 on ship ins one
2025-08-08 00:18:58,328 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:18:58,328 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all sensors on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of GT 1 on ship ins one
2025-08-08 00:18:58,328 - DEBUG - üìå Generated Prompt Length: 10039 characters
2025-08-08 00:18:58,328 - INFO - Generating SQL query...
2025-08-08 00:18:58,328 - DEBUG - close.started
2025-08-08 00:18:58,328 - DEBUG - close.complete
2025-08-08 00:18:58,328 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:18:58,329 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399a6527cd0>
2025-08-08 00:18:58,329 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:18:58,329 - DEBUG - send_request_headers.complete
2025-08-08 00:18:58,329 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:18:58,329 - DEBUG - send_request_body.complete
2025-08-08 00:18:58,329 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:19:01,592 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:49:01 GMT'), (b'Content-Length', b'640')])
2025-08-08 00:19:01,592 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:19:01,592 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:19:01,592 - DEBUG - receive_response_body.complete
2025-08-08 00:19:01,592 - DEBUG - response_closed.started
2025-08-08 00:19:01,593 - DEBUG - response_closed.complete
2025-08-08 00:19:01,593 - DEBUG - Extracting SQL from response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ...
2025-08-08 00:19:01,593 - INFO - Direct SQL response detected: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:19:01,593 - INFO - SQL query generation completed
2025-08-08 00:19:01,593 - DEBUG - Generated SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:19:01,593 - DEBUG - üìå LLM Raw Response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:19:01,593 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:19:01,593 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:19:01,593 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:19:01,593 - INFO - üìå Generated Valid SQL Query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:19:01,593 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:19:01,593 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:19:01,593 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:19:01,593 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:19:01,593 - INFO - üìå Executing SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) = UPPER('GT 1') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:19:01,599 - INFO - üìå Query executed successfully in 0.005 seconds. Retrieved 1 records.
2025-08-08 00:19:31,743 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:19:31,759 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:19:31,767 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:19:31,782 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:19:31,782 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:19:31,796 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:19:31,796 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:19:31,812 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:19:31,812 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:19:31,812 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:19:31,812 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:19:31,812 - INFO - ‚úÖ Database connection established
2025-08-08 00:19:31,824 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:19:31,828 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:19:31,831 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:19:31,834 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:19:31,836 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:19:31,838 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:19:31,841 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:19:31,844 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:19:31,846 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:19:31,849 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:19:31,852 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:19:31,855 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:19:31,857 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:19:31,861 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:19:31,866 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:19:31,870 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:19:31,870 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:19:31,874 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:19:31,874 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:19:31,878 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:19:31,879 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:19:31,884 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:19:31,884 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:19:31,888 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:19:31,888 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:19:31,892 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:19:31,892 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:19:31,896 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:19:31,897 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:19:31,897 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:19:31,901 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:19:31,901 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:19:31,901 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:19:31,905 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:19:31,910 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:19:31,910 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:19:31,910 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:19:31,910 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:19:31,910 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:19:31,914 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:19:31,919 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:19:31,919 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:19:31,919 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:19:31,919 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:19:31,919 - DEBUG - üîç Relationship Details:
2025-08-08 00:19:31,919 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:19:31,919 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:19:31,919 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:19:31,919 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:19:31,919 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:19:31,919 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:19:31,919 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:19:31,919 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:19:31,919 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:19:31,919 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:19:31,919 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:19:31,919 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:19:31,919 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:19:31,919 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:19:31,919 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:19:31,920 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:19:31,921 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:19:31,921 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:19:31,921 - INFO - üìå User input: list alpha beta of GT 1 , GT 2 on ship ins one
2025-08-08 00:19:31,921 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of GT 1 , GT 2 on ship ins one
2025-08-08 00:19:31,921 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of GT 1 , GT 2 on ship ins one
2025-08-08 00:19:31,921 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:19:31,921 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='what are all the equipment on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of GT 1 , GT 2 on ship ins one
2025-08-08 00:19:31,921 - DEBUG - üìå Generated Prompt Length: 10058 characters
2025-08-08 00:19:31,921 - INFO - Generating SQL query...
2025-08-08 00:19:31,922 - DEBUG - close.started
2025-08-08 00:19:31,922 - DEBUG - close.complete
2025-08-08 00:19:31,922 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:19:31,922 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399a6524090>
2025-08-08 00:19:31,922 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:19:31,922 - DEBUG - send_request_headers.complete
2025-08-08 00:19:31,922 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:19:31,922 - DEBUG - send_request_body.complete
2025-08-08 00:19:31,922 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:19:35,249 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:49:35 GMT'), (b'Content-Length', b'644')])
2025-08-08 00:19:35,249 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:19:35,250 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:19:35,250 - DEBUG - receive_response_body.complete
2025-08-08 00:19:35,250 - DEBUG - response_closed.started
2025-08-08 00:19:35,250 - DEBUG - response_closed.complete
2025-08-08 00:19:35,250 - DEBUG - Extracting SQL from response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ...
2025-08-08 00:19:35,250 - INFO - Direct SQL response detected: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) IN ('GT 1', 'GT 2') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:19:35,250 - INFO - SQL query generation completed
2025-08-08 00:19:35,250 - DEBUG - Generated SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) IN ('GT 1', 'GT 2') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:19:35,250 - DEBUG - üìå LLM Raw Response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) IN ('GT 1', 'GT 2') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:19:35,250 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:19:35,250 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:19:35,250 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:19:35,250 - INFO - üìå Generated Valid SQL Query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) IN ('GT 1', 'GT 2') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:19:35,250 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:19:35,250 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:19:35,251 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:19:35,251 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:19:35,251 - INFO - üìå Executing SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) IN ('GT 1', 'GT 2') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:19:35,257 - INFO - üìå Query executed successfully in 0.006 seconds. Retrieved 2 records.
2025-08-08 00:19:51,663 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:19:51,679 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:19:51,686 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:19:51,702 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:19:51,702 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:19:51,717 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:19:51,717 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:19:51,732 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:19:51,733 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:19:51,733 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:19:51,733 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:19:51,733 - INFO - ‚úÖ Database connection established
2025-08-08 00:19:51,746 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:19:51,750 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:19:51,752 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:19:51,755 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:19:51,758 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:19:51,760 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:19:51,763 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:19:51,765 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:19:51,768 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:19:51,771 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:19:51,774 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:19:51,777 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:19:51,779 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:19:51,783 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:19:51,788 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:19:51,792 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:19:51,792 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:19:51,797 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:19:51,797 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:19:51,801 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:19:51,801 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:19:51,805 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:19:51,805 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:19:51,809 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:19:51,809 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:19:51,813 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:19:51,813 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:19:51,817 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:19:51,817 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:19:51,817 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:19:51,821 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:19:51,821 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:19:51,821 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:19:51,825 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:19:51,830 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:19:51,830 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:19:51,830 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:19:51,830 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:19:51,830 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:19:51,834 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:19:51,839 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:19:51,839 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:19:51,839 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:19:51,839 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:19:51,839 - DEBUG - üîç Relationship Details:
2025-08-08 00:19:51,839 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:19:51,839 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:19:51,839 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:19:51,839 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:19:51,839 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:19:51,839 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:19:51,839 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:19:51,839 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:19:51,839 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:19:51,839 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:19:51,839 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:19:51,839 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:19:51,839 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:19:51,839 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:19:51,839 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:19:51,839 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:19:51,841 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:19:51,841 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:19:51,841 - INFO - üìå User input: list alpha beta of GT 1 , GT 2 on ship ins one
2025-08-08 00:19:51,841 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of GT 1 , GT 2 on ship ins one
2025-08-08 00:19:51,841 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of GT 1 , GT 2 on ship ins one
2025-08-08 00:19:51,841 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:19:51,841 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list all sensors with unit Deg C of GT 1 on ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of GT 1 , GT 2 on ship ins one
2025-08-08 00:19:51,841 - DEBUG - üìå Generated Prompt Length: 10067 characters
2025-08-08 00:19:51,841 - INFO - Generating SQL query...
2025-08-08 00:19:51,842 - DEBUG - close.started
2025-08-08 00:19:51,842 - DEBUG - close.complete
2025-08-08 00:19:51,842 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:19:51,842 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399a65c5e50>
2025-08-08 00:19:51,842 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:19:51,842 - DEBUG - send_request_headers.complete
2025-08-08 00:19:51,842 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:19:51,843 - DEBUG - send_request_body.complete
2025-08-08 00:19:51,843 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:19:55,311 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:49:55 GMT'), (b'Content-Length', b'703')])
2025-08-08 00:19:55,311 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:19:55,311 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:19:55,311 - DEBUG - receive_response_body.complete
2025-08-08 00:19:55,311 - DEBUG - response_closed.started
2025-08-08 00:19:55,311 - DEBUG - response_closed.complete
2025-08-08 00:19:55,311 - DEBUG - Extracting SQL from response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM system_configuration sc
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) IN ('GT 1', 'GT 2') AND UP...
2025-08-08 00:19:55,311 - INFO - Direct SQL response detected: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM system_configuration sc
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) IN ('GT 1', 'GT 2') AND UPPER(s.ship_name) = UPPER('INS ONE')

Note: The above query assumes that the user is asking for the alpha and beta values of the sensors with nomenclatures GT 1 and GT 2 on the ship INS ONE.
2025-08-08 00:19:55,312 - INFO - SQL query generation completed
2025-08-08 00:19:55,312 - DEBUG - Generated SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM system_configuration sc
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) IN ('GT 1', 'GT 2') AND UPPER(s.ship_name) = UPPER('INS ONE')

Note: The above query assumes that the user is asking for the alpha and beta values of the sensors with nomenclatures GT 1 and GT 2 on the ship INS ONE.
2025-08-08 00:19:55,312 - DEBUG - üìå LLM Raw Response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM system_configuration sc
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) IN ('GT 1', 'GT 2') AND UPPER(s.ship_name) = UPPER('INS ONE')

Note: The above query assumes that the user is asking for the alpha and beta values of the sensors with nomenclatures GT 1 and GT 2 on the ship INS ONE.
2025-08-08 00:19:55,312 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'ab'}
2025-08-08 00:19:55,312 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:19:55,312 - ERROR - ‚ùå Generated query failed validation: Tables referenced in WHERE clause but not in FROM/JOIN: s. You must include these tables in your FROM or JOIN clauses.
2025-08-08 00:20:10,127 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:20:10,252 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:20:10,261 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:20:10,276 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:20:10,276 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:20:10,291 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:20:10,291 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:20:10,307 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:20:10,307 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:20:10,307 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:20:10,307 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:20:10,307 - INFO - ‚úÖ Database connection established
2025-08-08 00:20:10,320 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:20:10,324 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:20:10,327 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:20:10,330 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:20:10,332 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:20:10,335 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:20:10,337 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:20:10,340 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:20:10,343 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:20:10,346 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:20:10,349 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:20:10,352 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:20:10,354 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:20:10,357 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:20:10,362 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:20:10,367 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:20:10,367 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:20:10,371 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:20:10,371 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:20:10,375 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:20:10,375 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:20:10,379 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:20:10,379 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:20:10,384 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:20:10,384 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:20:10,388 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:20:10,388 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:20:10,392 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:20:10,392 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:20:10,392 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:20:10,396 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:20:10,396 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:20:10,396 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:20:10,401 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:20:10,405 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:20:10,405 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:20:10,405 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:20:10,405 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:20:10,405 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:20:10,410 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:20:10,414 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:20:10,414 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:20:10,414 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:20:10,414 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:20:10,414 - DEBUG - üîç Relationship Details:
2025-08-08 00:20:10,414 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:20:10,414 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:20:10,414 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:20:10,414 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:20:10,415 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:20:10,415 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:20:10,415 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:20:10,415 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:20:10,415 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:20:10,415 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:20:10,415 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:20:10,415 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:20:10,415 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:20:10,415 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:20:10,415 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:20:10,415 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:20:10,417 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:20:10,417 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:20:10,418 - INFO - üìå User input: list alpha beta of all gas turbines on ship ins one
2025-08-08 00:20:10,418 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of all gas turbines on ship ins one
2025-08-08 00:20:10,418 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of all gas turbines on ship ins one
2025-08-08 00:20:10,418 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:20:10,418 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='what is the monthly utilization of GT 1 on ine one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of all gas turbines on ship ins one
2025-08-08 00:20:10,418 - DEBUG - üìå Generated Prompt Length: 10067 characters
2025-08-08 00:20:10,418 - INFO - Generating SQL query...
2025-08-08 00:20:10,418 - DEBUG - close.started
2025-08-08 00:20:10,418 - DEBUG - close.complete
2025-08-08 00:20:10,418 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:20:10,419 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399ac654190>
2025-08-08 00:20:10,419 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:20:10,419 - DEBUG - send_request_headers.complete
2025-08-08 00:20:10,419 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:20:10,419 - DEBUG - send_request_body.complete
2025-08-08 00:20:10,419 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:20:13,736 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:50:13 GMT'), (b'Content-Length', b'649')])
2025-08-08 00:20:13,737 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:20:13,737 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:20:13,737 - DEBUG - receive_response_body.complete
2025-08-08 00:20:13,737 - DEBUG - response_closed.started
2025-08-08 00:20:13,737 - DEBUG - response_closed.complete
2025-08-08 00:20:13,737 - DEBUG - Extracting SQL from response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JO...
2025-08-08 00:20:13,737 - INFO - Direct SQL response detected: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) LIKE '%GT%' AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:20:13,737 - INFO - SQL query generation completed
2025-08-08 00:20:13,737 - DEBUG - Generated SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) LIKE '%GT%' AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:20:13,737 - DEBUG - üìå LLM Raw Response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) LIKE '%GT%' AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:20:13,738 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:20:13,738 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:20:13,738 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:20:13,738 - INFO - üìå Generated Valid SQL Query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) LIKE '%GT%' AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:20:13,738 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:20:13,738 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:20:13,738 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:20:13,738 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:20:13,738 - INFO - üìå Executing SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) LIKE '%GT%' AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:20:13,744 - INFO - üìå Query executed successfully in 0.005 seconds. Retrieved 8 records.
2025-08-08 00:20:56,167 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:20:56,183 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:20:56,192 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:20:56,208 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:20:56,208 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:20:56,223 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:20:56,224 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:20:56,239 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:20:56,239 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:20:56,239 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:20:56,240 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:20:56,240 - INFO - ‚úÖ Database connection established
2025-08-08 00:20:56,253 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:20:56,257 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:20:56,260 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:20:56,263 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:20:56,266 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:20:56,268 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:20:56,271 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:20:56,274 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:20:56,277 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:20:56,280 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:20:56,283 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:20:56,286 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:20:56,289 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:20:56,292 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:20:56,297 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:20:56,302 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:20:56,302 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:20:56,306 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:20:56,306 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:20:56,310 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:20:56,310 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:20:56,314 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:20:56,314 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:20:56,319 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:20:56,319 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:20:56,323 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:20:56,323 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:20:56,327 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:20:56,327 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:20:56,327 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:20:56,332 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:20:56,332 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:20:56,332 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:20:56,336 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:20:56,340 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:20:56,340 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:20:56,340 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:20:56,340 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:20:56,341 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:20:56,345 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:20:56,349 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:20:56,349 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:20:56,349 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:20:56,349 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:20:56,349 - DEBUG - üîç Relationship Details:
2025-08-08 00:20:56,349 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:20:56,349 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:20:56,349 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:20:56,349 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:20:56,349 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:20:56,349 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:20:56,349 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:20:56,349 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:20:56,349 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:20:56,350 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:20:56,350 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:20:56,350 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:20:56,350 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:20:56,350 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:20:56,350 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:20:56,350 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:20:56,351 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:20:56,351 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:20:56,352 - INFO - üìå User input: list alpha beta of gas turbines on ship ins one
2025-08-08 00:20:56,352 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of gas turbines on ship ins one
2025-08-08 00:20:56,352 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of gas turbines on ship ins one
2025-08-08 00:20:56,352 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:20:56,352 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of gas turbines on ship ins one
2025-08-08 00:20:56,352 - DEBUG - üìå Generated Prompt Length: 10064 characters
2025-08-08 00:20:56,352 - INFO - Generating SQL query...
2025-08-08 00:20:56,352 - DEBUG - close.started
2025-08-08 00:20:56,352 - DEBUG - close.complete
2025-08-08 00:20:56,352 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:20:56,353 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399a535af50>
2025-08-08 00:20:56,353 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:20:56,353 - DEBUG - send_request_headers.complete
2025-08-08 00:20:56,353 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:20:56,353 - DEBUG - send_request_body.complete
2025-08-08 00:20:56,353 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:20:59,719 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:50:59 GMT'), (b'Content-Length', b'650')])
2025-08-08 00:20:59,719 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:20:59,719 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:20:59,719 - DEBUG - receive_response_body.complete
2025-08-08 00:20:59,719 - DEBUG - response_closed.started
2025-08-08 00:20:59,719 - DEBUG - response_closed.complete
2025-08-08 00:20:59,719 - DEBUG - Extracting SQL from response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JO...
2025-08-08 00:20:59,719 - INFO - Direct SQL response detected: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:20:59,719 - INFO - SQL query generation completed
2025-08-08 00:20:59,720 - DEBUG - Generated SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:20:59,720 - DEBUG - üìå LLM Raw Response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:20:59,720 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:20:59,720 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:20:59,720 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:20:59,720 - INFO - üìå Generated Valid SQL Query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:20:59,720 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:20:59,720 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:20:59,720 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:20:59,720 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:20:59,720 - INFO - üìå Executing SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:20:59,857 - INFO - üìå Query executed successfully in 0.137 seconds, but no records were found.
2025-08-08 00:21:14,467 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:14,483 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:21:14,485 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:14,501 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:21:14,501 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:14,516 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:21:14,516 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:14,532 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:21:14,532 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:21:14,532 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:21:14,533 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:21:14,533 - INFO - ‚úÖ Database connection established
2025-08-08 00:21:14,546 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:21:14,551 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:21:14,554 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:21:14,557 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:21:14,559 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:21:14,562 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:21:14,565 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:21:14,568 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:21:14,571 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:21:14,573 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:21:14,576 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:21:14,579 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:21:14,582 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:21:14,585 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:21:14,590 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:21:14,594 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:14,594 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:21:14,598 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:21:14,599 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:21:14,603 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:14,603 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:21:14,606 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:14,607 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:21:14,611 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:14,611 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:21:14,615 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:21:14,615 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:21:14,619 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:21:14,619 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:21:14,619 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:21:14,623 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:21:14,623 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:21:14,623 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:21:14,627 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:21:14,631 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:21:14,632 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:21:14,632 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:21:14,632 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:21:14,632 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:21:14,636 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:21:14,640 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:21:14,640 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:21:14,640 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:21:14,640 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:21:14,640 - DEBUG - üîç Relationship Details:
2025-08-08 00:21:14,640 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:21:14,640 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:21:14,640 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:21:14,640 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:21:14,640 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:21:14,640 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:21:14,641 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:21:14,641 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:21:14,641 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:21:14,641 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:21:14,641 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:21:14,641 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:21:14,641 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:21:14,641 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:21:14,641 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:21:14,641 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:21:14,643 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:21:14,643 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:21:14,644 - INFO - üìå User input: list alpha beta of only gas turbines on ship ins one
2025-08-08 00:21:14,644 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of only gas turbines on ship ins one
2025-08-08 00:21:14,644 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of only gas turbines on ship ins one
2025-08-08 00:21:14,644 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:21:14,644 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list alpha beta of GT 1 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of only gas turbines on ship ins one
2025-08-08 00:21:14,644 - DEBUG - üìå Generated Prompt Length: 10085 characters
2025-08-08 00:21:14,644 - INFO - Generating SQL query...
2025-08-08 00:21:14,644 - DEBUG - close.started
2025-08-08 00:21:14,644 - DEBUG - close.complete
2025-08-08 00:21:14,644 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:21:14,645 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399ad4d5cd0>
2025-08-08 00:21:14,645 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:21:14,645 - DEBUG - send_request_headers.complete
2025-08-08 00:21:14,645 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:21:14,645 - DEBUG - send_request_body.complete
2025-08-08 00:21:14,645 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:21:17,994 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:51:17 GMT'), (b'Content-Length', b'651')])
2025-08-08 00:21:17,995 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:21:17,995 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:21:17,995 - DEBUG - receive_response_body.complete
2025-08-08 00:21:17,995 - DEBUG - response_closed.started
2025-08-08 00:21:17,995 - DEBUG - response_closed.complete
2025-08-08 00:21:17,995 - DEBUG - Extracting SQL from response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JO...
2025-08-08 00:21:17,995 - INFO - Direct SQL response detected: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:21:17,995 - INFO - SQL query generation completed
2025-08-08 00:21:17,995 - DEBUG - Generated SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:21:17,995 - DEBUG - üìå LLM Raw Response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:21:17,995 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:21:17,995 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:21:17,996 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:21:17,996 - INFO - üìå Generated Valid SQL Query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:21:17,996 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:21:17,996 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:21:17,996 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:21:17,996 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:21:17,996 - INFO - üìå Executing SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name, s.ship_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:21:17,999 - INFO - üìå Query executed successfully in 0.002 seconds, but no records were found.
2025-08-08 00:21:24,050 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:24,066 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:21:24,069 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:24,085 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:21:24,085 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:24,100 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:21:24,100 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:24,115 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:21:24,115 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:21:24,116 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:21:24,116 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:21:24,116 - INFO - ‚úÖ Database connection established
2025-08-08 00:21:24,129 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:21:24,133 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:21:24,136 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:21:24,139 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:21:24,142 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:21:24,144 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:21:24,147 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:21:24,150 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:21:24,153 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:21:24,156 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:21:24,158 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:21:24,162 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:21:24,164 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:21:24,167 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:21:24,172 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:21:24,177 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:24,177 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:21:24,181 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:21:24,181 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:21:24,186 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:24,186 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:21:24,190 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:24,190 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:21:24,194 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:24,194 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:21:24,198 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:21:24,199 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:21:24,203 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:21:24,203 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:21:24,203 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:21:24,207 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:21:24,207 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:21:24,207 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:21:24,212 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:21:24,216 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:21:24,216 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:21:24,217 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:21:24,217 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:21:24,217 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:21:24,221 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:21:24,225 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:21:24,225 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:21:24,225 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:21:24,225 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:21:24,225 - DEBUG - üîç Relationship Details:
2025-08-08 00:21:24,226 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:21:24,226 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:21:24,226 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:21:24,226 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:21:24,226 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:21:24,226 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:21:24,226 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:21:24,226 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:21:24,226 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:21:24,226 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:21:24,226 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:21:24,226 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:21:24,226 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:21:24,226 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:21:24,226 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:21:24,227 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:21:24,229 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:21:24,229 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:21:24,229 - INFO - üìå User input: list alpha beta of all gas turbines on ship ins one
2025-08-08 00:21:24,230 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of all gas turbines on ship ins one
2025-08-08 00:21:24,230 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of all gas turbines on ship ins one
2025-08-08 00:21:24,230 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:21:24,230 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta of all gas turbines on ship ins one
2025-08-08 00:21:24,230 - DEBUG - üìå Generated Prompt Length: 10097 characters
2025-08-08 00:21:24,230 - INFO - Generating SQL query...
2025-08-08 00:21:24,230 - DEBUG - close.started
2025-08-08 00:21:24,230 - DEBUG - close.complete
2025-08-08 00:21:24,230 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:21:24,231 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399aee1cf90>
2025-08-08 00:21:24,231 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:21:24,231 - DEBUG - send_request_headers.complete
2025-08-08 00:21:24,231 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:21:24,231 - DEBUG - send_request_body.complete
2025-08-08 00:21:24,231 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:21:27,455 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:51:27 GMT'), (b'Content-Length', b'638')])
2025-08-08 00:21:27,456 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:21:27,456 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:21:27,456 - DEBUG - receive_response_body.complete
2025-08-08 00:21:27,456 - DEBUG - response_closed.started
2025-08-08 00:21:27,456 - DEBUG - response_closed.complete
2025-08-08 00:21:27,456 - DEBUG - Extracting SQL from response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ...
2025-08-08 00:21:27,456 - INFO - Direct SQL response detected: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:21:27,456 - INFO - SQL query generation completed
2025-08-08 00:21:27,456 - DEBUG - Generated SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:21:27,456 - DEBUG - üìå LLM Raw Response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:21:27,456 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:21:27,456 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:21:27,457 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:21:27,457 - INFO - üìå Generated Valid SQL Query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:21:27,457 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:21:27,457 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:21:27,457 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:21:27,457 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:21:27,457 - INFO - üìå Executing SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(sc.nomenclature) = UPPER('GT') AND UPPER(s.ship_name) = UPPER('INS ONE')
2025-08-08 00:21:27,463 - INFO - üìå Query executed successfully in 0.006 seconds, but no records were found.
2025-08-08 00:21:52,618 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:52,634 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:21:52,637 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:52,653 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:21:52,653 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:52,668 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:21:52,668 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:21:52,684 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:21:52,684 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:21:52,684 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:21:52,684 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:21:52,684 - INFO - ‚úÖ Database connection established
2025-08-08 00:21:52,698 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:21:52,702 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:21:52,705 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:21:52,707 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:21:52,710 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:21:52,713 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:21:52,716 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:21:52,718 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:21:52,721 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:21:52,724 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:21:52,727 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:21:52,730 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:21:52,733 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:21:52,736 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:21:52,741 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:21:52,746 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:52,746 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:21:52,750 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:21:52,750 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:21:52,755 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:52,755 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:21:52,759 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:52,759 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:21:52,763 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:21:52,763 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:21:52,768 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:21:52,768 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:21:52,772 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:21:52,772 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:21:52,772 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:21:52,777 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:21:52,777 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:21:52,777 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:21:52,781 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:21:52,785 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:21:52,786 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:21:52,786 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:21:52,786 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:21:52,786 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:21:52,790 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:21:52,794 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:21:52,794 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:21:52,794 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:21:52,794 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:21:52,794 - DEBUG - üîç Relationship Details:
2025-08-08 00:21:52,795 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:21:52,795 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:21:52,795 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:21:52,795 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:21:52,795 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:21:52,795 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:21:52,795 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:21:52,795 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:21:52,795 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:21:52,795 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:21:52,795 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:21:52,795 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:21:52,795 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:21:52,795 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:21:52,796 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:21:52,796 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:21:52,797 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:21:52,798 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:21:52,798 - INFO - üìå User input: list alpha beta on ship ins one
2025-08-08 00:21:52,798 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta on ship ins one
2025-08-08 00:21:52,798 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta on ship ins one
2025-08-08 00:21:52,798 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:21:52,798 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list alpha beta of GT 1 , GT 2 on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta on ship ins one
2025-08-08 00:21:52,798 - DEBUG - üìå Generated Prompt Length: 10082 characters
2025-08-08 00:21:52,798 - INFO - Generating SQL query...
2025-08-08 00:21:52,799 - DEBUG - close.started
2025-08-08 00:21:52,799 - DEBUG - close.complete
2025-08-08 00:21:52,799 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:21:52,799 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7399a536a490>
2025-08-08 00:21:52,799 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:21:52,800 - DEBUG - send_request_headers.complete
2025-08-08 00:21:52,800 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:21:52,800 - DEBUG - send_request_body.complete
2025-08-08 00:21:52,800 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:21:56,037 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:51:56 GMT'), (b'Content-Length', b'645')])
2025-08-08 00:21:56,038 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:21:56,038 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:21:56,038 - DEBUG - receive_response_body.complete
2025-08-08 00:21:56,038 - DEBUG - response_closed.started
2025-08-08 00:21:56,038 - DEBUG - response_closed.complete
2025-08-08 00:21:56,038 - DEBUG - Extracting SQL from response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ...
2025-08-08 00:21:56,038 - INFO - Direct SQL response detected: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sc.nomenclature) IN ('GT 1', 'GT 2');
2025-08-08 00:21:56,038 - INFO - SQL query generation completed
2025-08-08 00:21:56,038 - DEBUG - Generated SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sc.nomenclature) IN ('GT 1', 'GT 2');
2025-08-08 00:21:56,038 - DEBUG - üìå LLM Raw Response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sc.nomenclature) IN ('GT 1', 'GT 2');
2025-08-08 00:21:56,039 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:21:56,039 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:21:56,039 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:21:56,039 - INFO - üìå Generated Valid SQL Query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sc.nomenclature) IN ('GT 1', 'GT 2');
2025-08-08 00:21:56,039 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'ab', 'd'}
2025-08-08 00:21:56,039 - DEBUG - üîç Table aliases in WHERE: {'s', 'sc'}
2025-08-08 00:21:56,039 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:21:56,039 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:21:56,039 - INFO - üìå Executing SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(s.ship_name) = UPPER('ins one') AND UPPER(sc.nomenclature) IN ('GT 1', 'GT 2');
2025-08-08 00:21:56,045 - INFO - üìå Query executed successfully in 0.005 seconds. Retrieved 2 records.
2025-08-08 00:22:35,407 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 00:22:35,540 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-08 00:22:35,540 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-08 00:22:35,540 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-08 00:22:35,714 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-08 00:22:35,811 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:35,828 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:22:35,828 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:35,843 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:22:35,843 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:35,858 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:22:35,858 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:22:35,858 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:22:35,881 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:22:35,881 - INFO - ‚úÖ Database connection established
2025-08-08 00:22:35,934 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:35,940 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:22:35,942 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:22:35,945 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:22:35,947 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:22:35,950 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:22:35,953 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:22:35,955 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:22:35,958 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:22:35,961 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:22:35,963 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:22:35,967 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:22:35,969 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:22:35,972 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:22:35,977 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:22:35,981 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:35,981 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:22:35,985 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:22:35,985 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:22:35,989 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:35,989 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:22:35,993 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:35,993 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:22:35,997 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:35,997 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:22:36,001 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:22:36,001 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:22:36,005 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:22:36,005 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:22:36,005 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:22:36,009 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:22:36,009 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:22:36,009 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:22:36,013 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:22:36,017 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:22:36,017 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:22:36,018 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:22:36,018 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:22:36,018 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:22:36,022 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:22:36,026 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:22:36,026 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:22:36,026 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:36,026 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:22:36,026 - DEBUG - üîç Relationship Details:
2025-08-08 00:22:36,026 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,026 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:22:36,026 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,026 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,026 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,026 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:22:36,026 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,027 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:22:36,027 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,027 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:22:36,027 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:22:36,027 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:22:36,027 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:22:36,027 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:22:36,027 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:22:36,027 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:22:36,028 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:22:36,028 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:22:36,028 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 00:22:36,274 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:22:36,274 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:36,290 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:22:36,290 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:22:36,290 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:22:36,291 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:22:36,291 - INFO - ‚úÖ Database connection established
2025-08-08 00:22:36,303 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:36,307 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:22:36,310 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:22:36,312 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:22:36,315 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:22:36,318 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:22:36,320 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:22:36,323 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:22:36,326 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:22:36,328 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:22:36,331 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:22:36,335 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:22:36,337 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:22:36,340 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:22:36,345 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:22:36,349 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:36,349 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:22:36,353 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:22:36,353 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:22:36,357 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:36,357 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:22:36,361 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:36,361 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:22:36,365 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:36,365 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:22:36,369 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:22:36,369 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:22:36,373 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:22:36,373 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:22:36,373 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:22:36,377 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:22:36,377 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:22:36,377 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:22:36,381 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:22:36,386 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:22:36,386 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:22:36,386 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:22:36,386 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:22:36,386 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:22:36,390 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:22:36,394 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:22:36,394 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:22:36,394 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:36,394 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:22:36,394 - DEBUG - üîç Relationship Details:
2025-08-08 00:22:36,394 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,394 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:22:36,394 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,394 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,394 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,394 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:22:36,394 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,394 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:22:36,394 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:22:36,394 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:22:36,395 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:22:36,395 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:22:36,395 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:22:36,395 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:22:36,395 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:22:36,395 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:22:42,691 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 00:22:42,824 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-08 00:22:42,824 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-08 00:22:42,824 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-08 00:22:42,999 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-08 00:22:43,095 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:43,111 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:22:43,111 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:43,126 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:22:43,126 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:43,140 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:22:43,141 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:22:43,141 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:22:43,150 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:22:43,150 - INFO - ‚úÖ Database connection established
2025-08-08 00:22:43,170 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:43,176 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:22:43,178 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:22:43,181 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:22:43,184 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:22:43,187 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:22:43,190 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:22:43,192 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:22:43,195 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:22:43,198 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:22:43,201 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:22:43,204 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:22:43,206 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:22:43,209 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:22:43,215 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:22:43,219 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:43,219 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:22:43,223 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:22:43,223 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:22:43,227 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:43,227 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:22:43,231 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:43,231 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:22:43,235 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:43,236 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:22:43,239 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:22:43,240 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:22:43,244 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:22:43,244 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:22:43,244 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:22:43,248 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:22:43,248 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:22:43,248 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:22:43,252 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:22:43,256 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:22:43,256 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:22:43,256 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:22:43,256 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:22:43,256 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:22:43,260 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:22:43,265 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:22:43,265 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:22:43,265 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:43,265 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:22:43,265 - DEBUG - üîç Relationship Details:
2025-08-08 00:22:43,265 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,265 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:22:43,265 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,265 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,265 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,265 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:22:43,266 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,266 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:22:43,266 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,266 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:22:43,266 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:22:43,266 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:22:43,266 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:22:43,266 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:22:43,266 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:22:43,266 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:22:43,267 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:22:43,267 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:22:43,267 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 00:22:43,498 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:22:43,498 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:43,514 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:22:43,514 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:22:43,514 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:22:43,514 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:22:43,514 - INFO - ‚úÖ Database connection established
2025-08-08 00:22:43,527 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:43,531 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:22:43,534 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:22:43,536 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:22:43,539 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:22:43,542 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:22:43,544 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:22:43,547 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:22:43,550 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:22:43,553 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:22:43,556 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:22:43,559 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:22:43,561 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:22:43,564 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:22:43,569 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:22:43,574 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:43,574 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:22:43,578 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:22:43,578 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:22:43,582 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:43,582 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:22:43,586 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:43,586 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:22:43,590 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:43,590 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:22:43,594 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:22:43,594 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:22:43,598 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:22:43,598 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:22:43,598 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:22:43,603 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:22:43,603 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:22:43,603 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:22:43,607 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:22:43,611 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:22:43,611 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:22:43,611 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:22:43,611 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:22:43,611 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:22:43,615 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:22:43,619 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:22:43,619 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:22:43,619 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:43,619 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:22:43,619 - DEBUG - üîç Relationship Details:
2025-08-08 00:22:43,619 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,619 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:22:43,620 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,620 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,620 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,620 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:22:43,620 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,620 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:22:43,620 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:22:43,620 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:22:43,620 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:22:43,620 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:22:43,620 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:22:43,620 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:22:43,620 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:22:43,620 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:22:51,198 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:51,213 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-08 00:22:51,214 - INFO - Database engine created with pool_size=10
2025-08-08 00:22:51,251 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:51,266 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:22:51,266 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:51,281 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:22:51,281 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:22:51,296 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:22:51,296 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:22:51,296 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:22:51,297 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:22:51,297 - INFO - ‚úÖ Database connection established
2025-08-08 00:22:51,309 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:51,313 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:22:51,316 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:22:51,319 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:22:51,321 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:22:51,324 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:22:51,326 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:22:51,329 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:22:51,332 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:22:51,335 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:22:51,337 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:22:51,341 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:22:51,343 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:22:51,346 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:22:51,351 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:22:51,355 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:51,355 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:22:51,359 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:22:51,359 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:22:51,363 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:51,363 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:22:51,367 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:51,367 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:22:51,371 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:22:51,371 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:22:51,375 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:22:51,375 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:22:51,379 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:22:51,379 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:22:51,380 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:22:51,384 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:22:51,384 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:22:51,384 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:22:51,388 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:22:51,392 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:22:51,392 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:22:51,392 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:22:51,392 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:22:51,392 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:22:51,396 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:22:51,400 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:22:51,401 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:22:51,401 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:51,401 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:22:51,401 - DEBUG - üîç Relationship Details:
2025-08-08 00:22:51,401 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:22:51,401 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:22:51,401 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:22:51,401 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:22:51,401 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:22:51,401 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:22:51,401 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:22:51,401 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:22:51,401 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:22:51,401 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:22:51,401 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:22:51,401 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:22:51,401 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:22:51,401 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:22:51,401 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:22:51,401 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:22:51,402 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:22:51,403 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:22:51,403 - INFO - üìå User input: list alpha beta on ship ins one
2025-08-08 00:22:51,403 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta on ship ins one
2025-08-08 00:22:51,403 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta on ship ins one
2025-08-08 00:22:51,403 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:22:51,403 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list alpha beta on ship ins one
2025-08-08 00:22:51,403 - DEBUG - üìå Generated Prompt Length: 7639 characters
2025-08-08 00:22:51,403 - INFO - Generating SQL query...
2025-08-08 00:22:51,404 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-08 00:22:51,404 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x74c8853e64d0>
2025-08-08 00:22:51,404 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-08 00:22:51,404 - DEBUG - send_request_headers.complete
2025-08-08 00:22:51,404 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-08 00:22:51,404 - DEBUG - send_request_body.complete
2025-08-08 00:22:51,404 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-08 00:22:54,727 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 07 Aug 2025 18:52:54 GMT'), (b'Content-Length', b'598')])
2025-08-08 00:22:54,727 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-08 00:22:54,727 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-08 00:22:54,727 - DEBUG - receive_response_body.complete
2025-08-08 00:22:54,728 - DEBUG - response_closed.started
2025-08-08 00:22:54,728 - DEBUG - response_closed.complete
2025-08-08 00:22:54,728 - DEBUG - Extracting SQL from response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ...
2025-08-08 00:22:54,728 - INFO - Direct SQL response detected: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one')
2025-08-08 00:22:54,728 - INFO - SQL query generation completed
2025-08-08 00:22:54,728 - DEBUG - Generated SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one')
2025-08-08 00:22:54,728 - DEBUG - üìå LLM Raw Response: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN alphabeta ab ON sc.component_id = ab.component_id
WHERE UPPER(s.ship_name) = UPPER('ins one')
2025-08-08 00:22:54,729 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'd', 'ab'}
2025-08-08 00:22:54,729 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-08 00:22:54,730 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:22:54,730 - INFO - üìå Generated Valid SQL Query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(s.ship_name) = UPPER('ins one')
2025-08-08 00:22:54,730 - DEBUG - üîç Table aliases in FROM/JOIN: {'s', 'sc', 'd', 'ab'}
2025-08-08 00:22:54,730 - DEBUG - üîç Table aliases in WHERE: {'s'}
2025-08-08 00:22:54,730 - INFO - ‚úÖ Query passed advanced validation
2025-08-08 00:22:54,730 - INFO - ‚úÖ Query is safe and authorized!
2025-08-08 00:22:54,730 - INFO - üìå Executing SQL query: SELECT ab.alpha, ab.beta, sc.nomenclature, sc.component_name FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN alphabeta ab ON sc.component_id = ab.component_id WHERE UPPER(s.ship_name) = UPPER('ins one')
2025-08-08 00:22:54,735 - INFO - üìå Query executed successfully in 0.005 seconds. Retrieved 16 records.
2025-08-08 00:26:29,438 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-08 00:26:29,448 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 00:26:29,450 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 00:26:29,452 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 00:26:29,454 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 00:26:29,457 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-08 00:26:29,464 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 00:26:29,466 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 00:26:29,467 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 00:26:29,469 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 00:27:08,585 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-08 00:27:08,592 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 00:27:08,594 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 00:27:08,596 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 00:27:08,598 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 00:27:08,602 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-08 00:27:08,608 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 00:27:08,610 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 00:27:08,612 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 00:27:08,614 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 00:31:44,117 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-08 00:31:44,124 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 00:31:44,126 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 00:31:44,128 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 00:31:44,130 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 00:31:44,133 - INFO - Retrieved 4 systems for ship ID: fdc1f9a0-d380-42bb-9ee5-7990a46ddff5
2025-08-08 00:31:44,140 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 00:31:44,142 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 00:31:44,144 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 00:31:44,146 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 00:35:04,074 - INFO - Retrieved 4 systems for ship ID: 53f13701-849f-4030-8d71-a0f65eac992e
2025-08-08 00:35:04,081 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 00:35:04,083 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 00:35:04,085 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 00:35:04,086 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 00:35:04,090 - INFO - Retrieved 4 systems for ship ID: 53f13701-849f-4030-8d71-a0f65eac992e
2025-08-08 00:35:04,096 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 00:35:04,098 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 00:35:04,099 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 00:35:04,101 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 00:35:17,733 - INFO - Retrieved 4 systems for ship ID: 53f13701-849f-4030-8d71-a0f65eac992e
2025-08-08 00:35:17,740 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 00:35:17,742 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 00:35:17,744 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 00:35:17,746 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 00:35:17,750 - INFO - Retrieved 4 systems for ship ID: 53f13701-849f-4030-8d71-a0f65eac992e
2025-08-08 00:35:17,756 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 00:35:17,758 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 00:35:17,759 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 00:35:17,761 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 00:48:11,031 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 00:48:11,165 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-08 00:48:11,165 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-08 00:48:11,165 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-08 00:48:11,344 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-08 00:48:11,441 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:11,457 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:48:11,457 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:11,472 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:48:11,472 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:11,487 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:48:11,487 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:48:11,487 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:48:11,496 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:48:11,496 - INFO - ‚úÖ Database connection established
2025-08-08 00:48:11,516 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:11,522 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:48:11,525 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:48:11,528 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:48:11,531 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:48:11,533 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:48:11,536 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:48:11,539 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:48:11,542 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:48:11,544 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:48:11,548 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:48:11,551 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:48:11,553 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:48:11,556 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:48:11,562 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:48:11,566 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:11,566 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:11,570 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:48:11,570 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:48:11,574 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:11,574 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:11,578 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:11,578 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:48:11,582 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:11,582 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:48:11,587 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:48:11,587 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:48:11,591 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:48:11,591 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:48:11,591 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:48:11,595 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:48:11,595 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:48:11,595 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:48:11,599 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:48:11,604 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:48:11,604 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:48:11,604 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:48:11,604 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:48:11,604 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:48:11,608 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:48:11,612 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:48:11,613 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:48:11,613 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:11,613 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:48:11,613 - DEBUG - üîç Relationship Details:
2025-08-08 00:48:11,613 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,613 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:48:11,613 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,613 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,613 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,613 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:48:11,613 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,613 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:48:11,613 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,613 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:48:11,613 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:48:11,613 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:48:11,613 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:48:11,613 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:48:11,613 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:48:11,613 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:48:11,615 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:48:11,615 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:48:11,615 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 00:48:11,846 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:48:11,846 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:11,862 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:48:11,862 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:48:11,862 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:48:11,863 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:48:11,863 - INFO - ‚úÖ Database connection established
2025-08-08 00:48:11,877 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:11,881 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:48:11,884 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:48:11,887 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:48:11,890 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:48:11,893 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:48:11,895 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:48:11,898 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:48:11,901 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:48:11,903 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:48:11,906 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:48:11,909 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:48:11,912 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:48:11,915 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:48:11,920 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:48:11,925 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:11,925 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:11,929 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:48:11,929 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:48:11,933 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:11,933 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:11,937 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:11,937 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:48:11,941 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:11,941 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:48:11,945 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:48:11,945 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:48:11,949 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:48:11,950 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:48:11,950 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:48:11,954 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:48:11,954 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:48:11,954 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:48:11,958 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:48:11,963 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:48:11,963 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:48:11,963 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:48:11,963 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:48:11,963 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:48:11,967 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:48:11,971 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:48:11,971 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:48:11,971 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:11,971 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:48:11,971 - DEBUG - üîç Relationship Details:
2025-08-08 00:48:11,971 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,971 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:48:11,971 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,971 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,971 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,971 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:48:11,971 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,971 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:48:11,971 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:48:11,972 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:48:11,972 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:48:11,972 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:48:11,972 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:48:11,972 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:48:11,972 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:48:11,972 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:48:14,354 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 00:48:14,485 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-08 00:48:14,485 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-08 00:48:14,485 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-08 00:48:14,661 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-08 00:48:14,756 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:14,773 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:48:14,773 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:14,788 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:48:14,788 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:14,803 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:48:14,803 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:48:14,803 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:48:14,812 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:48:14,812 - INFO - ‚úÖ Database connection established
2025-08-08 00:48:14,832 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:14,838 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:48:14,841 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:48:14,843 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:48:14,846 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:48:14,849 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:48:14,851 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:48:14,854 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:48:14,857 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:48:14,860 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:48:14,863 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:48:14,866 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:48:14,868 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:48:14,871 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:48:14,877 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:48:14,881 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:14,881 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:14,885 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:48:14,885 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:48:14,889 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:14,889 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:14,894 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:14,894 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:48:14,898 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:14,898 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:48:14,902 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:48:14,902 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:48:14,906 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:48:14,906 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:48:14,906 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:48:14,910 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:48:14,910 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:48:14,910 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:48:14,915 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:48:14,919 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:48:14,919 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:48:14,919 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:48:14,919 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:48:14,919 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:48:14,923 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:48:14,927 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:48:14,927 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:48:14,927 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:14,928 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:48:14,928 - DEBUG - üîç Relationship Details:
2025-08-08 00:48:14,928 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:14,928 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:48:14,928 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:14,928 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:48:14,928 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:48:14,928 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:48:14,928 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:48:14,928 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:48:14,928 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:48:14,928 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:48:14,928 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:48:14,928 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:48:14,928 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:48:14,928 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:48:14,928 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:48:14,928 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:48:14,929 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:48:14,929 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:48:14,930 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 00:48:15,163 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:48:15,163 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:15,179 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:48:15,179 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:48:15,179 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:48:15,179 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:48:15,179 - INFO - ‚úÖ Database connection established
2025-08-08 00:48:15,192 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:15,196 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:48:15,198 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:48:15,201 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:48:15,204 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:48:15,206 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:48:15,209 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:48:15,212 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:48:15,215 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:48:15,218 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:48:15,220 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:48:15,224 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:48:15,226 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:48:15,229 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:48:15,235 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:48:15,239 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:15,239 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:15,243 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:48:15,243 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:48:15,248 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:15,248 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:15,252 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:15,252 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:48:15,256 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:15,256 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:48:15,260 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:48:15,260 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:48:15,264 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:48:15,264 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:48:15,264 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:48:15,268 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:48:15,268 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:48:15,268 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:48:15,273 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:48:15,277 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:48:15,277 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:48:15,277 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:48:15,277 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:48:15,277 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:48:15,282 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:48:15,286 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:48:15,286 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:48:15,286 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:15,286 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:48:15,286 - DEBUG - üîç Relationship Details:
2025-08-08 00:48:15,286 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:15,286 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:48:15,286 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:15,286 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:48:15,286 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:48:15,286 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:48:15,287 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:48:15,287 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:48:15,287 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:48:15,287 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:48:15,287 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:48:15,287 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:48:15,287 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:48:15,287 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:48:15,287 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:48:15,287 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:48:17,068 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 00:48:17,200 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-08 00:48:17,200 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-08 00:48:17,200 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-08 00:48:17,375 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-08 00:48:17,471 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:17,487 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:48:17,487 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:17,502 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:48:17,502 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:17,517 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:48:17,517 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:48:17,517 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:48:17,526 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:48:17,526 - INFO - ‚úÖ Database connection established
2025-08-08 00:48:17,546 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:17,552 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:48:17,555 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:48:17,557 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:48:17,560 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:48:17,563 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:48:17,565 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:48:17,568 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:48:17,571 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:48:17,574 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:48:17,577 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:48:17,581 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:48:17,583 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:48:17,586 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:48:17,593 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:48:17,600 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:17,600 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:17,605 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:48:17,605 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:48:17,610 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:17,610 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:17,615 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:17,615 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:48:17,619 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:17,619 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:48:17,623 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:48:17,623 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:48:17,627 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:48:17,627 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:48:17,627 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:48:17,632 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:48:17,632 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:48:17,632 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:48:17,636 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:48:17,640 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:48:17,640 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:48:17,640 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:48:17,640 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:48:17,640 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:48:17,645 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:48:17,649 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:48:17,649 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:48:17,649 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:17,649 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:48:17,649 - DEBUG - üîç Relationship Details:
2025-08-08 00:48:17,649 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:17,649 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:48:17,649 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:17,649 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:48:17,649 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:48:17,649 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:48:17,649 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:48:17,649 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:48:17,649 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:48:17,649 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:48:17,649 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:48:17,649 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:48:17,649 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:48:17,649 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:48:17,649 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:48:17,650 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 00:48:17,651 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 00:48:17,651 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 00:48:17,651 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 00:48:17,879 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 00:48:17,880 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 00:48:17,896 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 00:48:17,896 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 00:48:17,896 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 00:48:17,896 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 00:48:17,897 - INFO - ‚úÖ Database connection established
2025-08-08 00:48:17,909 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:17,914 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 00:48:17,916 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 00:48:17,919 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 00:48:17,922 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 00:48:17,925 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 00:48:17,928 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 00:48:17,931 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 00:48:17,934 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 00:48:17,936 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 00:48:17,939 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 00:48:17,943 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 00:48:17,945 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 00:48:17,948 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 00:48:17,954 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 00:48:17,958 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:17,959 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:17,963 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 00:48:17,963 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 00:48:17,967 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:17,967 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 00:48:17,971 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:17,971 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 00:48:17,976 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 00:48:17,976 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 00:48:17,980 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 00:48:17,980 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 00:48:17,984 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 00:48:17,984 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 00:48:17,984 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 00:48:17,988 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 00:48:17,988 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 00:48:17,988 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 00:48:17,992 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 00:48:17,997 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 00:48:17,997 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 00:48:17,997 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 00:48:17,997 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 00:48:17,997 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 00:48:18,002 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 00:48:18,006 - DEBUG - üîó Foreign keys for users: []
2025-08-08 00:48:18,006 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 00:48:18,006 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 00:48:18,006 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 00:48:18,006 - DEBUG - üîç Relationship Details:
2025-08-08 00:48:18,006 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:18,006 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 00:48:18,006 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 00:48:18,006 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 00:48:18,006 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 00:48:18,006 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 00:48:18,006 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 00:48:18,006 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 00:48:18,007 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 00:48:18,007 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 00:48:18,007 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 00:48:18,007 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 00:48:18,007 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 00:48:18,007 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 00:48:18,007 - INFO - üìå Maritime system initialization complete.
2025-08-08 00:48:18,007 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 11:43:23,236 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 11:43:23,371 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-08 11:43:23,372 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-08 11:43:23,372 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-08 11:43:23,548 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-08 11:43:23,669 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 11:43:23,686 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 11:43:23,686 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 11:43:23,701 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 11:43:23,701 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 11:43:23,717 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 11:43:23,717 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 11:43:23,717 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 11:43:23,728 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 11:43:23,728 - INFO - ‚úÖ Database connection established
2025-08-08 11:43:23,960 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 11:43:23,966 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 11:43:23,969 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 11:43:23,972 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 11:43:23,975 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 11:43:23,978 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 11:43:23,981 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 11:43:23,984 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 11:43:23,987 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 11:43:23,990 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 11:43:23,993 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 11:43:23,996 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 11:43:23,999 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 11:43:24,002 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 11:43:24,008 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 11:43:24,012 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 11:43:24,012 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 11:43:24,017 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 11:43:24,017 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 11:43:24,021 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 11:43:24,021 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 11:43:24,025 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 11:43:24,025 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 11:43:24,029 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 11:43:24,030 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 11:43:24,034 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 11:43:24,034 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 11:43:24,039 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 11:43:24,039 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 11:43:24,039 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 11:43:24,043 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 11:43:24,043 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 11:43:24,043 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 11:43:24,048 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 11:43:24,053 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 11:43:24,053 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 11:43:24,053 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 11:43:24,053 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 11:43:24,053 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 11:43:24,057 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 11:43:24,062 - DEBUG - üîó Foreign keys for users: []
2025-08-08 11:43:24,062 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 11:43:24,062 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 11:43:24,062 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 11:43:24,062 - DEBUG - üîç Relationship Details:
2025-08-08 11:43:24,062 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,062 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 11:43:24,062 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,062 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,062 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,062 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 11:43:24,063 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,063 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 11:43:24,063 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,063 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 11:43:24,063 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 11:43:24,063 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 11:43:24,063 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 11:43:24,063 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 11:43:24,063 - INFO - üìå Maritime system initialization complete.
2025-08-08 11:43:24,063 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 11:43:24,065 - INFO - üìå Loaded conversation memory from disk.
2025-08-08 11:43:24,065 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-08 11:43:24,066 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-08 11:43:24,297 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-08 11:43:24,297 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-08 11:43:24,313 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-08 11:43:24,313 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-08 11:43:24,313 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-08 11:43:24,314 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-08 11:43:24,314 - INFO - ‚úÖ Database connection established
2025-08-08 11:43:24,326 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 11:43:24,331 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-08 11:43:24,333 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-08 11:43:24,336 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-08 11:43:24,339 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-08 11:43:24,341 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-08 11:43:24,344 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-08 11:43:24,347 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-08 11:43:24,350 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-08 11:43:24,352 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-08 11:43:24,355 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-08 11:43:24,358 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-08 11:43:24,361 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-08 11:43:24,364 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-08 11:43:24,369 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-08 11:43:24,374 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 11:43:24,374 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-08 11:43:24,378 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-08 11:43:24,378 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-08 11:43:24,382 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 11:43:24,382 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-08 11:43:24,386 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 11:43:24,386 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-08 11:43:24,391 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-08 11:43:24,391 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-08 11:43:24,395 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-08 11:43:24,395 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-08 11:43:24,399 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-08 11:43:24,399 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-08 11:43:24,399 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-08 11:43:24,404 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-08 11:43:24,404 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-08 11:43:24,404 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-08 11:43:24,408 - DEBUG - üîó Foreign keys for ships: []
2025-08-08 11:43:24,413 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-08 11:43:24,413 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-08 11:43:24,413 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-08 11:43:24,413 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-08 11:43:24,413 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-08 11:43:24,417 - DEBUG - üîó Foreign keys for systems: []
2025-08-08 11:43:24,421 - DEBUG - üîó Foreign keys for users: []
2025-08-08 11:43:24,421 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-08 11:43:24,421 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-08 11:43:24,422 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-08 11:43:24,422 - DEBUG - üîç Relationship Details:
2025-08-08 11:43:24,422 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,422 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-08 11:43:24,422 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,422 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,422 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,422 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-08 11:43:24,422 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,422 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-08 11:43:24,422 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-08 11:43:24,422 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-08 11:43:24,422 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-08 11:43:24,422 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-08 11:43:24,422 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-08 11:43:24,422 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-08 11:43:24,422 - INFO - üìå Maritime system initialization complete.
2025-08-08 11:43:24,422 - INFO - ‚úÖ All global variables verified successfully
2025-08-08 11:44:00,277 - INFO - Database engine created with pool_size=10
2025-08-08 11:49:17,532 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-08 11:49:17,542 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 11:49:17,544 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 11:49:17,546 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 11:49:17,547 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-08 11:49:17,551 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-08 11:49:17,557 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-08 11:49:17,559 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-08 11:49:17,561 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-08 11:49:17,562 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-11 11:46:18,901 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-11 11:46:19,350 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-11 11:46:19,350 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-11 11:46:19,350 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-11 11:46:19,985 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-11 11:46:20,336 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-11 11:46:20,387 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-11 11:46:20,387 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-11 11:46:20,403 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-11 11:46:20,403 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-11 11:46:20,419 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-11 11:46:20,419 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-11 11:46:20,419 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-11 11:46:20,529 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-11 11:46:20,529 - INFO - ‚úÖ Database connection established
2025-08-11 11:46:20,893 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-11 11:46:20,900 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-11 11:46:20,903 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-11 11:46:20,906 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-11 11:46:20,909 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-11 11:46:20,912 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-11 11:46:20,915 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-11 11:46:20,918 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-11 11:46:20,921 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-11 11:46:20,925 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-11 11:46:20,928 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-11 11:46:20,932 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-11 11:46:20,935 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-11 11:46:20,938 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-11 11:46:20,944 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-11 11:46:20,949 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-11 11:46:20,949 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-11 11:46:20,953 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-11 11:46:20,953 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-11 11:46:20,958 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-11 11:46:20,958 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-11 11:46:20,963 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-11 11:46:20,963 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-11 11:46:20,967 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-11 11:46:20,967 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-11 11:46:20,972 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-11 11:46:20,972 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-11 11:46:20,976 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-11 11:46:20,976 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-11 11:46:20,976 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-11 11:46:20,981 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-11 11:46:20,981 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-11 11:46:20,981 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-11 11:46:20,986 - DEBUG - üîó Foreign keys for ships: []
2025-08-11 11:46:20,990 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-11 11:46:20,990 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-11 11:46:20,990 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-11 11:46:20,990 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-11 11:46:20,990 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-11 11:46:20,995 - DEBUG - üîó Foreign keys for systems: []
2025-08-11 11:46:20,999 - DEBUG - üîó Foreign keys for users: []
2025-08-11 11:46:21,000 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-11 11:46:21,000 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-11 11:46:21,000 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-11 11:46:21,000 - DEBUG - üîç Relationship Details:
2025-08-11 11:46:21,000 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-11 11:46:21,000 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-11 11:46:21,000 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-11 11:46:21,000 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-11 11:46:21,000 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-11 11:46:21,000 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-11 11:46:21,000 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-11 11:46:21,000 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-11 11:46:21,000 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-11 11:46:21,000 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-11 11:46:21,000 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-11 11:46:21,000 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-11 11:46:21,000 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-11 11:46:21,000 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-11 11:46:21,000 - INFO - üìå Maritime system initialization complete.
2025-08-11 11:46:21,000 - INFO - ‚úÖ All global variables verified successfully
2025-08-11 11:46:21,002 - INFO - üìå Loaded conversation memory from disk.
2025-08-11 11:46:21,002 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-11 11:46:21,003 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-11 11:46:21,972 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-11 11:46:21,972 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-11 11:46:21,989 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-11 11:46:21,989 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-11 11:46:21,989 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-11 11:46:21,989 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-11 11:46:21,989 - INFO - ‚úÖ Database connection established
2025-08-11 11:46:22,002 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-11 11:46:22,007 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-11 11:46:22,009 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-11 11:46:22,013 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-11 11:46:22,015 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-11 11:46:22,018 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-11 11:46:22,021 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-11 11:46:22,024 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-11 11:46:22,026 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-11 11:46:22,029 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-11 11:46:22,032 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-11 11:46:22,035 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-11 11:46:22,038 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-11 11:46:22,041 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-11 11:46:22,047 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-11 11:46:22,051 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-11 11:46:22,051 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-11 11:46:22,056 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-11 11:46:22,056 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-11 11:46:22,061 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-11 11:46:22,061 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-11 11:46:22,065 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-11 11:46:22,065 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-11 11:46:22,070 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-11 11:46:22,070 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-11 11:46:22,074 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-11 11:46:22,074 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-11 11:46:22,078 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-11 11:46:22,078 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-11 11:46:22,078 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-11 11:46:22,083 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-11 11:46:22,083 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-11 11:46:22,083 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-11 11:46:22,087 - DEBUG - üîó Foreign keys for ships: []
2025-08-11 11:46:22,092 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-11 11:46:22,092 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-11 11:46:22,092 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-11 11:46:22,092 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-11 11:46:22,092 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-11 11:46:22,096 - DEBUG - üîó Foreign keys for systems: []
2025-08-11 11:46:22,100 - DEBUG - üîó Foreign keys for users: []
2025-08-11 11:46:22,100 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-11 11:46:22,100 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-11 11:46:22,100 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-11 11:46:22,100 - DEBUG - üîç Relationship Details:
2025-08-11 11:46:22,101 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-11 11:46:22,101 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-11 11:46:22,101 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-11 11:46:22,101 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-11 11:46:22,101 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-11 11:46:22,101 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-11 11:46:22,101 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-11 11:46:22,101 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-11 11:46:22,101 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-11 11:46:22,101 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-11 11:46:22,101 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-11 11:46:22,101 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-11 11:46:22,101 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-11 11:46:22,101 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-11 11:46:22,101 - INFO - üìå Maritime system initialization complete.
2025-08-11 11:46:22,101 - INFO - ‚úÖ All global variables verified successfully
2025-08-11 11:46:40,618 - INFO - Database engine created with pool_size=10
2025-08-13 12:04:19,577 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 12:04:19,948 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 12:04:19,948 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 12:04:19,949 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 12:04:20,447 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 12:04:20,745 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-13 12:04:20,773 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-13 12:04:20,773 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-13 12:04:20,787 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-13 12:04:20,788 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-13 12:04:20,803 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-13 12:04:20,803 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-13 12:04:20,803 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-13 12:04:20,917 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-13 12:04:20,917 - INFO - ‚úÖ Database connection established
2025-08-13 12:04:21,181 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-13 12:04:21,187 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-13 12:04:21,226 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-13 12:04:21,229 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-13 12:04:21,232 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-13 12:04:21,235 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-13 12:04:21,237 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-13 12:04:21,240 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-13 12:04:21,243 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-13 12:04:21,246 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-13 12:04:21,248 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-13 12:04:21,252 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-13 12:04:21,254 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-13 12:04:21,257 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-13 12:04:21,263 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-13 12:04:21,267 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 12:04:21,267 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-13 12:04:21,271 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-13 12:04:21,271 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-13 12:04:21,275 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 12:04:21,275 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-13 12:04:21,279 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 12:04:21,279 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-13 12:04:21,283 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 12:04:21,283 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-13 12:04:21,287 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-13 12:04:21,287 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-13 12:04:21,292 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-13 12:04:21,292 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-13 12:04:21,292 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-13 12:04:21,296 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-13 12:04:21,296 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-13 12:04:21,296 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-13 12:04:21,300 - DEBUG - üîó Foreign keys for ships: []
2025-08-13 12:04:21,304 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-13 12:04:21,304 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-13 12:04:21,304 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-13 12:04:21,304 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-13 12:04:21,304 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-13 12:04:21,308 - DEBUG - üîó Foreign keys for systems: []
2025-08-13 12:04:21,312 - DEBUG - üîó Foreign keys for users: []
2025-08-13 12:04:21,312 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-13 12:04:21,313 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-13 12:04:21,313 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-13 12:04:21,313 - DEBUG - üîç Relationship Details:
2025-08-13 12:04:21,313 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-13 12:04:21,313 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-13 12:04:21,313 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-13 12:04:21,313 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-13 12:04:21,313 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-13 12:04:21,313 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-13 12:04:21,313 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-13 12:04:21,313 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-13 12:04:21,313 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-13 12:04:21,313 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-13 12:04:21,313 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-13 12:04:21,313 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-13 12:04:21,313 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-13 12:04:21,313 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-13 12:04:21,313 - INFO - üìå Maritime system initialization complete.
2025-08-13 12:04:21,313 - INFO - ‚úÖ All global variables verified successfully
2025-08-13 12:04:21,315 - INFO - üìå Loaded conversation memory from disk.
2025-08-13 12:04:21,315 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-13 12:04:21,316 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 12:04:22,150 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-13 12:04:22,150 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-13 12:04:22,166 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-13 12:04:22,167 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-13 12:04:22,167 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-13 12:04:22,167 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-13 12:04:22,167 - INFO - ‚úÖ Database connection established
2025-08-13 12:04:22,181 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-13 12:04:22,185 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-13 12:04:22,188 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-13 12:04:22,191 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-13 12:04:22,193 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-13 12:04:22,196 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-13 12:04:22,199 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-13 12:04:22,201 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-13 12:04:22,205 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-13 12:04:22,208 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-13 12:04:22,211 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-13 12:04:22,214 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-13 12:04:22,216 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-13 12:04:22,220 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-13 12:04:22,225 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-13 12:04:22,229 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 12:04:22,229 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-13 12:04:22,234 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-13 12:04:22,234 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-13 12:04:22,238 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 12:04:22,238 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-13 12:04:22,242 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 12:04:22,244 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-13 12:04:22,248 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 12:04:22,248 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-13 12:04:22,253 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-13 12:04:22,253 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-13 12:04:22,257 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-13 12:04:22,257 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-13 12:04:22,257 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-13 12:04:22,261 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-13 12:04:22,261 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-13 12:04:22,261 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-13 12:04:22,265 - DEBUG - üîó Foreign keys for ships: []
2025-08-13 12:04:22,270 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-13 12:04:22,270 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-13 12:04:22,270 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-13 12:04:22,270 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-13 12:04:22,270 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-13 12:04:22,274 - DEBUG - üîó Foreign keys for systems: []
2025-08-13 12:04:22,279 - DEBUG - üîó Foreign keys for users: []
2025-08-13 12:04:22,279 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-13 12:04:22,279 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-13 12:04:22,279 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-13 12:04:22,279 - DEBUG - üîç Relationship Details:
2025-08-13 12:04:22,279 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-13 12:04:22,279 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-13 12:04:22,279 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-13 12:04:22,279 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-13 12:04:22,279 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-13 12:04:22,279 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-13 12:04:22,279 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-13 12:04:22,279 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-13 12:04:22,279 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-13 12:04:22,279 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-13 12:04:22,279 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-13 12:04:22,279 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-13 12:04:22,279 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-13 12:04:22,279 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-13 12:04:22,279 - INFO - üìå Maritime system initialization complete.
2025-08-13 12:04:22,279 - INFO - ‚úÖ All global variables verified successfully
2025-08-13 12:12:38,428 - INFO - Database engine created with pool_size=10
2025-08-13 14:32:43,393 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:32:43,524 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:32:43,525 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:32:43,525 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:32:43,702 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:32:46,203 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:32:46,333 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:32:46,333 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:32:46,333 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:32:46,507 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:32:58,319 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:32:58,450 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:32:58,450 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:32:58,450 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:32:58,625 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:33:00,645 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:33:00,778 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:33:00,778 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:33:00,778 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:33:00,954 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:33:10,975 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:33:11,109 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:33:11,109 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:33:11,109 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:33:11,286 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:33:15,228 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:33:15,374 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:33:15,374 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:33:15,374 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:33:15,549 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:33:22,815 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:33:22,973 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:33:22,974 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:33:22,974 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:33:23,152 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:33:25,804 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:33:25,935 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:33:25,935 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:33:25,935 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:33:26,109 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:33:33,605 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:33:33,739 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:33:33,739 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:33:33,739 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:33:33,915 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:33:39,361 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:33:39,492 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:33:39,492 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:33:39,492 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:33:39,665 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:33:53,491 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:33:53,625 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:33:53,625 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:33:53,625 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:33:53,802 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:33:57,737 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:33:57,867 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:33:57,867 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:33:57,867 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:33:58,041 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:34:03,636 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:34:03,774 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:34:03,774 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:34:03,775 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:34:03,954 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:34:05,957 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:34:06,090 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:34:06,090 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:34:06,090 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:34:06,268 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:34:10,747 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:34:10,881 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:34:10,881 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:34:10,881 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:34:11,060 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:34:14,792 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:34:14,938 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:34:14,938 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:34:14,938 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:34:15,154 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:34:17,790 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:34:17,921 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:34:17,921 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:34:17,921 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:34:18,094 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:43:45,957 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:43:46,087 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:43:46,087 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:43:46,087 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:43:46,267 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:43:48,297 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:43:48,434 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:43:48,434 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:43:48,434 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:43:48,610 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:43:50,602 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:43:50,743 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:43:50,744 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:43:50,744 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:43:50,921 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:43:56,672 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:43:56,802 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:43:56,802 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:43:56,802 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:43:56,977 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:44:07,003 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:44:07,134 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:44:07,134 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:44:07,135 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:44:07,312 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:44:10,497 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-13 14:44:10,629 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-13 14:44:10,629 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-13 14:44:10,629 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-13 14:44:10,804 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-13 14:44:10,918 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-13 14:44:10,935 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-13 14:44:10,935 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-13 14:44:10,950 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-13 14:44:10,950 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-13 14:44:10,966 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-13 14:44:10,966 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-13 14:44:10,966 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-13 14:44:11,001 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-13 14:44:11,001 - INFO - ‚úÖ Database connection established
2025-08-13 14:44:11,969 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-13 14:44:11,975 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-13 14:44:11,978 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-13 14:44:11,981 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-13 14:44:11,984 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-13 14:44:11,986 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-13 14:44:11,989 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-13 14:44:11,992 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-13 14:44:11,995 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-13 14:44:11,998 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-13 14:44:12,001 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-13 14:44:12,004 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-13 14:44:12,006 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-13 14:44:12,009 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-13 14:44:12,014 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-13 14:44:12,019 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 14:44:12,019 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-13 14:44:12,023 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-13 14:44:12,023 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-13 14:44:12,027 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 14:44:12,027 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-13 14:44:12,031 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 14:44:12,031 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-13 14:44:12,035 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-13 14:44:12,035 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-13 14:44:12,039 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-13 14:44:12,039 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-13 14:44:12,044 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-13 14:44:12,044 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-13 14:44:12,044 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-13 14:44:12,049 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-13 14:44:12,049 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-13 14:44:12,049 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-13 14:44:12,053 - DEBUG - üîó Foreign keys for ships: []
2025-08-13 14:44:12,057 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-13 14:44:12,057 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-13 14:44:12,057 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-13 14:44:12,057 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-13 14:44:12,058 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-13 14:44:12,062 - DEBUG - üîó Foreign keys for systems: []
2025-08-13 14:44:12,066 - DEBUG - üîó Foreign keys for users: []
2025-08-13 14:44:12,067 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-13 14:44:12,067 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-13 14:44:12,067 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-13 14:44:12,067 - DEBUG - üîç Relationship Details:
2025-08-13 14:44:12,067 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-13 14:44:12,067 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-13 14:44:12,067 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-13 14:44:12,067 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-13 14:44:12,067 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-13 14:44:12,067 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-13 14:44:12,067 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-13 14:44:12,067 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-13 14:44:12,067 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-13 14:44:12,067 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-13 14:44:12,067 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-13 14:44:12,067 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-13 14:44:12,067 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-13 14:44:12,067 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-13 14:44:12,067 - INFO - üìå Maritime system initialization complete.
2025-08-13 14:44:12,067 - INFO - ‚úÖ All global variables verified successfully
2025-08-13 14:44:12,069 - INFO - üìå Loaded conversation memory from disk.
2025-08-13 14:44:12,069 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-13 14:44:12,069 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-21 10:26:57,033 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-21 10:26:57,371 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-21 10:26:57,371 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-21 10:26:57,371 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-21 10:26:57,838 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-21 10:26:58,203 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:26:58,239 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 10:26:58,239 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:26:58,254 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-21 10:26:58,254 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:26:58,269 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-21 10:26:58,270 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 10:26:58,270 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-21 10:26:58,406 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-21 10:26:58,406 - INFO - ‚úÖ Database connection established
2025-08-21 10:26:59,207 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:26:59,623 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-21 10:26:59,626 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-21 10:26:59,629 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-21 10:26:59,651 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-21 10:26:59,654 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-21 10:26:59,657 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-21 10:26:59,660 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-21 10:26:59,664 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-21 10:26:59,667 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-21 10:26:59,669 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-21 10:26:59,673 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-21 10:26:59,676 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-21 10:26:59,679 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-21 10:27:00,065 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-21 10:27:00,071 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:00,071 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:00,075 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-21 10:27:00,075 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-21 10:27:00,080 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:00,080 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:00,084 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:00,084 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-21 10:27:00,088 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:00,088 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-21 10:27:00,094 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-21 10:27:00,094 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-21 10:27:00,101 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-21 10:27:00,101 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-21 10:27:00,101 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-21 10:27:00,106 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-21 10:27:00,106 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-21 10:27:00,106 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-21 10:27:00,113 - DEBUG - üîó Foreign keys for ships: []
2025-08-21 10:27:00,118 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-21 10:27:00,118 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-21 10:27:00,118 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-21 10:27:00,118 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-21 10:27:00,118 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-21 10:27:00,122 - DEBUG - üîó Foreign keys for systems: []
2025-08-21 10:27:00,127 - DEBUG - üîó Foreign keys for users: []
2025-08-21 10:27:00,127 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-21 10:27:00,127 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:00,127 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-21 10:27:00,127 - DEBUG - üîç Relationship Details:
2025-08-21 10:27:00,127 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:00,127 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-21 10:27:00,127 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:00,127 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-21 10:27:00,127 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-21 10:27:00,128 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-21 10:27:00,128 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-21 10:27:00,128 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-21 10:27:00,128 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-21 10:27:00,128 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-21 10:27:00,128 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-21 10:27:00,128 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-21 10:27:00,128 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-21 10:27:00,128 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-21 10:27:00,128 - INFO - üìå Maritime system initialization complete.
2025-08-21 10:27:00,128 - INFO - ‚úÖ All global variables verified successfully
2025-08-21 10:27:00,140 - INFO - üìå Loaded conversation memory from disk.
2025-08-21 10:27:00,140 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-21 10:27:00,140 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-21 10:27:21,652 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-21 10:27:21,784 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-21 10:27:21,784 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-21 10:27:21,784 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-21 10:27:21,958 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-21 10:27:22,054 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:22,071 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 10:27:22,071 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:22,086 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-21 10:27:22,086 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:22,101 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-21 10:27:22,101 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 10:27:22,101 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-21 10:27:22,110 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-21 10:27:22,111 - INFO - ‚úÖ Database connection established
2025-08-21 10:27:22,131 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:22,136 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-21 10:27:22,139 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-21 10:27:22,142 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-21 10:27:22,145 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-21 10:27:22,147 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-21 10:27:22,150 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-21 10:27:22,152 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-21 10:27:22,155 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-21 10:27:22,158 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-21 10:27:22,161 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-21 10:27:22,164 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-21 10:27:22,166 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-21 10:27:22,169 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-21 10:27:22,174 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-21 10:27:22,178 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:22,179 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:22,183 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-21 10:27:22,183 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-21 10:27:22,186 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:22,187 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:22,191 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:22,191 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-21 10:27:22,195 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:22,195 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-21 10:27:22,199 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-21 10:27:22,199 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-21 10:27:22,203 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-21 10:27:22,203 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-21 10:27:22,203 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-21 10:27:22,207 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-21 10:27:22,207 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-21 10:27:22,207 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-21 10:27:22,212 - DEBUG - üîó Foreign keys for ships: []
2025-08-21 10:27:22,216 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-21 10:27:22,216 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-21 10:27:22,216 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-21 10:27:22,216 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-21 10:27:22,216 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-21 10:27:22,220 - DEBUG - üîó Foreign keys for systems: []
2025-08-21 10:27:22,224 - DEBUG - üîó Foreign keys for users: []
2025-08-21 10:27:22,224 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-21 10:27:22,224 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:22,224 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-21 10:27:22,224 - DEBUG - üîç Relationship Details:
2025-08-21 10:27:22,224 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:22,224 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-21 10:27:22,224 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:22,224 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-21 10:27:22,224 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-21 10:27:22,224 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-21 10:27:22,224 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-21 10:27:22,224 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-21 10:27:22,224 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-21 10:27:22,225 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-21 10:27:22,225 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-21 10:27:22,225 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-21 10:27:22,225 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-21 10:27:22,225 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-21 10:27:22,225 - INFO - üìå Maritime system initialization complete.
2025-08-21 10:27:22,225 - INFO - ‚úÖ All global variables verified successfully
2025-08-21 10:27:22,226 - INFO - üìå Loaded conversation memory from disk.
2025-08-21 10:27:22,226 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-21 10:27:22,226 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-21 10:27:39,766 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-21 10:27:39,897 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-21 10:27:39,897 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-21 10:27:39,897 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-21 10:27:40,072 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-21 10:27:40,167 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:40,183 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 10:27:40,183 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:40,198 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-21 10:27:40,199 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:40,213 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-21 10:27:40,214 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 10:27:40,214 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-21 10:27:40,223 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-21 10:27:40,223 - INFO - ‚úÖ Database connection established
2025-08-21 10:27:40,242 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:40,248 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-21 10:27:40,251 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-21 10:27:40,254 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-21 10:27:40,256 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-21 10:27:40,259 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-21 10:27:40,261 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-21 10:27:40,264 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-21 10:27:40,267 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-21 10:27:40,270 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-21 10:27:40,273 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-21 10:27:40,276 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-21 10:27:40,279 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-21 10:27:40,282 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-21 10:27:40,287 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-21 10:27:40,291 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:40,291 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:40,295 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-21 10:27:40,295 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-21 10:27:40,299 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:40,299 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:40,303 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:40,303 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-21 10:27:40,307 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:40,307 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-21 10:27:40,311 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-21 10:27:40,311 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-21 10:27:40,316 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-21 10:27:40,316 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-21 10:27:40,316 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-21 10:27:40,321 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-21 10:27:40,321 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-21 10:27:40,321 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-21 10:27:40,326 - DEBUG - üîó Foreign keys for ships: []
2025-08-21 10:27:40,330 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-21 10:27:40,330 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-21 10:27:40,330 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-21 10:27:40,330 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-21 10:27:40,330 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-21 10:27:40,334 - DEBUG - üîó Foreign keys for systems: []
2025-08-21 10:27:40,338 - DEBUG - üîó Foreign keys for users: []
2025-08-21 10:27:40,338 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-21 10:27:40,338 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:40,338 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-21 10:27:40,338 - DEBUG - üîç Relationship Details:
2025-08-21 10:27:40,338 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,339 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-21 10:27:40,339 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,339 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,339 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,339 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-21 10:27:40,339 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,339 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-21 10:27:40,339 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,339 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-21 10:27:40,339 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-21 10:27:40,339 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-21 10:27:40,339 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-21 10:27:40,339 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-21 10:27:40,339 - INFO - üìå Maritime system initialization complete.
2025-08-21 10:27:40,339 - INFO - ‚úÖ All global variables verified successfully
2025-08-21 10:27:40,340 - INFO - üìå Loaded conversation memory from disk.
2025-08-21 10:27:40,340 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-21 10:27:40,341 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-21 10:27:40,539 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-21 10:27:40,539 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:40,555 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-21 10:27:40,555 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 10:27:40,555 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-21 10:27:40,556 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-21 10:27:40,556 - INFO - ‚úÖ Database connection established
2025-08-21 10:27:40,568 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:40,572 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-21 10:27:40,575 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-21 10:27:40,578 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-21 10:27:40,580 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-21 10:27:40,583 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-21 10:27:40,586 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-21 10:27:40,588 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-21 10:27:40,591 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-21 10:27:40,594 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-21 10:27:40,597 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-21 10:27:40,600 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-21 10:27:40,603 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-21 10:27:40,606 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-21 10:27:40,611 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-21 10:27:40,615 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:40,615 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:40,619 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-21 10:27:40,619 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-21 10:27:40,623 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:40,623 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:40,627 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:40,627 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-21 10:27:40,631 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:40,631 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-21 10:27:40,635 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-21 10:27:40,635 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-21 10:27:40,639 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-21 10:27:40,639 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-21 10:27:40,640 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-21 10:27:40,644 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-21 10:27:40,644 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-21 10:27:40,644 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-21 10:27:40,648 - DEBUG - üîó Foreign keys for ships: []
2025-08-21 10:27:40,652 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-21 10:27:40,652 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-21 10:27:40,652 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-21 10:27:40,652 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-21 10:27:40,652 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-21 10:27:40,656 - DEBUG - üîó Foreign keys for systems: []
2025-08-21 10:27:40,660 - DEBUG - üîó Foreign keys for users: []
2025-08-21 10:27:40,661 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-21 10:27:40,661 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:40,661 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-21 10:27:40,661 - DEBUG - üîç Relationship Details:
2025-08-21 10:27:40,661 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,661 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-21 10:27:40,661 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,661 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,661 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,661 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-21 10:27:40,661 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,661 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-21 10:27:40,661 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-21 10:27:40,661 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-21 10:27:40,661 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-21 10:27:40,661 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-21 10:27:40,661 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-21 10:27:40,661 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-21 10:27:40,661 - INFO - üìå Maritime system initialization complete.
2025-08-21 10:27:40,661 - INFO - ‚úÖ All global variables verified successfully
2025-08-21 10:27:48,476 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-21 10:27:48,605 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-08-21 10:27:48,605 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-08-21 10:27:48,605 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-08-21 10:27:48,779 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-08-21 10:27:48,873 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:48,889 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 10:27:48,890 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:48,904 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-21 10:27:48,905 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:48,920 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-21 10:27:48,920 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 10:27:48,920 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-21 10:27:48,929 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-21 10:27:48,929 - INFO - ‚úÖ Database connection established
2025-08-21 10:27:48,948 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:48,954 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-21 10:27:48,956 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-21 10:27:48,959 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-21 10:27:48,962 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-21 10:27:48,964 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-21 10:27:48,967 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-21 10:27:48,970 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-21 10:27:48,973 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-21 10:27:48,975 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-21 10:27:48,978 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-21 10:27:48,981 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-21 10:27:48,984 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-21 10:27:48,986 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-21 10:27:48,992 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-21 10:27:48,996 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:48,996 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:49,000 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-21 10:27:49,000 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-21 10:27:49,004 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:49,004 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:49,008 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:49,008 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-21 10:27:49,012 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:49,013 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-21 10:27:49,017 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-21 10:27:49,017 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-21 10:27:49,021 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-21 10:27:49,021 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-21 10:27:49,021 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-21 10:27:49,026 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-21 10:27:49,026 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-21 10:27:49,026 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-21 10:27:49,030 - DEBUG - üîó Foreign keys for ships: []
2025-08-21 10:27:49,035 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-21 10:27:49,035 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-21 10:27:49,035 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-21 10:27:49,035 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-21 10:27:49,035 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-21 10:27:49,039 - DEBUG - üîó Foreign keys for systems: []
2025-08-21 10:27:49,043 - DEBUG - üîó Foreign keys for users: []
2025-08-21 10:27:49,043 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-21 10:27:49,043 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:49,043 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-21 10:27:49,043 - DEBUG - üîç Relationship Details:
2025-08-21 10:27:49,043 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,043 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-21 10:27:49,043 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,043 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,043 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,044 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-21 10:27:49,044 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,044 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-21 10:27:49,044 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,044 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-21 10:27:49,044 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-21 10:27:49,044 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-21 10:27:49,044 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-21 10:27:49,044 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-21 10:27:49,044 - INFO - üìå Maritime system initialization complete.
2025-08-21 10:27:49,044 - INFO - ‚úÖ All global variables verified successfully
2025-08-21 10:27:49,045 - INFO - üìå Loaded conversation memory from disk.
2025-08-21 10:27:49,045 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-21 10:27:49,045 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-08-21 10:27:49,244 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-21 10:27:49,244 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 10:27:49,260 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-21 10:27:49,260 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 10:27:49,260 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-21 10:27:49,261 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-21 10:27:49,261 - INFO - ‚úÖ Database connection established
2025-08-21 10:27:49,273 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:49,277 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-21 10:27:49,279 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-21 10:27:49,282 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-21 10:27:49,285 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-21 10:27:49,287 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-21 10:27:49,290 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-21 10:27:49,292 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-21 10:27:49,295 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-21 10:27:49,298 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-21 10:27:49,300 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-21 10:27:49,304 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-21 10:27:49,306 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-21 10:27:49,309 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-21 10:27:49,315 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-21 10:27:49,320 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:49,320 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:49,324 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-21 10:27:49,325 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-21 10:27:49,329 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:49,329 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-21 10:27:49,334 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:49,334 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-21 10:27:49,338 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 10:27:49,338 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-21 10:27:49,343 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-21 10:27:49,343 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-21 10:27:49,348 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-21 10:27:49,348 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-21 10:27:49,348 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-21 10:27:49,352 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-21 10:27:49,353 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-21 10:27:49,353 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-21 10:27:49,357 - DEBUG - üîó Foreign keys for ships: []
2025-08-21 10:27:49,361 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-21 10:27:49,361 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-21 10:27:49,361 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-21 10:27:49,361 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-21 10:27:49,361 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-21 10:27:49,365 - DEBUG - üîó Foreign keys for systems: []
2025-08-21 10:27:49,369 - DEBUG - üîó Foreign keys for users: []
2025-08-21 10:27:49,369 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-21 10:27:49,369 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 10:27:49,369 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-21 10:27:49,369 - DEBUG - üîç Relationship Details:
2025-08-21 10:27:49,369 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,369 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-21 10:27:49,369 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,369 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,369 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,370 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-21 10:27:49,370 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,370 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-21 10:27:49,370 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-21 10:27:49,370 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-21 10:27:49,370 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-21 10:27:49,370 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-21 10:27:49,370 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-21 10:27:49,370 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-21 10:27:49,370 - INFO - üìå Maritime system initialization complete.
2025-08-21 10:27:49,370 - INFO - ‚úÖ All global variables verified successfully
2025-08-21 10:28:11,919 - INFO - Database engine created with pool_size=10
2025-08-21 10:56:43,516 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-21 10:56:43,528 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-21 10:56:43,531 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-21 10:56:43,533 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-21 10:56:43,534 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-21 10:56:43,537 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-08-21 10:56:43,543 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-08-21 10:56:43,545 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-08-21 10:56:43,546 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-08-21 10:56:43,548 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-08-21 12:04:36,323 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 12:04:36,339 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-08-21 12:04:36,342 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 12:04:36,357 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 12:04:36,357 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 12:04:36,373 - INFO - üìå Initializing maritime sensor monitoring system...
2025-08-21 12:04:36,373 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-08-21 12:04:36,388 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-08-21 12:04:36,388 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-08-21 12:04:36,388 - INFO - ‚úÖ LLM Client initialized successfully
2025-08-21 12:04:36,389 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-08-21 12:04:36,389 - INFO - ‚úÖ Database connection established
2025-08-21 12:04:36,401 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 12:04:36,405 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-08-21 12:04:36,408 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-08-21 12:04:36,411 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-08-21 12:04:36,413 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-08-21 12:04:36,416 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-08-21 12:04:36,418 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-08-21 12:04:36,421 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-08-21 12:04:36,424 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-08-21 12:04:36,427 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-08-21 12:04:36,430 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-08-21 12:04:36,433 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-08-21 12:04:36,435 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-08-21 12:04:36,438 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-08-21 12:04:36,443 - DEBUG - üîó Foreign keys for alembic_version: []
2025-08-21 12:04:36,448 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 12:04:36,448 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-08-21 12:04:36,452 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-08-21 12:04:36,452 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-08-21 12:04:36,457 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 12:04:36,457 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-08-21 12:04:36,461 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 12:04:36,461 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-08-21 12:04:36,465 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-08-21 12:04:36,465 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-08-21 12:04:36,469 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-08-21 12:04:36,469 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-08-21 12:04:36,473 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-08-21 12:04:36,473 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-08-21 12:04:36,473 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-08-21 12:04:36,478 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-08-21 12:04:36,478 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-08-21 12:04:36,478 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-08-21 12:04:36,482 - DEBUG - üîó Foreign keys for ships: []
2025-08-21 12:04:36,486 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-08-21 12:04:36,487 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-08-21 12:04:36,487 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-08-21 12:04:36,487 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-08-21 12:04:36,487 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-08-21 12:04:36,491 - DEBUG - üîó Foreign keys for systems: []
2025-08-21 12:04:36,495 - DEBUG - üîó Foreign keys for users: []
2025-08-21 12:04:36,495 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-08-21 12:04:36,495 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 12:04:36,495 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-08-21 12:04:36,495 - DEBUG - üîç Relationship Details:
2025-08-21 12:04:36,495 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-08-21 12:04:36,495 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-08-21 12:04:36,495 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-08-21 12:04:36,495 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-08-21 12:04:36,496 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-08-21 12:04:36,496 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-08-21 12:04:36,496 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-08-21 12:04:36,496 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-08-21 12:04:36,496 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-08-21 12:04:36,496 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-08-21 12:04:36,496 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-08-21 12:04:36,496 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-08-21 12:04:36,496 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-08-21 12:04:36,496 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-08-21 12:04:36,496 - INFO - üìå Maritime system initialization complete.
2025-08-21 12:04:36,496 - INFO - ‚úÖ All global variables verified successfully
2025-08-21 12:04:36,497 - INFO - üìå Loaded conversation memory from disk.
2025-08-21 12:04:36,498 - INFO - üìå Initialized memory: Last 5 exchanges
2025-08-21 12:04:36,498 - INFO - üìå User input: show me operating hours of GT1 on INS ONE
2025-08-21 12:04:36,498 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: show me operating hours of GT1 on INS ONE
2025-08-21 12:04:36,498 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: show me operating hours of GT1 on INS ONE
2025-08-21 12:04:36,498 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-08-21 12:04:36,498 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list alpha beta of gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: show me operating hours of GT1 on INS ONE
2025-08-21 12:04:36,498 - DEBUG - üìå Generated Prompt Length: 10057 characters
2025-08-21 12:04:36,498 - INFO - Generating SQL query...
2025-08-21 12:04:36,499 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-08-21 12:04:36,499 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7ab7ecadf510>
2025-08-21 12:04:36,499 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-21 12:04:36,499 - DEBUG - send_request_headers.complete
2025-08-21 12:04:36,499 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-21 12:04:36,499 - DEBUG - send_request_body.complete
2025-08-21 12:04:36,499 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-21 12:06:05,821 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Thu, 21 Aug 2025 06:36:05 GMT'), (b'Content-Length', b'618')])
2025-08-21 12:06:05,822 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-08-21 12:06:05,822 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-21 12:06:05,822 - DEBUG - receive_response_body.complete
2025-08-21 12:06:05,822 - DEBUG - response_closed.started
2025-08-21 12:06:05,822 - DEBUG - response_closed.complete
2025-08-21 12:06:05,823 - DEBUG - Extracting SQL from response: SELECT s.operating_hours
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN sensor_metadata sm ON sc.component_id = sm.com...
2025-08-21 12:06:05,823 - INFO - Direct SQL response detected: SELECT s.operating_hours
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN sensor_metadata sm ON sc.component_id = sm.component_id
WHERE UPPER(s.ship_name) = UPPER('INS ONE') AND UPPER(sm.nomenclature) = UPPER('GT1');
2025-08-21 12:06:05,823 - INFO - SQL query generation completed
2025-08-21 12:06:05,823 - DEBUG - Generated SQL query: SELECT s.operating_hours
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN sensor_metadata sm ON sc.component_id = sm.component_id
WHERE UPPER(s.ship_name) = UPPER('INS ONE') AND UPPER(sm.nomenclature) = UPPER('GT1');
2025-08-21 12:06:05,823 - DEBUG - üìå LLM Raw Response: SELECT s.operating_hours
FROM ships s
JOIN departments d ON s.ship_id = d.ship_id
JOIN system_configuration sc ON d.department_id = sc.department_id
JOIN sensor_metadata sm ON sc.component_id = sm.component_id
WHERE UPPER(s.ship_name) = UPPER('INS ONE') AND UPPER(sm.nomenclature) = UPPER('GT1');
2025-08-21 12:06:05,823 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'd', 'sm', 's'}
2025-08-21 12:06:05,824 - DEBUG - üîç Table aliases in WHERE: {'sm', 's'}
2025-08-21 12:06:05,824 - INFO - ‚úÖ Query passed advanced validation
2025-08-21 12:06:05,824 - INFO - üìå Generated Valid SQL Query: SELECT s.operating_hours FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE') AND UPPER(sm.nomenclature) = UPPER('GT1');
2025-08-21 12:06:05,824 - DEBUG - üîç Table aliases in FROM/JOIN: {'sc', 'd', 'sm', 's'}
2025-08-21 12:06:05,824 - DEBUG - üîç Table aliases in WHERE: {'sm', 's'}
2025-08-21 12:06:05,824 - INFO - ‚úÖ Query passed advanced validation
2025-08-21 12:06:05,824 - INFO - ‚úÖ Query is safe and authorized!
2025-08-21 12:06:05,824 - INFO - üìå Executing SQL query: SELECT s.operating_hours FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE') AND UPPER(sm.nomenclature) = UPPER('GT1');
2025-08-21 12:06:05,886 - ERROR - ‚ùå SQL Execution Error: (pyodbc.ProgrammingError) ('42S22', "[42S22] [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Invalid column name 'nomenclature'. (207) (SQLExecDirectW)")
[SQL: SELECT s.operating_hours FROM ships s JOIN departments d ON s.ship_id = d.ship_id JOIN system_configuration sc ON d.department_id = sc.department_id JOIN sensor_metadata sm ON sc.component_id = sm.component_id WHERE UPPER(s.ship_name) = UPPER('INS ONE') AND UPPER(sm.nomenclature) = UPPER('GT1');]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-09 12:39:42,971 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-09 12:39:43,287 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-09 12:39:43,287 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-09 12:39:43,287 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-09 12:39:43,795 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-09 12:39:44,140 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-09 12:39:44,177 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-09 12:39:44,177 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-09 12:39:44,191 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-09 12:39:44,192 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-09 12:39:44,206 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-09 12:39:44,206 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-09 12:39:44,207 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-09 12:39:44,293 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-09 12:39:44,293 - INFO - ‚úÖ Database connection established
2025-09-09 12:39:45,080 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-09 12:39:45,225 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-09 12:39:45,228 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-09 12:39:45,231 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-09 12:39:45,234 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-09 12:39:45,237 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-09 12:39:45,239 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-09 12:39:45,242 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-09 12:39:45,245 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-09 12:39:45,249 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-09 12:39:45,252 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-09 12:39:45,255 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-09 12:39:45,257 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-09 12:39:45,261 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-09 12:39:45,578 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-09 12:39:45,582 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:39:45,583 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-09 12:39:45,587 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-09 12:39:45,587 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-09 12:39:45,591 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:39:45,591 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-09 12:39:45,596 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:39:45,596 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-09 12:39:45,600 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:39:45,600 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-09 12:39:45,635 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-09 12:39:45,636 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-09 12:39:45,640 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-09 12:39:45,640 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-09 12:39:45,640 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-09 12:39:45,644 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-09 12:39:45,644 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-09 12:39:45,645 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-09 12:39:45,649 - DEBUG - üîó Foreign keys for ships: []
2025-09-09 12:39:45,653 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-09 12:39:45,653 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-09 12:39:45,654 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-09 12:39:45,654 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-09 12:39:45,654 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-09 12:39:45,658 - DEBUG - üîó Foreign keys for systems: []
2025-09-09 12:39:45,662 - DEBUG - üîó Foreign keys for users: []
2025-09-09 12:39:45,662 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-09 12:39:45,662 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-09 12:39:45,662 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-09 12:39:45,662 - DEBUG - üîç Relationship Details:
2025-09-09 12:39:45,662 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-09 12:39:45,662 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-09 12:39:45,662 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-09 12:39:45,662 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-09 12:39:45,662 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-09 12:39:45,663 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-09 12:39:45,663 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-09 12:39:45,663 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-09 12:39:45,663 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-09 12:39:45,663 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-09 12:39:45,663 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-09 12:39:45,663 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-09 12:39:45,663 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-09 12:39:45,663 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-09 12:39:45,663 - INFO - üìå Maritime system initialization complete.
2025-09-09 12:39:45,663 - INFO - ‚úÖ All global variables verified successfully
2025-09-09 12:39:45,675 - INFO - üìå Loaded conversation memory from disk.
2025-09-09 12:39:45,675 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-09 12:39:45,675 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-09 12:39:46,480 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-09 12:39:46,480 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-09 12:39:46,497 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-09 12:39:46,497 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-09 12:39:46,497 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-09 12:39:46,497 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-09 12:39:46,498 - INFO - ‚úÖ Database connection established
2025-09-09 12:39:46,511 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-09 12:39:46,515 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-09 12:39:46,519 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-09 12:39:46,523 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-09 12:39:46,526 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-09 12:39:46,529 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-09 12:39:46,532 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-09 12:39:46,536 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-09 12:39:46,539 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-09 12:39:46,542 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-09 12:39:46,545 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-09 12:39:46,548 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-09 12:39:46,551 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-09 12:39:46,553 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-09 12:39:46,559 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-09 12:39:46,563 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:39:46,563 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-09 12:39:46,568 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-09 12:39:46,568 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-09 12:39:46,572 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:39:46,572 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-09 12:39:46,576 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:39:46,576 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-09 12:39:46,580 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:39:46,580 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-09 12:39:46,584 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-09 12:39:46,585 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-09 12:39:46,589 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-09 12:39:46,589 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-09 12:39:46,589 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-09 12:39:46,593 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-09 12:39:46,593 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-09 12:39:46,593 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-09 12:39:46,597 - DEBUG - üîó Foreign keys for ships: []
2025-09-09 12:39:46,602 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-09 12:39:46,602 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-09 12:39:46,602 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-09 12:39:46,602 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-09 12:39:46,602 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-09 12:39:46,606 - DEBUG - üîó Foreign keys for systems: []
2025-09-09 12:39:46,610 - DEBUG - üîó Foreign keys for users: []
2025-09-09 12:39:46,610 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-09 12:39:46,610 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-09 12:39:46,610 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-09 12:39:46,610 - DEBUG - üîç Relationship Details:
2025-09-09 12:39:46,611 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-09 12:39:46,611 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-09 12:39:46,611 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-09 12:39:46,611 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-09 12:39:46,611 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-09 12:39:46,611 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-09 12:39:46,611 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-09 12:39:46,611 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-09 12:39:46,611 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-09 12:39:46,611 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-09 12:39:46,611 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-09 12:39:46,611 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-09 12:39:46,611 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-09 12:39:46,611 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-09 12:39:46,611 - INFO - üìå Maritime system initialization complete.
2025-09-09 12:39:46,611 - INFO - ‚úÖ All global variables verified successfully
2025-09-09 12:41:22,374 - INFO - Database engine created with pool_size=10
2025-09-09 12:42:13,126 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-09 12:42:13,142 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-09 12:42:13,400 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-09 12:42:13,415 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-09 12:42:13,416 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-09 12:42:13,430 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-09 12:42:13,430 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-09 12:42:13,445 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-09 12:42:13,445 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-09 12:42:13,445 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-09 12:42:13,446 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-09 12:42:13,446 - INFO - ‚úÖ Database connection established
2025-09-09 12:42:13,460 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-09 12:42:13,465 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-09 12:42:13,467 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-09 12:42:13,470 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-09 12:42:13,473 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-09 12:42:13,476 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-09 12:42:13,478 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-09 12:42:13,481 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-09 12:42:13,484 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-09 12:42:13,487 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-09 12:42:13,490 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-09 12:42:13,493 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-09 12:42:13,495 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-09 12:42:13,498 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-09 12:42:13,503 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-09 12:42:13,507 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:42:13,508 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-09 12:42:13,512 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-09 12:42:13,512 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-09 12:42:13,516 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:42:13,516 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-09 12:42:13,520 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:42:13,520 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-09 12:42:13,524 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-09 12:42:13,524 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-09 12:42:13,528 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-09 12:42:13,528 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-09 12:42:13,533 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-09 12:42:13,533 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-09 12:42:13,533 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-09 12:42:13,537 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-09 12:42:13,537 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-09 12:42:13,537 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-09 12:42:13,541 - DEBUG - üîó Foreign keys for ships: []
2025-09-09 12:42:13,546 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-09 12:42:13,546 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-09 12:42:13,546 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-09 12:42:13,546 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-09 12:42:13,546 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-09 12:42:13,550 - DEBUG - üîó Foreign keys for systems: []
2025-09-09 12:42:13,554 - DEBUG - üîó Foreign keys for users: []
2025-09-09 12:42:13,554 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-09 12:42:13,554 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-09 12:42:13,554 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-09 12:42:13,554 - DEBUG - üîç Relationship Details:
2025-09-09 12:42:13,554 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-09 12:42:13,554 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-09 12:42:13,554 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-09 12:42:13,554 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-09 12:42:13,554 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-09 12:42:13,554 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-09 12:42:13,554 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-09 12:42:13,554 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-09 12:42:13,554 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-09 12:42:13,554 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-09 12:42:13,554 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-09 12:42:13,554 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-09 12:42:13,555 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-09 12:42:13,555 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-09 12:42:13,555 - INFO - üìå Maritime system initialization complete.
2025-09-09 12:42:13,555 - INFO - ‚úÖ All global variables verified successfully
2025-09-09 12:42:13,556 - INFO - üìå Loaded conversation memory from disk.
2025-09-09 12:42:13,556 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-09 12:42:13,556 - INFO - üìå User input: list all ships
2025-09-09 12:42:13,556 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='show me operating hours of GT1 on INS ONE', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-09-09 12:42:13,556 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='show me operating hours of GT1 on INS ONE', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-09-09 12:42:13,556 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-09 12:42:13,556 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list alpha beta of only gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='show me operating hours of GT1 on INS ONE', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-09-09 12:42:13,557 - DEBUG - üìå Generated Prompt Length: 10024 characters
2025-09-09 12:42:13,557 - INFO - Generating SQL query...
2025-09-09 12:42:13,557 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-09-09 12:42:13,558 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x753b42114b50>
2025-09-09 12:42:13,558 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-09-09 12:42:13,558 - DEBUG - send_request_headers.complete
2025-09-09 12:42:13,558 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-09-09 12:42:13,558 - DEBUG - send_request_body.complete
2025-09-09 12:42:13,558 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-09-09 12:43:03,880 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Tue, 09 Sep 2025 07:13:03 GMT'), (b'Content-Length', b'358')])
2025-09-09 12:43:03,880 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-09-09 12:43:03,880 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-09-09 12:43:03,881 - DEBUG - receive_response_body.complete
2025-09-09 12:43:03,881 - DEBUG - response_closed.started
2025-09-09 12:43:03,881 - DEBUG - response_closed.complete
2025-09-09 12:43:03,881 - DEBUG - Extracting SQL from response: SELECT s.ship_id, s.ship_name
FROM ships s;...
2025-09-09 12:43:03,881 - INFO - Direct SQL response detected: SELECT s.ship_id, s.ship_name
FROM ships s;
2025-09-09 12:43:03,881 - INFO - SQL query generation completed
2025-09-09 12:43:03,881 - DEBUG - Generated SQL query: SELECT s.ship_id, s.ship_name
FROM ships s;
2025-09-09 12:43:03,882 - DEBUG - üìå LLM Raw Response: SELECT s.ship_id, s.ship_name
FROM ships s;
2025-09-09 12:43:03,882 - DEBUG - üîç Table aliases in FROM/JOIN: {'s'}
2025-09-09 12:43:03,883 - INFO - ‚úÖ Query passed advanced validation
2025-09-09 12:43:03,883 - INFO - üìå Generated Valid SQL Query: SELECT s.ship_id, s.ship_name FROM ships s;
2025-09-09 12:43:03,883 - DEBUG - üîç Table aliases in FROM/JOIN: {'s'}
2025-09-09 12:43:03,883 - INFO - ‚úÖ Query passed advanced validation
2025-09-09 12:43:03,883 - INFO - ‚úÖ Query is safe and authorized!
2025-09-09 12:43:03,883 - INFO - üìå Executing SQL query: SELECT s.ship_id, s.ship_name FROM ships s;
2025-09-09 12:43:03,950 - INFO - üìå Query executed successfully in 0.066 seconds. Retrieved 3 records.
2025-09-09 12:44:19,121 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-09-09 12:44:19,132 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-09-09 12:44:19,134 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-09-09 12:44:19,136 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-09-09 12:44:19,138 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-09-09 12:44:19,141 - INFO - Retrieved 4 systems for ship ID: 33f13701-849f-4030-8d71-a0f65eac992e
2025-09-09 12:44:19,147 - INFO - Retrieved hierarchical component structure for system 64044bde-5b46-4ab3-b44d-2d140833284b: 4 total components, 4 root components
2025-09-09 12:44:19,149 - INFO - Retrieved hierarchical component structure for system 017bdf6b-d9f2-4f31-869d-842ad61a9627: 4 total components, 4 root components
2025-09-09 12:44:19,151 - INFO - Retrieved hierarchical component structure for system 6b3a59eb-4cc2-4480-b512-9357aed35540: 6 total components, 6 root components
2025-09-09 12:44:19,152 - INFO - Retrieved hierarchical component structure for system a2b3e95b-c3b8-43ce-af79-eb445794f7ab: 2 total components, 2 root components
2025-09-12 12:46:38,342 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-12 12:46:38,703 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-12 12:46:38,703 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-12 12:46:38,703 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-12 12:46:40,101 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-12 12:46:43,001 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 12:46:43,092 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-12 12:46:43,092 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 12:46:43,107 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-12 12:46:43,107 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 12:46:43,123 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-12 12:46:43,123 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-12 12:46:43,123 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-12 12:46:43,763 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-12 12:46:43,763 - INFO - ‚úÖ Database connection established
2025-09-12 12:47:01,161 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 12:47:01,632 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-12 12:47:01,636 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-12 12:47:01,639 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-12 12:47:01,680 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-12 12:47:01,683 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-12 12:47:01,686 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-12 12:47:01,998 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-12 12:47:02,002 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-12 12:47:02,005 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-12 12:47:02,008 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-12 12:47:02,054 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-12 12:47:02,057 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-12 12:47:02,177 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-12 12:47:05,181 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-12 12:47:05,185 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 12:47:05,185 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-12 12:47:05,190 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-12 12:47:05,190 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-12 12:47:05,194 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 12:47:05,194 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-12 12:47:05,199 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 12:47:05,199 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-12 12:47:05,204 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 12:47:05,204 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-12 12:47:05,208 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-12 12:47:05,208 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-12 12:47:05,213 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-12 12:47:05,213 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-12 12:47:05,213 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-12 12:47:05,218 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-12 12:47:05,218 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-12 12:47:05,218 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-12 12:47:05,222 - DEBUG - üîó Foreign keys for ships: []
2025-09-12 12:47:05,227 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-12 12:47:05,227 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-12 12:47:05,227 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-12 12:47:05,227 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-12 12:47:05,227 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-12 12:47:05,232 - DEBUG - üîó Foreign keys for systems: []
2025-09-12 12:47:05,432 - DEBUG - üîó Foreign keys for users: []
2025-09-12 12:47:05,432 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-12 12:47:05,432 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 12:47:05,432 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-12 12:47:05,432 - DEBUG - üîç Relationship Details:
2025-09-12 12:47:05,432 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-12 12:47:05,432 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-12 12:47:05,432 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-12 12:47:05,432 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-12 12:47:05,432 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-12 12:47:05,433 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-12 12:47:05,433 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-12 12:47:05,433 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-12 12:47:05,433 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-12 12:47:05,433 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-12 12:47:05,433 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-12 12:47:05,433 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-12 12:47:05,433 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-12 12:47:05,433 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-12 12:47:05,433 - INFO - üìå Maritime system initialization complete.
2025-09-12 12:47:05,433 - INFO - ‚úÖ All global variables verified successfully
2025-09-12 12:47:05,531 - INFO - üìå Loaded conversation memory from disk.
2025-09-12 12:47:05,531 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-12 12:47:05,532 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-12 12:47:08,713 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-12 12:47:08,713 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 12:47:08,730 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-12 12:47:08,730 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-12 12:47:08,730 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-12 12:47:08,731 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-12 12:47:08,731 - INFO - ‚úÖ Database connection established
2025-09-12 12:47:08,937 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 12:47:08,942 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-12 12:47:08,945 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-12 12:47:08,948 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-12 12:47:08,950 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-12 12:47:08,953 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-12 12:47:08,987 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-12 12:47:08,990 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-12 12:47:08,993 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-12 12:47:08,996 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-12 12:47:08,999 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-12 12:47:09,002 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-12 12:47:09,004 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-12 12:47:09,112 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-12 12:47:09,262 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-12 12:47:09,266 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 12:47:09,266 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-12 12:47:09,270 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-12 12:47:09,270 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-12 12:47:09,274 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 12:47:09,274 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-12 12:47:09,279 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 12:47:09,279 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-12 12:47:09,284 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 12:47:09,284 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-12 12:47:09,288 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-12 12:47:09,288 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-12 12:47:09,293 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-12 12:47:09,293 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-12 12:47:09,293 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-12 12:47:09,297 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-12 12:47:09,297 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-12 12:47:09,297 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-12 12:47:09,302 - DEBUG - üîó Foreign keys for ships: []
2025-09-12 12:47:09,306 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-12 12:47:09,306 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-12 12:47:09,306 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-12 12:47:09,306 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-12 12:47:09,306 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-12 12:47:09,311 - DEBUG - üîó Foreign keys for systems: []
2025-09-12 12:47:09,315 - DEBUG - üîó Foreign keys for users: []
2025-09-12 12:47:09,316 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-12 12:47:09,316 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 12:47:09,316 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-12 12:47:09,316 - DEBUG - üîç Relationship Details:
2025-09-12 12:47:09,316 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-12 12:47:09,316 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-12 12:47:09,316 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-12 12:47:09,316 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-12 12:47:09,316 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-12 12:47:09,316 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-12 12:47:09,317 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-12 12:47:09,317 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-12 12:47:09,317 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-12 12:47:09,317 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-12 12:47:09,317 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-12 12:47:09,317 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-12 12:47:09,317 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-12 12:47:09,317 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-12 12:47:09,317 - INFO - üìå Maritime system initialization complete.
2025-09-12 12:47:09,317 - INFO - ‚úÖ All global variables verified successfully
2025-09-12 12:48:36,756 - INFO - Database engine created with pool_size=10
2025-09-12 13:09:10,103 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-12 13:09:10,236 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-12 13:09:10,236 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-12 13:09:10,236 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-12 13:09:10,411 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-12 13:09:10,505 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 13:09:10,521 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-12 13:09:10,521 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 13:09:10,536 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-12 13:09:10,537 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 13:09:10,552 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-12 13:09:10,552 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-12 13:09:10,552 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-12 13:09:10,562 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-12 13:09:10,562 - INFO - ‚úÖ Database connection established
2025-09-12 13:09:10,583 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 13:09:10,588 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-12 13:09:10,591 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-12 13:09:10,594 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-12 13:09:10,597 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-12 13:09:10,599 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-12 13:09:10,602 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-12 13:09:10,604 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-12 13:09:10,607 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-12 13:09:10,610 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-12 13:09:10,613 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-12 13:09:10,615 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-12 13:09:10,618 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-12 13:09:10,621 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-12 13:09:10,626 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-12 13:09:10,681 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:09:10,681 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-12 13:09:10,685 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-12 13:09:10,685 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-12 13:09:10,689 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:09:10,690 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-12 13:09:10,694 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:09:10,694 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-12 13:09:10,698 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:09:10,698 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-12 13:09:10,702 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-12 13:09:10,702 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-12 13:09:10,706 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-12 13:09:10,706 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-12 13:09:10,706 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-12 13:09:10,710 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-12 13:09:10,710 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-12 13:09:10,710 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-12 13:09:10,714 - DEBUG - üîó Foreign keys for ships: []
2025-09-12 13:09:10,718 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-12 13:09:10,718 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-12 13:09:10,718 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-12 13:09:10,718 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-12 13:09:10,718 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-12 13:09:10,722 - DEBUG - üîó Foreign keys for systems: []
2025-09-12 13:09:10,727 - DEBUG - üîó Foreign keys for users: []
2025-09-12 13:09:10,727 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-12 13:09:10,727 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 13:09:10,727 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-12 13:09:10,727 - DEBUG - üîç Relationship Details:
2025-09-12 13:09:10,727 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-12 13:09:10,727 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-12 13:09:10,727 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-12 13:09:10,727 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-12 13:09:10,727 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-12 13:09:10,727 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-12 13:09:10,727 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-12 13:09:10,727 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-12 13:09:10,727 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-12 13:09:10,727 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-12 13:09:10,727 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-12 13:09:10,727 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-12 13:09:10,727 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-12 13:09:10,727 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-12 13:09:10,728 - INFO - üìå Maritime system initialization complete.
2025-09-12 13:09:10,728 - INFO - ‚úÖ All global variables verified successfully
2025-09-12 13:09:10,729 - INFO - üìå Loaded conversation memory from disk.
2025-09-12 13:09:10,729 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-12 13:09:10,729 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-12 13:09:10,926 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-12 13:09:10,926 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 13:09:10,942 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-12 13:09:10,943 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-12 13:09:10,943 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-12 13:09:10,943 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-12 13:09:10,943 - INFO - ‚úÖ Database connection established
2025-09-12 13:09:10,956 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 13:09:10,960 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-12 13:09:10,963 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-12 13:09:10,965 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-12 13:09:10,968 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-12 13:09:10,971 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-12 13:09:10,973 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-12 13:09:10,976 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-12 13:09:10,979 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-12 13:09:10,982 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-12 13:09:10,984 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-12 13:09:10,987 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-12 13:09:10,990 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-12 13:09:11,105 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-12 13:09:11,111 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-12 13:09:11,115 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:09:11,116 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-12 13:09:11,120 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-12 13:09:11,120 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-12 13:09:11,124 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:09:11,124 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-12 13:09:11,129 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:09:11,129 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-12 13:09:11,134 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:09:11,134 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-12 13:09:11,138 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-12 13:09:11,138 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-12 13:09:11,142 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-12 13:09:11,142 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-12 13:09:11,142 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-12 13:09:11,147 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-12 13:09:11,147 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-12 13:09:11,147 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-12 13:09:11,151 - DEBUG - üîó Foreign keys for ships: []
2025-09-12 13:09:11,156 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-12 13:09:11,156 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-12 13:09:11,156 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-12 13:09:11,156 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-12 13:09:11,156 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-12 13:09:11,161 - DEBUG - üîó Foreign keys for systems: []
2025-09-12 13:09:11,165 - DEBUG - üîó Foreign keys for users: []
2025-09-12 13:09:11,165 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-12 13:09:11,165 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 13:09:11,165 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-12 13:09:11,165 - DEBUG - üîç Relationship Details:
2025-09-12 13:09:11,165 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-12 13:09:11,165 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-12 13:09:11,165 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-12 13:09:11,165 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-12 13:09:11,165 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-12 13:09:11,165 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-12 13:09:11,165 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-12 13:09:11,165 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-12 13:09:11,165 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-12 13:09:11,165 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-12 13:09:11,166 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-12 13:09:11,166 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-12 13:09:11,166 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-12 13:09:11,166 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-12 13:09:11,166 - INFO - üìå Maritime system initialization complete.
2025-09-12 13:09:11,166 - INFO - ‚úÖ All global variables verified successfully
2025-09-12 13:09:19,263 - INFO - Database engine created with pool_size=10
2025-09-12 13:13:40,423 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 13:13:40,438 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-12 13:13:41,236 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 13:13:41,252 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-12 13:13:41,252 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 13:13:41,267 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-12 13:13:41,267 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-12 13:13:41,282 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-12 13:13:41,282 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-12 13:13:41,282 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-12 13:13:41,282 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-12 13:13:41,283 - INFO - ‚úÖ Database connection established
2025-09-12 13:13:41,307 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 13:13:41,315 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-12 13:13:41,318 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-12 13:13:41,338 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-12 13:13:41,341 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-12 13:13:41,344 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-12 13:13:41,347 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-12 13:13:41,350 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-12 13:13:41,354 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-12 13:13:41,357 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-12 13:13:41,360 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-12 13:13:41,363 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-12 13:13:41,366 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-12 13:13:41,369 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-12 13:13:41,375 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-12 13:13:41,379 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:13:41,379 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-12 13:13:41,383 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-12 13:13:41,383 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-12 13:13:41,387 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:13:41,388 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-12 13:13:41,392 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:13:41,392 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-12 13:13:41,396 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-12 13:13:41,396 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-12 13:13:41,423 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-12 13:13:41,424 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-12 13:13:41,428 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-12 13:13:41,428 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-12 13:13:41,428 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-12 13:13:41,432 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-12 13:13:41,432 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-12 13:13:41,432 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-12 13:13:41,437 - DEBUG - üîó Foreign keys for ships: []
2025-09-12 13:13:41,441 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-12 13:13:41,441 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-12 13:13:41,441 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-12 13:13:41,441 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-12 13:13:41,441 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-12 13:13:41,446 - DEBUG - üîó Foreign keys for systems: []
2025-09-12 13:13:41,450 - DEBUG - üîó Foreign keys for users: []
2025-09-12 13:13:41,450 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-12 13:13:41,450 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 13:13:41,450 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-12 13:13:41,450 - DEBUG - üîç Relationship Details:
2025-09-12 13:13:41,450 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-12 13:13:41,450 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-12 13:13:41,450 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-12 13:13:41,451 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-12 13:13:41,451 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-12 13:13:41,451 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-12 13:13:41,451 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-12 13:13:41,451 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-12 13:13:41,451 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-12 13:13:41,451 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-12 13:13:41,451 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-12 13:13:41,451 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-12 13:13:41,451 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-12 13:13:41,451 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-12 13:13:41,451 - INFO - üìå Maritime system initialization complete.
2025-09-12 13:13:41,451 - INFO - ‚úÖ All global variables verified successfully
2025-09-12 13:13:41,454 - INFO - üìå Loaded conversation memory from disk.
2025-09-12 13:13:41,454 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-12 13:13:41,454 - INFO - üìå User input: list all ships
2025-09-12 13:13:41,454 - DEBUG - üìå Full input with context: Previous conversation:
[HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='show me operating hours of GT1 on INS ONE', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-09-12 13:13:41,454 - INFO - üìå Processing query: Previous conversation:
[HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='show me operating hours of GT1 on INS ONE', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-09-12 13:13:41,455 - DEBUG - ‚úÖ Schema available for role Admin/ INSMA: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-12 13:13:41,455 - INFO - üìå Generating SQL for: Previous conversation:
[HumanMessage(content='list alpha beta of all gas turbines on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list alpha beta on ship ins one', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='show me operating hours of GT1 on INS ONE', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={}), HumanMessage(content='list all ships', additional_kwargs={}, response_metadata={}), AIMessage(content='', additional_kwargs={}, response_metadata={})]

User: list all ships
2025-09-12 13:13:41,455 - DEBUG - üìå Generated Prompt Length: 9986 characters
2025-09-12 13:13:41,455 - INFO - Generating SQL query...
2025-09-12 13:13:41,465 - DEBUG - connect_tcp.started host='127.0.0.1' port=11434 local_address=None timeout=None socket_options=None
2025-09-12 13:13:41,465 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x7620b93c54d0>
2025-09-12 13:13:41,465 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-09-12 13:13:41,465 - DEBUG - send_request_headers.complete
2025-09-12 13:13:41,466 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-09-12 13:13:41,466 - DEBUG - send_request_body.complete
2025-09-12 13:13:41,466 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-09-12 13:14:48,830 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Fri, 12 Sep 2025 07:44:48 GMT'), (b'Content-Length', b'359')])
2025-09-12 13:14:48,831 - INFO - HTTP Request: POST http://127.0.0.1:11434/api/chat "HTTP/1.1 200 OK"
2025-09-12 13:14:48,831 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-09-12 13:14:48,831 - DEBUG - receive_response_body.complete
2025-09-12 13:14:48,831 - DEBUG - response_closed.started
2025-09-12 13:14:48,831 - DEBUG - response_closed.complete
2025-09-12 13:14:48,831 - DEBUG - Extracting SQL from response: SELECT s.ship_id, s.ship_name
FROM ships s;...
2025-09-12 13:14:48,832 - INFO - Direct SQL response detected: SELECT s.ship_id, s.ship_name
FROM ships s;
2025-09-12 13:14:48,832 - INFO - SQL query generation completed
2025-09-12 13:14:48,832 - DEBUG - Generated SQL query: SELECT s.ship_id, s.ship_name
FROM ships s;
2025-09-12 13:14:48,832 - DEBUG - üìå LLM Raw Response: SELECT s.ship_id, s.ship_name
FROM ships s;
2025-09-12 13:14:48,832 - DEBUG - üîç Table aliases in FROM/JOIN: {'s'}
2025-09-12 13:14:48,833 - INFO - ‚úÖ Query passed advanced validation
2025-09-12 13:14:48,833 - INFO - üìå Generated Valid SQL Query: SELECT s.ship_id, s.ship_name FROM ships s;
2025-09-12 13:14:48,833 - DEBUG - üîç Table aliases in FROM/JOIN: {'s'}
2025-09-12 13:14:48,833 - INFO - ‚úÖ Query passed advanced validation
2025-09-12 13:14:48,833 - INFO - ‚úÖ Query is safe and authorized!
2025-09-12 13:14:48,833 - INFO - üìå Executing SQL query: SELECT s.ship_id, s.ship_name FROM ships s;
2025-09-12 13:14:48,974 - INFO - üìå Query executed successfully in 0.14 seconds. Retrieved 3 records.
2025-09-20 16:32:48,513 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:32:49,252 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:32:49,252 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:32:49,253 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:32:49,934 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:32:50,339 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:32:50,359 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:32:50,359 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:32:50,375 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:32:50,375 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:32:50,390 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:32:50,390 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:32:50,390 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:32:50,488 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:32:50,488 - INFO - ‚úÖ Database connection established
2025-09-20 16:32:51,116 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:32:51,163 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:32:51,166 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:32:51,169 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:32:51,172 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:32:51,174 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:32:51,177 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:32:51,189 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:32:51,193 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:32:51,195 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:32:51,198 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:32:51,201 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:32:51,203 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:32:51,207 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:32:51,566 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:32:51,571 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:32:51,571 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:32:51,575 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:32:51,575 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:32:51,580 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:32:51,580 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:32:51,585 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:32:51,585 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:32:51,589 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:32:51,589 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:32:51,594 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:32:51,594 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:32:51,598 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:32:51,598 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:32:51,598 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:32:51,603 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:32:51,603 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:32:51,603 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:32:51,608 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:32:51,613 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:32:51,613 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:32:51,613 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:32:51,613 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:32:51,613 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:32:51,618 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:32:51,622 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:32:51,623 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:32:51,623 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:32:51,623 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:32:51,623 - DEBUG - üîç Relationship Details:
2025-09-20 16:32:51,623 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:32:51,623 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:32:51,623 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:32:51,623 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:32:51,623 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:32:51,624 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:32:51,624 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:32:51,624 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:32:51,624 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:32:51,624 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:32:51,624 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:32:51,624 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:32:51,624 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:32:51,624 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:32:51,624 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:32:51,624 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:32:51,637 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:32:51,637 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:32:51,637 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:35:57,760 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:35:57,895 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:35:57,895 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:35:57,896 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:35:58,024 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:35:58,193 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:35:58,210 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:35:58,211 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:35:58,226 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:35:58,226 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:35:58,241 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:35:58,241 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:35:58,241 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:35:58,250 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:35:58,250 - INFO - ‚úÖ Database connection established
2025-09-20 16:35:58,281 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:35:58,287 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:35:58,290 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:35:58,293 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:35:58,296 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:35:58,299 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:35:58,301 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:35:58,304 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:35:58,307 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:35:58,310 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:35:58,312 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:35:58,316 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:35:58,319 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:35:58,322 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:35:58,329 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:35:58,333 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:35:58,334 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:35:58,339 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:35:58,339 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:35:58,343 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:35:58,344 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:35:58,348 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:35:58,348 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:35:58,353 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:35:58,353 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:35:58,357 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:35:58,357 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:35:58,361 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:35:58,361 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:35:58,361 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:35:58,365 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:35:58,365 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:35:58,365 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:35:58,370 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:35:58,374 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:35:58,374 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:35:58,374 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:35:58,374 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:35:58,374 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:35:58,378 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:35:58,382 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:35:58,382 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:35:58,382 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:35:58,382 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:35:58,382 - DEBUG - üîç Relationship Details:
2025-09-20 16:35:58,382 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:35:58,383 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:35:58,383 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:35:58,383 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:35:58,383 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:35:58,383 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:35:58,383 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:35:58,383 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:35:58,383 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:35:58,383 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:35:58,383 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:35:58,383 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:35:58,383 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:35:58,383 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:35:58,383 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:35:58,383 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:35:58,385 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:35:58,385 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:35:58,385 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:36:26,387 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:36:26,524 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:36:26,524 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:36:26,524 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:36:26,654 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:36:26,816 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:36:26,831 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:36:26,831 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:36:26,846 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:36:26,846 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:36:26,862 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:36:26,862 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:36:26,862 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:36:26,871 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:36:26,871 - INFO - ‚úÖ Database connection established
2025-09-20 16:36:26,920 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:36:26,925 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:36:26,928 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:36:26,930 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:36:26,933 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:36:26,936 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:36:26,938 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:36:26,941 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:36:26,944 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:36:26,946 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:36:26,949 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:36:26,952 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:36:26,955 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:36:26,958 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:36:26,963 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:36:26,967 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:26,967 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:36:26,971 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:36:26,971 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:36:26,975 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:26,976 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:36:26,979 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:26,980 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:36:26,983 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:26,984 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:36:26,987 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:36:26,987 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:36:26,992 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:36:26,992 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:36:26,992 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:36:26,996 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:36:26,996 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:36:26,996 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:36:27,000 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:36:27,005 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:36:27,005 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:36:27,005 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:36:27,005 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:36:27,005 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:36:27,009 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:36:27,013 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:36:27,013 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:36:27,013 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:36:27,013 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:36:27,013 - DEBUG - üîç Relationship Details:
2025-09-20 16:36:27,014 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:36:27,014 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:36:27,014 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:36:27,014 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:36:27,014 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:36:27,014 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:36:27,014 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:36:27,014 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:36:27,014 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:36:27,014 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:36:27,014 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:36:27,014 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:36:27,014 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:36:27,014 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:36:27,014 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:36:27,014 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:36:27,016 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:36:27,016 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:36:27,016 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:36:48,289 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:36:48,426 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:36:48,426 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:36:48,426 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:36:48,553 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:36:48,713 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:36:48,729 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:36:48,729 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:36:48,744 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:36:48,744 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:36:48,759 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:36:48,759 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:36:48,759 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:36:48,768 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:36:48,768 - INFO - ‚úÖ Database connection established
2025-09-20 16:36:48,791 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:36:48,796 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:36:48,799 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:36:48,802 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:36:48,804 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:36:48,807 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:36:48,810 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:36:48,812 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:36:48,815 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:36:48,818 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:36:48,821 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:36:48,824 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:36:48,826 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:36:48,829 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:36:48,834 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:36:48,838 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:48,838 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:36:48,842 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:36:48,842 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:36:48,846 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:48,847 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:36:48,850 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:48,851 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:36:48,854 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:48,855 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:36:48,859 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:36:48,859 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:36:48,863 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:36:48,863 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:36:48,863 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:36:48,867 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:36:48,867 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:36:48,867 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:36:48,871 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:36:48,876 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:36:48,876 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:36:48,876 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:36:48,876 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:36:48,876 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:36:48,880 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:36:48,884 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:36:48,884 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:36:48,884 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:36:48,885 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:36:48,885 - DEBUG - üîç Relationship Details:
2025-09-20 16:36:48,885 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:36:48,885 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:36:48,885 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:36:48,885 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:36:48,885 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:36:48,885 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:36:48,885 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:36:48,885 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:36:48,885 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:36:48,885 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:36:48,885 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:36:48,886 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:36:48,886 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:36:48,886 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:36:48,886 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:36:48,886 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:36:48,889 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:36:48,889 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:36:48,889 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:36:48,971 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:36:48,971 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:36:48,986 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:36:48,986 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:36:48,987 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:36:48,987 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:36:48,987 - INFO - ‚úÖ Database connection established
2025-09-20 16:36:49,112 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:36:49,116 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:36:49,119 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:36:49,122 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:36:49,125 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:36:49,128 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:36:49,131 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:36:49,134 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:36:49,137 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:36:49,140 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:36:49,143 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:36:49,146 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:36:49,149 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:36:49,152 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:36:49,157 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:36:49,162 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:49,162 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:36:49,166 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:36:49,166 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:36:49,170 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:49,170 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:36:49,175 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:49,175 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:36:49,180 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:36:49,180 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:36:49,185 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:36:49,185 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:36:49,189 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:36:49,189 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:36:49,189 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:36:49,193 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:36:49,194 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:36:49,194 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:36:49,198 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:36:49,203 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:36:49,203 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:36:49,203 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:36:49,203 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:36:49,203 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:36:49,207 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:36:49,211 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:36:49,212 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:36:49,212 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:36:49,212 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:36:49,212 - DEBUG - üîç Relationship Details:
2025-09-20 16:36:49,212 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:36:49,212 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:36:49,212 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:36:49,212 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:36:49,212 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:36:49,212 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:36:49,212 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:36:49,212 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:36:49,212 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:36:49,212 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:36:49,212 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:36:49,212 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:36:49,212 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:36:49,212 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:36:49,212 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:36:49,212 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:37:05,091 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:05,224 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:37:05,224 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:37:05,224 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:37:05,351 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:37:05,510 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:05,526 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:05,526 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:05,541 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:37:05,541 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:05,557 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:37:05,557 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:05,557 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:37:05,566 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:37:05,566 - INFO - ‚úÖ Database connection established
2025-09-20 16:37:05,587 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:05,592 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:37:05,595 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:37:05,598 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:37:05,601 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:37:05,603 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:37:05,605 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:37:05,608 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:37:05,611 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:37:05,614 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:37:05,616 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:37:05,619 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:37:05,622 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:37:05,624 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:37:05,630 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:37:05,634 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:05,634 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:05,638 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:37:05,638 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:37:05,642 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:05,642 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:05,646 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:05,646 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:37:05,650 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:05,650 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:37:05,654 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:37:05,654 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:37:05,658 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:37:05,658 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:37:05,658 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:37:05,662 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:37:05,662 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:37:05,662 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:37:05,667 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:37:05,671 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:37:05,671 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:37:05,671 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:37:05,671 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:37:05,671 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:37:05,675 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:37:05,679 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:37:05,679 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:37:05,679 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:05,679 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:37:05,679 - DEBUG - üîç Relationship Details:
2025-09-20 16:37:05,679 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:05,679 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:37:05,679 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:05,679 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:37:05,679 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:37:05,680 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:37:05,680 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:37:05,680 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:37:05,680 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:37:05,680 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:37:05,680 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:37:05,680 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:37:05,680 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:37:05,680 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:37:05,680 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:37:05,680 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:37:05,682 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:37:05,682 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:37:05,682 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:14,767 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:14,900 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:37:14,900 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:37:14,900 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:37:15,028 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:37:15,189 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:15,205 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:15,205 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:15,220 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:37:15,220 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:15,235 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:37:15,235 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:15,235 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:37:15,244 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:37:15,245 - INFO - ‚úÖ Database connection established
2025-09-20 16:37:15,264 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:15,270 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:37:15,273 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:37:15,276 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:37:15,278 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:37:15,281 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:37:15,284 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:37:15,286 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:37:15,290 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:37:15,292 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:37:15,295 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:37:15,298 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:37:15,300 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:37:15,303 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:37:15,309 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:37:15,313 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:15,313 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:15,317 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:37:15,317 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:37:15,321 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:15,321 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:15,325 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:15,325 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:37:15,329 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:15,329 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:37:15,333 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:37:15,333 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:37:15,337 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:37:15,337 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:37:15,337 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:37:15,341 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:37:15,341 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:37:15,341 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:37:15,345 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:37:15,350 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:37:15,350 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:37:15,350 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:37:15,350 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:37:15,350 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:37:15,354 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:37:15,358 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:37:15,358 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:37:15,358 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:15,358 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:37:15,358 - DEBUG - üîç Relationship Details:
2025-09-20 16:37:15,358 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:15,358 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:37:15,358 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:15,358 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:37:15,358 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:37:15,358 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:37:15,358 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:37:15,358 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:37:15,359 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:37:15,359 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:37:15,359 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:37:15,359 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:37:15,359 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:37:15,359 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:37:15,359 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:37:15,359 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:37:15,361 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:37:15,361 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:37:15,361 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:45,277 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:45,409 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:37:45,410 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:37:45,410 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:37:45,536 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:37:45,696 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:45,711 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:45,711 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:45,726 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:37:45,726 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:45,742 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:37:45,742 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:45,742 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:37:45,751 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:37:45,751 - INFO - ‚úÖ Database connection established
2025-09-20 16:37:45,800 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:45,805 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:37:45,808 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:37:45,811 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:37:45,813 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:37:45,816 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:37:45,818 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:37:45,821 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:37:45,824 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:37:45,827 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:37:45,829 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:37:45,832 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:37:45,835 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:37:45,838 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:37:45,843 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:37:45,848 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:45,848 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:45,852 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:37:45,852 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:37:45,856 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:45,856 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:45,860 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:45,860 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:37:45,864 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:45,864 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:37:45,868 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:37:45,868 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:37:45,872 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:37:45,872 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:37:45,872 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:37:45,876 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:37:45,876 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:37:45,877 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:37:45,881 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:37:45,885 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:37:45,885 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:37:45,885 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:37:45,885 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:37:45,885 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:37:45,889 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:37:45,893 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:37:45,893 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:37:45,893 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:45,894 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:37:45,894 - DEBUG - üîç Relationship Details:
2025-09-20 16:37:45,894 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:45,894 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:37:45,894 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:45,894 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:37:45,894 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:37:45,894 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:37:45,894 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:37:45,894 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:37:45,894 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:37:45,894 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:37:45,894 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:37:45,894 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:37:45,894 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:37:45,894 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:37:45,894 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:37:45,895 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:37:45,897 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:37:45,897 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:37:45,898 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:48,147 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:48,288 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:37:48,288 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:37:48,288 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:37:48,424 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:37:48,596 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:48,614 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:48,615 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:48,630 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:37:48,630 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:48,647 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:37:48,647 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:48,647 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:37:48,657 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:37:48,657 - INFO - ‚úÖ Database connection established
2025-09-20 16:37:48,677 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:48,683 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:37:48,686 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:37:48,688 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:37:48,691 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:37:48,693 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:37:48,696 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:37:48,699 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:37:48,702 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:37:48,705 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:37:48,708 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:37:48,711 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:37:48,713 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:37:48,716 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:37:48,721 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:37:48,725 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:48,725 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:48,730 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:37:48,730 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:37:48,736 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:48,736 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:48,741 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:48,741 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:37:48,747 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:48,747 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:37:48,751 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:37:48,752 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:37:48,756 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:37:48,757 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:37:48,757 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:37:48,761 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:37:48,761 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:37:48,761 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:37:48,766 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:37:48,772 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:37:48,772 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:37:48,773 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:37:48,773 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:37:48,773 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:37:48,777 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:37:48,782 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:37:48,782 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:37:48,782 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:48,782 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:37:48,782 - DEBUG - üîç Relationship Details:
2025-09-20 16:37:48,783 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:48,783 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:37:48,783 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:48,783 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:37:48,783 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:37:48,783 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:37:48,783 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:37:48,783 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:37:48,783 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:37:48,783 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:37:48,783 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:37:48,783 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:37:48,783 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:37:48,783 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:37:48,784 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:37:48,784 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:37:48,786 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:37:48,787 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:37:48,787 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:51,484 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:51,624 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:37:51,624 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:37:51,624 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:37:51,754 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:37:51,919 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:51,935 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:51,935 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:51,951 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:37:51,951 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:51,967 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:37:51,967 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:51,967 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:37:51,976 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:37:51,976 - INFO - ‚úÖ Database connection established
2025-09-20 16:37:51,998 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:52,003 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:37:52,006 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:37:52,009 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:37:52,011 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:37:52,014 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:37:52,017 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:37:52,020 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:37:52,022 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:37:52,025 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:37:52,028 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:37:52,031 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:37:52,034 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:37:52,037 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:37:52,042 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:37:52,047 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:52,047 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:52,051 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:37:52,051 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:37:52,055 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:52,055 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:52,059 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:52,059 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:37:52,063 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:52,063 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:37:52,067 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:37:52,068 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:37:52,072 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:37:52,072 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:37:52,072 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:37:52,076 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:37:52,076 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:37:52,076 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:37:52,081 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:37:52,085 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:37:52,085 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:37:52,085 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:37:52,085 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:37:52,085 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:37:52,089 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:37:52,093 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:37:52,094 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:37:52,094 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:52,094 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:37:52,094 - DEBUG - üîç Relationship Details:
2025-09-20 16:37:52,094 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:52,094 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:37:52,094 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:52,094 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:37:52,094 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:37:52,094 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:37:52,094 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:37:52,094 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:37:52,094 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:37:52,094 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:37:52,094 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:37:52,094 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:37:52,094 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:37:52,094 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:37:52,094 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:37:52,094 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:37:52,096 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:37:52,096 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:37:52,097 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:54,512 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:37:54,643 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:37:54,643 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:37:54,644 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:37:54,769 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:37:54,929 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:54,945 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:54,945 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:54,961 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:37:54,961 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:37:54,976 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:37:54,976 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:37:54,976 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:37:54,986 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:37:54,986 - INFO - ‚úÖ Database connection established
2025-09-20 16:37:55,007 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:55,013 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:37:55,015 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:37:55,018 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:37:55,021 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:37:55,023 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:37:55,026 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:37:55,029 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:37:55,032 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:37:55,035 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:37:55,038 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:37:55,041 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:37:55,044 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:37:55,047 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:37:55,052 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:37:55,056 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:55,057 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:55,061 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:37:55,061 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:37:55,065 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:55,065 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:37:55,069 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:55,069 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:37:55,073 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:37:55,073 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:37:55,078 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:37:55,078 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:37:55,082 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:37:55,082 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:37:55,082 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:37:55,086 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:37:55,086 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:37:55,086 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:37:55,091 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:37:55,095 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:37:55,095 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:37:55,095 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:37:55,095 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:37:55,095 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:37:55,099 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:37:55,103 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:37:55,103 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:37:55,103 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:37:55,103 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:37:55,103 - DEBUG - üîç Relationship Details:
2025-09-20 16:37:55,103 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:55,103 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:37:55,103 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:37:55,103 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:37:55,103 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:37:55,103 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:37:55,103 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:37:55,104 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:37:55,104 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:37:55,104 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:37:55,104 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:37:55,104 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:37:55,104 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:37:55,104 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:37:55,104 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:37:55,104 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:37:55,106 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:37:55,106 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:37:55,106 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:38:54,391 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:38:54,526 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:38:54,526 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:38:54,526 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:38:54,653 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:38:54,812 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:38:54,828 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:38:54,828 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:38:54,843 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:38:54,843 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:38:54,858 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:38:54,859 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:38:54,859 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:38:54,867 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:38:54,867 - INFO - ‚úÖ Database connection established
2025-09-20 16:38:54,888 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:38:54,893 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:38:54,897 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:38:54,899 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:38:54,902 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:38:54,905 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:38:54,907 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:38:54,910 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:38:54,913 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:38:54,916 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:38:54,918 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:38:54,921 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:38:54,924 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:38:54,927 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:38:54,932 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:38:54,937 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:38:54,937 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:38:54,941 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:38:54,941 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:38:54,945 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:38:54,945 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:38:54,949 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:38:54,949 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:38:54,953 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:38:54,953 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:38:54,958 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:38:54,958 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:38:54,962 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:38:54,962 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:38:54,962 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:38:54,966 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:38:54,966 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:38:54,966 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:38:54,970 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:38:54,974 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:38:54,974 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:38:54,975 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:38:54,975 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:38:54,975 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:38:54,979 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:38:54,983 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:38:54,983 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:38:54,983 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:38:54,983 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:38:54,983 - DEBUG - üîç Relationship Details:
2025-09-20 16:38:54,983 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:38:54,983 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:38:54,983 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:38:54,983 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:38:54,983 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:38:54,983 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:38:54,983 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:38:54,983 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:38:54,983 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:38:54,983 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:38:54,984 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:38:54,984 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:38:54,984 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:38:54,984 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:38:54,984 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:38:54,984 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:38:54,986 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:38:54,986 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:38:54,986 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:38:55,031 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:38:55,032 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:38:55,047 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:38:55,047 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:38:55,047 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:38:55,048 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:38:55,048 - INFO - ‚úÖ Database connection established
2025-09-20 16:38:55,060 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:38:55,065 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:38:55,067 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:38:55,070 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:38:55,072 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:38:55,075 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:38:55,077 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:38:55,080 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:38:55,083 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:38:55,085 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:38:55,088 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:38:55,091 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:38:55,094 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:38:55,097 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:38:55,102 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:38:55,106 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:38:55,106 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:38:55,110 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:38:55,110 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:38:55,114 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:38:55,114 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:38:55,118 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:38:55,118 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:38:55,122 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:38:55,122 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:38:55,126 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:38:55,126 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:38:55,130 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:38:55,130 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:38:55,130 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:38:55,134 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:38:55,134 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:38:55,134 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:38:55,139 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:38:55,144 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:38:55,144 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:38:55,144 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:38:55,144 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:38:55,144 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:38:55,148 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:38:55,152 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:38:55,152 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:38:55,152 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:38:55,152 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:38:55,152 - DEBUG - üîç Relationship Details:
2025-09-20 16:38:55,152 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:38:55,152 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:38:55,152 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:38:55,152 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:38:55,152 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:38:55,152 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:38:55,152 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:38:55,153 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:38:55,153 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:38:55,153 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:38:55,153 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:38:55,153 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:38:55,153 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:38:55,153 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:38:55,153 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:38:55,153 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:39:04,114 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:39:04,250 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:39:04,250 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:39:04,250 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:39:04,378 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:39:04,540 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:04,555 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:39:04,555 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:04,570 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:39:04,570 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:04,586 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:39:04,586 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:39:04,586 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:39:04,595 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:39:04,595 - INFO - ‚úÖ Database connection established
2025-09-20 16:39:04,615 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:39:04,621 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:39:04,624 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:39:04,626 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:39:04,629 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:39:04,631 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:39:04,634 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:39:04,637 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:39:04,640 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:39:04,642 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:39:04,645 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:39:04,648 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:39:04,650 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:39:04,653 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:39:04,659 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:39:04,663 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:04,663 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:39:04,667 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:39:04,667 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:39:04,671 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:04,671 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:39:04,676 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:04,676 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:39:04,680 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:04,680 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:39:04,684 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:39:04,684 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:39:04,688 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:39:04,688 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:39:04,688 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:39:04,692 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:39:04,693 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:39:04,693 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:39:04,697 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:39:04,702 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:39:04,703 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:39:04,703 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:39:04,703 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:39:04,703 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:39:04,707 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:39:04,711 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:39:04,711 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:39:04,712 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:39:04,712 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:39:04,712 - DEBUG - üîç Relationship Details:
2025-09-20 16:39:04,712 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:39:04,712 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:39:04,712 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:39:04,712 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:39:04,712 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:39:04,712 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:39:04,712 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:39:04,712 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:39:04,712 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:39:04,712 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:39:04,712 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:39:04,713 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:39:04,713 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:39:04,713 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:39:04,713 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:39:04,713 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:39:04,716 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:39:04,716 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:39:04,717 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:39:30,043 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:39:30,182 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:39:30,182 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:39:30,183 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:39:30,310 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:39:30,475 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:30,491 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:39:30,491 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:30,506 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:39:30,522 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:30,538 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:39:30,538 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:39:30,538 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:39:30,547 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:39:30,547 - INFO - ‚úÖ Database connection established
2025-09-20 16:39:30,733 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:39:30,739 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:39:30,742 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:39:30,745 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:39:30,748 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:39:30,751 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:39:30,754 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:39:30,757 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:39:30,760 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:39:30,763 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:39:30,766 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:39:30,770 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:39:30,772 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:39:30,776 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:39:30,782 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:39:30,786 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:30,786 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:39:30,791 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:39:30,791 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:39:30,795 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:30,795 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:39:30,799 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:30,799 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:39:30,803 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:30,803 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:39:30,806 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:39:30,807 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:39:30,811 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:39:30,811 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:39:30,811 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:39:30,815 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:39:30,815 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:39:30,815 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:39:30,819 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:39:30,824 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:39:30,824 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:39:30,824 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:39:30,824 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:39:30,824 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:39:30,828 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:39:30,832 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:39:30,832 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:39:30,832 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:39:30,832 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:39:30,832 - DEBUG - üîç Relationship Details:
2025-09-20 16:39:30,832 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:39:30,832 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:39:30,832 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:39:30,832 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:39:30,832 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:39:30,832 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:39:30,832 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:39:30,832 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:39:30,832 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:39:30,833 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:39:30,833 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:39:30,833 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:39:30,833 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:39:30,833 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:39:30,833 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:39:30,833 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:39:30,835 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:39:30,835 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:39:30,835 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:39:34,582 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:39:34,718 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:39:34,718 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:39:34,718 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:39:34,849 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:39:35,012 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:35,027 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:39:35,028 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:35,043 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:39:35,043 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:35,058 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:39:35,059 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:39:35,059 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:39:35,068 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:39:35,068 - INFO - ‚úÖ Database connection established
2025-09-20 16:39:35,088 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:39:35,093 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:39:35,096 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:39:35,099 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:39:35,101 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:39:35,104 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:39:35,106 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:39:35,109 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:39:35,112 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:39:35,114 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:39:35,117 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:39:35,120 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:39:35,122 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:39:35,125 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:39:35,131 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:39:35,135 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:35,135 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:39:35,139 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:39:35,139 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:39:35,143 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:35,143 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:39:35,146 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:35,147 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:39:35,150 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:35,150 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:39:35,154 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:39:35,154 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:39:35,158 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:39:35,158 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:39:35,158 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:39:35,162 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:39:35,162 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:39:35,163 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:39:35,167 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:39:35,171 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:39:35,171 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:39:35,171 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:39:35,171 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:39:35,171 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:39:35,175 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:39:35,179 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:39:35,179 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:39:35,179 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:39:35,179 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:39:35,179 - DEBUG - üîç Relationship Details:
2025-09-20 16:39:35,179 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:39:35,179 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:39:35,179 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:39:35,179 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:39:35,179 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:39:35,179 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:39:35,179 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:39:35,179 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:39:35,179 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:39:35,179 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:39:35,179 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:39:35,180 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:39:35,180 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:39:35,180 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:39:35,180 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:39:35,180 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:39:35,181 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:39:35,182 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:39:35,182 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:39:43,393 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:39:43,528 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:39:43,528 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:39:43,528 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:39:43,656 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:39:43,816 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:43,831 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:39:43,831 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:43,846 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:39:43,846 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:43,862 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:39:43,862 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:39:43,862 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:39:43,871 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:39:43,871 - INFO - ‚úÖ Database connection established
2025-09-20 16:39:43,919 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:39:43,925 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:39:43,928 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:39:43,930 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:39:43,933 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:39:43,936 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:39:43,938 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:39:43,941 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:39:43,944 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:39:43,946 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:39:43,949 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:39:43,952 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:39:43,955 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:39:43,958 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:39:43,964 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:39:43,969 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:43,969 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:39:43,973 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:39:43,973 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:39:43,977 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:43,977 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:39:43,982 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:43,982 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:39:43,986 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:43,986 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:39:43,990 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:39:43,990 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:39:43,994 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:39:43,994 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:39:43,995 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:39:43,999 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:39:43,999 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:39:43,999 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:39:44,003 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:39:44,007 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:39:44,007 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:39:44,007 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:39:44,007 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:39:44,007 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:39:44,011 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:39:44,015 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:39:44,015 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:39:44,015 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:39:44,015 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:39:44,016 - DEBUG - üîç Relationship Details:
2025-09-20 16:39:44,016 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,016 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:39:44,016 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,016 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,016 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,016 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:39:44,016 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,016 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:39:44,016 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,016 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:39:44,016 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:39:44,016 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:39:44,016 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:39:44,016 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:39:44,016 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:39:44,017 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:39:44,019 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:39:44,019 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:39:44,019 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:39:44,066 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:39:44,066 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:39:44,081 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:39:44,082 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:39:44,082 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:39:44,082 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:39:44,082 - INFO - ‚úÖ Database connection established
2025-09-20 16:39:44,107 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:39:44,112 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:39:44,114 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:39:44,117 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:39:44,120 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:39:44,124 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:39:44,126 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:39:44,129 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:39:44,132 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:39:44,134 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:39:44,137 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:39:44,140 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:39:44,142 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:39:44,145 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:39:44,150 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:39:44,154 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:44,154 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:39:44,158 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:39:44,158 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:39:44,162 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:44,162 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:39:44,166 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:44,166 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:39:44,170 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:39:44,170 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:39:44,174 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:39:44,174 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:39:44,178 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:39:44,179 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:39:44,179 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:39:44,183 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:39:44,183 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:39:44,183 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:39:44,188 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:39:44,192 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:39:44,192 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:39:44,192 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:39:44,192 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:39:44,192 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:39:44,196 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:39:44,200 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:39:44,200 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:39:44,200 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:39:44,200 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:39:44,201 - DEBUG - üîç Relationship Details:
2025-09-20 16:39:44,201 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,201 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:39:44,201 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,201 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,201 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,201 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:39:44,201 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,201 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:39:44,201 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:39:44,201 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:39:44,201 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:39:44,201 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:39:44,201 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:39:44,201 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:39:44,201 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:39:44,202 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:39:49,678 - INFO - Database engine created with pool_size=10
2025-09-20 16:42:53,400 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:42:53,416 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 16:43:20,512 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:43:20,528 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 16:44:02,021 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:02,037 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 16:44:17,019 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:44:17,154 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:44:17,154 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:44:17,154 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:44:17,282 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:44:17,442 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:17,458 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:44:17,458 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:17,473 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:44:17,473 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:17,489 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:44:17,489 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:44:17,489 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:44:17,497 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:44:17,498 - INFO - ‚úÖ Database connection established
2025-09-20 16:44:17,517 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:44:17,523 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:44:17,526 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:44:17,529 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:44:17,532 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:44:17,534 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:44:17,537 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:44:17,540 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:44:17,543 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:44:17,546 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:44:17,549 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:44:17,552 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:44:17,554 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:44:17,557 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:44:17,563 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:44:17,567 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:17,567 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:44:17,571 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:44:17,571 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:44:17,575 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:17,575 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:44:17,579 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:17,579 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:44:17,583 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:17,583 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:44:17,587 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:44:17,587 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:44:17,592 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:44:17,592 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:44:17,592 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:44:17,596 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:44:17,596 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:44:17,596 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:44:17,600 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:44:17,604 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:44:17,604 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:44:17,604 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:44:17,604 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:44:17,604 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:44:17,608 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:44:17,612 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:44:17,612 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:44:17,612 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:44:17,613 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:44:17,613 - DEBUG - üîç Relationship Details:
2025-09-20 16:44:17,613 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:44:17,613 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:44:17,613 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:44:17,613 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:44:17,613 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:44:17,613 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:44:17,613 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:44:17,613 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:44:17,613 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:44:17,613 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:44:17,613 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:44:17,613 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:44:17,613 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:44:17,613 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:44:17,613 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:44:17,613 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:44:17,615 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:44:17,615 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:44:17,615 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:44:20,015 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:44:20,150 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:44:20,150 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:44:20,150 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:44:20,278 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:44:20,439 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:20,454 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:44:20,454 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:20,469 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:44:20,469 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:20,484 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:44:20,484 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:44:20,485 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:44:20,493 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:44:20,494 - INFO - ‚úÖ Database connection established
2025-09-20 16:44:20,514 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:44:20,519 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:44:20,522 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:44:20,525 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:44:20,528 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:44:20,530 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:44:20,533 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:44:20,536 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:44:20,539 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:44:20,542 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:44:20,544 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:44:20,547 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:44:20,550 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:44:20,553 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:44:20,558 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:44:20,562 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:20,562 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:44:20,566 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:44:20,566 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:44:20,570 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:20,570 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:44:20,574 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:20,575 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:44:20,579 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:20,579 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:44:20,583 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:44:20,583 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:44:20,587 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:44:20,587 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:44:20,587 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:44:20,591 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:44:20,591 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:44:20,591 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:44:20,595 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:44:20,599 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:44:20,599 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:44:20,599 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:44:20,599 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:44:20,599 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:44:20,603 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:44:20,607 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:44:20,607 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:44:20,607 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:44:20,607 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:44:20,607 - DEBUG - üîç Relationship Details:
2025-09-20 16:44:20,607 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:44:20,607 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:44:20,607 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:44:20,608 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:44:20,608 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:44:20,608 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:44:20,608 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:44:20,608 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:44:20,608 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:44:20,608 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:44:20,608 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:44:20,608 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:44:20,608 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:44:20,608 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:44:20,608 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:44:20,608 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:44:20,610 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:44:20,610 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:44:20,610 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:44:35,725 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:44:35,868 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:44:35,869 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:44:35,869 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:44:36,007 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:44:36,182 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:36,198 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:44:36,198 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:36,213 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:44:36,213 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:36,229 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:44:36,229 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:44:36,229 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:44:36,238 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:44:36,238 - INFO - ‚úÖ Database connection established
2025-09-20 16:44:36,259 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:44:36,265 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:44:36,267 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:44:36,270 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:44:36,273 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:44:36,275 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:44:36,278 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:44:36,280 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:44:36,283 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:44:36,286 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:44:36,288 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:44:36,291 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:44:36,294 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:44:36,297 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:44:36,303 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:44:36,307 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:36,307 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:44:36,311 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:44:36,312 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:44:36,316 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:36,316 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:44:36,320 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:36,320 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:44:36,324 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:36,324 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:44:36,328 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:44:36,329 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:44:36,333 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:44:36,333 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:44:36,333 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:44:36,337 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:44:36,337 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:44:36,337 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:44:36,341 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:44:36,346 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:44:36,346 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:44:36,346 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:44:36,346 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:44:36,346 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:44:36,350 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:44:36,354 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:44:36,354 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:44:36,354 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:44:36,354 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:44:36,354 - DEBUG - üîç Relationship Details:
2025-09-20 16:44:36,354 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:44:36,354 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:44:36,354 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:44:36,355 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:44:36,355 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:44:36,355 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:44:36,355 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:44:36,355 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:44:36,355 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:44:36,355 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:44:36,355 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:44:36,355 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:44:36,355 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:44:36,355 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:44:36,355 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:44:36,355 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:44:36,358 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:44:36,358 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:44:36,359 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:44:39,384 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:44:39,521 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:44:39,521 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:44:39,521 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:44:39,649 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:44:39,812 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:39,828 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:44:39,828 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:39,843 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:44:39,843 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:39,859 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:44:39,859 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:44:39,859 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:44:39,868 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:44:39,868 - INFO - ‚úÖ Database connection established
2025-09-20 16:44:39,887 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:44:39,893 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:44:39,895 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:44:39,898 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:44:39,901 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:44:39,903 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:44:39,906 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:44:39,908 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:44:39,911 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:44:39,914 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:44:39,917 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:44:39,920 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:44:39,922 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:44:39,925 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:44:39,931 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:44:39,935 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:39,935 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:44:39,939 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:44:39,939 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:44:39,943 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:39,943 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:44:39,947 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:39,947 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:44:39,952 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:39,952 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:44:39,956 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:44:39,956 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:44:39,960 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:44:39,961 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:44:39,961 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:44:39,965 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:44:39,965 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:44:39,965 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:44:39,969 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:44:39,973 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:44:39,973 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:44:39,973 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:44:39,973 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:44:39,974 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:44:39,978 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:44:39,982 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:44:39,982 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:44:39,982 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:44:39,982 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:44:39,982 - DEBUG - üîç Relationship Details:
2025-09-20 16:44:39,982 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:44:39,982 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:44:39,982 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:44:39,982 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:44:39,982 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:44:39,982 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:44:39,982 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:44:39,982 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:44:39,982 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:44:39,982 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:44:39,982 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:44:39,982 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:44:39,982 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:44:39,982 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:44:39,982 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:44:39,983 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:44:39,984 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:44:39,984 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:44:39,985 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:44:46,693 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:44:46,830 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:44:46,830 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:44:46,831 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:44:46,958 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:44:47,119 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:47,135 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:44:47,135 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:47,149 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:44:47,149 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:44:47,165 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:44:47,165 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:44:47,165 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:44:47,174 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:44:47,174 - INFO - ‚úÖ Database connection established
2025-09-20 16:44:47,194 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:44:47,200 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:44:47,203 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:44:47,205 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:44:47,208 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:44:47,211 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:44:47,213 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:44:47,216 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:44:47,219 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:44:47,221 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:44:47,224 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:44:47,227 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:44:47,229 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:44:47,232 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:44:47,237 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:44:47,241 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:47,241 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:44:47,245 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:44:47,246 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:44:47,249 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:47,249 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:44:47,253 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:47,253 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:44:47,257 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:44:47,257 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:44:47,261 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:44:47,261 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:44:47,265 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:44:47,265 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:44:47,265 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:44:47,270 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:44:47,270 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:44:47,270 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:44:47,274 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:44:47,279 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:44:47,279 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:44:47,279 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:44:47,279 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:44:47,279 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:44:47,283 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:44:47,287 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:44:47,287 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:44:47,287 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:44:47,287 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:44:47,287 - DEBUG - üîç Relationship Details:
2025-09-20 16:44:47,287 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:44:47,287 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:44:47,287 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:44:47,287 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:44:47,287 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:44:47,287 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:44:47,288 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:44:47,288 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:44:47,288 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:44:47,288 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:44:47,288 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:44:47,288 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:44:47,288 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:44:47,288 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:44:47,288 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:44:47,288 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:44:47,291 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:44:47,291 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:44:47,292 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:49:13,532 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:49:13,671 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:49:13,671 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:49:13,671 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:49:13,802 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:49:13,966 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:13,982 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:49:13,982 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:13,997 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:49:13,997 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:14,012 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:49:14,012 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:49:14,012 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:49:14,022 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:49:14,022 - INFO - ‚úÖ Database connection established
2025-09-20 16:49:14,043 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:49:14,049 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:49:14,051 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:49:14,054 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:49:14,057 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:49:14,059 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:49:14,062 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:49:14,065 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:49:14,068 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:49:14,071 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:49:14,074 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:49:14,077 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:49:14,080 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:49:14,083 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:49:14,089 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:49:14,093 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:14,093 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:49:14,097 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:49:14,097 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:49:14,101 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:14,101 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:49:14,105 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:14,105 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:49:14,109 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:14,109 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:49:14,113 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:49:14,113 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:49:14,117 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:49:14,117 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:49:14,118 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:49:14,122 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:49:14,122 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:49:14,122 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:49:14,126 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:49:14,130 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:49:14,130 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:49:14,130 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:49:14,130 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:49:14,130 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:49:14,134 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:49:14,138 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:49:14,138 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:49:14,138 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:49:14,138 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:49:14,139 - DEBUG - üîç Relationship Details:
2025-09-20 16:49:14,139 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:49:14,139 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:49:14,139 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:49:14,139 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:49:14,139 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:49:14,139 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:49:14,139 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:49:14,139 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:49:14,139 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:49:14,139 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:49:14,139 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:49:14,139 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:49:14,139 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:49:14,139 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:49:14,139 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:49:14,139 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:49:14,141 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:49:14,141 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:49:14,141 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:49:36,436 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:49:36,575 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:49:36,575 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:49:36,575 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:49:36,709 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:49:36,874 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:36,890 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:49:36,890 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:36,905 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:49:36,905 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:36,920 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:49:36,920 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:49:36,920 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:49:36,929 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:49:36,929 - INFO - ‚úÖ Database connection established
2025-09-20 16:49:36,949 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:49:36,955 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:49:36,957 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:49:36,960 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:49:36,962 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:49:36,965 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:49:36,967 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:49:36,970 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:49:36,973 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:49:36,976 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:49:36,978 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:49:36,982 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:49:36,984 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:49:36,987 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:49:36,993 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:49:36,997 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:36,997 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:49:37,001 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:49:37,001 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:49:37,005 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:37,005 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:49:37,009 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:37,009 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:49:37,013 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:37,013 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:49:37,017 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:49:37,017 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:49:37,021 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:49:37,021 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:49:37,021 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:49:37,025 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:49:37,025 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:49:37,025 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:49:37,029 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:49:37,033 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:49:37,033 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:49:37,033 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:49:37,033 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:49:37,034 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:49:37,038 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:49:37,042 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:49:37,042 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:49:37,042 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:49:37,042 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:49:37,042 - DEBUG - üîç Relationship Details:
2025-09-20 16:49:37,042 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:49:37,042 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:49:37,042 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:49:37,042 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:49:37,042 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:49:37,042 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:49:37,042 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:49:37,043 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:49:37,043 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:49:37,043 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:49:37,043 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:49:37,043 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:49:37,043 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:49:37,043 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:49:37,043 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:49:37,043 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:49:37,045 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:49:37,045 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:49:37,045 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:49:42,695 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:49:42,832 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:49:42,832 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:49:42,832 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:49:42,959 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:49:43,122 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:43,138 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:49:43,138 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:43,152 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:49:43,152 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:43,167 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:49:43,168 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:49:43,168 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:49:43,177 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:49:43,177 - INFO - ‚úÖ Database connection established
2025-09-20 16:49:43,197 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:49:43,203 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:49:43,205 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:49:43,208 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:49:43,210 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:49:43,213 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:49:43,215 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:49:43,218 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:49:43,221 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:49:43,223 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:49:43,226 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:49:43,229 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:49:43,231 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:49:43,234 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:49:43,239 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:49:43,243 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:43,243 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:49:43,247 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:49:43,248 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:49:43,251 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:43,251 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:49:43,255 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:43,255 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:49:43,259 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:43,259 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:49:43,263 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:49:43,263 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:49:43,267 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:49:43,267 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:49:43,267 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:49:43,271 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:49:43,272 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:49:43,272 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:49:43,276 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:49:43,280 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:49:43,280 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:49:43,280 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:49:43,280 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:49:43,280 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:49:43,285 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:49:43,289 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:49:43,289 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:49:43,289 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:49:43,289 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:49:43,289 - DEBUG - üîç Relationship Details:
2025-09-20 16:49:43,289 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:49:43,289 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:49:43,289 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:49:43,289 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:49:43,289 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:49:43,289 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:49:43,289 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:49:43,289 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:49:43,289 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:49:43,289 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:49:43,289 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:49:43,289 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:49:43,289 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:49:43,289 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:49:43,290 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:49:43,290 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:49:43,291 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:49:43,291 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:49:43,292 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:49:45,708 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:49:45,844 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:49:45,845 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:49:45,845 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:49:45,973 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:49:46,136 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:46,151 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:49:46,152 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:46,167 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:49:46,167 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:49:46,182 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:49:46,182 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:49:46,182 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:49:46,191 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:49:46,191 - INFO - ‚úÖ Database connection established
2025-09-20 16:49:46,212 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:49:46,217 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:49:46,220 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:49:46,223 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:49:46,225 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:49:46,228 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:49:46,231 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:49:46,234 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:49:46,237 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:49:46,240 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:49:46,242 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:49:46,246 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:49:46,248 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:49:46,251 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:49:46,257 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:49:46,261 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:46,261 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:49:46,265 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:49:46,265 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:49:46,269 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:46,269 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:49:46,273 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:46,273 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:49:46,277 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:49:46,277 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:49:46,281 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:49:46,281 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:49:46,286 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:49:46,286 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:49:46,286 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:49:46,290 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:49:46,290 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:49:46,290 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:49:46,294 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:49:46,299 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:49:46,299 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:49:46,299 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:49:46,299 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:49:46,299 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:49:46,303 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:49:46,307 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:49:46,307 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:49:46,307 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:49:46,307 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:49:46,307 - DEBUG - üîç Relationship Details:
2025-09-20 16:49:46,307 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:49:46,307 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:49:46,307 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:49:46,307 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:49:46,307 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:49:46,307 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:49:46,308 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:49:46,308 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:49:46,308 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:49:46,308 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:49:46,308 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:49:46,308 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:49:46,308 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:49:46,308 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:49:46,308 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:49:46,308 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:49:46,311 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:49:46,311 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:49:46,311 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:51:28,074 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:51:28,213 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:51:28,213 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:51:28,213 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:51:28,343 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:51:28,504 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:51:28,520 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:51:28,520 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:51:28,535 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:51:28,535 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:51:28,551 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:51:28,551 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:51:28,551 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:51:28,559 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:51:28,560 - INFO - ‚úÖ Database connection established
2025-09-20 16:51:28,580 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:51:28,586 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:51:28,588 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:51:28,591 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:51:28,594 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:51:28,596 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:51:28,599 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:51:28,602 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:51:28,605 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:51:28,608 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:51:28,610 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:51:28,613 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:51:28,616 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:51:28,619 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:51:28,624 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:51:28,628 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:51:28,628 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:51:28,632 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:51:28,632 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:51:28,636 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:51:28,636 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:51:28,640 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:51:28,640 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:51:28,644 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:51:28,644 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:51:28,648 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:51:28,648 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:51:28,652 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:51:28,652 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:51:28,653 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:51:28,657 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:51:28,657 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:51:28,657 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:51:28,661 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:51:28,665 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:51:28,665 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:51:28,665 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:51:28,665 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:51:28,665 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:51:28,669 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:51:28,674 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:51:28,674 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:51:28,674 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:51:28,674 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:51:28,674 - DEBUG - üîç Relationship Details:
2025-09-20 16:51:28,674 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:51:28,674 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:51:28,674 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:51:28,674 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:51:28,674 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:51:28,674 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:51:28,674 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:51:28,674 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:51:28,674 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:51:28,674 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:51:28,674 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:51:28,674 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:51:28,675 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:51:28,675 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:51:28,675 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:51:28,675 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:51:28,676 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:51:28,677 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:51:28,677 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:53:36,556 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:53:36,693 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:53:36,693 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:53:36,693 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:53:36,820 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:53:36,980 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:53:36,996 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:53:36,996 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:53:37,011 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:53:37,011 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:53:37,026 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:53:37,027 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:53:37,027 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:53:37,035 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:53:37,035 - INFO - ‚úÖ Database connection established
2025-09-20 16:53:37,056 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:53:37,061 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:53:37,064 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:53:37,067 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:53:37,070 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:53:37,073 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:53:37,075 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:53:37,078 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:53:37,081 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:53:37,084 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:53:37,086 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:53:37,089 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:53:37,092 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:53:37,095 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:53:37,100 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:53:37,104 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:53:37,104 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:53:37,108 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:53:37,108 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:53:37,112 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:53:37,112 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:53:37,116 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:53:37,116 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:53:37,120 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:53:37,120 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:53:37,124 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:53:37,124 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:53:37,128 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:53:37,128 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:53:37,128 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:53:37,132 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:53:37,132 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:53:37,132 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:53:37,136 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:53:37,140 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:53:37,140 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:53:37,140 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:53:37,140 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:53:37,140 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:53:37,144 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:53:37,148 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:53:37,148 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:53:37,148 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:53:37,148 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:53:37,148 - DEBUG - üîç Relationship Details:
2025-09-20 16:53:37,148 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:53:37,148 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:53:37,149 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:53:37,149 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:53:37,149 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:53:37,149 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:53:37,149 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:53:37,149 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:53:37,149 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:53:37,149 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:53:37,149 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:53:37,149 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:53:37,149 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:53:37,149 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:53:37,149 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:53:37,149 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:53:37,151 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:53:37,151 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:53:37,151 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:55:18,249 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:55:18,386 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:55:18,386 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:55:18,386 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:55:18,513 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:55:18,673 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:55:18,689 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:55:18,689 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:55:18,704 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:55:18,704 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:55:18,720 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:55:18,720 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:55:18,720 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:55:18,729 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:55:18,729 - INFO - ‚úÖ Database connection established
2025-09-20 16:55:18,749 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:55:18,755 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:55:18,757 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:55:18,760 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:55:18,763 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:55:18,766 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:55:18,768 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:55:18,771 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:55:18,774 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:55:18,777 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:55:18,779 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:55:18,783 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:55:18,785 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:55:18,788 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:55:18,794 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:55:18,798 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:18,798 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:55:18,802 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:55:18,802 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:55:18,806 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:18,806 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:55:18,810 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:18,810 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:55:18,814 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:18,814 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:55:18,818 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:55:18,818 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:55:18,822 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:55:18,822 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:55:18,822 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:55:18,826 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:55:18,826 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:55:18,826 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:55:18,830 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:55:18,834 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:55:18,834 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:55:18,835 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:55:18,835 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:55:18,835 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:55:18,839 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:55:18,843 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:55:18,843 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:55:18,843 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:55:18,843 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:55:18,843 - DEBUG - üîç Relationship Details:
2025-09-20 16:55:18,843 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:55:18,843 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:55:18,843 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:55:18,843 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:55:18,843 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:55:18,843 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:55:18,843 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:55:18,843 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:55:18,843 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:55:18,843 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:55:18,843 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:55:18,843 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:55:18,843 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:55:18,843 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:55:18,843 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:55:18,843 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:55:18,845 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:55:18,845 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:55:18,846 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:55:21,271 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:55:21,409 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:55:21,409 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:55:21,409 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:55:21,538 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:55:21,700 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:55:21,716 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:55:21,716 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:55:21,731 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:55:21,731 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:55:21,747 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:55:21,747 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:55:21,747 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:55:21,756 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:55:21,756 - INFO - ‚úÖ Database connection established
2025-09-20 16:55:21,775 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:55:21,781 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:55:21,784 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:55:21,787 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:55:21,789 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:55:21,792 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:55:21,795 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:55:21,797 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:55:21,800 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:55:21,803 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:55:21,806 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:55:21,809 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:55:21,811 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:55:21,814 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:55:21,819 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:55:21,823 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:21,823 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:55:21,827 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:55:21,827 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:55:21,831 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:21,831 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:55:21,835 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:21,835 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:55:21,838 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:21,838 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:55:21,842 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:55:21,842 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:55:21,846 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:55:21,846 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:55:21,846 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:55:21,850 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:55:21,850 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:55:21,851 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:55:21,854 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:55:21,859 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:55:21,859 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:55:21,859 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:55:21,859 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:55:21,859 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:55:21,863 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:55:21,867 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:55:21,867 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:55:21,867 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:55:21,867 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:55:21,867 - DEBUG - üîç Relationship Details:
2025-09-20 16:55:21,867 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:55:21,867 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:55:21,867 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:55:21,867 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:55:21,867 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:55:21,867 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:55:21,867 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:55:21,867 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:55:21,867 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:55:21,867 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:55:21,867 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:55:21,867 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:55:21,867 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:55:21,867 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:55:21,867 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:55:21,868 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:55:21,869 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:55:21,869 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:55:21,870 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:55:24,296 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:55:24,430 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:55:24,430 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:55:24,431 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:55:24,558 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:55:24,720 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:55:24,736 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:55:24,736 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:55:24,751 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:55:24,751 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:55:24,766 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:55:24,766 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:55:24,766 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:55:24,775 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:55:24,775 - INFO - ‚úÖ Database connection established
2025-09-20 16:55:24,795 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:55:24,801 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:55:24,803 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:55:24,806 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:55:24,809 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:55:24,811 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:55:24,813 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:55:24,816 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:55:24,819 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:55:24,822 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:55:24,825 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:55:24,828 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:55:24,830 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:55:24,833 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:55:24,838 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:55:24,842 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:24,842 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:55:24,846 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:55:24,846 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:55:24,850 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:24,850 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:55:24,854 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:24,854 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:55:24,858 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:55:24,858 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:55:24,862 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:55:24,862 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:55:24,866 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:55:24,866 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:55:24,866 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:55:24,871 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:55:24,871 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:55:24,871 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:55:24,875 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:55:24,879 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:55:24,879 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:55:24,879 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:55:24,879 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:55:24,879 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:55:24,883 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:55:24,887 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:55:24,887 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:55:24,887 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:55:24,887 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:55:24,887 - DEBUG - üîç Relationship Details:
2025-09-20 16:55:24,887 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:55:24,887 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:55:24,887 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:55:24,887 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:55:24,888 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:55:24,888 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:55:24,888 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:55:24,888 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:55:24,888 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:55:24,888 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:55:24,888 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:55:24,888 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:55:24,888 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:55:24,888 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:55:24,888 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:55:24,888 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:55:24,890 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:55:24,890 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:55:24,890 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:56:53,624 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:56:53,757 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:56:53,758 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:56:53,758 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:56:53,884 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:56:54,042 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:56:54,058 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:56:54,058 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:56:54,073 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:56:54,073 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:56:54,089 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:56:54,089 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:56:54,089 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:56:54,098 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:56:54,098 - INFO - ‚úÖ Database connection established
2025-09-20 16:56:54,118 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:56:54,123 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:56:54,126 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:56:54,128 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:56:54,131 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:56:54,134 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:56:54,136 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:56:54,139 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:56:54,142 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:56:54,144 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:56:54,147 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:56:54,150 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:56:54,153 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:56:54,156 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:56:54,161 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:56:54,165 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:56:54,165 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:56:54,169 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:56:54,170 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:56:54,173 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:56:54,174 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:56:54,178 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:56:54,178 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:56:54,182 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:56:54,182 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:56:54,186 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:56:54,186 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:56:54,190 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:56:54,190 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:56:54,190 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:56:54,195 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:56:54,195 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:56:54,195 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:56:54,199 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:56:54,203 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:56:54,203 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:56:54,203 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:56:54,203 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:56:54,203 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:56:54,208 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:56:54,212 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:56:54,212 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:56:54,212 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:56:54,212 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:56:54,212 - DEBUG - üîç Relationship Details:
2025-09-20 16:56:54,212 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:56:54,212 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:56:54,212 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:56:54,212 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:56:54,212 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:56:54,212 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:56:54,212 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:56:54,213 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:56:54,213 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:56:54,213 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:56:54,213 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:56:54,213 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:56:54,213 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:56:54,213 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:56:54,213 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:56:54,213 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:56:54,216 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:56:54,216 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:56:54,217 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:58:58,644 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:58:58,782 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 16:58:58,782 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 16:58:58,782 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 16:58:58,911 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 16:58:59,073 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:58:59,090 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:58:59,090 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:58:59,105 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:58:59,105 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:58:59,122 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:58:59,122 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:58:59,122 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:58:59,131 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:58:59,131 - INFO - ‚úÖ Database connection established
2025-09-20 16:58:59,152 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:58:59,158 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:58:59,161 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:58:59,163 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:58:59,166 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:58:59,169 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:58:59,171 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:58:59,174 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:58:59,177 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:58:59,180 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:58:59,183 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:58:59,186 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:58:59,188 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:58:59,191 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:58:59,197 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:58:59,201 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:58:59,201 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:58:59,205 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:58:59,205 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:58:59,209 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:58:59,209 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:58:59,213 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:58:59,213 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:58:59,217 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:58:59,217 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:58:59,221 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:58:59,221 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:58:59,225 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:58:59,225 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:58:59,225 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:58:59,229 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:58:59,229 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:58:59,229 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:58:59,234 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:58:59,238 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:58:59,238 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:58:59,238 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:58:59,238 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:58:59,238 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:58:59,242 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:58:59,246 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:58:59,246 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:58:59,246 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:58:59,246 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:58:59,246 - DEBUG - üîç Relationship Details:
2025-09-20 16:58:59,246 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:58:59,246 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:58:59,246 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:58:59,246 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:58:59,246 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:58:59,246 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:58:59,247 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:58:59,247 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:58:59,247 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:58:59,247 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:58:59,247 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:58:59,247 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:58:59,247 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:58:59,247 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:58:59,247 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:58:59,247 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 16:58:59,249 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 16:58:59,249 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 16:58:59,249 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 16:59:00,000 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 16:59:00,000 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 16:59:00,016 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 16:59:00,016 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 16:59:00,016 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 16:59:00,017 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 16:59:00,017 - INFO - ‚úÖ Database connection established
2025-09-20 16:59:00,029 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:59:00,033 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 16:59:00,036 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 16:59:00,039 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 16:59:00,041 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 16:59:00,044 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 16:59:00,046 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 16:59:00,049 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 16:59:00,051 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 16:59:00,054 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 16:59:00,057 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 16:59:00,060 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 16:59:00,062 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 16:59:00,065 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 16:59:00,070 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 16:59:00,074 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:59:00,074 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 16:59:00,078 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 16:59:00,078 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 16:59:00,082 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:59:00,082 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 16:59:00,086 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:59:00,086 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 16:59:00,090 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 16:59:00,090 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 16:59:00,094 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 16:59:00,094 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 16:59:00,098 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 16:59:00,098 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 16:59:00,098 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 16:59:00,102 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 16:59:00,102 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 16:59:00,102 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 16:59:00,106 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 16:59:00,110 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 16:59:00,110 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 16:59:00,110 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 16:59:00,110 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 16:59:00,110 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 16:59:00,115 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 16:59:00,119 - DEBUG - üîó Foreign keys for users: []
2025-09-20 16:59:00,119 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 16:59:00,119 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 16:59:00,119 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 16:59:00,119 - DEBUG - üîç Relationship Details:
2025-09-20 16:59:00,119 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:59:00,119 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 16:59:00,119 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 16:59:00,119 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 16:59:00,119 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 16:59:00,119 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 16:59:00,120 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 16:59:00,120 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 16:59:00,120 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 16:59:00,120 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 16:59:00,120 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 16:59:00,120 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 16:59:00,120 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 16:59:00,120 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 16:59:00,120 - INFO - üìå Maritime system initialization complete.
2025-09-20 16:59:00,120 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:00:49,541 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:00:49,676 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:00:49,676 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:00:49,676 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:00:49,805 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:00:49,968 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:00:49,984 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:00:49,984 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:00:49,999 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 17:00:49,999 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:00:50,014 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:00:50,014 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:00:50,014 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:00:50,023 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:00:50,024 - INFO - ‚úÖ Database connection established
2025-09-20 17:00:50,110 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:00:50,115 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:00:50,118 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:00:50,120 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:00:50,123 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:00:50,125 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:00:50,128 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:00:50,130 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:00:50,133 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:00:50,136 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:00:50,138 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:00:50,141 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:00:50,144 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:00:50,147 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:00:50,152 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:00:50,156 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:00:50,156 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:00:50,160 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:00:50,160 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:00:50,164 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:00:50,164 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:00:50,168 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:00:50,168 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:00:50,172 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:00:50,172 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:00:50,176 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:00:50,176 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:00:50,180 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:00:50,180 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:00:50,180 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:00:50,184 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:00:50,184 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:00:50,184 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:00:50,188 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:00:50,192 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:00:50,192 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:00:50,192 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:00:50,192 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:00:50,192 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:00:50,196 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:00:50,200 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:00:50,200 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:00:50,200 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:00:50,200 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:00:50,200 - DEBUG - üîç Relationship Details:
2025-09-20 17:00:50,200 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,201 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:00:50,201 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,201 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,201 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,201 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:00:50,201 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,201 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:00:50,201 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,201 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:00:50,201 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:00:50,201 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:00:50,201 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:00:50,201 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:00:50,201 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:00:50,201 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:00:50,203 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:00:50,203 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:00:50,203 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:00:50,385 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 17:00:50,386 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:00:50,401 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:00:50,401 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:00:50,401 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:00:50,402 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:00:50,402 - INFO - ‚úÖ Database connection established
2025-09-20 17:00:50,415 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:00:50,419 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:00:50,423 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:00:50,425 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:00:50,428 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:00:50,431 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:00:50,433 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:00:50,436 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:00:50,439 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:00:50,442 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:00:50,444 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:00:50,447 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:00:50,450 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:00:50,453 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:00:50,458 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:00:50,462 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:00:50,462 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:00:50,466 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:00:50,466 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:00:50,470 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:00:50,470 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:00:50,474 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:00:50,474 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:00:50,478 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:00:50,478 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:00:50,482 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:00:50,482 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:00:50,486 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:00:50,486 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:00:50,486 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:00:50,490 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:00:50,491 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:00:50,491 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:00:50,495 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:00:50,499 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:00:50,499 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:00:50,499 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:00:50,499 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:00:50,499 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:00:50,503 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:00:50,507 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:00:50,507 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:00:50,507 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:00:50,508 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:00:50,508 - DEBUG - üîç Relationship Details:
2025-09-20 17:00:50,508 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,508 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:00:50,508 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,508 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,508 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,508 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:00:50,508 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,508 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:00:50,508 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:00:50,508 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:00:50,508 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:00:50,508 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:00:50,508 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:00:50,508 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:00:50,508 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:00:50,508 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:01:03,116 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:01:03,252 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:01:03,252 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:01:03,252 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:01:03,381 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:01:03,543 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:03,559 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:03,559 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:03,574 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 17:01:03,574 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:03,590 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:01:03,590 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:03,591 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:01:03,599 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:01:03,599 - INFO - ‚úÖ Database connection established
2025-09-20 17:01:03,619 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:03,624 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:01:03,627 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:01:03,629 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:01:03,632 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:01:03,635 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:01:03,637 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:01:03,640 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:01:03,643 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:01:03,645 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:01:03,648 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:01:03,651 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:01:03,654 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:01:03,656 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:01:03,662 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:01:03,666 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:03,666 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:03,670 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:01:03,670 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:01:03,674 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:03,674 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:03,678 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:03,678 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:01:03,682 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:03,682 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:01:03,686 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:01:03,686 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:01:03,690 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:01:03,690 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:01:03,690 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:01:03,694 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:01:03,694 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:01:03,694 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:01:03,698 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:01:03,703 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:01:03,703 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:01:03,703 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:01:03,703 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:01:03,703 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:01:03,707 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:01:03,711 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:01:03,711 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:01:03,711 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:03,711 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:01:03,711 - DEBUG - üîç Relationship Details:
2025-09-20 17:01:03,711 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:03,711 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:01:03,712 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:03,712 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:01:03,712 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:01:03,712 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:01:03,712 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:01:03,712 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:01:03,712 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:01:03,712 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:01:03,712 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:01:03,712 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:01:03,712 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:01:03,712 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:01:03,712 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:01:03,712 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:01:03,715 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:01:03,716 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:01:03,716 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:01:03,900 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 17:01:03,900 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:03,916 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:01:03,916 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:03,917 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:01:03,917 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:01:03,917 - INFO - ‚úÖ Database connection established
2025-09-20 17:01:03,930 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:03,935 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:01:03,938 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:01:03,941 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:01:03,943 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:01:03,946 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:01:03,948 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:01:03,951 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:01:03,954 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:01:03,957 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:01:03,960 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:01:03,963 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:01:03,966 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:01:03,969 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:01:03,974 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:01:03,978 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:03,978 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:03,982 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:01:03,982 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:01:03,986 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:03,986 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:03,990 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:03,990 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:01:03,995 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:03,995 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:01:03,999 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:01:03,999 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:01:04,003 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:01:04,003 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:01:04,003 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:01:04,007 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:01:04,007 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:01:04,007 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:01:04,011 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:01:04,016 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:01:04,016 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:01:04,016 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:01:04,016 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:01:04,016 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:01:04,020 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:01:04,024 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:01:04,024 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:01:04,024 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:04,024 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:01:04,024 - DEBUG - üîç Relationship Details:
2025-09-20 17:01:04,024 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:04,024 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:01:04,025 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:04,025 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:01:04,025 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:01:04,025 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:01:04,025 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:01:04,025 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:01:04,025 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:01:04,025 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:01:04,025 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:01:04,025 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:01:04,025 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:01:04,025 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:01:04,025 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:01:04,025 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:01:05,979 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:01:06,122 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:01:06,122 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:01:06,122 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:01:06,261 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:01:06,432 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:06,449 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:06,449 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:06,464 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 17:01:06,464 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:06,480 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:01:06,480 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:06,480 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:01:06,489 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:01:06,489 - INFO - ‚úÖ Database connection established
2025-09-20 17:01:06,510 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:06,516 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:01:06,519 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:01:06,522 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:01:06,524 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:01:06,527 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:01:06,529 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:01:06,532 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:01:06,535 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:01:06,537 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:01:06,540 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:01:06,543 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:01:06,545 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:01:06,548 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:01:06,553 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:01:06,557 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:06,558 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:06,562 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:01:06,562 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:01:06,566 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:06,566 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:06,570 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:06,570 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:01:06,574 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:06,574 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:01:06,578 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:01:06,578 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:01:06,583 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:01:06,583 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:01:06,583 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:01:06,587 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:01:06,587 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:01:06,587 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:01:06,591 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:01:06,596 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:01:06,596 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:01:06,596 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:01:06,596 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:01:06,596 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:01:06,600 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:01:06,604 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:01:06,604 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:01:06,604 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:06,604 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:01:06,604 - DEBUG - üîç Relationship Details:
2025-09-20 17:01:06,605 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,605 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:01:06,605 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,605 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,605 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,605 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:01:06,605 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,605 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:01:06,605 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,605 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:01:06,605 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:01:06,605 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:01:06,605 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:01:06,605 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:01:06,605 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:01:06,605 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:01:06,608 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:01:06,608 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:01:06,609 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:01:06,804 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 17:01:06,804 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:06,820 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:01:06,820 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:06,820 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:01:06,820 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:01:06,820 - INFO - ‚úÖ Database connection established
2025-09-20 17:01:06,833 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:06,837 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:01:06,840 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:01:06,843 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:01:06,846 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:01:06,849 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:01:06,852 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:01:06,855 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:01:06,859 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:01:06,862 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:01:06,865 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:01:06,891 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:01:06,894 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:01:06,897 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:01:06,903 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:01:06,907 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:06,907 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:06,911 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:01:06,911 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:01:06,916 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:06,916 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:06,921 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:06,921 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:01:06,926 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:06,927 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:01:06,931 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:01:06,931 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:01:06,937 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:01:06,937 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:01:06,937 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:01:06,942 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:01:06,942 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:01:06,942 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:01:06,947 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:01:06,952 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:01:06,952 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:01:06,952 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:01:06,952 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:01:06,953 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:01:06,958 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:01:06,963 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:01:06,963 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:01:06,963 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:06,963 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:01:06,963 - DEBUG - üîç Relationship Details:
2025-09-20 17:01:06,963 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,963 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:01:06,963 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,963 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,963 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,964 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:01:06,964 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,964 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:01:06,964 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:01:06,964 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:01:06,964 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:01:06,964 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:01:06,964 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:01:06,964 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:01:06,964 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:01:06,964 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:01:08,924 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:01:09,061 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:01:09,061 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:01:09,061 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:01:09,191 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:01:09,352 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:09,368 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:09,368 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:09,383 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 17:01:09,383 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:09,399 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:01:09,399 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:09,399 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:01:09,408 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:01:09,408 - INFO - ‚úÖ Database connection established
2025-09-20 17:01:09,428 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:09,434 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:01:09,436 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:01:09,439 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:01:09,442 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:01:09,445 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:01:09,447 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:01:09,450 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:01:09,453 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:01:09,456 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:01:09,459 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:01:09,462 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:01:09,464 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:01:09,467 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:01:09,473 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:01:09,477 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:09,477 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:09,481 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:01:09,481 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:01:09,485 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:09,485 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:09,489 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:09,489 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:01:09,493 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:09,493 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:01:09,497 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:01:09,498 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:01:09,502 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:01:09,502 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:01:09,502 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:01:09,506 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:01:09,506 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:01:09,506 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:01:09,510 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:01:09,514 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:01:09,514 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:01:09,514 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:01:09,514 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:01:09,514 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:01:09,518 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:01:09,522 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:01:09,522 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:01:09,522 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:09,522 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:01:09,522 - DEBUG - üîç Relationship Details:
2025-09-20 17:01:09,522 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,522 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:01:09,523 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,523 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,523 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,523 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:01:09,523 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,523 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:01:09,523 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,523 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:01:09,523 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:01:09,523 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:01:09,523 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:01:09,523 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:01:09,523 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:01:09,523 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:01:09,525 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:01:09,525 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:01:09,525 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:01:09,714 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 17:01:09,714 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:09,730 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:01:09,730 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:09,730 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:01:09,730 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:01:09,730 - INFO - ‚úÖ Database connection established
2025-09-20 17:01:09,743 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:09,747 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:01:09,750 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:01:09,753 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:01:09,756 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:01:09,758 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:01:09,761 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:01:09,763 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:01:09,766 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:01:09,769 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:01:09,771 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:01:09,774 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:01:09,777 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:01:09,780 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:01:09,785 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:01:09,789 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:09,789 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:09,793 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:01:09,793 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:01:09,797 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:09,797 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:09,801 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:09,801 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:01:09,805 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:09,805 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:01:09,809 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:01:09,809 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:01:09,813 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:01:09,813 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:01:09,813 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:01:09,817 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:01:09,817 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:01:09,817 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:01:09,821 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:01:09,825 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:01:09,825 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:01:09,825 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:01:09,825 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:01:09,825 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:01:09,830 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:01:09,834 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:01:09,834 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:01:09,834 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:09,834 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:01:09,834 - DEBUG - üîç Relationship Details:
2025-09-20 17:01:09,834 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,834 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:01:09,834 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,834 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,834 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,834 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:01:09,834 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,835 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:01:09,835 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:01:09,835 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:01:09,835 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:01:09,835 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:01:09,835 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:01:09,835 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:01:09,835 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:01:09,835 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:01:11,787 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:01:11,928 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:01:11,928 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:01:11,928 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:01:12,058 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:01:12,219 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:12,234 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:12,234 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:12,249 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 17:01:12,249 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:12,265 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:01:12,265 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:12,265 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:01:12,274 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:01:12,274 - INFO - ‚úÖ Database connection established
2025-09-20 17:01:12,295 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:12,301 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:01:12,304 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:01:12,307 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:01:12,309 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:01:12,312 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:01:12,314 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:01:12,317 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:01:12,320 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:01:12,323 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:01:12,325 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:01:12,328 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:01:12,331 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:01:12,334 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:01:12,339 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:01:12,343 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:12,343 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:12,347 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:01:12,347 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:01:12,351 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:12,351 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:12,355 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:12,355 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:01:12,358 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:12,359 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:01:12,362 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:01:12,363 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:01:12,367 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:01:12,367 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:01:12,367 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:01:12,371 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:01:12,371 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:01:12,371 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:01:12,375 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:01:12,379 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:01:12,379 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:01:12,379 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:01:12,379 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:01:12,379 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:01:12,383 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:01:12,387 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:01:12,387 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:01:12,388 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:12,388 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:01:12,388 - DEBUG - üîç Relationship Details:
2025-09-20 17:01:12,388 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,388 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:01:12,388 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,388 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,388 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,388 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:01:12,388 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,388 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:01:12,388 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,388 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:01:12,388 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:01:12,388 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:01:12,388 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:01:12,388 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:01:12,388 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:01:12,388 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:01:12,390 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:01:12,390 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:01:12,391 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:01:12,575 - INFO - üìå Initializing maritime sensor monitoring system...
2025-09-20 17:01:12,575 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:01:12,590 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:01:12,591 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:01:12,591 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:01:12,591 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:01:12,591 - INFO - ‚úÖ Database connection established
2025-09-20 17:01:12,616 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:12,621 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:01:12,624 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:01:12,626 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:01:12,629 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:01:12,631 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:01:12,633 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:01:12,636 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:01:12,639 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:01:12,642 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:01:12,644 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:01:12,647 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:01:12,650 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:01:12,652 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:01:12,657 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:01:12,661 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:12,661 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:12,665 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:01:12,665 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:01:12,669 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:12,669 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:01:12,673 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:12,673 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:01:12,677 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:01:12,677 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:01:12,681 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:01:12,681 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:01:12,685 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:01:12,685 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:01:12,685 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:01:12,689 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:01:12,689 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:01:12,689 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:01:12,693 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:01:12,698 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:01:12,698 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:01:12,698 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:01:12,698 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:01:12,698 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:01:12,702 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:01:12,706 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:01:12,706 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:01:12,706 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:01:12,706 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:01:12,706 - DEBUG - üîç Relationship Details:
2025-09-20 17:01:12,706 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,706 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:01:12,706 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,706 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,706 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,706 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:01:12,706 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,706 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:01:12,706 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:01:12,706 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:01:12,706 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:01:12,706 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:01:12,707 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:01:12,707 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:01:12,707 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:01:12,707 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:02:56,002 - INFO - Database engine created with pool_size=10
2025-09-20 17:03:03,839 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:03:03,856 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 17:20:40,826 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:20:40,842 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 17:21:13,564 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:21:13,579 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 17:24:17,640 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:17,775 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:24:17,775 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:24:17,775 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:24:17,903 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:24:18,063 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:18,078 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:18,079 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:18,093 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:18,109 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:24:18,109 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:18,109 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:24:18,118 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:18,118 - INFO - ‚úÖ Database connection established
2025-09-20 17:24:18,138 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:18,144 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:18,146 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:18,149 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:18,152 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:18,155 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:18,158 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:18,160 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:18,163 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:18,166 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:18,169 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:18,172 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:18,175 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:18,178 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:18,184 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:18,188 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:18,188 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:18,192 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:18,192 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:18,196 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:18,196 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:18,200 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:18,201 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:18,205 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:18,205 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:18,209 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:18,209 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:18,213 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:18,213 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:18,213 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:18,217 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:18,217 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:18,217 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:18,221 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:18,226 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:18,226 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:18,226 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:18,226 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:18,226 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:18,230 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:18,234 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:18,234 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:18,234 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:18,234 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:24:18,234 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:18,234 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,234 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:18,234 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,234 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,234 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,234 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:18,234 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,234 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:18,234 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,235 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:18,235 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:18,235 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:18,235 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:18,235 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:18,235 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:18,235 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:18,237 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:24:18,237 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:24:18,237 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:18,417 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:18,433 - DEBUG - üëâ Configuration Loaded: {'RBAC_RULES': {'Developer Mode': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship HoD': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Ship CO': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Fleet/ Command HQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'NHQ': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Admin/ INSMA': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}, 'Handheld': {'ships': ['ship_id', 'ship_name', 'ship_category', 'ship_class', 'command', 'created_date', 'modified_date'], 'departments': ['department_id', 'ship_id', 'department_name', 'department_code', 'created_date', 'modified_date'], 'sensor_metadata': ['sensor_id', 'sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id', 'value', 'operating_hours', 'alert', 'date'], 'system_configuration': ['component_id', 'component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'created_date', 'modified_date'], 'users': ['id', 'username', 'full_name', 'role', 'is_active', 'email', 'hashed_password', 'created_at', 'updated_at', 'last_login'], 'failure_modes': ['name', 'severity', 'component_id', 'failure_mode_id'], 'etabeta': ['id', 'eta', 'beta', 'component_id', 'priority'], 'alphabeta': ['id', 'alpha', 'beta', 'component_id'], 'monthly_utilization': ['id', 'operation_date', 'utlization', 'component_id']}}, 'RLS_RULES': {'Admin/ INSMA': "ship_id = '{user_id}'", 'system_configuration': "component_id = '{user_id}'"}, 'USER_SETTINGS': {'USER_ROLE': 'Admin/ INSMA', 'USER_ID': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'USERNAME': 'jake'}, 'SQL_INJECTION_PATTERNS': ['--|#', ';(?!\\s*$)', '\\b(DROP|DELETE|INSERT|UPDATE|ALTER|EXEC)\\b', '\\bUNION\\b(?!(\\s+SELECT))', '\\bOR\\s+1\\s*=\\s*1\\b'], 'SENSITIVE_COLUMNS': {'ships': ['ship_id'], 'departments': ['department_id'], 'sensor_metadata': ['sensor_id', 'component_id', 'failure_mode_id'], 'sensor_readings': ['id', 'sensor_id', 'component_id'], 'system_configuration': ['component_id', 'parent_id', 'department_id'], 'users': ['id', 'hashed_password', 'email'], 'failure_modes': ['failure_mode_id', 'component_id'], 'etabeta': ['id', 'component_id'], 'alphabeta': ['id', 'component_id']}, 'LLM_PROVIDER': 'ollama', 'OPENROUTER': {'API_KEY': '${OPENROUTER_API_KEY}', 'MODEL': 'anthropic/claude-3.5-sonnet', 'BASE_URL': 'https://openrouter.ai/api/v1'}, 'OPENAI': {'API_KEY': '${OPENAI_API_KEY}', 'MODEL': 'gpt-4o'}, 'LLAMA_LOCAL': {'MODEL_PATH': '/path/to/local/llama/model'}, 'OLLAMA': {'MODEL': 'codellama:7b-instruct'}, 'max_memory_length': 5}
2025-09-20 17:24:18,433 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:18,433 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:24:18,433 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:18,433 - INFO - ‚úÖ Database connection established
2025-09-20 17:24:18,445 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:18,451 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:18,454 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:18,457 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:18,459 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:18,462 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:18,464 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:18,467 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:18,470 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:18,472 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:18,476 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:18,479 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:18,482 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:18,485 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:18,490 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:18,493 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:18,494 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:18,497 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:18,498 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:18,501 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:18,501 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:18,506 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:18,506 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:18,510 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:18,510 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:18,514 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:18,514 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:18,518 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:18,518 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:18,518 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:18,522 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:18,522 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:18,522 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:18,526 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:18,530 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:18,530 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:18,530 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:18,530 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:18,530 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:18,534 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:18,538 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:18,538 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:18,538 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:18,538 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:24:18,538 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:18,538 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,538 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:18,538 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,538 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,538 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,539 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:18,539 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,539 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:18,539 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:18,539 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:18,539 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:18,539 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:18,539 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:18,539 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:18,539 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:18,539 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:23,203 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:23,342 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:24:23,343 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:24:23,343 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:24:23,473 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:24:23,640 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:23,655 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:23,656 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:23,671 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:23,686 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:23,686 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:24:23,695 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:23,695 - INFO - ‚úÖ Database connection established
2025-09-20 17:24:23,727 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:23,733 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:23,736 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:23,739 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:23,741 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:23,744 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:23,747 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:23,749 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:23,753 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:23,755 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:23,758 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:23,761 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:23,764 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:23,767 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:23,773 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:23,777 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:23,777 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:23,781 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:23,781 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:23,785 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:23,785 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:23,789 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:23,789 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:23,794 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:23,794 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:23,798 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:23,798 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:23,802 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:23,802 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:23,802 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:23,806 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:23,806 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:23,806 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:23,811 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:23,815 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:23,815 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:23,815 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:23,815 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:23,815 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:23,819 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:23,823 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:23,824 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:23,824 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:23,824 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:24:23,824 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:23,824 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:23,824 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:23,824 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:23,824 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:23,824 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:23,824 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:23,824 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:23,824 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:23,824 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:23,824 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:23,824 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:23,824 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:23,824 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:23,825 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:23,825 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:23,825 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:23,826 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:24:23,827 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:24:23,827 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:24,014 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:24,029 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:24,030 - INFO - ‚úÖ LLM Client initialized successfully
2025-09-20 17:24:24,030 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:24,030 - INFO - ‚úÖ Database connection established
2025-09-20 17:24:24,042 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:24,047 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:24,050 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:24,053 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:24,055 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:24,058 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:24,061 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:24,064 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:24,066 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:24,069 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:24,072 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:24,075 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:24,077 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:24,080 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:24,085 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:24,090 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:24,090 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:24,094 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:24,094 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:24,098 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:24,098 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:24,102 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:24,102 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:24,106 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:24,106 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:24,110 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:24,110 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:24,114 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:24,114 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:24,114 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:24,119 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:24,119 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:24,119 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:24,123 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:24,127 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:24,128 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:24,128 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:24,128 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:24,128 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:24,132 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:24,136 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:24,136 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:24,136 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:24,136 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:24:24,136 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:24,136 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:24,136 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:24,136 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:24,136 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:24,136 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:24,136 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:24,136 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:24,136 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:24,136 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:24,137 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:24,137 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:24,137 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:24,137 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:24,137 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:24,137 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:24,137 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:28,340 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:28,477 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:24:28,477 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:24:28,477 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:24:28,607 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:24:28,785 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:28,801 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:28,801 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:28,817 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:28,832 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:28,841 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:28,861 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:28,866 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:28,869 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:28,872 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:28,874 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:28,877 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:28,879 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:28,882 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:28,885 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:28,888 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:28,891 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:28,894 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:28,896 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:28,899 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:28,904 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:28,908 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:28,908 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:28,912 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:28,913 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:28,916 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:28,917 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:28,920 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:28,920 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:28,924 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:28,924 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:28,928 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:28,928 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:28,932 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:28,933 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:28,933 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:28,937 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:28,937 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:28,937 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:28,941 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:28,945 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:28,945 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:28,945 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:28,945 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:28,945 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:28,949 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:28,953 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:28,954 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:28,954 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:28,954 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:24:28,954 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:28,954 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:28,954 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:28,954 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:28,954 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:28,954 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:28,954 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:28,954 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:28,954 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:28,954 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:28,954 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:28,954 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:28,954 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:28,954 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:28,954 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:28,954 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:28,954 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:28,956 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:24:28,956 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:24:28,957 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:29,154 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:29,169 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:29,170 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:29,170 - INFO - ‚úÖ Database connection established
2025-09-20 17:24:29,187 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:29,192 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:29,195 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:29,198 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:29,200 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:29,203 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:29,205 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:29,208 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:29,211 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:29,213 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:29,216 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:29,219 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:29,222 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:29,224 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:29,230 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:29,234 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:29,234 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:29,238 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:29,238 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:29,243 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:29,243 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:29,247 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:29,247 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:29,251 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:29,251 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:29,255 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:29,255 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:29,259 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:29,259 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:29,259 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:29,263 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:29,263 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:29,263 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:29,267 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:29,272 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:29,272 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:29,272 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:29,272 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:29,272 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:29,276 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:29,280 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:29,280 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:29,280 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:29,280 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:24:29,280 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:29,280 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:29,280 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:29,280 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:29,280 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:29,281 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:29,281 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:29,281 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:29,281 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:29,281 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:29,281 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:29,281 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:29,281 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:29,281 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:29,281 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:29,281 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:29,281 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:31,259 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:31,402 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:24:31,402 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:24:31,403 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:24:31,535 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:24:32,078 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:32,094 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:32,095 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:32,111 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:32,127 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:32,136 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:32,155 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:32,161 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:32,165 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:32,167 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:32,170 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:32,173 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:32,175 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:32,178 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:32,181 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:32,184 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:32,186 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:32,189 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:32,192 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:32,194 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:32,200 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:32,204 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:32,204 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:32,208 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:32,208 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:32,212 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:32,212 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:32,216 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:32,216 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:32,220 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:32,220 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:32,224 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:32,224 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:32,228 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:32,228 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:32,228 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:32,232 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:32,232 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:32,232 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:32,236 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:32,241 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:32,241 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:32,241 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:32,241 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:32,241 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:32,246 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:32,250 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:32,250 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:32,250 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:24:32,250 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:32,250 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,250 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:32,250 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,250 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,251 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,251 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:32,251 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,251 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:32,251 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,251 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:32,251 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:32,251 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:32,251 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:32,251 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:32,251 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:32,251 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:32,254 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:24:32,254 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:24:32,255 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:32,440 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:32,456 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:32,457 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:32,470 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:32,475 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:32,477 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:32,480 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:32,483 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:32,485 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:32,488 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:32,490 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:32,493 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:32,496 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:32,499 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:32,502 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:32,504 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:32,507 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:32,513 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:32,517 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:32,517 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:32,521 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:32,521 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:32,525 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:32,525 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:32,529 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:32,529 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:32,533 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:32,533 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:32,537 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:32,537 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:32,541 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:32,541 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:32,541 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:32,545 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:32,545 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:32,545 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:32,549 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:32,553 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:32,553 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:32,553 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:32,553 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:32,553 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:32,557 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:32,562 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:32,562 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:32,562 - INFO - ‚úÖ Schema loaded successfully. Tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:32,562 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:24:32,562 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:32,562 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,562 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:32,562 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,562 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,562 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,562 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:32,562 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,562 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:32,562 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:32,562 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:32,562 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:32,562 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:32,562 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:32,562 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:32,562 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:32,562 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:34,603 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:34,740 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:24:34,740 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:24:34,740 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:24:34,869 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:24:35,032 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:35,047 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:35,048 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:35,062 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:35,078 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:35,086 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:35,106 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:35,112 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:35,114 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:35,117 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:35,119 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:35,122 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:35,124 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:35,127 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:35,130 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:35,133 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:35,135 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:35,138 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:35,141 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:35,144 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:35,149 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:35,153 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:35,153 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:35,157 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:35,157 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:35,161 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:35,161 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:35,165 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:35,165 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:35,169 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:35,169 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:35,173 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:35,173 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:35,177 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:35,177 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:35,177 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:35,181 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:35,181 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:35,181 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:35,185 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:35,189 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:35,189 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:35,189 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:35,189 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:35,189 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:35,193 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:35,197 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:35,197 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:35,197 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:35,197 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,197 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:35,197 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,197 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,197 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,197 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:35,197 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,198 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:35,198 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,198 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:35,198 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:35,198 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:35,198 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:35,198 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:35,198 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:35,198 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:35,201 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:24:35,201 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:24:35,201 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:35,384 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:35,400 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:35,400 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:35,413 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:35,418 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:35,420 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:35,423 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:35,426 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:35,428 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:35,431 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:35,434 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:35,437 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:35,439 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:35,442 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:35,445 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:35,447 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:35,450 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:35,455 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:35,460 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:35,460 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:35,467 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:35,467 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:35,472 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:35,472 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:35,477 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:35,478 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:35,482 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:35,482 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:35,486 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:35,487 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:35,491 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:35,491 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:35,491 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:35,495 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:35,495 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:35,496 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:35,500 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:35,504 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:35,504 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:35,504 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:35,504 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:35,504 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:35,508 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:35,512 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:35,512 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:35,512 - INFO - ‚úÖ Relationships loaded: 14 relationships found
2025-09-20 17:24:35,512 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:35,512 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,513 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:35,513 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,513 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,513 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,513 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:35,513 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,513 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:35,513 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:35,513 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:35,513 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:35,513 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:35,513 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:35,513 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:35,513 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:35,513 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:37,470 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:37,609 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:24:37,609 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:24:37,609 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:24:37,739 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:24:37,904 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:37,920 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:37,920 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:37,937 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:37,956 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:37,971 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:37,995 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:38,004 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:38,007 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:38,011 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:38,015 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:38,018 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:38,022 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:38,027 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:38,032 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:38,036 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:38,039 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:38,045 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:38,050 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:38,055 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:38,064 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:38,070 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:38,071 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:38,077 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:38,078 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:38,084 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:38,085 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:38,092 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:38,092 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:38,099 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:38,099 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:38,106 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:38,106 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:38,114 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:38,114 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:38,114 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:38,122 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:38,122 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:38,122 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:38,130 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:38,136 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:38,136 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:38,136 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:38,136 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:38,136 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:38,142 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:38,147 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:38,148 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:38,148 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:38,148 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,148 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:38,148 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,148 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,148 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,148 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:38,148 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,148 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:38,148 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,148 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:38,149 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:38,149 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:38,149 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:38,149 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:38,149 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:38,149 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:38,152 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:24:38,152 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:24:38,152 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:38,353 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:38,369 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:38,369 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:38,382 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:38,386 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:38,389 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:38,392 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:38,394 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:38,397 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:38,399 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:38,402 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:38,405 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:38,408 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:38,410 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:38,413 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:38,416 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:38,419 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:38,424 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:38,428 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:38,428 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:38,432 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:38,432 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:38,436 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:38,436 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:38,441 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:38,441 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:38,445 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:38,445 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:38,449 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:38,449 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:38,453 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:38,453 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:38,453 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:38,457 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:38,457 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:38,457 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:38,461 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:38,465 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:38,465 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:38,466 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:38,466 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:38,466 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:38,470 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:38,474 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:38,474 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:38,474 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:38,474 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,474 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:38,474 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,474 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,474 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,474 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:38,474 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,474 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:38,474 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:38,474 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:38,474 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:38,474 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:38,474 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:38,474 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:38,475 - INFO - üìå Maritime system initialization complete.
2025-09-20 17:24:38,475 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:40,650 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:40,785 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:24:40,785 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:24:40,785 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:24:40,913 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:24:41,076 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:41,092 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:41,092 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:41,107 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:41,122 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:41,131 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:41,150 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:41,156 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:41,159 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:41,162 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:41,164 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:41,167 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:41,169 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:41,172 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:41,175 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:41,178 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:41,180 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:41,184 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:41,186 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:41,189 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:41,194 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:41,198 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:41,198 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:41,202 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:41,203 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:41,207 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:41,207 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:41,211 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:41,211 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:41,215 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:41,215 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:41,219 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:41,219 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:41,223 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:41,223 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:41,223 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:41,227 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:41,227 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:41,227 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:41,231 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:41,235 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:41,235 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:41,236 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:41,236 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:41,236 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:41,239 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:41,243 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:41,243 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:41,244 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:41,244 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,244 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:41,244 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,244 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,244 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,244 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:41,244 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,244 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:41,244 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,244 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:41,244 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:41,244 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:41,244 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:41,244 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:41,244 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:41,246 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:24:41,246 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:24:41,246 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:41,427 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:41,443 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:41,443 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:41,455 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:41,460 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:41,463 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:41,466 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:41,468 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:41,471 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:41,473 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:41,476 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:41,479 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:41,482 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:41,484 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:41,488 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:41,490 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:41,493 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:41,499 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:41,503 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:41,503 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:41,508 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:41,508 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:41,512 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:41,512 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:41,516 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:41,516 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:41,520 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:41,520 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:41,524 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:41,524 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:41,528 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:41,528 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:41,528 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:41,532 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:41,532 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:41,533 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:41,537 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:41,542 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:41,542 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:41,542 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:41,542 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:41,542 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:41,547 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:41,551 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:41,551 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:41,551 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:41,551 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,552 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:41,552 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,552 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,552 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,552 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:41,552 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,552 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:41,552 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:41,552 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:41,552 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:41,552 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:41,552 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:41,552 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:41,553 - INFO - ‚úÖ All global variables verified successfully
2025-09-20 17:24:48,322 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:48,459 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 17:24:48,459 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 17:24:48,459 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 17:24:48,587 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 17:24:48,749 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:48,765 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:48,765 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:48,780 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:48,795 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:48,804 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:48,825 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:48,830 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:48,833 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:48,836 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:48,839 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:48,841 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:48,844 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:48,847 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:48,850 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:48,853 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:48,855 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:48,859 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:48,861 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:48,864 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:48,869 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:48,874 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:48,874 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:48,878 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:48,878 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:48,882 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:48,882 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:48,886 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:48,886 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:48,890 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:48,890 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:48,895 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:48,895 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:48,899 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:48,899 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:48,899 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:48,903 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:48,903 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:48,903 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:48,908 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:48,912 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:48,912 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:48,912 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:48,912 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:48,912 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:48,916 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:48,920 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:48,921 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:48,921 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:48,921 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:48,921 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:48,921 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:48,921 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:48,921 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:48,921 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:48,921 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:48,921 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:48,921 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:48,921 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:48,921 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:48,921 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:48,921 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:48,922 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 17:24:48,925 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 17:24:48,925 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 17:24:48,925 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 17:24:49,107 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 17:24:49,122 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 17:24:49,123 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 17:24:49,135 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 17:24:49,140 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 17:24:49,143 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 17:24:49,146 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 17:24:49,149 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 17:24:49,151 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 17:24:49,154 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 17:24:49,157 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 17:24:49,160 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 17:24:49,162 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 17:24:49,165 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 17:24:49,168 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 17:24:49,171 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 17:24:49,174 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 17:24:49,179 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 17:24:49,183 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:49,183 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:49,187 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 17:24:49,187 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 17:24:49,192 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:49,192 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 17:24:49,196 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:49,196 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 17:24:49,200 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 17:24:49,200 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 17:24:49,204 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 17:24:49,204 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 17:24:49,208 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 17:24:49,209 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 17:24:49,209 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 17:24:49,213 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 17:24:49,213 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 17:24:49,213 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 17:24:49,217 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 17:24:49,221 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 17:24:49,221 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 17:24:49,221 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 17:24:49,221 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 17:24:49,221 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 17:24:49,226 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 17:24:49,229 - DEBUG - üîó Foreign keys for users: []
2025-09-20 17:24:49,230 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 17:24:49,230 - DEBUG - üîç Relationship Details:
2025-09-20 17:24:49,230 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:49,230 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 17:24:49,230 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 17:24:49,230 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 17:24:49,230 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 17:24:49,230 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 17:24:49,230 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 17:24:49,230 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 17:24:49,230 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 17:24:49,230 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 17:24:49,230 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 17:24:49,230 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 17:24:49,231 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 17:24:49,231 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 19:55:02,702 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 19:55:02,911 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 19:55:02,911 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 19:55:02,911 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 19:55:03,041 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 19:55:03,206 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 19:55:03,222 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 19:55:03,222 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 19:55:03,237 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 19:55:03,252 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 19:55:03,383 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 19:55:03,696 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 19:55:03,701 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 19:55:03,704 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 19:55:03,707 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 19:55:03,710 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 19:55:03,713 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 19:55:03,715 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 19:55:03,718 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 19:55:03,722 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 19:55:03,725 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 19:55:03,728 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 19:55:03,731 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 19:55:03,734 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 19:55:03,737 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 19:55:03,743 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 19:55:03,747 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:55:03,747 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 19:55:03,751 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 19:55:03,751 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 19:55:03,756 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:55:03,756 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 19:55:03,760 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:55:03,761 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 19:55:03,765 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:55:03,765 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 19:55:03,769 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 19:55:03,769 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 19:55:03,774 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 19:55:03,774 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 19:55:03,774 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 19:55:03,778 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 19:55:03,778 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 19:55:03,778 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 19:55:03,782 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 19:55:03,786 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 19:55:03,786 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 19:55:03,786 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 19:55:03,786 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 19:55:03,786 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 19:55:03,790 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 19:55:03,795 - DEBUG - üîó Foreign keys for users: []
2025-09-20 19:55:03,795 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 19:55:03,795 - DEBUG - üîç Relationship Details:
2025-09-20 19:55:03,795 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 19:55:03,795 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 19:55:03,795 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 19:55:03,795 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 19:55:03,795 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 19:55:03,795 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 19:55:03,795 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 19:55:03,795 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 19:55:03,795 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 19:55:03,795 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 19:55:03,795 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 19:55:03,795 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 19:55:03,795 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 19:55:03,795 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 19:55:03,797 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 19:55:03,797 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 19:55:03,797 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 19:55:03,989 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 19:55:04,005 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 19:55:04,005 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 19:55:04,025 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 19:55:04,030 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 19:55:04,033 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 19:55:04,036 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 19:55:04,039 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 19:55:04,041 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 19:55:04,043 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 19:55:04,046 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 19:55:04,049 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 19:55:04,052 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 19:55:04,054 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 19:55:04,057 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 19:55:04,060 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 19:55:04,063 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 19:55:04,068 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 19:55:04,072 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:55:04,072 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 19:55:04,076 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 19:55:04,076 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 19:55:04,080 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:55:04,080 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 19:55:04,084 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:55:04,084 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 19:55:04,088 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:55:04,088 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 19:55:04,092 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 19:55:04,092 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 19:55:04,096 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 19:55:04,096 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 19:55:04,096 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 19:55:04,100 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 19:55:04,100 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 19:55:04,100 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 19:55:04,105 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 19:55:04,109 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 19:55:04,109 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 19:55:04,109 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 19:55:04,109 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 19:55:04,109 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 19:55:04,113 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 19:55:04,117 - DEBUG - üîó Foreign keys for users: []
2025-09-20 19:55:04,117 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 19:55:04,117 - DEBUG - üîç Relationship Details:
2025-09-20 19:55:04,117 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 19:55:04,117 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 19:55:04,117 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 19:55:04,118 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 19:55:04,118 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 19:55:04,118 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 19:55:04,118 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 19:55:04,118 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 19:55:04,118 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 19:55:04,118 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 19:55:04,118 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 19:55:04,118 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 19:55:04,118 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 19:55:04,118 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 19:57:31,355 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 19:57:31,492 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 19:57:31,492 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 19:57:31,492 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 19:57:31,623 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 19:57:31,806 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 19:57:31,822 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 19:57:31,822 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 19:57:31,838 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 19:57:31,853 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 19:57:31,862 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 19:57:31,883 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 19:57:31,889 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 19:57:31,892 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 19:57:31,894 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 19:57:31,897 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 19:57:31,900 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 19:57:31,903 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 19:57:31,905 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 19:57:31,908 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 19:57:31,911 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 19:57:31,914 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 19:57:31,917 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 19:57:31,920 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 19:57:31,923 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 19:57:31,929 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 19:57:31,933 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:57:31,933 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 19:57:31,937 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 19:57:31,937 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 19:57:31,941 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:57:31,941 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 19:57:31,945 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:57:31,945 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 19:57:31,950 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:57:31,950 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 19:57:31,954 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 19:57:31,954 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 19:57:31,958 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 19:57:31,958 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 19:57:31,958 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 19:57:31,962 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 19:57:31,962 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 19:57:31,962 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 19:57:31,967 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 19:57:31,971 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 19:57:31,971 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 19:57:31,971 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 19:57:31,971 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 19:57:31,971 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 19:57:31,975 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 19:57:31,979 - DEBUG - üîó Foreign keys for users: []
2025-09-20 19:57:31,979 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 19:57:31,979 - DEBUG - üîç Relationship Details:
2025-09-20 19:57:31,979 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 19:57:31,979 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 19:57:31,979 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 19:57:31,979 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 19:57:31,979 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 19:57:31,979 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 19:57:31,979 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 19:57:31,980 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 19:57:31,980 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 19:57:31,980 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 19:57:31,980 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 19:57:31,980 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 19:57:31,980 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 19:57:31,980 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 19:57:31,982 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 19:57:31,982 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 19:57:31,982 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 19:57:32,169 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 19:57:32,184 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 19:57:32,185 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 19:57:32,198 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 19:57:32,202 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 19:57:32,205 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 19:57:32,208 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 19:57:32,211 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 19:57:32,213 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 19:57:32,216 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 19:57:32,219 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 19:57:32,222 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 19:57:32,224 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 19:57:32,227 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 19:57:32,230 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 19:57:32,233 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 19:57:32,236 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 19:57:32,241 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 19:57:32,246 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:57:32,246 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 19:57:32,250 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 19:57:32,250 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 19:57:32,254 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:57:32,254 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 19:57:32,258 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:57:32,258 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 19:57:32,262 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 19:57:32,262 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 19:57:32,266 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 19:57:32,266 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 19:57:32,271 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 19:57:32,271 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 19:57:32,271 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 19:57:32,275 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 19:57:32,275 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 19:57:32,275 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 19:57:32,280 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 19:57:32,284 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 19:57:32,284 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 19:57:32,284 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 19:57:32,284 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 19:57:32,284 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 19:57:32,289 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 19:57:32,293 - DEBUG - üîó Foreign keys for users: []
2025-09-20 19:57:32,293 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 19:57:32,293 - DEBUG - üîç Relationship Details:
2025-09-20 19:57:32,293 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 19:57:32,293 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 19:57:32,293 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 19:57:32,293 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 19:57:32,293 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 19:57:32,293 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 19:57:32,293 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 19:57:32,293 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 19:57:32,293 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 19:57:32,293 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 19:57:32,293 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 19:57:32,293 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 19:57:32,294 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 19:57:32,294 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 19:57:35,360 - INFO - Database engine created with pool_size=10
2025-09-20 19:57:43,640 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 19:57:43,656 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 20:36:45,905 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 20:36:46,042 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 20:36:46,043 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 20:36:46,043 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 20:36:46,172 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 20:36:46,337 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:36:46,353 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 20:36:46,353 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:36:46,368 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:36:46,384 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 20:36:46,416 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 20:36:46,619 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 20:36:46,625 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 20:36:46,628 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 20:36:46,631 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 20:36:46,634 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 20:36:46,637 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 20:36:46,640 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 20:36:46,643 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 20:36:46,646 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 20:36:46,649 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 20:36:46,652 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 20:36:46,655 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 20:36:46,658 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 20:36:46,661 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 20:36:46,667 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 20:36:46,671 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:36:46,672 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 20:36:46,676 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 20:36:46,676 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 20:36:46,680 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:36:46,681 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 20:36:46,685 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:36:46,685 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 20:36:46,689 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:36:46,689 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 20:36:46,693 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 20:36:46,693 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 20:36:46,698 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 20:36:46,698 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 20:36:46,698 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 20:36:46,702 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 20:36:46,702 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 20:36:46,702 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 20:36:46,706 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 20:36:46,710 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 20:36:46,711 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 20:36:46,711 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 20:36:46,711 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 20:36:46,711 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 20:36:46,715 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 20:36:46,719 - DEBUG - üîó Foreign keys for users: []
2025-09-20 20:36:46,719 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 20:36:46,719 - DEBUG - üîç Relationship Details:
2025-09-20 20:36:46,720 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:36:46,720 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 20:36:46,720 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:36:46,720 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 20:36:46,720 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 20:36:46,720 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 20:36:46,720 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 20:36:46,720 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 20:36:46,720 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 20:36:46,720 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 20:36:46,720 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 20:36:46,720 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 20:36:46,720 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 20:36:46,720 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 20:36:46,723 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 20:36:46,723 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 20:36:46,724 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 20:36:46,915 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:36:46,930 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 20:36:46,931 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 20:36:46,943 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 20:36:46,948 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 20:36:46,951 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 20:36:46,954 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 20:36:46,956 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 20:36:46,959 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 20:36:46,962 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 20:36:46,964 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 20:36:46,968 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 20:36:46,970 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 20:36:46,973 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 20:36:46,976 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 20:36:46,978 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 20:36:46,981 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 20:36:46,987 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 20:36:46,991 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:36:46,991 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 20:36:46,995 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 20:36:46,995 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 20:36:46,999 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:36:46,999 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 20:36:47,003 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:36:47,003 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 20:36:47,007 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:36:47,007 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 20:36:47,011 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 20:36:47,011 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 20:36:47,015 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 20:36:47,015 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 20:36:47,016 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 20:36:47,019 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 20:36:47,020 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 20:36:47,020 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 20:36:47,024 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 20:36:47,028 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 20:36:47,028 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 20:36:47,028 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 20:36:47,028 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 20:36:47,028 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 20:36:47,032 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 20:36:47,037 - DEBUG - üîó Foreign keys for users: []
2025-09-20 20:36:47,037 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 20:36:47,037 - DEBUG - üîç Relationship Details:
2025-09-20 20:36:47,037 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:36:47,037 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 20:36:47,037 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:36:47,037 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 20:36:47,037 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 20:36:47,037 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 20:36:47,037 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 20:36:47,037 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 20:36:47,037 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 20:36:47,037 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 20:36:47,038 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 20:36:47,038 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 20:36:47,038 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 20:36:47,038 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 20:36:53,489 - INFO - Database engine created with pool_size=10
2025-09-20 20:37:09,138 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:37:09,155 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 20:37:54,931 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:37:54,947 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 20:44:28,603 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 20:44:28,739 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 20:44:28,739 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 20:44:28,739 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 20:44:28,874 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 20:44:29,036 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:44:29,052 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 20:44:29,052 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:44:29,067 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:44:29,082 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 20:44:29,091 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 20:44:29,136 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 20:44:29,142 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 20:44:29,144 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 20:44:29,147 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 20:44:29,150 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 20:44:29,153 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 20:44:29,156 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 20:44:29,158 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 20:44:29,161 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 20:44:29,164 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 20:44:29,167 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 20:44:29,170 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 20:44:29,173 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 20:44:29,176 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 20:44:29,181 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 20:44:29,186 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:44:29,186 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 20:44:29,190 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 20:44:29,190 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 20:44:29,194 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:44:29,194 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 20:44:29,198 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:44:29,198 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 20:44:29,202 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:44:29,202 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 20:44:29,206 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 20:44:29,206 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 20:44:29,210 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 20:44:29,210 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 20:44:29,210 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 20:44:29,214 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 20:44:29,214 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 20:44:29,214 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 20:44:29,218 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 20:44:29,223 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 20:44:29,223 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 20:44:29,223 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 20:44:29,223 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 20:44:29,223 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 20:44:29,227 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 20:44:29,231 - DEBUG - üîó Foreign keys for users: []
2025-09-20 20:44:29,231 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 20:44:29,231 - DEBUG - üîç Relationship Details:
2025-09-20 20:44:29,231 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,231 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 20:44:29,231 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,231 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,231 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,231 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 20:44:29,232 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,232 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 20:44:29,232 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,232 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 20:44:29,232 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 20:44:29,232 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 20:44:29,232 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 20:44:29,232 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 20:44:29,234 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 20:44:29,234 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 20:44:29,234 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 20:44:29,416 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:44:29,431 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 20:44:29,431 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 20:44:29,444 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 20:44:29,449 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 20:44:29,452 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 20:44:29,455 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 20:44:29,458 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 20:44:29,460 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 20:44:29,463 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 20:44:29,466 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 20:44:29,468 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 20:44:29,471 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 20:44:29,474 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 20:44:29,477 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 20:44:29,479 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 20:44:29,482 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 20:44:29,488 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 20:44:29,492 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:44:29,492 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 20:44:29,496 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 20:44:29,496 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 20:44:29,500 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:44:29,500 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 20:44:29,504 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:44:29,504 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 20:44:29,508 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:44:29,508 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 20:44:29,513 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 20:44:29,513 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 20:44:29,517 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 20:44:29,517 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 20:44:29,517 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 20:44:29,521 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 20:44:29,521 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 20:44:29,522 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 20:44:29,526 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 20:44:29,530 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 20:44:29,530 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 20:44:29,530 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 20:44:29,530 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 20:44:29,530 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 20:44:29,534 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 20:44:29,538 - DEBUG - üîó Foreign keys for users: []
2025-09-20 20:44:29,539 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 20:44:29,539 - DEBUG - üîç Relationship Details:
2025-09-20 20:44:29,539 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,539 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 20:44:29,539 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,539 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,539 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,539 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 20:44:29,539 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,539 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 20:44:29,539 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 20:44:29,540 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 20:44:29,540 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 20:44:29,540 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 20:44:29,540 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 20:44:29,540 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 20:45:06,757 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:45:06,773 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 20:55:35,484 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 20:55:35,895 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 20:55:35,895 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 20:55:35,896 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 20:55:36,197 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 20:55:36,512 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:55:36,584 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 20:55:36,584 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:55:36,656 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:55:36,726 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 20:55:36,746 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 20:55:36,771 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 20:55:36,782 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 20:55:36,786 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 20:55:36,790 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 20:55:36,793 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 20:55:36,797 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 20:55:36,801 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 20:55:36,805 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 20:55:36,809 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 20:55:36,813 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 20:55:36,817 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 20:55:36,821 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 20:55:36,825 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 20:55:36,829 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 20:55:36,837 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 20:55:36,842 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:55:36,842 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 20:55:36,847 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 20:55:36,847 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 20:55:36,852 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:55:36,852 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 20:55:36,856 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:55:36,857 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 20:55:36,862 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:55:36,862 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 20:55:36,867 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 20:55:36,867 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 20:55:36,872 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 20:55:36,872 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 20:55:36,873 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 20:55:36,878 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 20:55:36,878 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 20:55:36,878 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 20:55:36,883 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 20:55:36,888 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 20:55:36,889 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 20:55:36,889 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 20:55:36,889 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 20:55:36,889 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 20:55:36,894 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 20:55:36,899 - DEBUG - üîó Foreign keys for users: []
2025-09-20 20:55:36,899 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 20:55:36,900 - DEBUG - üîç Relationship Details:
2025-09-20 20:55:36,900 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:55:36,900 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 20:55:36,900 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:55:36,901 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 20:55:36,901 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 20:55:36,901 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 20:55:36,901 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 20:55:36,901 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 20:55:36,901 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 20:55:36,902 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 20:55:36,902 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 20:55:36,902 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 20:55:36,902 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 20:55:36,902 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 20:55:36,905 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 20:55:36,905 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 20:55:36,905 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 20:55:59,052 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 20:55:59,129 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 20:55:59,130 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 20:55:59,143 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 20:55:59,151 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 20:55:59,155 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 20:55:59,159 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 20:55:59,163 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 20:55:59,167 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 20:55:59,171 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 20:55:59,175 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 20:55:59,179 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 20:55:59,183 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 20:55:59,187 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 20:55:59,191 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 20:55:59,195 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 20:55:59,200 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 20:55:59,207 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 20:55:59,212 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:55:59,212 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 20:55:59,217 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 20:55:59,217 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 20:55:59,222 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:55:59,222 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 20:55:59,227 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:55:59,227 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 20:55:59,232 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 20:55:59,232 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 20:55:59,237 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 20:55:59,237 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 20:55:59,242 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 20:55:59,243 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 20:55:59,243 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 20:55:59,248 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 20:55:59,248 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 20:55:59,248 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 20:55:59,253 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 20:55:59,258 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 20:55:59,259 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 20:55:59,259 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 20:55:59,259 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 20:55:59,259 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 20:55:59,265 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 20:55:59,270 - DEBUG - üîó Foreign keys for users: []
2025-09-20 20:55:59,270 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 20:55:59,271 - DEBUG - üîç Relationship Details:
2025-09-20 20:55:59,271 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:55:59,271 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 20:55:59,271 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 20:55:59,272 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 20:55:59,272 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 20:55:59,272 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 20:55:59,272 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 20:55:59,272 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 20:55:59,272 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 20:55:59,273 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 20:55:59,273 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 20:55:59,273 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 20:55:59,273 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 20:55:59,273 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 21:18:03,585 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:18:03,655 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 21:18:34,817 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:18:34,890 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 21:18:50,996 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:18:51,069 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 21:19:23,777 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:19:23,854 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 21:23:12,150 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 21:23:12,541 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 21:23:12,542 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 21:23:12,542 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 21:23:12,832 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 21:23:13,137 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:23:13,208 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 21:23:13,208 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:23:13,277 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:23:13,346 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 21:23:13,366 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 21:23:13,392 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 21:23:13,403 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 21:23:13,407 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 21:23:13,411 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 21:23:13,414 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 21:23:13,418 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 21:23:13,422 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 21:23:13,426 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 21:23:13,430 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 21:23:13,434 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 21:23:13,438 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 21:23:13,442 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 21:23:13,446 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 21:23:13,450 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 21:23:13,458 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 21:23:13,463 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:13,463 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 21:23:13,468 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 21:23:13,468 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 21:23:13,473 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:13,473 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 21:23:13,478 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:13,478 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 21:23:13,483 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:13,483 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 21:23:13,488 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 21:23:13,488 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 21:23:13,492 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 21:23:13,493 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 21:23:13,493 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 21:23:13,498 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 21:23:13,498 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 21:23:13,498 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 21:23:13,504 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 21:23:13,509 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 21:23:13,509 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 21:23:13,509 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 21:23:13,510 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 21:23:13,510 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 21:23:13,515 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 21:23:13,520 - DEBUG - üîó Foreign keys for users: []
2025-09-20 21:23:13,520 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 21:23:13,521 - DEBUG - üîç Relationship Details:
2025-09-20 21:23:13,521 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 21:23:13,521 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 21:23:13,521 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 21:23:13,522 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 21:23:13,522 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 21:23:13,522 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 21:23:13,522 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 21:23:13,522 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 21:23:13,523 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 21:23:13,523 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 21:23:13,523 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 21:23:13,523 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 21:23:13,524 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 21:23:13,524 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 21:23:13,526 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 21:23:13,526 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 21:23:13,527 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 21:23:13,878 - ERROR - ‚úó Import failed - ImportError: No module named 'mcp.llm_service'
2025-09-20 21:23:13,968 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:23:14,047 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 21:23:14,047 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 21:23:14,061 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 21:23:14,069 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 21:23:14,073 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 21:23:14,077 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 21:23:14,081 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 21:23:14,085 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 21:23:14,089 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 21:23:14,093 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 21:23:14,097 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 21:23:14,101 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 21:23:14,105 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 21:23:14,109 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 21:23:14,113 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 21:23:14,117 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 21:23:14,125 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 21:23:14,129 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:14,130 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 21:23:14,134 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 21:23:14,135 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 21:23:14,139 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:14,139 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 21:23:14,144 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:14,144 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 21:23:14,149 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:14,149 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 21:23:14,154 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 21:23:14,154 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 21:23:14,159 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 21:23:14,159 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 21:23:14,160 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 21:23:14,165 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 21:23:14,165 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 21:23:14,165 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 21:23:14,170 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 21:23:14,175 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 21:23:14,176 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 21:23:14,176 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 21:23:14,176 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 21:23:14,176 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 21:23:14,181 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 21:23:14,187 - DEBUG - üîó Foreign keys for users: []
2025-09-20 21:23:14,187 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 21:23:14,187 - DEBUG - üîç Relationship Details:
2025-09-20 21:23:14,187 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 21:23:14,187 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 21:23:14,188 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 21:23:14,188 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 21:23:14,188 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 21:23:14,188 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 21:23:14,188 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 21:23:14,189 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 21:23:14,189 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 21:23:14,189 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 21:23:14,189 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 21:23:14,189 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 21:23:14,190 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 21:23:14,190 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 21:23:37,548 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 21:23:37,938 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-20 21:23:37,938 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-20 21:23:37,938 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-20 21:23:38,228 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-20 21:23:38,534 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:23:38,605 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 21:23:38,605 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:23:38,675 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:23:38,744 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 21:23:38,764 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 21:23:38,789 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 21:23:38,800 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 21:23:38,804 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 21:23:38,808 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 21:23:38,811 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 21:23:38,816 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 21:23:38,820 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 21:23:38,825 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 21:23:38,830 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 21:23:38,834 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 21:23:38,838 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 21:23:38,842 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 21:23:38,846 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 21:23:38,850 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 21:23:38,857 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 21:23:38,862 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:38,862 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 21:23:38,867 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 21:23:38,868 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 21:23:38,873 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:38,873 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 21:23:38,878 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:38,878 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 21:23:38,883 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:38,883 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 21:23:38,888 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 21:23:38,888 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 21:23:38,893 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 21:23:38,893 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 21:23:38,893 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 21:23:38,898 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 21:23:38,898 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 21:23:38,898 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 21:23:38,903 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 21:23:38,909 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 21:23:38,909 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 21:23:38,909 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 21:23:38,910 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 21:23:38,910 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 21:23:38,915 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 21:23:38,920 - DEBUG - üîó Foreign keys for users: []
2025-09-20 21:23:38,920 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 21:23:38,920 - DEBUG - üîç Relationship Details:
2025-09-20 21:23:38,920 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 21:23:38,921 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 21:23:38,921 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 21:23:38,921 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 21:23:38,921 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 21:23:38,921 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 21:23:38,922 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 21:23:38,922 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 21:23:38,922 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 21:23:38,922 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 21:23:38,922 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 21:23:38,922 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 21:23:38,923 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 21:23:38,923 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 21:23:38,925 - INFO - üìå Loaded conversation memory from disk.
2025-09-20 21:23:38,925 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-20 21:23:38,926 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-20 21:23:39,274 - ERROR - ‚úó Import failed - ImportError: No module named 'mcp.llm_service'
2025-09-20 21:23:39,362 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:23:39,437 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-20 21:23:39,438 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-20 21:23:39,451 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-20 21:23:39,459 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-20 21:23:39,463 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-20 21:23:39,467 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-20 21:23:39,471 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-20 21:23:39,475 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-20 21:23:39,479 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-20 21:23:39,483 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-20 21:23:39,487 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-20 21:23:39,492 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-20 21:23:39,496 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-20 21:23:39,500 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-20 21:23:39,504 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-20 21:23:39,508 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-20 21:23:39,516 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-20 21:23:39,521 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:39,521 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-20 21:23:39,526 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-20 21:23:39,526 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-20 21:23:39,531 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:39,531 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-20 21:23:39,536 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:39,536 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-20 21:23:39,541 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-20 21:23:39,541 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-20 21:23:39,546 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-20 21:23:39,547 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-20 21:23:39,551 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-20 21:23:39,552 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-20 21:23:39,552 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-20 21:23:39,557 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-20 21:23:39,557 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-20 21:23:39,557 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-20 21:23:39,562 - DEBUG - üîó Foreign keys for ships: []
2025-09-20 21:23:39,568 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-20 21:23:39,568 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-20 21:23:39,568 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-20 21:23:39,568 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-20 21:23:39,569 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-20 21:23:39,574 - DEBUG - üîó Foreign keys for systems: []
2025-09-20 21:23:39,579 - DEBUG - üîó Foreign keys for users: []
2025-09-20 21:23:39,579 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-20 21:23:39,579 - DEBUG - üîç Relationship Details:
2025-09-20 21:23:39,580 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-20 21:23:39,580 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-20 21:23:39,580 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-20 21:23:39,580 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-20 21:23:39,581 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-20 21:23:39,581 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-20 21:23:39,581 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-20 21:23:39,581 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-20 21:23:39,581 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-20 21:23:39,581 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-20 21:23:39,582 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-20 21:23:39,582 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-20 21:23:39,582 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-20 21:23:39,582 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-20 21:23:48,017 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-20 21:23:48,089 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-20 21:23:48,092 - INFO - üì® Received chat request: what is the reliability of gt 1 on ins two and ins...
2025-09-20 21:23:48,092 - ERROR - Previous initialization failed: Import error: No module named 'mcp.llm_service'
2025-09-21 00:28:26,885 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-21 00:28:27,303 - DEBUG - loaded lazy attr 'SafeConfigParser': <class 'configparser.ConfigParser'>
2025-09-21 00:28:27,304 - DEBUG - loaded lazy attr 'NativeStringIO': <class '_io.StringIO'>
2025-09-21 00:28:27,304 - DEBUG - loaded lazy attr 'BytesIO': <class '_io.BytesIO'>
2025-09-21 00:28:27,608 - DEBUG - registered 'bcrypt' handler: <class 'passlib.handlers.bcrypt.bcrypt'>
2025-09-21 00:28:27,923 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-21 00:28:28,002 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-21 00:28:28,002 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-21 00:28:28,081 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-21 00:28:28,157 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-21 00:28:28,177 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-21 00:28:28,392 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-21 00:28:28,404 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-21 00:28:28,409 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-21 00:28:28,413 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-21 00:28:28,418 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-21 00:28:28,422 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-21 00:28:28,426 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-21 00:28:28,431 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-21 00:28:28,436 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-21 00:28:28,441 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-21 00:28:28,445 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-21 00:28:28,450 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-21 00:28:28,454 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-21 00:28:28,459 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-21 00:28:28,468 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-21 00:28:28,473 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-21 00:28:28,473 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-21 00:28:28,479 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-21 00:28:28,479 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-21 00:28:28,484 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-21 00:28:28,485 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-21 00:28:28,491 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-21 00:28:28,491 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-21 00:28:28,496 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-21 00:28:28,496 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-21 00:28:28,501 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-21 00:28:28,501 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-21 00:28:28,506 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-21 00:28:28,506 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-21 00:28:28,506 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-21 00:28:28,511 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-21 00:28:28,511 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-21 00:28:28,511 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-21 00:28:28,517 - DEBUG - üîó Foreign keys for ships: []
2025-09-21 00:28:28,521 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-21 00:28:28,522 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-21 00:28:28,522 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-21 00:28:28,522 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-21 00:28:28,522 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-21 00:28:28,527 - DEBUG - üîó Foreign keys for systems: []
2025-09-21 00:28:28,533 - DEBUG - üîó Foreign keys for users: []
2025-09-21 00:28:28,533 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-21 00:28:28,533 - DEBUG - üîç Relationship Details:
2025-09-21 00:28:28,533 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-21 00:28:28,534 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-21 00:28:28,534 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-21 00:28:28,534 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-21 00:28:28,534 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-21 00:28:28,535 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-21 00:28:28,535 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-21 00:28:28,535 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-21 00:28:28,535 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-21 00:28:28,535 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-21 00:28:28,536 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-21 00:28:28,536 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-21 00:28:28,536 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-21 00:28:28,536 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-21 00:28:28,539 - INFO - üìå Loaded conversation memory from disk.
2025-09-21 00:28:28,539 - INFO - üìå Initialized memory: Last 5 exchanges
2025-09-21 00:28:28,540 - INFO - üìå Logging initialized. Logs will be saved in 'logs/application.log'
2025-09-21 00:28:28,567 - INFO - ‚úÖ Added backend directory to Python path: /home/user/IITB/netra/backend
2025-09-21 00:28:29,304 - INFO - ‚úÖ Successfully imported LLMService!
2025-09-21 00:28:29,398 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-21 00:28:29,480 - INFO - Initializing LLMClient with Ollama model: codellama:7b-instruct
2025-09-21 00:28:29,481 - INFO - ‚úÖ Database engine created with URL: mssql+pyodbc://sa:Camlab110@localhost:1433/NetraKoshx?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes&timeout=300
2025-09-21 00:28:29,495 - INFO - üîç Found tables: ['alembic_version', 'alphabeta', 'departments', 'etabeta', 'failure_modes', 'monthly_utilization', 'refresh_tokens', 'sensor_metadata', 'sensor_readings', 'ships', 'system_configuration', 'systems', 'users']
2025-09-21 00:28:29,503 - DEBUG - üìä Table alembic_version columns: ['version_num']
2025-09-21 00:28:29,507 - DEBUG - üìä Table alphabeta columns: ['id', 'alpha', 'beta', 'component_id']
2025-09-21 00:28:29,511 - DEBUG - üìä Table departments columns: ['ship_id', 'department_name', 'department_code', 'department_id', 'created_date', 'modified_date']
2025-09-21 00:28:29,515 - DEBUG - üìä Table etabeta columns: ['id', 'eta', 'beta', 'component_id', 'priority']
2025-09-21 00:28:29,519 - DEBUG - üìä Table failure_modes columns: ['name', 'severity', 'component_id', 'failure_mode_id']
2025-09-21 00:28:29,523 - DEBUG - üìä Table monthly_utilization columns: ['id', 'operation_date', 'utlization', 'component_id']
2025-09-21 00:28:29,527 - DEBUG - üìä Table refresh_tokens columns: ['id', 'token', 'user_id', 'expires_at', 'created_at', 'is_revoked']
2025-09-21 00:28:29,531 - DEBUG - üìä Table sensor_metadata columns: ['sensor_name', 'unit', 'min_value', 'max_value', 'frequency', 'P', 'F', 'component_id', 'sensor_id', 'failure_mode_id']
2025-09-21 00:28:29,536 - DEBUG - üìä Table sensor_readings columns: ['value', 'operating_hours', 'alert', 'id', 'date', 'component_id', 'sensor_id']
2025-09-21 00:28:29,540 - DEBUG - üìä Table ships columns: ['ship_name', 'ship_category', 'ship_class', 'command', 'ship_id', 'created_date', 'modified_date']
2025-09-21 00:28:29,545 - DEBUG - üìä Table system_configuration columns: ['component_name', 'parent_id', 'department_id', 'CMMS_EquipmentCode', 'is_lmu', 'parent_name', 'nomenclature', 'etl', 'component_id', 'created_date', 'modified_date', 'ship_id', 'system_id']
2025-09-21 00:28:29,549 - DEBUG - üìä Table systems columns: ['system_id', 'system_type', 'created_date']
2025-09-21 00:28:29,553 - DEBUG - üìä Table users columns: ['email', 'username', 'full_name', 'role', 'is_active', 'id', 'hashed_password', 'created_at', 'updated_at', 'last_login']
2025-09-21 00:28:29,561 - DEBUG - üîó Foreign keys for alembic_version: []
2025-09-21 00:28:29,566 - DEBUG - üîó Foreign keys for alphabeta: [{'name': 'FK__alphabeta__compo__3E1D39E1', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-21 00:28:29,566 - DEBUG - üîó Added relationship: alphabeta.component_id -> system_configuration.component_id
2025-09-21 00:28:29,571 - DEBUG - üîó Foreign keys for departments: [{'name': 'FK__departmen__ship___47DBAE45', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}]
2025-09-21 00:28:29,571 - DEBUG - üîó Added relationship: departments.ship_id -> ships.ship_id
2025-09-21 00:28:29,576 - DEBUG - üîó Foreign keys for etabeta: [{'name': 'FK__etabeta__compone__40F9A68C', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-21 00:28:29,576 - DEBUG - üîó Added relationship: etabeta.component_id -> system_configuration.component_id
2025-09-21 00:28:29,581 - DEBUG - üîó Foreign keys for failure_modes: [{'name': 'FK__failure_m__compo__37703C52', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-21 00:28:29,582 - DEBUG - üîó Added relationship: failure_modes.component_id -> system_configuration.component_id
2025-09-21 00:28:29,586 - DEBUG - üîó Foreign keys for monthly_utilization: [{'name': 'FK__monthly_u__compo__2EDAF651', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}]
2025-09-21 00:28:29,587 - DEBUG - üîó Added relationship: monthly_utilization.component_id -> system_configuration.component_id
2025-09-21 00:28:29,592 - DEBUG - üîó Foreign keys for refresh_tokens: [{'name': 'FK__refresh_t__user___49C3F6B7', 'constrained_columns': ['user_id'], 'referred_schema': None, 'referred_table': 'users', 'referred_columns': ['id'], 'options': {}}]
2025-09-21 00:28:29,592 - DEBUG - üîó Added relationship: refresh_tokens.user_id -> users.id
2025-09-21 00:28:29,597 - DEBUG - üîó Foreign keys for sensor_metadata: [{'name': 'FK__sensor_me__compo__31B762FC', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_me__failu__32AB8735', 'constrained_columns': ['failure_mode_id'], 'referred_schema': None, 'referred_table': 'failure_modes', 'referred_columns': ['failure_mode_id'], 'options': {}}]
2025-09-21 00:28:29,597 - DEBUG - üîó Added relationship: sensor_metadata.component_id -> system_configuration.component_id
2025-09-21 00:28:29,598 - DEBUG - üîó Added relationship: sensor_metadata.failure_mode_id -> failure_modes.failure_mode_id
2025-09-21 00:28:29,603 - DEBUG - üîó Foreign keys for sensor_readings: [{'name': 'FK__sensor_re__compo__3587F3E0', 'constrained_columns': ['component_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__sensor_re__senso__367C1819', 'constrained_columns': ['sensor_id'], 'referred_schema': None, 'referred_table': 'sensor_metadata', 'referred_columns': ['sensor_id'], 'options': {}}]
2025-09-21 00:28:29,603 - DEBUG - üîó Added relationship: sensor_readings.component_id -> system_configuration.component_id
2025-09-21 00:28:29,603 - DEBUG - üîó Added relationship: sensor_readings.sensor_id -> sensor_metadata.sensor_id
2025-09-21 00:28:29,609 - DEBUG - üîó Foreign keys for ships: []
2025-09-21 00:28:29,614 - DEBUG - üîó Foreign keys for system_configuration: [{'name': 'FK__system_co__depar__4BAC3F29', 'constrained_columns': ['department_id'], 'referred_schema': None, 'referred_table': 'departments', 'referred_columns': ['department_id'], 'options': {}}, {'name': 'FK__system_co__paren__4CA06362', 'constrained_columns': ['parent_id'], 'referred_schema': None, 'referred_table': 'system_configuration', 'referred_columns': ['component_id'], 'options': {}}, {'name': 'FK__system_co__ship___3864608B', 'constrained_columns': ['ship_id'], 'referred_schema': None, 'referred_table': 'ships', 'referred_columns': ['ship_id'], 'options': {}}, {'name': 'FK__system_co__syste__47A6A41B', 'constrained_columns': ['system_id'], 'referred_schema': None, 'referred_table': 'systems', 'referred_columns': ['system_id'], 'options': {}}]
2025-09-21 00:28:29,614 - DEBUG - üîó Added relationship: system_configuration.department_id -> departments.department_id
2025-09-21 00:28:29,614 - DEBUG - üîó Added relationship: system_configuration.parent_id -> system_configuration.component_id
2025-09-21 00:28:29,615 - DEBUG - üîó Added relationship: system_configuration.ship_id -> ships.ship_id
2025-09-21 00:28:29,615 - DEBUG - üîó Added relationship: system_configuration.system_id -> systems.system_id
2025-09-21 00:28:29,621 - DEBUG - üîó Foreign keys for systems: []
2025-09-21 00:28:29,627 - DEBUG - üîó Foreign keys for users: []
2025-09-21 00:28:29,627 - INFO - ‚úÖ Schema loading complete. Found 13 tables and 14 relationships
2025-09-21 00:28:29,627 - DEBUG - üîç Relationship Details:
2025-09-21 00:28:29,627 - DEBUG -   ('alphabeta', 'system_configuration') -> ('alphabeta.component_id', 'system_configuration.component_id')
2025-09-21 00:28:29,628 - DEBUG -   ('departments', 'ships') -> ('departments.ship_id', 'ships.ship_id')
2025-09-21 00:28:29,628 - DEBUG -   ('etabeta', 'system_configuration') -> ('etabeta.component_id', 'system_configuration.component_id')
2025-09-21 00:28:29,628 - DEBUG -   ('failure_modes', 'system_configuration') -> ('failure_modes.component_id', 'system_configuration.component_id')
2025-09-21 00:28:29,629 - DEBUG -   ('monthly_utilization', 'system_configuration') -> ('monthly_utilization.component_id', 'system_configuration.component_id')
2025-09-21 00:28:29,629 - DEBUG -   ('refresh_tokens', 'users') -> ('refresh_tokens.user_id', 'users.id')
2025-09-21 00:28:29,629 - DEBUG -   ('sensor_metadata', 'system_configuration') -> ('sensor_metadata.component_id', 'system_configuration.component_id')
2025-09-21 00:28:29,629 - DEBUG -   ('sensor_metadata', 'failure_modes') -> ('sensor_metadata.failure_mode_id', 'failure_modes.failure_mode_id')
2025-09-21 00:28:29,630 - DEBUG -   ('sensor_readings', 'system_configuration') -> ('sensor_readings.component_id', 'system_configuration.component_id')
2025-09-21 00:28:29,630 - DEBUG -   ('sensor_readings', 'sensor_metadata') -> ('sensor_readings.sensor_id', 'sensor_metadata.sensor_id')
2025-09-21 00:28:29,630 - DEBUG -   ('system_configuration', 'departments') -> ('system_configuration.department_id', 'departments.department_id')
2025-09-21 00:28:29,631 - DEBUG -   ('system_configuration', 'system_configuration') -> ('system_configuration.parent_id', 'system_configuration.component_id')
2025-09-21 00:28:29,631 - DEBUG -   ('system_configuration', 'ships') -> ('system_configuration.ship_id', 'ships.ship_id')
2025-09-21 00:28:29,631 - DEBUG -   ('system_configuration', 'systems') -> ('system_configuration.system_id', 'systems.system_id')
2025-09-21 00:29:41,590 - INFO - Loading configuration from: /home/user/IITB/netra/backend/utils/config.yaml
2025-09-21 00:29:41,671 - INFO - üìå User authenticated: {'role': 'Admin/ INSMA', 'user_id': 'f47ac10b-58cc-4372-a567-0e02b2c3d479', 'username': 'jake'}
2025-09-21 00:29:41,674 - INFO - üì® Chat request: what is the reliability of gt 1 on ins two and ins...
2025-09-21 00:29:41,674 - INFO - üöÄ Creating LLMService instance...
2025-09-21 00:29:41,674 - INFO - ‚úÖ LLMService instance created successfully!
2025-09-21 00:29:41,675 - INFO - ‚úÖ Got LLM service
2025-09-21 00:30:04,000 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=5.0 socket_options=None
2025-09-21 00:30:04,005 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7471a0b4d090>
2025-09-21 00:30:04,006 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-09-21 00:30:04,007 - DEBUG - send_request_headers.complete
2025-09-21 00:30:04,007 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-09-21 00:30:04,008 - DEBUG - send_request_body.complete
2025-09-21 00:30:04,008 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-09-21 00:30:04,009 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Sat, 20 Sep 2025 19:00:04 GMT'), (b'Content-Length', b'1373')])
2025-09-21 00:30:04,010 - INFO - HTTP Request: GET http://localhost:11434/api/tags "HTTP/1.1 200 OK"
2025-09-21 00:30:04,010 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-09-21 00:30:04,011 - DEBUG - receive_response_body.complete
2025-09-21 00:30:04,011 - DEBUG - response_closed.started
2025-09-21 00:30:04,011 - DEBUG - response_closed.complete
2025-09-21 00:30:04,012 - DEBUG - close.started
2025-09-21 00:30:04,012 - DEBUG - close.complete
2025-09-21 00:30:04,014 - INFO - Database engine created with pool_size=10
2025-09-21 00:30:05,612 - DEBUG - connect_tcp.started host='localhost' port=11434 local_address=None timeout=60.0 socket_options=None
2025-09-21 00:30:05,614 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x7471a0940850>
2025-09-21 00:30:05,615 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-09-21 00:30:05,615 - DEBUG - send_request_headers.complete
2025-09-21 00:30:05,616 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-09-21 00:30:05,616 - DEBUG - send_request_body.complete
2025-09-21 00:30:05,616 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-09-21 00:30:08,645 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=utf-8'), (b'Date', b'Sat, 20 Sep 2025 19:00:08 GMT'), (b'Content-Length', b'550')])
2025-09-21 00:30:08,646 - INFO - HTTP Request: POST http://localhost:11434/api/chat "HTTP/1.1 200 OK"
2025-09-21 00:30:08,646 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-09-21 00:30:08,646 - DEBUG - receive_response_body.complete
2025-09-21 00:30:08,646 - DEBUG - response_closed.started
2025-09-21 00:30:08,647 - DEBUG - response_closed.complete
2025-09-21 00:30:08,647 - DEBUG - close.started
2025-09-21 00:30:08,648 - DEBUG - close.complete
2025-09-21 00:30:08,804 - INFO - ‚úÖ Got result from LLM service
